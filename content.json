{"meta":{"title":"simonå°ğŸ“šåŠ","subtitle":"è„šè¸å®åœ°,ä»°æœ›æ˜Ÿç©º","description":"å—¨, æˆ‘æ˜¯simon","author":"Mr.Simon","url":"https://github.com/icoderRo"},"pages":[{"title":"tags","date":"2016-10-07T12:07:13.000Z","updated":"2016-10-07T10:07:23.000Z","comments":false,"path":"tags/index.html","permalink":"https://github.com/icoderRo/tags/index.html","excerpt":"","text":""},{"title":"categories","date":"2016-10-07T12:07:13.000Z","updated":"2016-10-07T10:10:26.000Z","comments":false,"path":"categories/index.html","permalink":"https://github.com/icoderRo/categories/index.html","excerpt":"","text":""}],"posts":[{"title":"æ¼«è°ˆiOS Appæ¶æ„ MVâ€œXâ€","slug":"æ¼«è°ˆiOS App MVXæ¶æ„ ","date":"2017-03-14T16:00:00.000Z","updated":"2017-08-27T10:15:05.000Z","comments":true,"path":"2017/03/15/æ¼«è°ˆiOS App MVXæ¶æ„ /","link":"","permalink":"https://github.com/icoderRo/2017/03/15/æ¼«è°ˆiOS App MVXæ¶æ„ /","excerpt":"å‰è¨€å½“æˆ‘ä»¬åœ¨å¼€å‘iOSåº”ç”¨ç¨‹åºçš„æ—¶å€™, éšç€ä¸šåŠ¡çš„ä¸æ–­æ·»åŠ , å¯¹åº”ä»£ç æ¨¡å—ä¹‹é—´çš„å¤æ‚åº¦ä¸è€¦åˆä¹Ÿéšä¹‹çš„å¢åŠ , ä¸æ–­çš„æå‡ç€å¼€å‘çš„å¤æ‚åº¦ä¸ç»´æŠ¤çš„é«˜æˆæœ¬, ä¸ºäº†èƒ½æé«˜å¼€å‘å’Œç»´æŠ¤çš„æ•ˆç‡, ç”šè‡³äºæ˜¯æµ‹è¯•çš„æ•ˆç‡, è®¾è®¡ç¬¦åˆå½“å‰ä¸šåŠ¡æ¨¡å¼çš„æ¶æ„æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚MVCæ˜¯ç»å…¸çš„è®¾è®¡æ¨¡å¼, ä½†æ˜¯Cçš„èŒè´£å¤ªå¤§, éšç€ä¸šåŠ¡çš„å‘å±•, Cä¿¨ç„¶æˆä¸ºä»£ç èšé›†çš„é‡ç¾åŒº, ä¼´éšç€ä¾¿æ˜¯ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜è€Œè¯ç”Ÿçš„MVCSã€MVPã€MVVMã€VIPã€VIPERç­‰æ¨¡å¼, ç„¶è€Œä¸‡å˜ä¸ç¦»å…¶å®—, æœ€ç»ˆçš„è®¾è®¡éƒ½ç¦»ä¸å¼€MVCè¿™ä¸ªæ ¹åŸºã€‚ MVCæ¨¡å¼ä¼ ç»Ÿçš„MVCç»å…¸çš„MVC, Viewæ˜¯å¹¶æ²¡æœ‰ä»»ä½•çš„ç•Œé™, ä¸‰ä¸ªæ¨¡å—ä¹‹é—´æ˜¯æœ‰éå¸¸å¼ºçš„è€¦åˆ, æå¤§çš„é™ä½äº†ä¸‰è€…çš„å¤ç”¨æ€§ä¸å¯æµ‹è¯•æ€§, å¹¶ä¸é€‚åˆä½œä¸ºiOSåº”ç”¨å±‚çš„æ¶æ„ã€‚","text":"å‰è¨€å½“æˆ‘ä»¬åœ¨å¼€å‘iOSåº”ç”¨ç¨‹åºçš„æ—¶å€™, éšç€ä¸šåŠ¡çš„ä¸æ–­æ·»åŠ , å¯¹åº”ä»£ç æ¨¡å—ä¹‹é—´çš„å¤æ‚åº¦ä¸è€¦åˆä¹Ÿéšä¹‹çš„å¢åŠ , ä¸æ–­çš„æå‡ç€å¼€å‘çš„å¤æ‚åº¦ä¸ç»´æŠ¤çš„é«˜æˆæœ¬, ä¸ºäº†èƒ½æé«˜å¼€å‘å’Œç»´æŠ¤çš„æ•ˆç‡, ç”šè‡³äºæ˜¯æµ‹è¯•çš„æ•ˆç‡, è®¾è®¡ç¬¦åˆå½“å‰ä¸šåŠ¡æ¨¡å¼çš„æ¶æ„æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚MVCæ˜¯ç»å…¸çš„è®¾è®¡æ¨¡å¼, ä½†æ˜¯Cçš„èŒè´£å¤ªå¤§, éšç€ä¸šåŠ¡çš„å‘å±•, Cä¿¨ç„¶æˆä¸ºä»£ç èšé›†çš„é‡ç¾åŒº, ä¼´éšç€ä¾¿æ˜¯ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜è€Œè¯ç”Ÿçš„MVCSã€MVPã€MVVMã€VIPã€VIPERç­‰æ¨¡å¼, ç„¶è€Œä¸‡å˜ä¸ç¦»å…¶å®—, æœ€ç»ˆçš„è®¾è®¡éƒ½ç¦»ä¸å¼€MVCè¿™ä¸ªæ ¹åŸºã€‚ MVCæ¨¡å¼ä¼ ç»Ÿçš„MVCç»å…¸çš„MVC, Viewæ˜¯å¹¶æ²¡æœ‰ä»»ä½•çš„ç•Œé™, ä¸‰ä¸ªæ¨¡å—ä¹‹é—´æ˜¯æœ‰éå¸¸å¼ºçš„è€¦åˆ, æå¤§çš„é™ä½äº†ä¸‰è€…çš„å¤ç”¨æ€§ä¸å¯æµ‹è¯•æ€§, å¹¶ä¸é€‚åˆä½œä¸ºiOSåº”ç”¨å±‚çš„æ¶æ„ã€‚ ï£¿æ¨èçš„MVCè‹¹æœå¸Œæœ›çš„MVCçš„æ¨¡å¼, ç”±Controllerå……å½“Viewä¸Modelä¹‹é—´çš„åè°ƒå™¨, Viewå’Œmodelä¹‹é—´å¹¶æ²¡æœ‰ç›´æ¥çš„è”ç³»ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹, Viewå’Œmodelçš„å¯å¤ç”¨æ€§ä¸æµ‹è¯•æ€§å¾—åˆ°æå¤§çš„æé«˜, ç”±äºControllerä½œä¸ºiOSåº”ç”¨å±‚çš„å…¥å£å¹¶ä¸”æ‰€æœ‰Viewä¸Modelä¹‹é—´åè°ƒçš„ä»£ç éƒ½é›†ä¸­äºæ­¤, åŠ¿å¿…ä¼šé€ æˆControllerçš„ä¸¥é‡æ‹¥å µ, å› æ­¤MVCä¹Ÿè¢«ç§°å‘¼Massive View Controllerã€‚ ï£¿å®é™…çš„MVCåœ¨Cocoaçš„MVCæ¨¡å¼ä¸­, Controllerç®¡ç†ç€Viewçš„ç”Ÿå‘½å‘¨æœŸ, Controllerä¸­æ‹¥æœ‰ç€Viewä¸Model, å¹¶ä¸”è´Ÿè´£æ›´æ–°Viewä¸Model, Controllerä¸­ä¼šæ‰¿æ‹…ä¸€åˆ‡çš„ä»£ç†æˆ–è€…æ•°æ®æº, åŒæ—¶è¿˜è´Ÿè´£ä¸€äº›ç½‘ç»œè¯·æ±‚çš„å‘èµ·/å–æ¶ˆç­‰ä»»åŠ¡ã€‚Viewä¸­ä¹Ÿæ‹¥æœ‰ç€Model, Viewçš„æœ€å¤§çš„ä»»åŠ¡å°±æ˜¯å‘Controllerä¼ é€’ç”¨æˆ·çš„äº‹ä»¶ã€‚Modelå¯ä»¥åˆ†ä¸ºèƒ–Modelå’Œç˜¦Model, ä¸ç®¡å“ªç§model, å…¶æœ€ç»ˆéƒ½æ˜¯ä¸ºäº†å°†æ•°æ®ç›´æ¥åº”ç”¨åˆ°Viewä¸Šã€‚ ç¤ºä¾‹ - View â€œtalk is cheap. show me the codeâ€ â€“ Linus Torvalds æ­£å‘æµç¨‹åœ¨iOSä¸­, Controllerä½œä¸ºæœ€å°å•å…ƒ, é€šå¸¸æ¥è¯´æ‰€æœ‰è§†å›¾å±•ç¤ºé€»è¾‘ä¸äº¤äº’çš„é€»è¾‘éƒ½éœ€è¦å€ŸåŠ©äºController(Windowé™¤å¤–), æ‰€ä»¥å…¥å£å¿…ç„¶æ˜¯Controller, åœ¨Controllerä¸­åˆå§‹åŒ–Viewä¸è·å–Modelåå°†äºŒè€…å…³è” åˆå§‹åŒ–View, åç»­Viewçš„ç”Ÿå‘½å‘¨æœŸå°†æœ‰Controllerç®¡ç† 123456/// Controllerfileprivate lazy var mvcView: MVCView = &#123; [unowned self] in let mvcView = MVCView(frame: self.view.bounds) self.view.addSubview(mvcView) return mvcView&#125;() è·å–Model 12345/// Controllerfileprivate lazy var mvcModel: MVCModel = &#123; let mvcModel = MVCModel() return mvcModel&#125;() å…³è”Viewä¸Model, æ•°æ®å°†å±•ç¤ºåœ¨Viewä¸Š 12345678/// Controllerfunc changeName() &#123; let index = arc4random() % 9 let model = MVCModel() model.name = \"simon\" + \"\\(index)\" mvcView.model = model&#125; åå‘æµç¨‹Viewæ¥æ”¶æ¥è‡ªç”¨æˆ·çš„äº‹ä»¶, å°†äº‹ä»¶ä¼ é€’ç»™Controller, Controlleré€šçŸ¥Modelæ›´æ”¹æ•°æ®ã€‚ Viewæ¥æ”¶ç”¨æˆ·äº‹ä»¶, å¹¶å°†äº‹ä»¶ä¼ é€’ç»™Controller 123456/// Viewextension MVCView &#123; @objc fileprivate func clickName() &#123; clickNameClosure?() &#125;&#125; Controlleræ¥å—åˆ°äº‹ä»¶, å¹¶æ›´æ–°Model 1234/// Controller mvcView.clickNameClosure = &#123;[weak self] in self?.changeName()&#125; èƒ–Model: èƒ–ModelåŒ…å«äº†éƒ¨åˆ†å¼±ä¸šåŠ¡é€»è¾‘ã€‚èƒ–Modelå¯ä»¥å‡è½»Controllerå¯¹äºå¼±ä¸šåŠ¡é€»è¾‘çš„è´Ÿæ‹…(å¼ºä¸šåŠ¡é€»è¾‘ä»»å°±äº¤ç»™Controller)ï¼ŒControllerä»èƒ–Modelè¿™é‡Œæ‹¿åˆ°æ•°æ®ä¹‹åï¼Œä¸éœ€è¦åšé¢å¤–çš„æ“ä½œ/åªåšéå¸¸å°‘çš„æ“ä½œï¼Œå°±èƒ½å¤Ÿå°†æ•°æ®ç›´æ¥åº”ç”¨åœ¨Viewä¸Šã€‚ ç˜¦Model: ç˜¦Modelåªè´Ÿè´£ä¸šåŠ¡æ•°æ®çš„è¡¨è¾¾ï¼Œæ— è®ºå¼º/å¼±ä¸šåŠ¡éƒ½äº¤ç»™Controllerå»å¤„ç†ã€‚ç˜¦Modeléœ€è¦é…å¥—å„ç§å·¥å…·ç±»æˆ–æ–¹æ³•æ¥å¯¹å¼±ä¸šåŠ¡åšæŠ½è±¡ï¼Œå¼ºä¸šåŠ¡ä¾æ—§äº¤ç»™Controller ä»å¼€å‘çš„é€Ÿåº¦æ¥è®², Cocoaçš„MVCæ˜¯æœ€å¥½çš„æ¶æ„æ–¹æ¡ˆ MVPæ¨¡å¼åœ¨MVPçš„æ¨¡å¼ä¸­å¼•å…¥äº†ä¸€ä¸ªPresenteræ¥åè°ƒViewä¸Modelä¹‹é—´çš„å…³è”, Persenterä¸­æ‹¥æœ‰Viewä¸Model, å¹¶å¤„ç†æ¥è‡ªViewçš„äº‹ä»¶ã€‚Viewåªæä¾›æ¥å£, å¹¶è´Ÿè´£å°†äº‹ä»¶ä¼ é€’ç»™Presenterã€‚modelè´Ÿè´£å°†è‡ªå·±æä¾›ç»™Persenterã€‚Controllerä½œä¸ºå±•ç¤ºçš„å…¥å£, è´Ÿè´£ç»„è£…ä¸‰è€…çš„å…³ç³»ä¸è·¯ç”±, ä¹Ÿå¯ä»¥å°†Controllerçœ‹åšæ˜¯Viewçš„ä¸€éƒ¨åˆ†ã€‚ ç¤ºä¾‹ - Viewæ­£å‘æµç¨‹ä¸MVCç›¸ä¼¼, å…¥å£ä¸ºController, Controllerä¸­è´Ÿè´£è·å–Modelã€åˆå§‹åŒ–Viewä¸Presenter, å°†ViewäºModelç»‘å®šä¸Persenter åˆå§‹åŒ–Viewä¸Persenter 1234567891011/// Controllerfileprivate lazy var mvpView: MVPView = &#123;[unowned self] in let mvpView = MVPView(frame: self.view.bounds) self.view.addSubview(mvpView) return mvpView&#125;()fileprivate lazy var presenter: Presenter = &#123; let presenter = Presenter() return presenter &#125;() è·å–Model 12345/// Controllerfileprivate lazy var mvpModel: MVPModel = &#123; let mvpModel = MVPModel() return mvpModel&#125;() å…³è”Presenter 123/// Controller presenter.mvpView = mvpView presenter.mvpModel = mvpModel Presenteræ“ä½œModel, æ›´æ–°Viewçš„å±•ç¤º 123456789/// Controllerpresenter.setName()presenter:func setName() &#123; let index = arc4random() % 9 mvpModel?.name = \"simon\" + \"\\(index)\" mvpView?.setName(mvpModel?.name)&#125; åå‘æµç¨‹Viewæ¥æ”¶æ¥è‡ªç”¨æˆ·çš„äº‹ä»¶, å°†äº‹ä»¶ä¼ é€’ç»™Persenter, Persenteré€šçŸ¥Modelæ›´æ”¹æ•°æ®ã€‚ Viewæ¥æ”¶ç”¨æˆ·äº‹ä»¶, å¹¶å°†äº‹ä»¶ä¼ é€’ç»™Presenter 12345678/// View@objc fileprivate func clickName() &#123; clickNameClosure?()&#125; @objc fileprivate func clickText() &#123; delegate?.mvpView?(self, didClickText: \"simon\")&#125; Presenteræ¥æ”¶åˆ°äº‹ä»¶, å¹¶æ›´æ–°Model 12345678910111213141516171819202122/// PresentermvpView?.delegate = self as MVPViewDelegate mvpView?.clickNameClosure = &#123;[weak self] in self?.setName()&#125;extension Presenter: MVPViewDelegate &#123; func setName() &#123; let index = arc4random() % 9 mvpModel?.name = \"simon\" + \"\\(index)\" mvpView?.setName(mvpModel?.name) &#125; func mvpView(_ mvpView: MVPView, didClickText text: String) &#123; mvpModel?.name = text self.mvpView?.setName(text) &#125;&#125; æ€è€ƒMVPæ¨¡å¼ä¼šå¢åŠ ä¸€å®šé‡ä»£ç é‡, åœ¨ä¸šåŠ¡é€»è¾‘å¤æ‚, è§„æ¨¡è¾ƒå¤§çš„åœºæ™¯ä¸‹Presenterä¹Ÿå¾ˆå®¹æ˜“æˆä¸ºä»£ç èšé›†çš„é‡ç¾åŒº, ç›¸å¯¹çš„æ­¤æ¨¡å¼ä¸‹ä»£ç çš„å¯æµ‹æ€§è‰¯å¥½, ä»»åŠ¡ä¹Ÿæ¯”è¾ƒå‡æ‘Šã€‚ ä»¥ä¸ŠåŸºäºPV(Passive View) MVPã€‚é¡¾åæ€ä¹‰, PVæ˜¯ä¸€ä¸ªè¢«åŠ¨çš„View, Viewä¸­çš„æ“ä½œç”±Presenteræ¥æ“ä½œã€‚ ä¸ä¹‹å¯¹åº”çš„æ˜¯SoC(Supervising Controller) MVP, æ­¤æ¨¡å¼ä¸»è¦æ˜¯ä¸ºäº†é™ä½Presenterçš„å¤æ‚åº¦, å°†æ•°æ®ç»‘å®šå’Œæ ¼å¼åŒ–ç­‰ç®€å•çš„UIå¤„ç†é€»è¾‘è½¬ç§»åˆ°Viewä¸­ã€‚ MVVMæ¨¡å¼MVVMæ˜¯MVâ€œXâ€ç³»åˆ—ä¸­æœ€æ–°çš„æ¨¡å¼, å¯¹äºMVVMçš„ä½¿ç”¨, é¢‡å…·äº‰è®®ã€‚è¢«è¯¯è§£çš„MVCå’Œè¢«ç¥åŒ–çš„MVVMåœ¨MVVMæ¨¡å¼ä¸­å¼•å…¥äº†ä¸€ä¸ªViewModelæ¥åè°ƒå¤„ç†Viewä¸Modelä¹‹é—´çš„è”ç³»ã€‚ MVVMä¸­Viewä¸­, é™¤äº†å­View, åªæ‹¥æœ‰ViewModel, å¹¶è´Ÿè´£ç»‘å®šViewModelã€‚ViewModelä¸­æ‹¥æœ‰Model, è´Ÿè´£æ›´æ–°Modelã€‚Controllerä¸MVPæ¨¡å¼ä¸­ç±»ä¼¼, è´Ÿè´£ç»„è£…ä¸‰è€…çš„å…³ç³»ä¸è·¯ç”±ã€‚ ç¤ºä¾‹ - Viewæ­£å‘æµç¨‹ä¸MVCã€MVVMç›¸ä¼¼, å…¥å£ä¸ºController, Controllerä¸­è´Ÿè´£åˆå§‹åŒ–ViewModelä¸View, è·å–model, å…³è”ä¸‰è€… åˆå§‹åŒ–Viewä¸ViewModel 123456789101112/// Controllerfileprivate lazy var mvvmView: MVVMView = &#123; [unowned self] in let mvvmView = MVVMView(frame: self.view.bounds) self.view.addSubview(mvvmView) return mvvmView&#125;()fileprivate lazy var mvvmVM: MVVMViewModel = &#123; let mvvmVM = MVVMViewModel() return mvvmVM&#125;() è·å–model 1234567/// Controllerfileprivate lazy var mvvmModel: MVVMModel = &#123; let mvvmModel = MVVMModel() mvvmModel.name = \"simon Init\" return mvvmModel&#125;() å…³è”å½¼æ­¤ 1234/// ControllermvvmView.mvvmVM = mvvmVM // ç»‘å®šmvvmVM.mvvmModel = mvvmModel Viewä¸­ç»‘å®šViewModel 123456789101112131415/// Viewvar mvvmVM: MVVMViewModel? &#123; didSet &#123; mvvmVM?.addObserver(self, forKeyPath: \"name\", options: [.new, .initial], context: nil) &#125;&#125; override func observeValue(forKeyPath keyPath: String?, of object: Any?, change: [NSKeyValueChangeKey : Any]?, context: UnsafeMutableRawPointer?) &#123; if keyPath == \"name\" &#123; let name = change?[.newKey] as? String setName(name) &#125;&#125; åå‘æµç¨‹Viewæ¥æ”¶æ¥è‡ªç”¨æˆ·çš„äº‹ä»¶, å°†äº‹ä»¶ä¼ é€’ç»™ViewModel, ViewModelé€šçŸ¥Modelæ›´æ”¹æ•°æ®ã€‚ Viewæ¥æ”¶ç”¨æˆ·äº‹ä»¶, å¹¶å°†äº‹ä»¶ä¼ é€’ç»™ViewModel 12345/// ViewModel@objc fileprivate func clickName() &#123; mvvmVM?.clickName()&#125; ViewModelæ¥æ”¶åˆ°äº‹ä»¶, å¹¶æ›´æ–°Modelä¸ViewModelçš„Name, ç”±äºç›‘å¬äº†ViewModelçš„Nameå±æ€§, æ‰€ä»¥Viewçš„è§†å›¾ä¹Ÿä¼šéšä¹‹è·Ÿç€æ›´æ”¹ 12345678910/// ViewModelextension MVVMViewModel &#123; func clickName() &#123; let index = arc4random() % 9 let mvvmModel = MVVMModel() mvvmModel.name = \"simon\" + \"\\(index)\" self.mvvmModel = mvvmModel &#125;&#125; æ€è€ƒ1åœ¨ç¤ºä¾‹ä¸­, MVVMçš„ä»»åŠ¡å‡æ‘Šéå¸¸åˆç†, å¯æµ‹è¯•æ€§ä¹Ÿéå¸¸çš„é«˜; ä½†æ˜¯MVVMçš„Viewéœ€è¦è®¾ç½®ç»‘å®šViewModelæ¥æ›´æ–°çŠ¶æ€, è€ŒMVPä¸­çš„Viewåªéœ€è¦ç›‘å¬Presenterçš„äº‹ä»¶ã€‚ ç¤ºä¾‹ - TableViewæ­¤tableViewä¸­å¹¶æœªä½¿ç”¨åŒå‘ç»‘å®š, æ˜¯ç¬”è€…è§‰å¾—åœ¨ä¸å¼•å…¥RxSwiftçš„åŸºç¡€ä¸Š, æ¯”è¾ƒåˆé€‚çš„åˆ’åˆ†ã€‚ViewModelä¸­æ‹¥æœ‰Model, å¹¶è´Ÿè´£ä¸Cellè§†å›¾çš„æ•°æ®å…³è”ã€‚Controllerä½œä¸ºå…¥å£, è´Ÿè´£åˆå§‹åŒ–Viewä¸ViewModel, å¹¶æˆä¸ºä»£ç†ä¸æ•°æ®æºå’Œæä¾›è·¯ç”±ã€‚ æ­£å‘æµç¨‹ åˆå§‹åŒ–TableViewä¸ViewModel 12345678910111213/// Controllerfileprivate lazy var mvvmVM: MVVMVM = &#123;return $0&#125;(MVVMVM()) fileprivate lazy var tableView: UITableView = &#123;[unowned self] in let tableView = UITableView(frame: self.view.bounds) tableView.delegate = self tableView.dataSource = self tableView.backgroundColor = .yellow tableView.rowHeight = 70 tableView.register(UINib(nibName: \"MVVMCell\", bundle: nil), forCellReuseIdentifier: \"cellId\") return tableView&#125;() Controlleræˆä¸ºæ•°æ®æºä¸ä»£ç†, å¹¶è®©ViewModelä¸Cellç»‘å®š 123456789101112131415161718/// Controllerextension MVVMController: UITableViewDelegate, UITableViewDataSource &#123; func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int &#123; return mvvmVM.models.count &#125; func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell &#123; let cell = tableView.dequeueReusableCell(withIdentifier: \"cellId\") mvvmVM.setCell(cell!, indexPath.row) return cell! &#125; func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) &#123; &#125;&#125; è·å–Model 123456789101112131415/// ViewModelextension MVVMVM &#123; func loadData() &#123; DispatchQueue.main.asyncAfter(deadline: .now() + 2) &#123; for i in 0..&lt;20 &#123; let model = MVVMModel() model.name = \"simon\" + \"\\(i)\" self.models.append(model) &#125; self.reloadData?() &#125; &#125;&#125; é€šçŸ¥TableViewåˆ·æ–° 12345/// ControllermvvmVM.reloadData = &#123;[weak self] in self?.tableView.reloadData()&#125; åå‘æµç¨‹ Cellæ¥æ”¶ç”¨æˆ·çš„äº‹ä»¶, ä¼ é€’ç»™ViewMode 12345/// Cell@IBAction func clickName(_ sender: UIButton) &#123; clickNameClosure?(index)&#125; ViewModeæ›´æ–°Model 12345678/// ViewModelcell.clickNameClosure = &#123;[weak self] index in let model = self?.models[index] model?.name = \"test test..\" self?.reloadData?()&#125; é€šçŸ¥TableViewåˆ·æ–° 12345/// ControllermvvmVM.reloadData = &#123;[weak self] in self?.tableView.reloadData()&#125; æ€è€ƒ2åœ¨ç¤ºä¾‹ä¸­, Controllerè´Ÿè´£ä»£ç†ä¸æ•°æ®æºå’Œè·¯ç”±ã€‚ViewModelè´Ÿè´£åŠ å·¥Model, ç»‘å®šCellã€‚ä»æ–¹ä¾¿å¼€å‘çš„è§’åº¦çœ‹, å‡è®¾ä»£ç†å’Œæ•°æ®æºäº¤ç»™ViewModelå»å¤„ç†, å½“cellå‘å‡ºè·³è½¬è‡³ä¸‹ä¸€æ§åˆ¶å™¨, éœ€è¦ViewModelé€šçŸ¥å½“å‰çš„Controllerå»æ‰§è¡Œç›¸åº”çš„æ“ä½œ, ä¸å…¶è¿™æ ·éœ€è¦ä¸­è½¬, ä¸å¦‚è®©Controllerç›´æ¥å»å¤„ç†ã€‚ä»èŒè´£æ˜ç¡®çš„è§’åº¦çœ‹, éœ€è¦å°†æ•°æ®æºä¸ä»£ç†äº¤ç”±ViewModelæ¥ç®¡ã€‚ åœ¨MVVMæœ‰ä¸€ä¸ªæ ¸å¿ƒå°±æ˜¯åŒå‘ç»‘å®š, å®ç°åŒå‘ç»‘å®šéœ€è¦å¼•å…¥æ›´å¤šå¤æ‚çš„æ¡†æ¶: åŸºäºKVOçš„ç»‘å®šåº“å¦‚ RZDataBinding å’Œ SwiftBond å‡½æ•°å“åº”å¼ç¼–ç¨‹ï¼ŒReactiveCocoaã€RxSwiftç­‰ å‡½æ•°å“åº”å¼ç¼–ç¨‹çš„å­¦ä¹ æ›²çº¿ç›¸å¯¹æ¯”è¾ƒé™¡å³­, åœ¨å›¢é˜Ÿä¸­æ¨å¹¿éœ€è¦ä¸€å®šçš„æ—¶é—´ã€‚ æ•°æ®çš„ç»‘å®šä¼šä½¿å¾—Bugå¾ˆéš¾è¢«è°ƒè¯•,å¼€å‘è€…éœ€è¦éå¸¸æ¸…æ¥šæ•´ä¸ªå‡½æ•°è°ƒç”¨çš„æµç¨‹, å¦‚æœæ˜¯å¼•å…¥çš„æ¡†æ¶å¤„äº†é—®é¢˜, é‚£æ›´æ˜¯åœ°ç‹±çº§çš„æƒ¨çŠ¶ã€‚ å¤§é‡æ•°æ®çš„ç»‘å®šè‚¯å®šéœ€è¦èŠ±è´¹æ›´å¤šçš„å†…å­˜ æ€»ç»“æ²¡æœ‰æœ€å¥½çš„æ¶æ„, åªæœ‰æœ€åˆé€‚çš„æ¶æ„ã€‚åº”ç”¨å±‚æ¶æ„çš„é€‰æ‹©éœ€è¦æ ¹æ®å…¬å¸çš„ä¸šåŠ¡ç‰¹ç‚¹ã€å¼€å‘è€…çš„èƒ½åŠ›ç­‰, è§†å…·ä½“æƒ…å†µå…·ä½“åˆ†æã€‚å‡è®¾ä¸šåŠ¡é€»è¾‘æ¯”è¾ƒå•ä¸€,å¹¶ä¸éœ€è¦å•å…ƒæµ‹è¯•, é€‰æ‹©Cocoaçš„MVCæ¨¡å¼å¼€å‘å°±æ˜¯éå¸¸å¥½çš„é€‰æ‹©; å‡è®¾ä½ çš„ä¸šåŠ¡é€»è¾‘æ¯”è¾ƒå¤æ‚, é‚£ä¹ˆé‡‡ç”¨MVVM, ç”šè‡³äºVIPERæ¨¡å¼(ç¬”è€…æ²¡å®é™…ç”¨è¿‡, å¯ä»¥ç¡®å®šçš„æ˜¯, å„æ¨¡å—é—´çš„é€»è¾‘ä¼šç›¸å¯¹å¤æ‚, ä»£ç é‡ä¹Ÿä¼šåŠ å€çš„é€’å¢)éƒ½æ˜¯éå¸¸åˆé€‚çš„ã€‚è¿™æ€»ç»“è²Œä¼¼æœ‰ç‚¹å¤šä½™, æ„Ÿå—ç¡®æ˜¯å¦‚æ­¤ã€‚ å¼•ç”¨ç¤ºä¾‹Demo iOS æ¶æ„æ¨¡å¼","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"æ¶æ„","slug":"æ¶æ„","permalink":"https://github.com/icoderRo/tags/æ¶æ„/"}]},{"title":"Realm-Swift3.0","slug":"RealmSwift","date":"2017-01-19T16:00:00.000Z","updated":"2017-08-17T14:45:09.000Z","comments":true,"path":"2017/01/20/RealmSwift/","link":"","permalink":"https://github.com/icoderRo/2017/01/20/RealmSwift/","excerpt":"Realm-Swift3.0 ç®€ä»‹Realm äº2014 å¹´7æœˆå‘å¸ƒï¼Œæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ç§»åŠ¨æ•°æ®åº“å¼•æ“ï¼Œä¸“é—¨ä¸ºç§»åŠ¨åº”ç”¨çš„æ•°æ®æŒä¹…åŒ–è€Œç”Ÿã€‚å…¶ç›®çš„æ˜¯è¦å–ä»£ Core Data å’Œ SQLite,æ”¯æŒJavaã€Objective-Cã€JavaScriptã€Swiftã€Xamarinå¹³å° Realmçš„ä¼˜ç‚¹åœ¨å®˜æ–¹ä¸Šæœ‰å¾ˆå¤šçš„è¯´æ˜, ç•¥ä¸¾ä¸¤ç‚¹: 1.æ˜“ä¸Šæ‰‹:æƒ³æ¯”äºCore Data å’ŒSQLite, Realmçš„å­¦ä¹ æˆæœ¬ç›¸å¯¹æ¥è¯´ä¼šæ¯”è¾ƒä½, æ¯«ä¸å¤¸å¼ çš„è¯´, æŠŠå®˜æ–¹çš„æ–‡æ¡£å’ŒDemoçœ‹å®Œä¸€é, å°±å¯ä»¥å¿«é€Ÿçš„ä¸Šæ‰‹å¼€å‘åŠŸèƒ½ã€‚ 2.å¯è§†åŒ–: Realmæä¾›äº†ä¸€ä¸ªè½»é‡çº§çš„æ•°æ®åº“æŸ¥çœ‹å·¥å…·, åœ¨App Storeä¸­ä¸‹è½½Realm Browser, ç›¸æ¯”äºSQLite, ä½ å¯èƒ½éœ€è¦å»ä¸‹è½½ä»˜è´¹æˆ–è€…ç ´è§£ç‰ˆçš„Navicatã€SQL Managerç­‰è½¯ä»¶ä¼šæ–¹ä¾¿å¾ˆå¤š, å€ŸåŠ©äºRealm Browserè°ƒè¯•Realmæ•°æ®åº“å¾ˆä¾¿æ·ã€‚ ä½¿ç”¨æ¨¡æ‹Ÿå™¨è¿›è¡Œè°ƒè¯• é€šè¿‡æ‰§è¡Œrealm.configuration.fileURLæ‰“å°å‡ºRealmæ•°æ®åº“çš„åœ°å€, Finderä¸­è·³è½¬è¿›å¯¹åº”çš„è·¯å¾„, ç”¨Realm Browseræ‰“å¼€å¯¹åº”çš„.realmæ–‡ä»¶å°±å¯ä»¥çœ‹åˆ°æ•°æ®å•¦ã€‚ ä½¿ç”¨çœŸæœºè°ƒè¯• Xcode-&gt;Window-&gt;Devices,ç„¶åæ‰¾åˆ°å¯¹åº”çš„è®¾å¤‡ä¸é¡¹ç›®,å¯¼å‡ºxcappdataæ–‡ä»¶å,æ˜¾ç¤ºåŒ…å†…å®¹è¿›å…¥Documents,ä½¿ç”¨Realm Browseræ‰“å¼€.realmæ–‡ä»¶å³å¯.","text":"Realm-Swift3.0 ç®€ä»‹Realm äº2014 å¹´7æœˆå‘å¸ƒï¼Œæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ç§»åŠ¨æ•°æ®åº“å¼•æ“ï¼Œä¸“é—¨ä¸ºç§»åŠ¨åº”ç”¨çš„æ•°æ®æŒä¹…åŒ–è€Œç”Ÿã€‚å…¶ç›®çš„æ˜¯è¦å–ä»£ Core Data å’Œ SQLite,æ”¯æŒJavaã€Objective-Cã€JavaScriptã€Swiftã€Xamarinå¹³å° Realmçš„ä¼˜ç‚¹åœ¨å®˜æ–¹ä¸Šæœ‰å¾ˆå¤šçš„è¯´æ˜, ç•¥ä¸¾ä¸¤ç‚¹: 1.æ˜“ä¸Šæ‰‹:æƒ³æ¯”äºCore Data å’ŒSQLite, Realmçš„å­¦ä¹ æˆæœ¬ç›¸å¯¹æ¥è¯´ä¼šæ¯”è¾ƒä½, æ¯«ä¸å¤¸å¼ çš„è¯´, æŠŠå®˜æ–¹çš„æ–‡æ¡£å’ŒDemoçœ‹å®Œä¸€é, å°±å¯ä»¥å¿«é€Ÿçš„ä¸Šæ‰‹å¼€å‘åŠŸèƒ½ã€‚ 2.å¯è§†åŒ–: Realmæä¾›äº†ä¸€ä¸ªè½»é‡çº§çš„æ•°æ®åº“æŸ¥çœ‹å·¥å…·, åœ¨App Storeä¸­ä¸‹è½½Realm Browser, ç›¸æ¯”äºSQLite, ä½ å¯èƒ½éœ€è¦å»ä¸‹è½½ä»˜è´¹æˆ–è€…ç ´è§£ç‰ˆçš„Navicatã€SQL Managerç­‰è½¯ä»¶ä¼šæ–¹ä¾¿å¾ˆå¤š, å€ŸåŠ©äºRealm Browserè°ƒè¯•Realmæ•°æ®åº“å¾ˆä¾¿æ·ã€‚ ä½¿ç”¨æ¨¡æ‹Ÿå™¨è¿›è¡Œè°ƒè¯• é€šè¿‡æ‰§è¡Œrealm.configuration.fileURLæ‰“å°å‡ºRealmæ•°æ®åº“çš„åœ°å€, Finderä¸­è·³è½¬è¿›å¯¹åº”çš„è·¯å¾„, ç”¨Realm Browseræ‰“å¼€å¯¹åº”çš„.realmæ–‡ä»¶å°±å¯ä»¥çœ‹åˆ°æ•°æ®å•¦ã€‚ ä½¿ç”¨çœŸæœºè°ƒè¯• Xcode-&gt;Window-&gt;Devices,ç„¶åæ‰¾åˆ°å¯¹åº”çš„è®¾å¤‡ä¸é¡¹ç›®,å¯¼å‡ºxcappdataæ–‡ä»¶å,æ˜¾ç¤ºåŒ…å†…å®¹è¿›å…¥Documents,ä½¿ç”¨Realm Browseræ‰“å¼€.realmæ–‡ä»¶å³å¯. Xcodeæ’ä»¶Realmçš„Xcodeæ’ä»¶ä»¤ Realm æ¨¡å‹çš„åˆ›å»ºæ›´åŠ æ–¹ä¾¿.gitHubä¸‹è½½ä¸€ä¸ªDemoä¼ é€é—¨, æ‰¾åˆ°é‡Œé¢çš„Pluginç›®å½•ä¸‹çš„RealmPlugin.xcodeprojå¹¶è¿›è¡Œç¼–è¯‘ï¼Œé‡å¯ Xcodeä¹‹åæ’ä»¶å³å¯ç”Ÿæ•ˆã€‚ çº¯SWiftç‰ˆçš„å®‰è£… ä½¿ç”¨ Realm æ„å»ºåº”ç”¨çš„åŸºæœ¬è¦æ±‚ï¼šiOS 8 åŠå…¶ä»¥ä¸Šç‰ˆæœ¬, macOS 10.9 åŠå…¶ä»¥ä¸Šç‰ˆæœ¬ï¼Œæ­¤å¤– Realm æ”¯æŒ tvOS å’Œ watchOS çš„æ‰€æœ‰ç‰ˆæœ¬ã€‚ éœ€è¦ä½¿ç”¨ Xcode 8.0 æˆ–è€…ä»¥åçš„ç‰ˆæœ¬ã€‚Realm Swift 2.3.0 æ˜¯æœ€åä¸€ä¸ªæ”¯æŒ Swift 2.x åŠ Xcode 7.3 çš„ç‰ˆæœ¬ã€‚ æ–¹æ³•1:Dynamic Framework ä¸‹è½½Realmçš„æœ€æ–°ç‰ˆæœ¬å¹¶è§£å‹ã€‚ å‰å¾€æ‚¨ Xcode å·¥ç¨‹çš„â€Generalâ€è®¾ç½®é¡µã€‚å‰å¾€é€‚åˆæ‚¨é¡¹ç›®çš„ Swift ç‰ˆæœ¬ç›®å½•ï¼Œä»å…¶ä¸­çš„ iosæ–‡ä»¶å¤¹ä¸­ï¼Œæ‹–æ‹½RealmSwift.framework å’ŒRealm.frameworkåˆ°â€Embedded Binariesâ€é€‰é¡¹ä¸­ï¼Œç¡®è®¤Copy items if neededè¢«é€‰ä¸­ï¼ˆé™¤éæ‚¨çš„é¡¹ç›®ä¸­éœ€è¦åœ¨å¤šä¸ªå¹³å°ä¸­ä½¿ç”¨ Realmï¼‰ï¼Œå¹¶ç‚¹å‡»Finishã€‚ åœ¨æ‚¨çš„å•å…ƒæµ‹è¯•ç›®æ ‡çš„â€Build Settingsâ€ä¸­ï¼Œæ·»åŠ RealmSwift.frameworkçš„ä¸Šçº§ç›®å½•åˆ°æ‚¨çš„â€Framework Search Pathsâ€ä¸­ã€‚ å¦‚æœæ‚¨æ‰“ç®—åœ¨æ‚¨çš„ iOSã€tcOS æˆ–è€… watchOS å·¥ç¨‹ä¸­ä½¿ç”¨ Realmï¼Œè¯·åœ¨æ‚¨çš„ app ç›®æ ‡çš„â€œBuild Phasesâ€ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„â€Run Script Phaseâ€ï¼Œå¹¶åœ¨æ–‡æœ¬æ¡†ä¸­å†™å…¥bash &quot;${BUILT_PRODUCTS_DIR}/${FRAMEWORKS_FOLDER_PATH}/Realm.framework/strip-frameworks.sh&quot;å› ä¸ºè¦ç»•è¿‡è¿™ä¸ªAPPå•†åº—æäº¤çš„bugï¼Œè¿™ä¸€æ­¥åœ¨æ‰“åŒ…äºŒè¿›åˆ¶å‘å¸ƒç‰ˆæœ¬æ—¶æ˜¯å¿…é¡»ã€‚ æ–¹æ³•2:Carthage å®‰è£… Carthage 0.17.0 æˆ–è€…æ›´é«˜ç‰ˆæœ¬ åœ¨Carthage ä¸­æ·»åŠ github realm/realm-cocoa è¿è¡Œ carthage update ä» Carthage/Build/ ç›®å½•ä¸‹å¯¹åº”å¹³å°æ–‡ä»¶å¤¹ä¸­ï¼Œå°† RealmSwift.framework å’Œ Realm.framework æ‹–æ›³åˆ°æ‚¨ Xcode å·¥ç¨‹Generalè®¾ç½®é¡¹çš„Linked Frameworks and Librariesé€‰é¡¹å¡ä¸­ iOS/tvOS/watchOS: åœ¨æ‚¨åº”ç”¨ç›®æ ‡çš„Build Phasesè®¾ç½®é€‰é¡¹å¡ä¸­ï¼Œç‚¹å‡»â€œ+â€æŒ‰é’®å¹¶é€‰æ‹©â€œNew Run Script Phaseâ€ã€‚åœ¨æ–°å»ºçš„Run Scriptä¸­ï¼Œå¡«å†™:/usr/local/bin/carthage copy-frameworks åœ¨Input Fileså†…æ·»åŠ æ‚¨æƒ³è¦ä½¿ç”¨çš„æ¡†æ¶è·¯å¾„ï¼Œä¾‹å¦‚: 1$(SRCROOT)/Carthage/Build/iOS/RealmSwift.framework æ–¹æ³•3:CocoaPods è¿è¡Œ pod repo updateï¼Œä»¥ç¡®ä¿ CocoaPods èƒ½å¤Ÿè·å–åˆ° Realm çš„æœ€æ–°ç‰ˆæœ¬ åœ¨Podfileä¸­ï¼Œæ·»åŠ use_frameworks!å’Œpod â€˜RealmSwiftâ€™ åˆ°æ‚¨çš„ä¸»è¦å’Œæµ‹è¯•ç›®æ ‡ å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Xcode 8ï¼Œé‚£ä¹ˆå°†ä¸‹é¢ä»£ç å¤åˆ¶åˆ°æ‚¨çš„ Podfile åº•éƒ¨ï¼Œä»¥ä¾¿åœ¨å¿…è¦çš„æ—¶å€™æ›´æ–° Swift çš„ç‰ˆæœ¬ï¼š 123456 installer.pods_project.targets.each do |target| target.build_configurations.each do |config| config.build_settings['SWIFT_VERSION'] = '3.0' end endend åœ¨ç»ˆç«¯è¿è¡Œ pod install,é‡‡ç”¨ CocoaPods ç”Ÿæˆçš„ .xcworkspace æ¥è¿è¡Œå·¥ç¨‹ï¼ æ³¨æ„:æˆ‘è¿™è¾¹é€‰ç”¨CocoaPodsçš„æ–¹å¼å®‰è£…, å®‰è£…çš„æ—¶é—´è¿˜æ˜¯éœ€è¦æ¯”è¾ƒå¤šçš„, å¦‚æœå‘ç°pod search RealmSwiftç‰ˆæœ¬æ¯”è¾ƒä½, å…ˆå‡çº§ä¸€ä¸‹podç´¢å¼•åº“ æœ¯è¯­æ”¯æŒçš„ç±»å‹ Realm æ”¯æŒä»¥ä¸‹çš„å±æ€§ç±»å‹ï¼šBoolã€Int8ã€Int16ã€Int32ã€Int64ã€Doubleã€Floatã€Stringã€Dateä»¥åŠDataã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨ List å’Œ Object æ¥å»ºç«‹è¯¸å¦‚ä¸€å¯¹å¤šã€ä¸€å¯¹ä¸€ä¹‹ç±»çš„å…³ç³»æ¨¡å‹ï¼Œæ­¤å¤– Object çš„å­ç±»ä¹Ÿæ”¯æŒæ­¤åŠŸèƒ½ã€‚ æ•°æ®æ¨¡å‹(Object) Realmæ•°æ®æ¨¡å‹æ˜¯åŸºäºæ ‡å‡†Swiftç±»æ¥è¿›è¡Œå®šä¹‰çš„, é€šè¿‡ç®€å•çš„é›†æˆObjectæˆ–è€…å…¶å­ç±», å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Realmæ•°æ®æ¨¡å‹å¯¹è±¡, å¯ä»¥ç»™Realmæ¨¡å‹æ·»åŠ æ–¹æ³•å’Œåè®®ç­‰, ç”¨æ³•å’Œswiftä¸­çš„å…¶ä»–å¯¹è±¡ç±»ä¼¼ Realm æ¨¡å‹çš„å±æ€§éœ€è¦è®¾ç½®ä¸ºdynamic varç‰¹æ€§ï¼Œä»¥ä¾¿å…¶èƒ½å¤Ÿè¢«æ•°æ®åº“åº•å±‚æ•°æ®æ‰€è®¿é—®ã€‚List å’Œ RealmOptional ä¸èƒ½è¢«è®¾ä¸ºåŠ¨æ€å±æ€§ï¼Œå› ä¸ºæ³›å‹å±æ€§ä¸èƒ½åœ¨ Objectiveâ€‘C è¿è¡Œæ—¶ä¸­è¢«è¯†åˆ«ï¼Œè€Œ dynamic å±æ€§ä¼šè¢«ç”¨äºè¿›è¡ŒåŠ¨æ€è°ƒåº¦ã€‚æ­¤å¤–è¿™ä¸¤ä¸ªç±»å‹åº”å½“å§‹ç»ˆå£°æ˜ä¸º let ä¸ºå¯¹è±¡çš„ç±»å‹åˆ—è¡¨æ·»åŠ ç›®æ ‡ç±»å‹çš„å±æ€§ï¼Œæˆ–è€…Listï¼Œå°±å¯ä»¥åˆ›å»ºæ•°æ®å…³ç³»(relationship)å’ŒåµŒå¥—æ•°æ®ç»“æ„(nested data structure)ã€‚ å…³ç³»(Relationships) Object èƒ½å¤Ÿå€ŸåŠ©Objectä»¥åŠListå±æ€§å’Œå¦ä¸€ä¸ªObjectå»ºç«‹è”ç³», Listçš„æ¥å£å’ŒArrayéå¸¸ç±»ä¼¼, èƒ½å¤Ÿé€šè¿‡ç´¢å¼•ä¸‹è¡¨è¿›è¡Œè®¿é—®, ä¸åŒä¹‹å¤„åœ¨äº, Listä¸­åªèƒ½å­˜æ”¾ç®€å•çš„Objectå­ç±»çš„ç±»å‹ äº‹åŠ¡(Transactions) Realm å†™å…¥æ“ä½œæ˜¯åŒæ­¥ä»¥åŠé˜»å¡çš„ï¼Œå¹¶ä¸ä¼šå¼‚æ­¥è¿è¡Œã€‚å¦‚æœçº¿ç¨‹ A å¼€å§‹äº†ä¸€ä¸ªå†™å…¥æ“ä½œï¼Œæ¥ç€åœ¨çº¿ç¨‹ A ç»“æŸä¹‹å‰ï¼Œçº¿ç¨‹ B åˆå¯¹åŒä¸€ä¸ª Realm æ•°æ®åº“å¼€å§‹äº†å†™å…¥æ“ä½œï¼Œé‚£ä¹ˆçº¿ç¨‹ A å¿…é¡»åœ¨çº¿ç¨‹ B çš„å†™å…¥æ“ä½œè¿›è¡Œä¹‹å‰ï¼Œå®Œæˆè‡ªå·±çš„å†™å…¥æ“ä½œï¼Œå¹¶å°†äº‹åŠ¡æäº¤ã€‚å†™å…¥æ“ä½œæ€»ä¼šåœ¨ beginWrite() æ“ä½œè¿›è¡Œçš„æ—¶å€™è‡ªåŠ¨åˆ·æ–°ï¼Œå› æ­¤é‡å¤å†™å…¥ (overlapping write) å¹¶ä¸ä¼šäº§ç”Ÿç«äº‰æ¡ä»¶ã€‚ ç”±äºå†™å…¥äº‹åŠ¡åƒå…¶ä½™ç¡¬ç›˜è¯»å†™æ“ä½œä¸€æ ·ï¼Œä¼šå‡ºç°å¤±è´¥çš„æƒ…å†µï¼Œå› æ­¤ Realm.write() ä»¥åŠ Realm.commitWrite() å¯ä»¥åŠ ä¸Š throwsæ ‡è®°ã€‚å› æ­¤ä½ å¯ä»¥å¤„ç†å’Œæ¢å¤è¯¸å¦‚ç¡¬ç›˜ç©ºé—´æº¢å‡ºä¹‹ç±»çš„é”™è¯¯ã€‚æ­¤å¤–ï¼Œå…¶ä»–çš„é”™è¯¯éƒ½æ— æ³•è¿›è¡Œæ¢å¤ã€‚ ç»“æœé›†(Results) é€šè¿‡æŸ¥è¯¢æ“ä½œï¼ŒRealm å°†ä¼šè¿”å›åŒ…å« Object é›†åˆçš„ Results å®ä¾‹ã€‚Results çš„è¡¨ç°å’Œ Array ååˆ†ç›¸ä¼¼ï¼Œå¹¶ä¸”åŒ…å«åœ¨ Results ä¸­çš„å¯¹è±¡èƒ½å¤Ÿé€šè¿‡ç´¢å¼•ä¸‹æ ‡è¿›è¡Œè®¿é—®ã€‚ æ‰€æœ‰çš„æŸ¥è¯¢åœ¨ Realm ä¸­éƒ½æ˜¯å»¶è¿ŸåŠ è½½çš„ï¼Œåªæœ‰å½“å±æ€§è¢«è®¿é—®æ—¶ï¼Œæ‰èƒ½å¤Ÿè¯»å–ç›¸åº”çš„æ•°æ®ã€‚ æŸ¥è¯¢ç»“æœå¹¶ä¸æ˜¯æ•°æ®çš„æ‹·è´ï¼šä¿®æ”¹æŸ¥è¯¢ç»“æœä¼šç›´æ¥ä¿®æ”¹ç¡¬ç›˜ä¸Šçš„æ•°æ®ã€‚ ä½¿ç”¨åˆ›å»ºæ•°æ®åº“ é»˜è®¤é…ç½®çš„ Realm æ•°æ®åº“é€šè¿‡è°ƒç”¨ Realm() æ¥åˆå§‹åŒ–ä»¥åŠè®¿é—®æˆ‘ä»¬çš„ realm å˜é‡ã€‚è¿™ä¸ªæ–¹æ³•å°†ä¼šè¿”å›ä¸€ä¸ª Realm å¯¹è±¡ï¼Œå¹¶æŒ‡å‘æ‚¨åº”ç”¨çš„ Documents (iOS) æˆ–è€… Application Support (OS X)æ–‡ä»¶å¤¹ä¸‹çš„ä¸€ä¸ªåä¸ºâ€œdefault.realmâ€çš„æ–‡ä»¶ 1let realm = try? Realm() é…ç½®Realmé€šè¿‡Realm.Configurationæ‚¨å¯ä»¥é…ç½®è¯¸å¦‚ Realm æ–‡ä»¶åœ¨ä½•å¤„å­˜å‚¨ä¹‹ç±»çš„ä¿¡æ¯ã€‚é…ç½®åŒæ—¶ä¹Ÿå¯ä»¥åœ¨æ¯æ¬¡æ‚¨éœ€è¦ä½¿ç”¨ Realm å®ä¾‹çš„æ—¶å€™ä¼ é€’ç»™Realm(configuration: config)ï¼Œæˆ–è€…å¯ä»¥é€šè¿‡ Realm.Configuration.defaultConfiguration = config æ¥ä¸ºé»˜è®¤çš„ Realm æ•°æ®åº“è¿›è¡Œé…ç½® 123456789func configRealmWithUser(_ username:String) &#123; var config = Realm.Configuration() config.fileURL = config.fileURL?.deletingLastPathComponent() .appendingPathComponent(\"\\(username).realm\") Realm.Configuration.defaultConfiguration = config &#125; ä½¿ç”¨æ–¹å¼ 12configRealmWithUser(\"simon\")let realm = try! Realm() å†…å­˜æ•°æ®åº“é€šå¸¸æƒ…å†µä¸‹ï¼ŒRealm æ•°æ®åº“æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­çš„ï¼Œä½†æ˜¯æ‚¨èƒ½å¤Ÿé€šè¿‡è®¾ç½® inMemoryIdentifier è€Œä¸æ˜¯è®¾ç½®Realm.Configuration ä¸­çš„ fileURL å±æ€§ï¼Œä»¥åˆ›å»ºä¸€ä¸ªå®Œå…¨åœ¨å†…å­˜ä¸­è¿è¡Œçš„æ•°æ®åº“ã€‚ 1let realm = try! Realm(configuration: Realm.Configuration(inMemoryIdentifier: \"MyInMemoryRealm\")) å†…å­˜æ•°æ®åº“åœ¨æ¯æ¬¡ç¨‹åºè¿è¡ŒæœŸé—´éƒ½ä¸ä¼šä¿å­˜æ•°æ®ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ä¼šå¦¨ç¢åˆ° Realm çš„å…¶ä»–åŠŸèƒ½ï¼ŒåŒ…æ‹¬æŸ¥è¯¢ã€å…³ç³»ä»¥åŠçº¿ç¨‹å®‰å…¨ã€‚ å‡å¦‚æ‚¨éœ€è¦çµæ´»çš„æ•°æ®è¯»å†™ä½†åˆä¸æƒ³å‚¨å­˜æ•°æ®çš„è¯ï¼Œé‚£ä¹ˆå†…å­˜æ•°æ®åº“å¯¹æ‚¨æ¥è¯´ä¸€å®šæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ å†…å­˜æ•°æ®åº“ä¼šåœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­åˆ›å»ºå¤šä¸ªæ–‡ä»¶ï¼Œç”¨æ¥åè°ƒå¤„ç†è¯¸å¦‚è·¨è¿›ç¨‹é€šçŸ¥ä¹‹ç±»çš„äº‹åŠ¡ã€‚ å®é™…ä¸Šæ²¡æœ‰ä»»ä½•çš„æ•°æ®ä¼šè¢«å†™å…¥åˆ°è¿™äº›æ–‡ä»¶å½“ä¸­ï¼Œé™¤éæ“ä½œç³»ç»Ÿç”±äºå†…å­˜è¿‡æ»¡éœ€è¦æ¸…é™¤ç£ç›˜ä¸Šçš„å¤šä½™ç©ºé—´ã€‚ æ³¨æ„ï¼š å½“æ‰€æœ‰å…·å¤‡ç‰¹å®šæ ‡è¯†ç¬¦çš„Realm å†…å­˜æ•°æ®åº“å®ä¾‹è¶…å‡ºå¯ç”¨èŒƒå›´ï¼Œä½†æ˜¯å´æ²¡æœ‰è¢«å¼•ç”¨çš„è¯ï¼Œé‚£ä¹ˆ Realm å†…å­˜æ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šè¢«åˆ é™¤ã€‚æˆ‘ä»¬å»ºè®®æ‚¨åœ¨åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œä¿æŒå¯¹ Realm å†…å­˜æ•°æ®åº“çš„å¼ºå¼•ç”¨ã€‚ï¼ˆå¯¹äºå­˜å‚¨åœ¨ç¡¬ç›˜å½“ä¸­çš„ Realm æ•°æ®åº“è€Œè¨€ï¼Œè¿™å¹¶ä¸æ˜¯å¿…é¡»çš„æ“ä½œã€‚ï¼‰ CRUDå¯¹è±¡123456789101112131415class Person: Object &#123; dynamic var name = \"\" dynamic var age = 0&#125;class Dog: Object &#123; dynamic var id = 0 dynamic var name = \"\" dynamic var age = 0 override static func primaryKey() -&gt; String? &#123; return \"id\" &#125;&#125; æ–°å¢ ä»¥å¯¹è±¡çš„å½¢å¼åˆ›å»º: æ­¤åˆ›å»ºæ–¹å¼, å¦‚æœæœ‰è®¾ç½®ä¸»é”®, åˆ™ä¸èƒ½åˆ›å»ºç›¸åŒçš„ä¸»é”® 1234let mydog = Dog()mydog.name = \"aa\"mydog.age = 20mydog.id = 5 ä»¥æ•°ç»„çš„å½¢å¼åˆ›å»º: å¦‚æœä¸»é”®ç›¸åŒ,åˆ™ä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®, æ²¡æœ‰è®¾ç½®ä¸»é”®, åˆ™updateåªèƒ½ä¸ºfalse 123realm.create(Dog.self, value: [6, \"sssssss\", 747], update: true) ä»¥å­—å…¸çš„å½¢å¼åˆ›å»º: å¦‚æœä¸»é”®ç›¸åŒ,åˆ™ä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®, æ²¡æœ‰è®¾ç½®ä¸»é”®, åˆ™updateåªèƒ½ä¸ºfalse 123realm.create(Dog.self, value: [\"id\":6, \"name\": \"sada\", \"age\":77], update: true) å¤åˆæ¨¡å‹ 1234567891011121314151617// åŸºç¡€æ¨¡å‹class Animal: Object &#123; dynamic var age = 0&#125;// åŒ…å«æœ‰ Animal çš„æ¨¡å‹class Duck: Object &#123; dynamic var animal: Animal? = nil dynamic var name = \"\"&#125;class Frog: Object &#123; dynamic var animal: Animal? = nil dynamic var dateProp = NSDate()&#125;// ç”¨æ³•let duck = Duck(value: [ \"animal\": [ \"age\": 3 ], \"name\": \"Gustav\" ]) Data ç±»å‹å­˜å‚¨(æœ¬åœ°å›¾ç‰‡ä¸ºä¾‹) 1234567891011121314151617class DogPortrait:Object &#123; dynamic var data:Data?&#125;let imageURL = Bundle.main.url(forResource: \"sssss.png\", withExtension: nil)!let imageData = try! Data(contentsOf: imageURL)let portrait = DogPortrait()portrait.data = imageDatatry! realm.write &#123; realm.add(portrait)&#125;// æŸ¥è¯¢let portraits = realm.objects(DogPortrait.self)let imgData = portraits[0].data æŸ¥è¯¢ Realmæ— æ³•ç›´æ¥é™åˆ¶æŸ¥è¯¢æ•°é‡ã€‚ 1let dogs = try! Realm().objects(Dog.self) éœ€è¦æŸ¥è¯¢é™åˆ¶æ•°é‡, å¯ä»¥å€ŸåŠ©forå¾ªç¯ 1234for i in 0..&lt;5 &#123; let dog = dogs[i] // ...&#125; Realmä¸ºä½•æ— æ³•é™åˆ¶æŸ¥è¯¢æ•°é‡ï¼Ÿ é€šå¸¸æŸ¥è¯¢æ•°æ®åº“æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨sqlè¯­å¥ä¸­æ·»åŠ ä¸€äº›é™åˆ¶è¯­å¥ï¼ˆæ¯”å¦‚rownumï¼Œlimitï¼Œtopç­‰ï¼‰æ¥é™åˆ¶è¿”å›çš„ç»“æœé›†çš„è¡Œæ•°ã€‚ä½†æˆ‘ä»¬ä½¿ç”¨Realmä¼šå‘ç°ï¼Œå®ƒæ²¡æœ‰è¿™ç§åˆ†é¡µåŠŸèƒ½ï¼Œæ„Ÿè§‰ä¸ç®¡æŸ¥ä»€ä¹ˆéƒ½æ˜¯æŠŠæ‰€æœ‰çš„ç»“æœéƒ½æå‡ºæ¥ã€‚æ¯”å¦‚æˆ‘ä»¬åªè¦Userè¡¨çš„å‰10æ¡æ•°æ®ï¼Œé‚£ä¹ˆåšæ³•æ˜¯å…ˆæŸ¥è¯¢å‡ºæ‰€æœ‰çš„Useræ•°æ®ï¼Œå†ä»ç»“æœé›†ä¸­å–å‡ºå‰10æ¡æ•°æ®ã€‚æœ‰äººå¯èƒ½ä¼šæ‹…å¿ƒï¼Œå¦‚æœæ•°æ®åº“ä¸­æ•°æ®éå¸¸å¤šï¼Œé‚£æ¯æ¬¡éƒ½è¿™ä¹ˆæŸ¥ä¸ä¼šå½±å“æ€§èƒ½å—ï¼Ÿå…¶å®å¤§å¯æ”¾å¿ƒï¼Œç”±äºRealméƒ½æ˜¯å»¶è¿ŸåŠ è½½çš„ï¼Œåªæœ‰å½“å±æ€§è¢«è®¿é—®æ—¶ï¼Œæ‰èƒ½å¤Ÿè¯»å–ç›¸åº”çš„æ•°æ®ã€‚ä¸åƒé€šå¸¸æ•°æ®åº“ï¼ŒæŸ¥è¯¢åï¼ŒæŸ¥è¯¢ç»“æœæ˜¯ä»æ•°æ®åº“æ‹·è´ä¸€ä»½å‡ºæ¥æ”¾åœ¨å†…å­˜ä¸­çš„ã€‚è€ŒRealmçš„æŸ¥è¯¢ç»“æœåº”è¯¥è¯´æ˜¯æ•°æ®åº“æ•°æ®çš„å¼•ç”¨ï¼Œå°±ç®—ä½ æŸ¥å‡ºæ¥ï¼Œå¦‚æœä¸ç”¨ä¹Ÿä¸ä¼šå ç”¨ä»€ä¹ˆå†…å­˜ã€‚ å¯ä»¥é€šè¿‡Predicateæ¡ä»¶æŸ¥è¯¢ç‰¹å®šæ•°æ® 1234567let results1 = realm.objects(Dog.self)let results = realm.objects(Dog.self).filter(NSPredicate(format: \"name contains 'A'\")) let result2 = results.filter(\"age &gt; 18\")let results3 = realm.objects(Dog.self).filter(NSPredicate(format: \"name contains 'A'\")).filter(\"age &gt; 16\").sorted(byKeyPath: \"age\") // å‡åº 1.NSPredicateï¼š æ¯”è¾ƒæ“ä½œæ•°(comparison operand)å¯ä»¥æ˜¯å±æ€§åç§°æˆ–è€…æŸä¸ªå¸¸é‡ï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªæ“ä½œæ•°å¿…é¡»æ˜¯å±æ€§åç§°ï¼›æ¯”è¾ƒæ“ä½œç¬¦ ==ã€&lt;=ã€&lt;ã€&gt;=ã€&gt;ã€!=, ä»¥åŠ BETWEEN æ”¯æŒ intã€longã€long longã€floatã€double ä»¥åŠ NSDate å±æ€§ç±»å‹çš„æ¯”è¾ƒï¼Œæ¯”å¦‚è¯´ age == 45ï¼›ç›¸ç­‰æ¯”è¾ƒ ==ä»¥åŠ!=ï¼Œæ¯”å¦‚è¯´Results().filter(â€œcompany == %@â€, company)æ¯”è¾ƒæ“ä½œç¬¦ == and != æ”¯æŒå¸ƒå°”å±æ€§ï¼›å¯¹äº NSString å’Œ NSData å±æ€§æ¥è¯´ï¼Œæˆ‘ä»¬æ”¯æŒ ==ã€!=ã€BEGINSWITHã€CONTAINS ä»¥åŠ ENDSWITH æ“ä½œç¬¦ï¼Œæ¯”å¦‚è¯´ name CONTAINS â€˜Jaâ€™ï¼›å­—ç¬¦ä¸²æ”¯æŒå¿½ç•¥å¤§å°å†™çš„æ¯”è¾ƒæ–¹å¼ï¼Œæ¯”å¦‚è¯´ name CONTAINS[c] â€˜Jaâ€™ ï¼Œæ³¨æ„åˆ°å…¶ä¸­å­—ç¬¦çš„å¤§å°å†™å°†è¢«å¿½ç•¥ï¼›Realm æ”¯æŒä»¥ä¸‹å¤åˆæ“ä½œç¬¦ï¼šâ€œANDâ€ã€â€œORâ€ ä»¥åŠ â€œNOTâ€ã€‚æ¯”å¦‚è¯´ name BEGINSWITH â€˜Jâ€™ AND age &gt;= 32ï¼›åŒ…å«æ“ä½œç¬¦ INï¼Œæ¯”å¦‚è¯´ name IN {â€˜Lisaâ€™, â€˜Spikeâ€™, â€˜Hachiâ€™}ï¼›==ã€!=æ”¯æŒä¸ nil æ¯”è¾ƒï¼Œæ¯”å¦‚è¯´ Results().filter(â€œceo == nilâ€)ã€‚æ³¨æ„åˆ°è¿™åªé€‚ç”¨äºæœ‰å…³ç³»çš„å¯¹è±¡ï¼Œè¿™é‡Œ ceo æ˜¯ Company æ¨¡å‹çš„ä¸€ä¸ªå±æ€§ã€‚ANY æ¯”è¾ƒï¼Œæ¯”å¦‚è¯´ ANY student.age &lt; 21æ³¨æ„ï¼Œè™½ç„¶æˆ‘ä»¬ä¸æ”¯æŒå¤åˆè¡¨è¾¾å¼ç±»å‹(aggregate expression type)ï¼Œä½†æ˜¯æˆ‘ä»¬æ”¯æŒå¯¹å¯¹è±¡çš„å€¼ä½¿ç”¨ BETWEEN æ“ä½œç¬¦ç±»å‹ã€‚æ¯”å¦‚è¯´ï¼ŒResults.filter(â€œage BETWEEN %@â€, [42, 43]])ã€‚ 2.æ’åº: sorted(byKeyPath:) ä»¥åŠ sorted(byProperty:) ä¸æ”¯æŒå°†å¤šä¸ªå±æ€§ç”¨ä½œæ’åºåŸºå‡†ï¼Œæ­¤å¤–ä¹Ÿä¸èƒ½é“¾å¼è°ƒç”¨ï¼ˆåªæœ‰æœ€åä¸€ä¸ª sorted ä¼šè¢«è°ƒç”¨ï¼‰ã€‚å¦‚æœè¦æŒ‰å¤šä¸ªå±æ€§è¿›è¡Œæ’åºçš„è¯ï¼Œè¯·ä½¿ç”¨ sorted(by:) æ–¹æ³•ï¼Œç„¶åå‘å…¶ä¸­ä¼ é€’å¤šä¸ª SortDescriptor å¯¹è±¡ ä¿®æ”¹ ç›´æ¥æ›´æ–°å†…å®¹, åœ¨å†™å…¥äº‹åŠ¡ä¸­é€šè¿‡è®¾ç½®æŸä¸ªå¯¹è±¡çš„å±æ€§ä»è€Œå®Œæˆå¯¹è±¡çš„æ›´æ–°æ“ä½œ 12mydog.name = \"aa\"mydog.age = 20 é€šè¿‡ä¸»é”®æ›´æ–°, æ•°æ®æ¨¡å‹ä¸­è®¾ç½®äº†ä¸»é”®çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨Realm().add(_:update:)æ¥æ›´æ–°å¯¹è±¡ï¼Œæˆ–è€…å½“å¯¹è±¡ä¸å­˜åœ¨æ—¶æ’å…¥æ–°çš„å¯¹è±¡ã€‚ 12345678let mydog = Dog()mydog.name = \"aa\"mydog.age = 20mydog.id = 5try! realm.write &#123; realm.add(mydog, update: true)&#125; é”®å€¼ç¼–ç Objectã€Result ä»¥åŠ Listéƒ½éµå®ˆé”®å€¼ç¼–ç (KVCï¼‰æœºåˆ¶, é€‚ç”¨äºå¤§é‡æ›´æ–°æ•°æ® 123try? realm.write &#123; results.first?.setValue(\"33\", forKeyPath: \"age\") &#125; åˆ é™¤ åˆ é™¤æ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ® 1234let realm = try! Realm()try? realm.write &#123; realm.deleteAll() &#125; åˆ é™¤æŸæ¡æ•°æ® 123456let realm = try! Realm() let results = realm.objects(Dog.self).filter(\"age = 33\")realm.beginWrite()realm.delete(dog)try? realm.commitWrite() å±æ€§Realm æ¨¡å‹çš„å±æ€§éœ€è¦è®¾ç½®ä¸ºdynamic varç‰¹æ€§ï¼Œä»¥ä¾¿å…¶èƒ½å¤Ÿè¢«æ•°æ®åº“åº•å±‚æ•°æ®æ‰€è®¿é—®ã€‚List å’Œ RealmOptional ä¸èƒ½è¢«è®¾ä¸ºåŠ¨æ€å±æ€§ï¼Œå› ä¸ºæ³›å‹å±æ€§ä¸èƒ½åœ¨ Objectiveâ€‘C è¿è¡Œæ—¶ä¸­è¢«è¯†åˆ«, List å’Œ RealmOptionalåº”è¯¥ç”¨letä¿®é¥° ç±»å‹ éå¯é€‰å€¼å½¢å¼ å¯é€‰å€¼å½¢å¼ Bool dynamic var value = false let value = RealmOptional() Int dynamic var value = 0 let value = RealmOptional() Float dynamic var value: Float = 0.0 let value = RealmOptional() Double dynamic var value: Double = 0.0 let value = RealmOptional() String dynamic var value = â€œâ€ dynamic var value: String? = nil Data dynamic var value = NSData() dynamic var value: NSData? = nil Date dynamic var value = NSDate() dynamic var value: NSDate? = nil Object n/a: å¿…é¡»æ˜¯å¯é€‰å€¼ dynamic var value: Class? List let value = List() n/a: å¿…é¡»æ˜¯éå¯é€‰å€¼ LinkingObjects let value = LinkingObjects(fromType: Class.self, property: â€œpropertyâ€) n/a: å¿…é¡»æ˜¯éå¯é€‰å€¼ ç´¢å¼•å±æ€§é‡å†™ Object.indexedProperties() æ–¹æ³•å¯ä»¥ä¸ºæ•°æ®æ¨¡å‹ä¸­éœ€è¦æ·»åŠ ç´¢å¼•çš„å±æ€§å»ºç«‹ç´¢å¼•;Realm æ”¯æŒå­—ç¬¦ä¸²ã€æ•´æ•°ã€å¸ƒå°”å€¼ä»¥åŠ NSDate å±æ€§ä½œä¸ºç´¢å¼•;å¯¹å±æ€§è¿›è¡Œç´¢å¼•å¯ä»¥å‡å°‘æ’å…¥æ“ä½œçš„æ€§èƒ½è€—è´¹ï¼ŒåŠ å¿«æ¯”è¾ƒæ£€ç´¢çš„é€Ÿåº¦ã€‚ 123override static func indexedProperties() -&gt; [String] &#123; return [\"id\"]&#125; ä¸»é”®é‡å†™ Object.primaryKey() å¯ä»¥è®¾ç½®æ¨¡å‹çš„ä¸»é”®ã€‚å£°æ˜ä¸»é”®ä¹‹åï¼Œå¯¹è±¡å°†å…è®¸è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä¸”æ›´æ–°é€Ÿåº¦æ›´åŠ é«˜æ•ˆï¼Œè€Œè¿™ä¹Ÿä¼šè¦æ±‚æ¯ä¸ªå¯¹è±¡ä¿æŒå”¯ä¸€æ€§ã€‚ ä¸€æ—¦å¸¦æœ‰ä¸»é”®çš„å¯¹è±¡è¢«æ·»åŠ åˆ° Realm ä¹‹åï¼Œè¯¥å¯¹è±¡çš„ä¸»é”®å°†ä¸å¯ä¿®æ”¹ã€‚ 123override static func primaryKey() -&gt; String? &#123; return \"id\"&#125; å¿½ç•¥å±æ€§é‡å†™ Object.ignoredProperties() å¯ä»¥é˜²æ­¢ Realm å­˜å‚¨æ•°æ®æ¨¡å‹çš„æŸä¸ªå±æ€§ã€‚Realm å°†ä¸ä¼šå¹²æ¶‰è¿™äº›å±æ€§çš„å¸¸è§„æ“ä½œï¼Œå®ƒä»¬å°†ç”±æˆå‘˜å˜é‡(ivar)æä¾›æ”¯æŒï¼Œå¹¶ä¸”æ‚¨èƒ½å¤Ÿè½»æ˜“é‡å†™å®ƒä»¬çš„ setter å’Œ getterã€‚ 12345678dynamic var tmpID = 0var name: String &#123; // åªè¯»å±æ€§å°†è¢«è‡ªåŠ¨å¿½ç•¥ return \"ignoredProperties\"&#125; override static func ignoredProperties() -&gt; [String] &#123; return [\"tmpID\"]&#125; å¯ç©ºå±æ€§ Stringã€NSDate ä»¥åŠ NSData å±æ€§é€šè¿‡æ ‡å‡†çš„ Swift è¯­æ³•å£°æ˜ä¸ºå¯ç©ºç±»å‹æˆ–è€…éç©ºç±»å‹; å£°æ˜å¯ç©ºçš„æ•°å€¼ç±»å‹å¯ä»¥ä½¿ç”¨RealmOptionalã€‚ 1234567891011121314151617class Person: Object &#123; // å¯é€‰çš„å­—ç¬¦ä¸²å±æ€§ï¼Œé»˜è®¤ä¸º nil dynamic var name: String? = nil // å¯é€‰çš„ int å±æ€§ï¼Œé»˜è®¤ä¸º nil // RealmOption å±æ€§åº”è¯¥å§‹ç»ˆå£°æ˜ä¸ºå¸¸é‡ // å› ä¸ºç›®å‰ç›´æ¥ç»™è¿™ä¸ªå±æ€§è¿›è¡Œèµ‹å€¼å¹¶ä¸ä¼šèµ·ä»»ä½•ä½œç”¨ let age = RealmOptional&lt;Int&gt;()&#125;let realm = try? Realm()var objc: optionObjc?try? realm?.write &#123;objc = realm?.create(optionObjc.self, value: [\"sx\", 12], update: false) // è¯»å–æˆ–è€…ä¿®æ”¹ `RealmOptional` å¯ä»¥é€šè¿‡ `value` å±æ€§å®ç° objc?.age.value = 20 &#125; å…³ç³» å¯¹ä¸€å…³ç³»:å¯¹äºå¤šå¯¹ä¸€æˆ–ä¸€å¯¹ä¸€çš„å…³ç³», åªéœ€è¦å£°æ˜ä¸€ä¸ªObjectå­ç±»ç±»å‹çš„å±æ€§å³å¯: 12345678910class Dog: Object &#123; dynamic var id = 0 dynamic var name = \"\" dynamic var age = 0 dynamic var owner: Person? // å¯é€‰&#125;let dog = Dog()let person = Person()dog.owner = person å¯¹å¤šå…³ç³»:é€šè¿‡ List ç±»å‹çš„å±æ€§æ‚¨å¯ä»¥å®šä¹‰ä¸€ä¸ªå¯¹å¤šå…³ç³»ã€‚Listä¸­å¯ä»¥åŒ…å«ç®€å•ç±»å‹çš„Objectï¼Œå…¶æ¥å£ä¸å¯å˜çš„Arrayéå¸¸ç±»ä¼¼ã€‚æ³¨æ„ä½¿ç”¨let 123456789101112131415class Person: Object &#123; dynamic var name = \"\" dynamic var age = 0 let dogs = List&lt;Dog&gt;()&#125;let results = try?Realm().objects(Dog.self).filter(\"age &gt; 18\") let person = Person() person.dogs.append((results?.first)!) person.dogs.append((results?.last)!) try? Realm().write &#123; try? Realm().add(person)&#125; åå‘å…³ç³»Realm æä¾›äº†é“¾æ¥å¯¹è±¡ (linking objects) å±æ€§æ¥è¡¨ç¤ºåå‘å…³ç³» ä¾‹å¦‚ï¼Œä¸€ä¸ª Dog å¯¹è±¡å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªåä¸º owners çš„é“¾æ¥å¯¹è±¡å±æ€§ï¼Œè¿™ä¸ªå±æ€§ä¸­åŒ…å«äº†æŸäº› Person å¯¹è±¡ï¼Œè€Œè¿™äº› Person å¯¹è±¡åœ¨å…¶ dogs å±æ€§ä¸­åŒ…å«äº†è¿™ä¸€ä¸ªç¡®å®šçš„ Dog å¯¹è±¡ã€‚æ‚¨å¯ä»¥å°† owners å±æ€§è®¾ç½®ä¸º LinkingObjects ç±»å‹ï¼Œç„¶åæŒ‡å®šå…¶å…³ç³»ï¼Œè¯´æ˜å…¶å½“ä¸­åŒ…å«äº† Person å¯¹è±¡ã€‚ 123456789101112131415161718192021222324252627class Dog: Object &#123; dynamic var name = \"\" dynamic var age = 0 // Realm å¹¶ä¸ä¼šå­˜å‚¨è¿™ä¸ªå±æ€§ï¼Œå› ä¸ºè¿™ä¸ªå±æ€§åªå®šä¹‰äº† getter // å®šä¹‰â€œownersâ€ï¼Œå’Œ Person.dogs å»ºç«‹åå‘å…³ç³» let owners = LinkingObjects(fromType: Person.self, property: \"dogs\") &#125;func RealmBackLink() &#123; let realm = try! Realm() let dog1 = Dog() dog1.name = \"ssssx\" dog1.age = 22 let owner = Person() owner.dogs.append(dog1) try! realm.write &#123; // åªéœ€å­˜å‚¨personå³å¯ realm.add(owner) &#125; let dogs = realm.objects(Dog.self) let ownerName = dogs.first?.owners.map&#123;$0.name&#125; print(ownerName)&#125; å¤šçº¿ç¨‹éœ€è¦æ³¨æ„çš„ä¸€ä»¶äº‹æƒ…å°±æ˜¯ä¸èƒ½è®©å¤šä¸ªçº¿ç¨‹éƒ½æŒæœ‰åŒä¸€ä¸ª Realm å¯¹è±¡çš„ å®ä¾‹ ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹éœ€è¦è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒä»¬åˆ†åˆ«ä¼šè·å–è‡ªå·±æ‰€éœ€è¦çš„å®ä¾‹ï¼ˆå¦åˆ™åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šå‘ç”Ÿçš„æ›´æ”¹å°±ä¼šé€ æˆå…¶ä»–çº¿ç¨‹å¾—åˆ°ä¸å®Œæ•´æˆ–è€…ä¸ä¸€è‡´çš„æ•°æ®ï¼‰ è·¨çº¿ç¨‹ä¼ é€’å®ä¾‹Object çš„æœªç®¡ç†å®ä¾‹ï¼ˆunmanaged) å¯ä»¥å®‰å…¨åœ°è·¨çº¿ç¨‹ä¼ é€’, ç®¡ç†å®ä¾‹çš†å—åˆ°çº¿ç¨‹çš„é™åˆ¶(Realmã€Objectã€Results æˆ–è€… List), è¿™æ„å‘³ç€å®ƒä»¬åªèƒ½å¤Ÿåœ¨è¢«åˆ›å»ºçš„çº¿ç¨‹ä¸Šä½¿ç”¨ã€‚Realm æä¾›äº†ä¸€ä¸ªæœºåˆ¶ï¼Œé€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤æ¥ä¿è¯å—åˆ°çº¿ç¨‹é™åˆ¶çš„å®ä¾‹èƒ½å¤Ÿå®‰å…¨ä¼ é€’: é€šè¿‡å—åˆ°çº¿ç¨‹é™åˆ¶çš„å¯¹è±¡æ¥æ„é€ ä¸€ä¸ª ThreadSafeReference å°†æ­¤ ThreadSafeReference ä¼ é€’ç»™ç›®æ ‡çº¿ç¨‹æˆ–è€…é˜Ÿåˆ— é€šè¿‡åœ¨ç›®æ ‡ Realm ä¸Šè°ƒç”¨ Realm.resolve(_:) æ¥è§£ææ­¤å¼•ç”¨ 12345678910111213141516let person = Person(name: \"Jane\")try! realm.write &#123; realm.add(person)&#125;let personRef = ThreadSafeReference(to: person)DispatchQueue(label: \"background\").async &#123; autoreleasepool &#123; let realm = try! Realm() guard let person = realm.resolve(personRef) else &#123; return // person å·²è¢«åˆ é™¤ &#125; try! realm.write &#123; person.name = \"Jane Doe\" &#125; &#125;&#125; ThreadSafeReferenceå¯¹è±¡æœ€å¤šåªèƒ½å¤Ÿè§£æä¸€æ¬¡;ThreadSafeReference è§£æå¤±è´¥çš„è¯ï¼Œå°†ä¼šå¯¼è‡´ Realm çš„åŸå§‹ç‰ˆæœ¬è¢«é”æ­»ï¼Œç›´åˆ°å¼•ç”¨è¢«é‡Šæ”¾ä¸ºæ­¢ã€‚å› æ­¤ï¼ŒThreadSafeReference çš„ç”Ÿå‘½å‘¨æœŸåº”è¯¥å¾ˆçŸ­(åŠ ä¸Šautoreleasepool)ã€‚ è¿™äº›ç±»å‹çš„æŸäº›å±æ€§å’Œæ–¹æ³•å¯ä»¥åœ¨ä»»æ„çº¿ç¨‹ä¸­è¿›è¡Œè®¿é—® Realm: æ‰€æœ‰çš„å±æ€§ã€ç±»æ–¹æ³•å’Œæ„é€ å™¨ï¼›all properties, class methods, and initializers Object: isInvalidatedã€objectSchemaã€realmï¼Œä»¥åŠæ‰€æœ‰çš„ç±»æ–¹æ³•å’Œæ„é€ å™¨ï¼›Results: objectClassName å’Œ realm List: isInvalidatedã€objectClassName å’Œ realmã€‚ è·¨çº¿ç¨‹ä½¿ç”¨æ•°æ®åº“åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ä½¿ç”¨åŒä¸€ä¸ª Realm æ–‡ä»¶, éœ€è¦åœ¨æ¯ä¸€ä¸ªçº¿ç¨‹åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„Realm å®ä¾‹, åªè¦æŒ‡å®šçš„é…ç½®æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ Realm å®ä¾‹éƒ½å°†ä¼šæŒ‡å‘ç¡¬ç›˜ä¸Šçš„åŒä¸€ä¸ªæ–‡ä»¶ã€‚ æš‚æ—¶ä¸æ”¯æŒå…±äº«Realmå®ä¾‹ å½“å†™å…¥å¤§é‡æ•°æ®çš„æ—¶å€™ï¼Œåœ¨ä¸€ä¸ªå•ç‹¬äº‹åŠ¡ä¸­é€šè¿‡æ‰¹é‡æ‰§è¡Œå¤šæ¬¡æ•°æ®ä¿®æ”¹æ“ä½œæ˜¯éå¸¸é«˜æ•ˆçš„ã€‚äº‹åŠ¡ä¹Ÿå¯ä»¥ä½¿ç”¨ Grand Central Dispatch(GCD) åœ¨åå°è¿è¡Œï¼Œä»¥é˜²æ­¢é˜»å¡ä¸»çº¿ç¨‹ã€‚ Realm å¯¹è±¡å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”å®ƒä¹Ÿä¸èƒ½å¤Ÿè·¨çº¿ç¨‹å…±äº«ï¼Œå› æ­¤è¦ä¸ºæ¯ä¸€ä¸ªè¦æ‰§è¡Œè¯»å–æˆ–è€…å†™å…¥æ“ä½œçš„çº¿ç¨‹æˆ–è€… dispatch é˜Ÿåˆ—åˆ›å»ºä¸€ä¸ª Realm å®ä¾‹ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªåœ¨åå°é˜Ÿåˆ—ä¸­æ’å…¥ç™¾ä¸‡æ•°æ®çš„ä¾‹å­ï¼š 12345678910111213141516171819202122DispatchQueue(label: \"background\").async &#123; autoreleasepool &#123; // åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­è·å– Realm å’Œè¡¨å®ä¾‹ let realm = try! Realm() // é€šè¿‡å¼€å¯å†™å…¥æ“ä½œå°†å†™å…¥é—­åŒ…åˆ†æˆå¤šä¸ªå¾®å°éƒ¨åˆ† for idx1 in 0..&lt;1000 &#123; realm.beginWrite() // é€šè¿‡å­—å…¸æ’å…¥è¡Œï¼Œå¿½ç•¥å±æ€§æ¬¡åº for idx2 in 0..&lt;1000 &#123; realm.create(Person.self, value: [ \"name\": \"\\(idx1)\", \"birthdate\": Date(timeIntervalSince1970: TimeInterval(idx2)) ]) &#125; // æäº¤å†™å…¥äº‹åŠ¡ä»¥ç¡®ä¿æ•°æ®åœ¨å…¶ä»–çº¿ç¨‹å¯ç”¨ try! realm.commitWrite() &#125; &#125;&#125; JsonRealm æ²¡æœ‰æä¾›å¯¹ JSON çš„ç›´æ¥æ”¯æŒï¼Œä½†å¯ä»¥ä½¿ç”¨ NSJSONSerialization.JSONObjectWithData(_:options:) çš„è¾“å‡ºå®Œæˆä» JSON ä¸­æ·»åŠ  Object çš„æ“ä½œã€‚ ç”±æ­¤æ‰€äº§ç”Ÿçš„ KVC å…¼å®¹çš„å¯¹è±¡å¯ä»¥ä½¿ç”¨åˆ›å»ºå’Œæ›´æ–°å¯¹è±¡çš„ æ ‡å‡† API æ¥æ·»åŠ /æ›´æ–° Objectã€‚ 123456789101112131415// è¡¨ç¤ºåŸå¸‚çš„ä¸€ä¸ª Realm å¯¹è±¡class City: Object &#123; dynamic var city = \"\" dynamic var id = 0 // å…¶å®ƒç©ºä½™çš„å±æ€§â€¦&#125;let data = \"&#123;\\\"name\\\": \\\"San Francisco\\\", \\\"cityId\\\": 123&#125;\".data(using: .utf8)!let realm = try! Realm()// ä»åŒ…å« JSON çš„ NSData ä¸­æ’å…¥æ•°æ®try! realm.write &#123; let json = try! JSONSerialization.jsonObject(with: data, options: []) realm.create(City.self, value: json, update: true)&#125; å¦‚æœåœ¨ JSON ä¸­åŒ…å«äº†åµŒå¥—çš„å¯¹è±¡æˆ–è€…æ•°ç»„çš„è¯ï¼Œè¿™äº›æ•°æ®éƒ½å°†è¢«è‡ªåŠ¨æ˜ å°„åˆ°å¯¹ä¸€ä»¥åŠå¯¹å¤šå…³ç³»â€”â€”å‚è§åµŒå¥—å¯¹è±¡ ä¸€èŠ‚è·å–è¯¦æƒ…ã€‚ å½“ä½¿ç”¨è¿™ç§æ–¹æ³•åœ¨ Realm ä¸­æ’å…¥æˆ–è€…æ›´æ–° JSON æ•°æ®çš„æ—¶å€™ï¼Œè¦æ³¨æ„ Realm éœ€è¦ç¡®ä¿ JSON çš„å±æ€§åå’Œç±»å‹èƒ½å¤Ÿä¸ Object å±æ€§å®Œå…¨åŒ¹é…ã€‚ä¾‹å¦‚ï¼š float å±æ€§åº”å½“ä½¿ç”¨ float è¿›è¡Œåˆå§‹åŒ–â€”â€”æ‚¨ä¹Ÿå¯ä»¥é€‰æ‹© NSNumbersã€‚ NSDate å’Œ NSData å±æ€§æ— æ³•ä»å­—ç¬¦ä¸²è¿›è¡Œè‡ªåŠ¨æ¨æ–­ï¼Œè€Œåº”è¯¥åœ¨ä¼ é€’ç»™ Realm().create(_:value:update:) ä¹‹å‰è½¬æ¢ä¸ºé€‚å½“çš„ç±»å‹ã€‚ å¦‚æœ JSON ä¸­çš„å±æ€§æ˜¯ null (ä¾‹å¦‚ï¼šNSNull) æä¾›ç»™äº†ä¸€ä¸ªå¿…éœ€å±æ€§çš„è¯ï¼Œé‚£ä¹ˆä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœæŸä¸ªå¿…éœ€å±æ€§åœ¨æ’å…¥æ“ä½œä¸­æ²¡æœ‰æä¾›çš„è¯ï¼Œé‚£ä¹ˆä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ Realm å°†ä¼šå¿½ç•¥ JSON ä¸­æ²¡æœ‰ä»¥ Object å®šä¹‰çš„ä»»ä½•å±æ€§ã€‚ å¦‚æœ JSON æ¨¡å¼å’Œ Realm å¯¹è±¡æ— æ³•å®Œå…¨ä¸€è‡´çš„è¯ï¼Œæ¨èä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æ¨¡å‹æ˜ å°„æ¡†æ¶ã€‚ é€šçŸ¥ Realmé€šçŸ¥ é€šçŸ¥é—­åŒ…-å¯ä»¥åœ¨æ•´ä¸ª Realm æ•°æ®åº“ä¸Šè¿›è¡Œæ³¨å†Œã€‚å½“ç›¸å…³ Realm çš„å†™æ“ä½œäº‹åŠ¡è¢«æäº¤ä¹‹åï¼Œæ— è®ºè¿™ä¸ªäº‹åŠ¡å‘ç”Ÿåœ¨ä½•ç§çº¿ç¨‹æˆ–è€…ä½•ç§è¿›ç¨‹ä¹‹ä¸­ï¼Œè¿™ä¸ªé€šçŸ¥å¤„ç†é—­åŒ…éƒ½å°†ä¼šè¢«è§¦å‘ï¼š 12345678910111213141516let realm = try? Realm()print(realm?.configuration.fileURL as Any)let token = realm?.addNotificationBlock(&#123; (note, realm) in print(note, realm)&#125;) try? realm?.write &#123; realm?.create(Dog.self, value: [\"id\":1, \"name\": \"xssx\"], update: true) // æ‰§è¡Œé€šçŸ¥é—­åŒ…&#125; token?.stop() // å…³é—­é€šçŸ¥ try? realm?.write &#123; realm?.create(Dog.self, value: [\"name\": \"stopxssx\"], update: true)// ä¸æ‰§è¡Œé€šçŸ¥é—­åŒ…&#125; é›†åˆé€šçŸ¥é›†åˆé€šçŸ¥æ˜¯å¼‚æ­¥è§¦å‘çš„ï¼Œé¦–å…ˆå®ƒä¼šåœ¨åˆå§‹åŒ–çš„æ—¶å€™è§¦å‘ï¼Œéšåå½“æŸä¸ªå†™å…¥äº‹åŠ¡æ”¹å˜äº†é›†åˆä¸­çš„æ‰€æœ‰æˆ–è€…æŸä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œé€šçŸ¥éƒ½ä¼šå†æ¬¡è§¦å‘ã€‚æ‰€æœ‰çš„CRUDéƒ½ä¼šä¼ é€’åˆ°é€šçŸ¥é—­åŒ…å½“ä¸­çš„ RealmCollectionChange(æšä¸¾) å‚æ•°è®¿é—®åˆ°ã€‚è¿™ä¸ªå¯¹è±¡å½“ä¸­åŒ…å«äº†å— deletionsã€insertions å’Œ modifications çŠ¶æ€æ‰€å½±å“çš„ç´¢å¼•ä¿¡æ¯, å…¶å®šä¹‰å¦‚ä¸‹: 12345public enum RealmCollectionChange&lt;T&gt; &#123; case initial(T) // åˆå§‹åŒ–ä¼šæ‰§è¡Œ case update(T, deletions: [Int], insertions: [Int], modifications: [Int]) case error(Error)&#125; å¦‚æœå¤„ç†é›†åˆä¸­çš„å¯¹è±¡çš„å±æ€§å‘ç”Ÿæ›´æ”¹, éƒ½å¯ä»¥ç›‘å¬çš„åˆ°ä¿®æ”¹ (modifications) çš„é€šçŸ¥, å½“å¯¹ä¸€å…³ç³»å’Œå¯¹å¤šå…³ç³» å‘ç”Ÿå˜åŒ–æ—¶ä¹Ÿä¼šè§¦å‘è¿™ä¸ªçŠ¶æ€å˜åŒ–ï¼Œä½†æ˜¯å¯¹äº åå‘å…³ç³» æ¥è¯´åˆ™ä¸ä¼šè§¦å‘è¿™ä¸ªå˜åŒ–ã€‚ ä»¥tableViewä¸ºä¾‹å­,ç›‘å¬æ•°æ®æºçš„æ”¹å˜, åšå‡ºç›¸åº”æ›´æ”¹, å½“ç„¶å¯ä»¥é‡å†™æ•°æ®æºçš„setæ–¹æ³•, ä½†å¦‚æœæ•°æ®æºé‡Œçš„æŸä¸€ä¸ªæ•°æ®é‡Œçš„å±æ€§å‘ç”Ÿäº†æ›´æ”¹, æ˜¯æ— æ³•ç›‘å¬çš„åˆ°, å½“ç„¶å¯ä»¥ç»“åˆKVO,ä½†è¿™æ ·ä¸€æ¥å°±ç›¸å¯¹å¤æ‚äº†; soé›†åˆé€šçŸ¥è¿˜æ˜¯æŒºå®ç”¨çš„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051class Dog: Object &#123; dynamic var name = \"\" dynamic var age = 0&#125;class Person: Object &#123; dynamic var name = \"\" let dogs = List&lt;Dog&gt;()&#125;class ViewController: UITableViewController &#123; var notificationToken: NotificationToken? = nil override func viewDidLoad() &#123; super.viewDidLoad() let realm = try! Realm() // å¯¹resultsçš„ç›‘å¬ let results = realm.objects(Person).filter(\"age &gt; 5\") // è§‚å¯Ÿ Results é€šçŸ¥ notificationToken = results.addNotificationBlock &#123; [weak self] (changes: RealmCollectionChange) in guard let tableView = self?.tableView else &#123; return &#125; switch changes &#123; case .initial: // Results ç°åœ¨å·²ç»å¡«å……å®Œæ¯•ï¼Œå¯ä»¥ä¸éœ€è¦é˜»å¡ UI å°±å¯ä»¥è¢«è®¿é—® tableView.reloadData() break case .update(_, let deletions, let insertions, let modifications): // Query results have changed, so apply them to the UITableView tableView.beginUpdates() tableView.insertRows(at: insertions.map(&#123; IndexPath(row: $0, section: 0) &#125;), with: .automatic) tableView.deleteRows(at: deletions.map(&#123; IndexPath(row: $0, section: 0)&#125;), with: .automatic) tableView.reloadRows(at: modifications.map(&#123; IndexPath(row: $0, section: 0) &#125;), with: .automatic) tableView.endUpdates() break case .error(let error): // å¦‚æœåœ¨åå°å·¥ä½œçº¿ç¨‹ä¸­æ‰“å¼€ Realm æ–‡ä»¶ï¼Œåˆ™ä¼šå‘ç”Ÿé”™è¯¯ fatalError(\"\\(error)\") break &#125; &#125; &#125; deinit &#123; notificationToken?.stop() &#125;&#125; å¯¹è±¡é€šçŸ¥ Realm æ”¯æŒå¯¹è±¡çº§åˆ«çš„é€šçŸ¥ã€‚åœ¨ç‰¹å®šçš„ Realm å¯¹è±¡ä¸Šè¿›è¡Œé€šçŸ¥çš„æ³¨å†Œï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ­¤å¯¹è±¡è¢«åˆ é™¤æ—¶ã€æˆ–è€…è¯¥å¯¹è±¡æ‰€ç®¡ç†çš„å±æ€§å€¼è¢«ä¿®æ”¹æ—¶è·å–ç›¸åº”çš„é€šçŸ¥ã€‚ åªæœ‰ç”± Realm æ•°æ®åº“æ‰€ç®¡ç†çš„å¯¹è±¡æ‰èƒ½å¤Ÿè¿›è¡Œé€šçŸ¥æ³¨å†Œã€‚ è¿™ä¸ªé€šçŸ¥å¤„ç†é—­åŒ…å°†åŒ…å«æœ‰ ObjectChange æšä¸¾å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æœ‰å¯¹è±¡è¢«åˆ é™¤ã€æ˜¯å¦æœ‰å¯¹è±¡çš„å±æ€§å€¼å‘ç”Ÿäº†æ”¹å˜ï¼Œä»¥åŠæ˜¯å¦æœ‰é”™è¯¯å‘ç”Ÿã€‚ å¯¹è±¡è¢«åˆ é™¤çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªé€šçŸ¥é—­åŒ…å°†ä¼šå¸¦ç€ ObjectChange.deleted çš„å‚æ•°è¢«è°ƒç”¨ã€‚è¿™ä¸ªé—­åŒ…å°†ä¸ä¼šè¢«å†æ¬¡è°ƒç”¨ã€‚ å¯¹è±¡çš„å±æ€§å‘ç”Ÿäº†å˜æ›´çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªé—­åŒ…å°†ä¼šå¸¦ç€ ObjectChange.change çš„å‚æ•°è¢«è°ƒç”¨ã€‚è¿™ä¸ªæšä¸¾å°†ä¼šåŒ…å«æœ‰ PropertyChange ç±»å‹çš„æ•°ç»„ã€‚æ¯ä¸ªæ•°ç»„å€¼éƒ½åŒ…å«æœ‰è¢«ä¿®æ”¹çš„å±æ€§å(ä»¥å­—ç¬¦ä¸²çš„å½¢å¼æä¾›)ã€ä¿®æ”¹å‰çš„å±æ€§å€¼ä»¥åŠå½“å‰çš„å±æ€§å€¼ã€‚ æœ‰é”™è¯¯å‘ç”Ÿï¼Œé‚£ä¹ˆè¿™ä¸ªé—­åŒ…å°†ä¼šå¸¦æœ‰ ObjectChange.error çš„å‚æ•°è¢«è°ƒç”¨ã€‚è¿™ä¸ªé—­åŒ…å°†ä¸ä¼šè¢«å†æ¬¡è°ƒç”¨ã€‚ 12345public enum ObjectChange &#123; case error(_: NSError) case change(_: [PropertyChange]) case deleted&#125; 1234567891011121314151617181920212223class StepCounter: Object &#123; dynamic var steps = 0&#125;let stepCounter = StepCounter()let realm = try! Realm()try! realm.write &#123; realm.add(stepCounter)&#125;var token : NotificationToken?token = stepCounter.addNotificationBlock &#123; change in switch change &#123; // ç›‘å¬å¯¹è±¡ case .change(let properties): for property in properties &#123; if property.name == \"steps\" &amp;&amp; property.newValue as! Int &gt; 1000 &#123; token = nil &#125; &#125; case .error(let error): case .deleted: &#125;&#125; ç•Œé¢é©±åŠ¨æ›´æ–°Realm çš„é€šçŸ¥æ€»æ˜¯ä»¥å¼‚æ­¥çš„æ–¹å¼è¿›è¡Œä¼ é€’ï¼Œå› æ­¤è¿™äº›æ“ä½œæ°¸è¿œä¸ä¼šé˜»å¡ä¸» UI çº¿ç¨‹ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´åº”ç”¨å¡é¡¿ã€‚å¦‚æœéœ€è¦åœ¨ä¸»çº¿ç¨‹åŒæ­¥ä¼ é€’, å¹¶ç«‹å³æ›´æ–°åœ¨UIä¸Š, å°±å¯ä»¥ä½¿ç”¨ç•Œé¢é©±åŠ¨æ›´æ–° (Interface-Driven writes)ã€‚ æ¡ˆä¾‹: å‡è®¾ç”¨æˆ·éœ€è¦å‘è¡¨è§†å›¾å½“ä¸­æ’å…¥ä¸€ä¸ªé¡¹ç›®ã€‚ç†æƒ³çŠ¶å†µä¸‹ï¼ŒUI å°†ä¼šå°†è¿™ä¸ªæ“ä½œç”¨åŠ¨ç”»è¡¨ç°å‡ºæ¥ï¼Œç„¶åå½“ç”¨æˆ·å®ŒæˆåŠ¨ä½œçš„æ—¶å€™ç«‹å³å¯åŠ¨ç›¸åº”çš„æ“ä½œã€‚ ç„¶è€Œï¼Œæ­¤æ’å…¥æ“ä½œçš„ Realm å˜æ›´é€šçŸ¥å°†ä¼šå»¶æ—¶ä¸€æ®µæ—¶é—´æ‰è¿›è¡Œä¼ é€’ï¼Œå®ƒä¼šå…ˆå°†ä¸€ä¸ªå¯¹è±¡æ·»åŠ åˆ°è¡¨è§†å›¾èƒŒåæ‰€å…³è”çš„é›†åˆå½“ä¸­ï¼Œéšåå†å°è¯•å»åœ¨ UI å½“ä¸­æ’å…¥ä¸€ä¸ªæ–°çš„é¡¹ç›®ã€‚è¿™ç§åŒé‡æ’å…¥å°†ä¼šå¯¼è‡´ UI ä¸åå°æ•°æ®ä¹‹é—´çš„æ•°æ®ä¸ä¸€è‡´ï¼Œè€Œè¿™å¾€å¾€ä¼šå¯¼è‡´åº”ç”¨å´©æºƒï¼ğŸ’¥NSInternalInconsistencyExceptionğŸ’¥ å€ŸåŠ© Realm.commitWrite(withoutNotifying:)ï¼Œè¿™æ ·åœ¨æ‰§è¡Œç•Œé¢é©±åŠ¨æ›´æ–°çš„æ—¶å€™ï¼Œé€šè¿‡ä¼ é€’é€šçŸ¥é—­åŒ…çš„é€šçŸ¥ä»¤ç‰Œçš„æ–¹å¼ï¼Œè¿™æ ·å°±ä¸ä¼šå¯¹å˜æ›´æ“ä½œæ‰§è¡ŒäºŒæ¬¡å“åº”ã€‚ 1234567891011121314151617181920212223242526272829token = collection.addNotificationBlock &#123; changes in switch changes &#123; case .initial: tableView.reloadData() break case .update(_, let deletions, let insertions, let modifications): tableView.beginUpdates() tableView.insertRows(at: insertions.map(&#123; IndexPath(row: $0, section: 0) &#125;), with: .automatic) tableView.deleteRows(at: deletions.map(&#123; IndexPath(row: $0, section: 0)&#125;), with: .automatic) tableView.reloadRows(at: modifications.map(&#123; IndexPath(row: $0, section: 0) &#125;), with: .automatic) tableView.endUpdates() break case .error(let error): break &#125;&#125;func insertItem() throws &#123; // åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ collection.realm!.beginWrite() collection.insert(Item(), at: 0) tableView.insertRows(at: [IndexPath(row: 0, section: 0)], with: .automatic) // ç¡®ä¿ä¸ä¼šé‡å¤æ‰§è¡Œ collection.realm!.commitWrite(withoutNotifying: [token])&#125; æ•°æ®åº“è¿ç§»å¦‚æœä¿®æ”¹äº†æ•°æ®æ¨¡å‹, ä¾‹å¦‚æ–°å¢å±æ€§, å°±éœ€è¦è¿›è¡Œæ•°æ®çš„è¿ç§» ç®€å•è¯´æ˜ 123456789101112131415161718192021222324252627282930313233/* Realm.Configuration(fileURL: &lt;#T##URL?#&gt;, inMemoryIdentifier: &lt;#T##String?#&gt;, syncConfiguration: &lt;#T##SyncConfiguration?#&gt;, encryptionKey: &lt;#T##Data?#&gt;, readOnly: &lt;#T##Bool#&gt;, schemaVersion: &lt;#T##UInt64#&gt;, migrationBlock: &lt;#T##MigrationBlock?##MigrationBlock?##(Migration, UInt64) -&gt; Void#&gt;, deleteRealmIfMigrationNeeded: &lt;#T##Bool#&gt;, shouldCompactOnLaunch: &lt;#T##((Int, Int) -&gt; Bool)?##((Int, Int) -&gt; Bool)?##(Int, Int) -&gt; Bool#&gt;, objectTypes: &lt;#T##[Object.Type]?#&gt;)*/func configRealmWithUser(_ username:String) &#123; var config = Realm.Configuration() config.fileURL = config.fileURL?.deletingLastPathComponent() .appendingPathComponent(\"\\(username).realm\")// config.syncConfiguration = // config.migrationBlock = // config.schemaVersion = // ... Realm.Configuration.defaultConfiguration = config&#125;æˆ–:å‚æ•°çš„ä¸ªæ•°ä»»æ„ç»„åˆçš„blockå½¢å¼let config = Realm.Configuration( schemaVersion: 1, migrationBlock: &#123; (migration, oldSchemaVersion) in if (oldSchemaVersion &lt; 1) &#123; // ä»€ä¹ˆéƒ½ä¸è¦åšï¼Realm ä¼šè‡ªè¡Œæ£€æµ‹æ–°å¢å’Œéœ€è¦ç§»é™¤çš„å±æ€§ï¼Œç„¶åè‡ªåŠ¨æ›´æ–°ç¡¬ç›˜ä¸Šçš„æ•°æ®åº“æ¶æ„ &#125;&#125;)Realm.Configuration.defaultConfiguration = config å€¼çš„æ›´æ–° åœ¨è¿ç§»é—­åŒ…ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè°ƒç”¨Migration().enumerateObjects(ofType: ::) æ¥æšä¸¾ç‰¹å®šç±»å‹çš„æ¯ä¸ª Object å¯¹è±¡ï¼Œç„¶åæ‰§è¡Œå¿…è¦çš„è¿ç§»é€»è¾‘ã€‚æ³¨æ„ï¼Œå¯¹æšä¸¾ä¸­æ¯ä¸ªå·²å­˜åœ¨çš„ Object å®ä¾‹æ¥è¯´ï¼Œåº”è¯¥æ˜¯é€šè¿‡è®¿é—® oldObject å¯¹è±¡è¿›è¡Œè®¿é—®ï¼Œè€Œæ›´æ–°ä¹‹åçš„å®ä¾‹åº”è¯¥é€šè¿‡ newObject è¿›è¡Œè®¿é—®ï¼š 123456789101112131415// åœ¨ application(application:didFinishLaunchingWithOptions:) ä¸­è¿›è¡Œé…ç½®Realm.Configuration.defaultConfiguration = Realm.Configuration( schemaVersion: 1, migrationBlock: &#123; migration, oldSchemaVersion in if (oldSchemaVersion &lt; 1) &#123; // enumerateObjects(ofType:_:) æ–¹æ³•éå†äº†å­˜å‚¨åœ¨ Realm æ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ªâ€œPersonâ€å¯¹è±¡ migration.enumerateObjects(ofType: Person.className()) &#123; oldObject, newObject in // å°†åå­—è¿›è¡Œåˆå¹¶ï¼Œå­˜æ”¾åœ¨ fullName åŸŸä¸­ let firstName = oldObject![\"firstName\"] as! String let lastName = oldObject![\"lastName\"] as! String newObject![\"fullName\"] = \"\\(firstName) \\(lastName)\" &#125; &#125; &#125;) å±æ€§çš„é‡å‘½å åœ¨è¿ç§»è¿‡ç¨‹ä¸­å¯¹ç±»ä¸­æŸä¸ªå±æ€§è¿›è¡Œé‡å‘½åæ“ä½œï¼Œæ¯”èµ·æ‹·è´å€¼å’Œä¿ç•™å…³ç³»æ¥è¯´è¦æ›´ä¸ºé«˜æ•ˆã€‚ è¦åœ¨è¿ç§»è¿‡ç¨‹ä¸­å¯¹æŸä¸ªå±æ€§å°±è¿›è¡Œé‡å‘½åçš„è¯ï¼Œè¯·ç¡®ä¿æ‚¨çš„æ–°æ¨¡å‹å½“ä¸­çš„è¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªå…¨æ–°çš„åå­—ï¼Œå®ƒçš„åå­—ä¸èƒ½å’ŒåŸæœ‰æ¨¡å‹å½“ä¸­çš„åå­—é‡åˆã€‚ å¦‚æœæ–°çš„å±æ€§æ‹¥æœ‰ä¸åŒçš„å¯ç©ºæ€§æˆ–è€…ç´¢å¼•è®¾ç½®çš„è¯ï¼Œè¿™äº›é…ç½®ä¼šåœ¨é‡å‘½åæ“ä½œæœŸé—´ç”Ÿæ•ˆã€‚ 1234567891011// åœ¨ application(application:didFinishLaunchingWithOptions:) å½“ä¸­ä½¿ç”¨Realm.Configuration.defaultConfiguration = Realm.Configuration( schemaVersion: 1, migrationBlock: &#123; migration, oldSchemaVersion in // æˆ‘ä»¬ç›®å‰è¿˜æ²¡æœ‰è¿ç§»ä»»ä½•ä¸œè¥¿ï¼Œå› æ­¤ oldSchemaVersion == 0 if (oldSchemaVersion &lt; 1) &#123; // é‡å‘½åæ“ä½œåº”è¯¥åœ¨è°ƒç”¨ `enumerateObjects(ofType: _:)` ä¹‹å¤–å®Œæˆ migration.renameProperty(onType: Person.className(), from: \"yearsSinceBirth\", to: \"age\") &#125; &#125;) å¤šä¸ªç‰ˆæœ¬çš„æ§åˆ¶ 123456789101112131415161718192021Realm.Configuration.defaultConfiguration = Realm.Configuration( schemaVersion: 2, migrationBlock: &#123; migration, oldSchemaVersion in // enumerateObjects:block: éå†äº†å­˜å‚¨åœ¨ Realm æ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ªâ€œPersonâ€å¯¹è±¡ migration.enumerateObjects(ofType: Person.className()) &#123; oldObject, newObject in // åªæœ‰å½“ Realm æ•°æ®åº“çš„æ¶æ„ç‰ˆæœ¬ä¸º 0 çš„æ—¶å€™ï¼Œæ‰æ·»åŠ  â€œfullNameâ€ å±æ€§ if oldSchemaVersion &lt; 1 &#123; let firstName = oldObject![\"firstName\"] as! String let lastName = oldObject![\"lastName\"] as! String newObject![\"fullName\"] = \"\\(firstName) \\(lastName)\" &#125; // åªæœ‰å½“ Realm æ•°æ®åº“çš„æ¶æ„ç‰ˆæœ¬ä¸º 0 æˆ–è€… 1 çš„æ—¶å€™ï¼Œæ‰æ·»åŠ â€œemailâ€å±æ€§ if oldSchemaVersion &lt; 2 &#123; newObject![\"email\"] = \"\" &#125; &#125; &#125;)// Realm æ•°æ®åº“ä¼šè‡ªåŠ¨æ‰§è¡Œæ­¤æ•°æ®è¿ç§»ï¼Œç„¶åæˆåŠŸè¿›è¡Œè®¿é—®let realm = try! Realm() æ•°æ®åº“åŠ å¯† Realm æ”¯æŒåœ¨åˆ›å»º Realm æ•°æ®åº“æ—¶é‡‡ç”¨64ä½çš„å¯†é’¥å¯¹æ•°æ®åº“æ–‡ä»¶è¿›è¡Œ AES-256+SHA2 åŠ å¯†ã€‚ 12345678910111213141516// äº§ç”Ÿéšæœºå¯†é’¥var key = Data(count: 64)_ = key.withUnsafeMutableBytes &#123; bytes in SecRandomCopyBytes(kSecRandomDefault, 64, bytes)&#125;// æ‰“å¼€åŠ å¯†æ–‡ä»¶let config = Realm.Configuration(encryptionKey: key)do &#123; let realm = try Realm(configuration: config) // å’Œå¾€å¸¸ä¸€æ ·ä½¿ç”¨ Realm å³å¯ let dogs = realm.objects(Dog).filter(\"name contains 'Fido'\")&#125; catch let error as NSError &#123; // å¦‚æœå¯†é’¥é”™è¯¯ï¼Œ`error` ä¼šæç¤ºæ•°æ®åº“ä¸å¯è®¿é—® fatalError(\"Error opening realm: \\(error)\")&#125; è¿™æ ·ç¡¬ç›˜ä¸Šçš„æ•°æ®éƒ½èƒ½éƒ½é‡‡ç”¨AES-256æ¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œå¹¶ç”¨ SHA-2 HMAC æ¥è¿›è¡ŒéªŒè¯ã€‚ æ¯æ¬¡æ‚¨è¦è·å–ä¸€ä¸ª Realm å®ä¾‹æ—¶ï¼Œæ‚¨éƒ½éœ€è¦æä¾›ä¸€æ¬¡ç›¸åŒçš„å¯†é’¥ã€‚ å¯†é’¥å¹¶å°†å…¶å®‰å…¨åœ°å­˜æ”¾åˆ°é’¥åŒ™ä¸²å½“ä¸­ï¼Œç„¶åç”¨å…¶åŠ å¯† Realmã€‚ 1234567891011121314151617181920212223242526272829303132333435363738import Securityfunc getKey() -&gt; NSData &#123; // æ ‡è¯†ç¬¦ let keychainIdentifier = \"io.Realm.EncryptionExampleKey\" let keychainIdentifierData = keychainIdentifier.data(using: String.Encoding.utf8, allowLossyConversion: false)! // æ£€æµ‹æ˜¯å¦å­˜åœ¨é’¥åŒ™ä¸² var query: [NSString: AnyObject] = [ kSecClass: kSecClassKey, kSecAttrApplicationTag: keychainIdentifierData as AnyObject, kSecAttrKeySizeInBits: 512 as AnyObject, kSecReturnData: true as AnyObject ] var dataTypeRef: AnyObject? var status = withUnsafeMutablePointer(to: &amp;dataTypeRef) &#123; SecItemCopyMatching(query as CFDictionary, UnsafeMutablePointer($0)) &#125; if status == errSecSuccess &#123; // æ‰¾åˆ°å°±è¿”å› return dataTypeRef as! NSData &#125; // æ²¡æœ‰æ‰¾åˆ°å°±æ–°å»ºä¸€ä¸ª let keyData = NSMutableData(length: 64)! let result = SecRandomCopyBytes(kSecRandomDefault, 64, keyData.mutableBytes.bindMemory(to: UInt8.self, capacity: 64)) assert(result == 0, \"Failed to get random bytes\") // å­˜å‚¨é’¥åŒ™ä¸² query = [ kSecClass: kSecClassKey, kSecAttrApplicationTag: keychainIdentifierData as AnyObject, kSecAttrKeySizeInBits: 512 as AnyObject, kSecValueData: keyData ] status = SecItemAdd(query as CFDictionary, nil) assert(status == errSecSuccess, \"Failed to insert the new key in the keychain\") return keyData &#125; ä½¿ç”¨ 12345678910111213141516171819202122// æ·»åŠ autoreleasepool &#123; let configuration = Realm.Configuration(encryptionKey: getKey() as Data) let realm = try! Realm(configuration: configuration) // Add an object try! realm.write &#123; let dog = Dog() dog.name = \"xxxx\" realm.add(dog) &#125;&#125;// æŸ¥è¯¢autoreleasepool &#123; let configuration = Realm.Configuration(encryptionKey: getKey() as Data) let realm = try! Realm(configuration: configuration) if let dogName = realm.objects(Dog.self).first?.name &#123; print(dogName) &#125; &#125; åŠ å¯†è¿‡çš„ Realm åªä¼šå¸¦æ¥å¾ˆå°‘çš„é¢å¤–èµ„æºå ç”¨ï¼ˆé€šå¸¸æœ€å¤šåªä¼šæ¯”å¹³å¸¸æ…¢10%ï¼‰ã€‚ Realm çš„åŠ å¯† API ç›®å‰æ”¯æŒ iOSã€OS X ä»¥åŠ WatchKit å¹³å°ï¼Œä½† ä¸æ”¯æŒ watchOS å¹³å°ï¼Œå› ä¸º Realm åŠ å¯†æœºåˆ¶ä½¿ç”¨çš„ ä»¥åŠ API è¢«æ ‡è®°ä¸º__WATCHOS_PROHIBITED` äº†ã€‚ ç‰ˆæœ¬é™åˆ¶ Realm è‡´åŠ›äºå¹³è¡¡æ•°æ®åº“è¯»å–çš„çµæ´»æ€§å’Œæ€§èƒ½ã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œåœ¨ Realm ä¸­æ‰€å­˜å‚¨çš„ä¿¡æ¯çš„å„ä¸ªæ–¹é¢éƒ½æœ‰åŸºæœ¬çš„é™åˆ¶ã€‚ä¾‹å¦‚ï¼š ï¼ˆ1ï¼‰ç±»åç§°çš„é•¿åº¦æœ€å¤§åªèƒ½å­˜å‚¨ 57 ä¸ª UTF8 å­—ç¬¦ã€‚ ï¼ˆ2ï¼‰å±æ€§åç§°çš„é•¿åº¦æœ€å¤§åªèƒ½æ”¯æŒ 63 ä¸ª UTF8 å­—ç¬¦ã€‚ ï¼ˆ3ï¼‰NSData ä»¥åŠ String å±æ€§ä¸èƒ½ä¿å­˜è¶…è¿‡ 16 MB å¤§å°çš„æ•°æ®ã€‚å¦‚æœè¦å­˜å‚¨å¤§é‡çš„æ•°æ®ï¼Œå¯é€šè¿‡å°†å…¶åˆ†è§£ä¸º16MB å¤§å°çš„å—ï¼Œæˆ–è€…ç›´æ¥å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç„¶åå°†æ–‡ä»¶è·¯å¾„å­˜å‚¨åœ¨ Realm ä¸­ã€‚å¦‚æœæ‚¨çš„åº”ç”¨è¯•å›¾å­˜å‚¨ä¸€ä¸ªå¤§äº 16MB çš„å•ä¸€å±æ€§ï¼Œç³»ç»Ÿå°†åœ¨è¿è¡Œæ—¶æŠ›å‡ºå¼‚å¸¸ã€‚ ï¼ˆ4ï¼‰å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ’åºä»¥åŠä¸åŒºåˆ†å¤§å°å†™æŸ¥è¯¢åªæ”¯æŒâ€œåŸºç¡€æ‹‰ä¸å­—ç¬¦é›†â€ã€â€œæ‹‰ä¸å­—ç¬¦è¡¥å……é›†â€ã€â€œæ‹‰ä¸æ–‡æ‰©å±•å­—ç¬¦é›† Aâ€ ä»¥åŠâ€æ‹‰ä¸æ–‡æ‰©å±•å­—ç¬¦é›† Bâ€œï¼ˆUTF-8 çš„èŒƒå›´åœ¨ 0~591 ä¹‹é—´ï¼‰ã€‚","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://github.com/icoderRo/tags/æ•°æ®åº“/"}]},{"title":"Xcode8æ–°ç‰¹æ€§","slug":"Xcode8æ–°ç‰¹æ€§","date":"2016-10-03T03:26:31.000Z","updated":"2017-08-17T15:01:37.000Z","comments":true,"path":"2016/10/03/Xcode8æ–°ç‰¹æ€§/","link":"","permalink":"https://github.com/icoderRo/2016/10/03/Xcode8æ–°ç‰¹æ€§/","excerpt":"ç®€ä»‹9æœˆ14æ—¥å¼€å‘è€…ä»¬å·²ç»å¯ä»¥ä¸‹è½½å¹¶ä½¿ç”¨æ­£å¼ç‰ˆXcode8, å€Ÿç€å›½åº†ä¼‘æ¯æœŸé—´,æœ¬äººä¹Ÿä¸‹è½½å¹¶ä½¿ç”¨äº†Xcode8, å‘ç°é‡Œé¢çš„å‘ç‚¹ä¸å°‘.ä¸‹é¢å°±æ€»ç»“åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡è§çš„ä¸€äº›é—®é¢˜. æ–°ç‰¹æ€§GeneralXcode8ä¸­é€šè¿‡Automatically manage signing, è®©è‹¹æœä¸ºæˆ‘ä»¬ç®¡ç†æ•´æ•°å’Œé…ç½®æ–‡ä»¶.æƒ³è¦è®¾ç½®å®‰è£…åæ˜¾ç¤ºåœ¨æ‰‹æœºä¸Šçš„APPçš„åå­—, å¯ä»¥ç›´æ¥ä¿®æ”¹Display Name, è¿™ä¸ªä¿®æ”¹å’ŒInfo.plistä¿®æ”¹æ˜¯åŒæ­¥çš„. æ‰‹åŠ¨ç®¡ç†è¯ä¹¦å’Œæè¿°æ–‡ä»¶, å»æ‰Automatically manage signingçš„å‹¾å³å¯. ATSé—®é¢˜åœ¨iOS9ä¸­,æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®NSAllowsArbitraryLoadsä¸ºYES, æ¥ä½¿ç”¨HTTPç½‘ç»œ; iOS10ä»2017å¹´1æœˆ1æ—¥å¼€å§‹, è‹¹æœä¸å…è®¸æˆ‘ä»¬é€šè¿‡è¿™ä¸ªæ–¹æ³•è·³è¿‡ATS, å¼ºåˆ¶ä½¿ç”¨HTTPS.æˆ‘ä»¬å¯ä»¥ç”¨è¿‡NSExceptionDomainså¯¹ç‰¹å®šçš„åŸŸåå¼€æ”¾HTTP.","text":"ç®€ä»‹9æœˆ14æ—¥å¼€å‘è€…ä»¬å·²ç»å¯ä»¥ä¸‹è½½å¹¶ä½¿ç”¨æ­£å¼ç‰ˆXcode8, å€Ÿç€å›½åº†ä¼‘æ¯æœŸé—´,æœ¬äººä¹Ÿä¸‹è½½å¹¶ä½¿ç”¨äº†Xcode8, å‘ç°é‡Œé¢çš„å‘ç‚¹ä¸å°‘.ä¸‹é¢å°±æ€»ç»“åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡è§çš„ä¸€äº›é—®é¢˜. æ–°ç‰¹æ€§GeneralXcode8ä¸­é€šè¿‡Automatically manage signing, è®©è‹¹æœä¸ºæˆ‘ä»¬ç®¡ç†æ•´æ•°å’Œé…ç½®æ–‡ä»¶.æƒ³è¦è®¾ç½®å®‰è£…åæ˜¾ç¤ºåœ¨æ‰‹æœºä¸Šçš„APPçš„åå­—, å¯ä»¥ç›´æ¥ä¿®æ”¹Display Name, è¿™ä¸ªä¿®æ”¹å’ŒInfo.plistä¿®æ”¹æ˜¯åŒæ­¥çš„. æ‰‹åŠ¨ç®¡ç†è¯ä¹¦å’Œæè¿°æ–‡ä»¶, å»æ‰Automatically manage signingçš„å‹¾å³å¯. ATSé—®é¢˜åœ¨iOS9ä¸­,æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®NSAllowsArbitraryLoadsä¸ºYES, æ¥ä½¿ç”¨HTTPç½‘ç»œ; iOS10ä»2017å¹´1æœˆ1æ—¥å¼€å§‹, è‹¹æœä¸å…è®¸æˆ‘ä»¬é€šè¿‡è¿™ä¸ªæ–¹æ³•è·³è¿‡ATS, å¼ºåˆ¶ä½¿ç”¨HTTPS.æˆ‘ä»¬å¯ä»¥ç”¨è¿‡NSExceptionDomainså¯¹ç‰¹å®šçš„åŸŸåå¼€æ”¾HTTP. éšç§æƒé™çš„è®¾ç½®iOS10 å¯¹éšç§æƒé™æ›´åŠ ä¸¥æ ¼, å¦‚æœä¸è®¾ç½®, ä¼šç›´æ¥å´©æºƒ.æ ¹æ®é”™è¯¯æç¤º: æˆ‘ä»¬å¯ä»¥åœ¨info.plistæ–‡ä»¶ä¸­ æ·»åŠ å¯¹åº”çš„é”®å€¼å°±å¯ä»¥äº†. éº¦å…‹é£æƒé™ï¼šPrivacy - Microphone Usage Description æ˜¯å¦å…è®¸æ­¤Appä½¿ç”¨ä½ çš„éº¦å…‹é£ï¼Ÿ ç›¸æœºæƒé™ï¼š Privacy - Camera Usage Description æ˜¯å¦å…è®¸æ­¤Appä½¿ç”¨ä½ çš„ç›¸æœºï¼Ÿ ç›¸å†Œæƒé™ï¼š Privacy - Photo Library Usage Description æ˜¯å¦å…è®¸æ­¤Appè®¿é—®ä½ çš„åª’ä½“èµ„æ–™åº“ï¼Ÿ é€šè®¯å½•æƒé™ï¼š Privacy - Contacts Usage Description æ˜¯å¦å…è®¸æ­¤Appè®¿é—®ä½ çš„é€šè®¯å½•ï¼Ÿ è“ç‰™æƒé™ï¼šPrivacy - Bluetooth Peripheral Usage Description æ˜¯å¦è®¸å…æ­¤Appä½¿ç”¨è“ç‰™ï¼Ÿ è¯­éŸ³è½¬æ–‡å­—æƒé™ï¼šPrivacy - Speech Recognition Usage Description æ˜¯å¦å…è®¸æ­¤Appä½¿ç”¨è¯­éŸ³è¯†åˆ«ï¼Ÿ æ—¥å†æƒé™ï¼šPrivacy - Calendars Usage Description æ˜¯å¦å…è®¸æ­¤Appä½¿ç”¨æ—¥å†ï¼Ÿ å®šä½æƒé™ï¼šPrivacy - Location When In Use Usage Description æˆ‘ä»¬éœ€è¦é€šè¿‡æ‚¨çš„åœ°ç†ä½ç½®ä¿¡æ¯è·å–æ‚¨å‘¨è¾¹çš„ç›¸å…³æ•°æ® å®šä½æƒé™: Privacy - Location Always Usage Description æˆ‘ä»¬éœ€è¦é€šè¿‡æ‚¨çš„åœ°ç†ä½ç½®ä¿¡æ¯è·å–æ‚¨å‘¨è¾¹çš„ç›¸å…³æ•°æ® Interface BuilderXcode8ä¹‹å‰çš„ Size ClassXcode8ä¹‹åçš„å°±ä¸å«Size Class, å°±æ˜¯ä¸€ä¸ªé¢„è§ˆå½“å‰å½“å‰XIBæˆ–SBåœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹çš„å›¾å½¢ç•Œé¢. Xcode8æ‰“å¼€ä¹‹å‰çš„æ—§é¡¹ç›®çš„XIBæˆ–SBæ–‡ä»¶æ—¶, ä¼šå¼¹å‡ºä¸€ä¸ªé€‰æ‹©åˆå§‹åŒ–è®¾ç½®è§†å›¾çš„çª—å£, ä¸€èˆ¬é€‰æ‹©Choose Device. å¦‚æœXcode8æ‰“å¼€è¿‡å½“å‰çš„XIBæ–‡ä»¶, å¹¶é€‰æ‹©Choose Deviceå, ä½äºXcode8ç‰ˆæœ¬çš„ç¼–è¯‘å™¨å°†æ— æ³•æ‰“å¼€è¿™ä¸ªXIBæ–‡ä»¶, å¹¶ä¼šæŠ¥ä¸€ä¸‹é”™è¯¯: The document â€œViewController.xibâ€ requires Xcode 8.0 or later. This version does not support documents saved in the Xcode 8 format. Open this document with Xcode 8.0 or later. æœ‰ä¸¤ç§æ–¹æ³•è§£å†³:1.åˆ é™¤XIBæˆ–SBæ–‡ä»¶ä¸­çš„ xmlä¸­çš„ä»£ç . æ‰“å¼€æ–¹å¼å³é”® -&gt; Open as -&gt; Source Code &lt;capability name=&quot;documents saved in the Xcode 8 format&quot; minToolsVersion=&quot;8.0&quot;/&gt; 2.å¤§å®¶ä¸€èµ·å‡çº§åˆ°Xcode8. ç¦ç”¨ç³»ç»ŸlogXcode 8åœ¨è°ƒè¯•å’Œè¿è¡Œè¿‡ç¨‹ä¸­, ä¼šæ‰“å°å¾ˆå¤šä¸è®¤è¯†çš„log.è¿™äº›æ˜¯ç³»ç»Ÿæ‰“å°çš„.è§£å†³åŠæ³•æ˜¯:åœ¨Target -&gt; Edit Scheme -&gt; Run -&gt; Argumentsä¸­ï¼Œæ·»åŠ OS_ACTIVITY_MODEå­—æ®µï¼Œå¹¶è®¾ç½®ä¸ºDisableå³å¯ã€‚ æ’ä»¶é—®é¢˜è‹¹æœä¸ºäº†é¿å…ç±»ä¼¼ Xcode Ghost: äº‹ä»¶çš„å†æ¬¡å‘ç”Ÿ,Xcode8 ç¦ç”¨äº†æ’ä»¶æœºåˆ¶,è€Œå¼€æ”¾äº†å¦ä¸€ç§å½¢å¼ï¼š Source Editor extensions ä½†æ˜¯è¿™ç§å½¢å¼å±€é™æ€§å¤ªå¤§.è¿™é‡Œæœ‰ä¸€è¾¹æ–‡ç« ä»‹ç», è®©ä½ çš„Xcode8ç»§ç»­ä½¿ç”¨æ’ä»¶:Xcode8ç»§ç»­ä½¿ç”¨æ’ä»¶ å¦‚æœå‡ºç°commandï¼‹ï¼æ³¨é‡Šä»£ç å¤±æ•ˆ, å¯ä»¥æ‰§è¡Œsudo /usr/libexec/xpccachectlåé‡å¯ç”µè„‘. VVDocumenter-Xcodeå·²ç»åœ¨Xcode8ä¸­é›†æˆäº†æ³¨é‡Šæ’ä»¶, ä½¿ç”¨æ–¹æ³•ä¸æ˜¯ä»¥å‰çš„///, è€Œæ˜¯optionï¼‹commandï¼‹ï¼. APIUIColoræ–°å¢æ–¹æ³•123+ (UIColor *)colorWithDisplayP3Red:(CGFloat)displayP3Red green:(CGFloat)green blue:(CGFloat)blue alpha:(CGFloat)alpha NS_AVAILABLE_IOS(10_0);- (UIColor *)initWithDisplayP3Red:(CGFloat)displayP3Red green:(CGFloat)green blue:(CGFloat)blue alpha:(CGFloat)alpha NS_AVAILABLE_IOS(10_0); æ®è‹¹æœå®˜æ–¹å»ºè®®ä½¿ç”¨sRGB, ç†ç”±æ˜¯æ€§èƒ½å¥½, è‰²å½©æ›´ä¸°å¯Œ. å­—ä½“123456789NS_CLASS_AVAILABLE_IOS(10_0) @protocol UIContentSizeCategoryAdjusting &lt;NSObject&gt;/* Indicates whether the corresponding element should automatically update its font when the deviceâ€™s UIContentSizeCategory is changed. For this property to take effect, the elementâ€™s font must be a font vended using +preferredFontForTextStyle: or +preferredFontForTextStyle:compatibleWithTraitCollection: with a valid UIFontTextStyle. */@property (nonatomic) BOOL adjustsFontForContentSizeCategory;@end adjustsFontForContentSizeCategory å­—ä½“æ˜¯å¦éšç€æ‰‹æœºç³»ç»Ÿå­—ä½“çš„å˜åŒ–è€Œå˜åŒ–. refreshControliOS10ä»¥å‰:1NS_CLASS_AVAILABLE_IOS(6_0) __TVOS_PROHIBITED @interface UIRefreshControl : UIControl iOS10ä»¥å: 1@property (nonatomic, strong, nullable) UIRefreshControl *refreshControl NS_AVAILABLE_IOS(10_0) __TVOS_PROHIBITED; iOS10 ä»¥ååªè¦æ˜¯é›†æˆä¸UIScrollView, å³å¯è·å¾—æ­¤å±æ€§. systemVersionåˆ¤æ–­ç³»ç»Ÿç‰ˆæœ¬å·å»ºè®®ç”¨æ³•:Objc [[UIDevice currentDevice] systemVersion] UICollectionViewiOS10 å¯¹UICollectionViewè¿›ä¸€æ­¥çš„ä¼˜åŒ–, è¯¦æƒ…å¯å‚è€ƒUICollectionViewæ–°ç‰¹æ€§ NotificationiOS10æ‰€æœ‰çš„é€šçŸ¥éƒ½å±äºUserNotifications.frameworkå¢åŠ äº†æ’¤å›å•æ¡é€šçŸ¥,æ›´æ–°å·²å±•ç¤ºé€šçŸ¥,ä¸­é€”ä¿®æ”¹é€šçŸ¥å†…å®¹,åœ¨é€šçŸ¥ä¸­å±•ç¤ºå›¾ç‰‡è§†é¢‘,è‡ªå®šä¹‰é€šçŸ¥ UI ç­‰ä¸€ç³»åˆ—æ–°åŠŸèƒ½,éå¸¸å¼ºå¤§.è¯¦æƒ…å¯ä»¥å‚è€ƒ:æ´»ä¹…è§çš„é‡æ„ - iOS 10 UserNotifications æ¡†æ¶è§£æUserNotifications","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"æ–°ç‰¹æ€§","slug":"æ–°ç‰¹æ€§","permalink":"https://github.com/icoderRo/tags/æ–°ç‰¹æ€§/"}]},{"title":"ç¼–è¯‘ijkplayerDemo","slug":"ç¼–è¯‘ijkplayerDemo","date":"2016-08-26T16:00:00.000Z","updated":"2017-08-27T10:22:37.000Z","comments":true,"path":"2016/08/27/ç¼–è¯‘ijkplayerDemo/","link":"","permalink":"https://github.com/icoderRo/2016/08/27/ç¼–è¯‘ijkplayerDemo/","excerpt":"ç¼–è¯‘ijkplayerDemoä¸‹è½½ ç¼–è¯‘ ijkplayerä¸‹è½½å›æ¥åä¼šå‘ç° ffmpeg - lib é‡Œé¢çš„.aæ–‡ä»¶ç¼ºå¤± æ˜¾ç¤ºä¸ºçº¢è‰²","text":"ç¼–è¯‘ijkplayerDemoä¸‹è½½ ç¼–è¯‘ ijkplayerä¸‹è½½å›æ¥åä¼šå‘ç° ffmpeg - lib é‡Œé¢çš„.aæ–‡ä»¶ç¼ºå¤± æ˜¾ç¤ºä¸ºçº¢è‰² æ¥ç€ç¼–è¯‘ ffmpegæ‰“å¼€ç»ˆç«¯, cd åˆ°ijkplayeræ–‡ä»¶å¤¹ä¸­ cd ijkplayer å¦‚ä¸‹å›¾: ä¸‹è½½ffmpeg ./init-ios.sh cdåˆ°iOSç›®å½• ç¼–è¯‘ ffmpeg./compile-ffmpeg.sh clean./compile-ffmpeg.sh allç­‰å¾…ç¼–è¯‘å®Œæˆå³å¯ è¿è¡ŒIJKMediaDemo åˆ¶ä½œframeworkæ‰“å¼€IJKMediaPlayerç›®å½• è¿è¡ŒIJKMediaPlayer.xcodeproj é€‰æ‹©releaseæ¨¡å¼,ç¼–è¯‘çœŸæœºå’Œæ¨¡æ‹Ÿå™¨çš„IJKMediaPlayer.xcodeproj, æ‰“å¼€ç›¸åº”ç›®å½• ä¼šå¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶å¤¹ ä¸€ä¸ªæ˜¯çœŸæœºçš„ Release-iphoneos ä¸€ä¸ªæ˜¯æ¨¡æ‹Ÿå™¨çš„Release-iphonesimulator å°†çœŸæœºframeworkå’Œæ¨¡æ‹Ÿå™¨çš„frameworkåˆå¹¶æˆä¸€ä¸ªæ‰“å¼€ç»ˆç«¯è¾“å…¥ lipo -create â€œçœŸæœºIJKMediaFrameworkè·¯å¾„â€ â€œæ¨¡æ‹Ÿå™¨IJKMediaFrameworkè·¯å¾„â€ -output â€œåˆå¹¶åçš„æ–‡ä»¶è·¯å¾„å’Œåç§°(LastPathComponentä¼šé»˜è®¤ä¸ºæ–‡ä»¶åå­—)â€ æ‰“å¼€ç›¸åº”è·¯åŠ² å¾—åˆ°åˆå¹¶åçš„framework å°†ç”Ÿæˆçš„åˆå¹¶åçš„framework æ›¿æ¢æ‰ Release-iphoneos å’ŒRelease-iphonesimulator é‡Œé¢çš„framework","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"framework","slug":"framework","permalink":"https://github.com/icoderRo/tags/framework/"}]},{"title":"è®°IMèŠå¤©ç•Œé¢å¡é¡¿åˆ†æ","slug":"è®°IMèŠå¤©ç•Œé¢å¡é¡¿åˆ†æ","date":"2016-08-06T12:26:31.000Z","updated":"2017-08-17T15:02:28.000Z","comments":true,"path":"2016/08/06/è®°IMèŠå¤©ç•Œé¢å¡é¡¿åˆ†æ/","link":"","permalink":"https://github.com/icoderRo/2016/08/06/è®°IMèŠå¤©ç•Œé¢å¡é¡¿åˆ†æ/","excerpt":"å¼€å§‹æµ‹è¯•å¿«é€Ÿæ»šåŠ¨è§†å›¾ å¼€å¯GPU Driveræ£€æµ‹ å›¾ä¸­å¯ä»¥çœ‹å‡ºå½“å‰çš„å¸§ç‡éå¸¸çš„ä½, ä¿æŒåœ¨ 40~50 FPS, æ˜æ˜¾å¯ä»¥æ„Ÿè§‰åˆ°å¡é¡¿.","text":"å¼€å§‹æµ‹è¯•å¿«é€Ÿæ»šåŠ¨è§†å›¾ å¼€å¯GPU Driveræ£€æµ‹ å›¾ä¸­å¯ä»¥çœ‹å‡ºå½“å‰çš„å¸§ç‡éå¸¸çš„ä½, ä¿æŒåœ¨ 40~50 FPS, æ˜æ˜¾å¯ä»¥æ„Ÿè§‰åˆ°å¡é¡¿. å¡é¡¿äº§ç”Ÿçš„åŸå›  å›¾åƒæ˜¾ç¤ºåŸç†:ç®€å•æ¥è¯´, CPUè®¡ç®—å¥½æ˜¾ç¤ºçš„å†…å®¹æäº¤åˆ°GPU, GPUæ¸²æŸ“å®Œæˆåå°†æ¸²æŸ“çš„ç»“æœæ”¾å…¥å¸§ç¼“å†²åŒº, è§†é¢‘æ§åˆ¶å™¨ä¼šé€è¡Œè¯»å–å¸§ç¼“å†²åŒºçš„æ•°æ®, è¿›è¿‡ä¸€äº›è½¬æ¢(æ•°æ¨¡è½¬æ¢)ä¼ é€’ç»™æ˜¾ç¤ºå™¨æ˜¾ç¤º. iOSè®¾å¤‡ç›®å‰ä½¿ç”¨çš„æ˜¯åŒç¼“å­˜+å‚ç›´åŒæ­¥, å®‰å“ç³»ç»Ÿæ˜¯ä¸‰ç¼“å­˜+å‚ç›´åŒæ­¥, æ„Ÿå…´è¶£çš„çœ‹å®˜, å¯è‡ªè¡Œæœç´¢. ç»“è®º:ä»æµç¨‹å›¾å¯ä»¥çœ‹å‡º, CPUå’ŒGPUä¸è®ºå“ªä¸ªé˜»ç¢äº†å›¾åƒæ˜¾ç¤ºæµç¨‹, å‡ä¼šé€ æˆæ‰å¸§, äº§ç”Ÿå±å¹•å¡é¡¿çš„ç°è±¡. CPU: ä¸€èˆ¬å¤„ç†è§†å›¾çš„åˆ›å»ºã€å¸ƒå±€è®¡ç®—ã€å›¾ç‰‡è§£ç ã€æ–‡æœ¬çš„ç»˜åˆ¶ã€å›¾åƒç»˜åˆ¶ç­‰ç­‰. GPU: å¯¹CPUæäº¤çš„å†…å®¹(çº¹ç†ã€é¡¶ç‚¹)è¿›è¡Œåº”ç”¨å˜æ¢ã€æ··åˆã€æ¸²æŸ“. ä¾‹å¦‚:çº¹ç†çš„æ¸²æŸ“ã€è§†å›¾çš„æ··åˆã€å›¾å½¢çš„ç”Ÿæˆ. ä¸‹é¢å¯¹GPUå’ŒCPUåˆ†åˆ«è¿›è¡Œæ£€æµ‹. æ£€æµ‹GPU Renderer Utilization å¦‚æœRenderer Utilizationçš„ç™¾åˆ†æ¯”è¶…è¿‡äº†50%, æœ‰å¯èƒ½æ˜¯å› ä¸ºç¦»å±æ¸²æŸ“æˆ–è€…æ˜¯é‡ç»˜å¯¼è‡´ Tiler Utilization å¦‚æœTiler Utilizationçš„ç™¾åˆ†æ¯”è¶…è¿‡äº†50%, å¾ˆæœ‰å¯èƒ½æ˜¯å±å¹•ä¸Šæœ‰å¤ªå¤šçš„å›¾å±‚è¦†ç›– å¯ä»¥åˆ¤æ–­, GPUå¹¶ä¸æ˜¯å½±å“æ€§èƒ½çš„ç½ªé­æ¶é¦– æ£€æµ‹CPU å‹¾ä¸ŠSeparate by Thread å’Œ Hide System Libraties : åˆ†ç¦»çº¿ç¨‹, æ–¹ä¾¿æŸ¥çœ‹å„æ¡çº¿ç¨‹å’Œéšè—ç³»ç»Ÿåº“. æ˜æ˜¾çœ‹è§CPUå ç”¨ç‡ç‰¹åˆ«é«˜,é¦–å½“å…¶å†²çš„æ˜¯åˆ†åˆ«æ˜¯å - cellForRowAtIndexPathå’Œ- heightForRowAtIndexPathçš„ä¸¤å¥ä»£ç . 1.æ£€æµ‹cellForRowAtIndexPathä»£ç  ç‚¹å¼€å°ç®­å¤´, å‘ç°é‡Œé¢emotionStringWithWH:æ¶ˆè€—äº†å¤§é‡CPUçš„æ€§èƒ½.åŒå‡»è¿›å»æŸ¥çœ‹ä»£ç , å¯ä»¥çœ‹åˆ°æ¶ˆè€—æ€§èƒ½çš„ä»£ç æ˜¯åœ¨cellæ¨¡å‹èµ‹å€¼çš„æ–¹æ³•._msgLabel.attributedText =[session.fullText emotionStringWithWH:23]; çŒœæƒ³:tableViewæ¯æ¬¡æ»šåŠ¨, cellçš„setæ–¹æ³•éƒ½ä¼šè°ƒç”¨emotionStringWithWH:,ä¸ºäº†é¿å…æ¯æ¬¡ç»™å¯Œæ–‡æœ¬èµ‹å€¼éƒ½è°ƒç”¨æ­¤æ–¹æ³•, æ–°å¢ä¸€ä¸ªå±æ€§NSAttributedString *text. å½“å‰ä»£ç ä¿®æ”¹æˆ:_msgLabel.attributedText = session.text; å› æ­¤, æˆ‘ä»¬éœ€è¦ç»™textåœ¨åˆé€‚çš„åœ°æ–¹èµ‹å€¼, æœ¬demoåœ¨ç‚¹å‡»å‘é€æ–‡æœ¬çš„æ–¹æ³•ä¸­æ·»åŠ session.text = [session.fullText emotionStringWithWH:23]; é‡æ–°è¿è¡Œé¡¹ç›®, å†æ¬¡æ£€æµ‹ å¯ä»¥çœ‹å‡ºå¸§ç‡æå‡äº†ä¸€å°éƒ¨åˆ† ä¿æŒåœ¨45~55 FPS, å¿«é€Ÿæ»‘åŠ¨CPUçš„ä½¿ç”¨ç‡åœ¨40%å·¦å³. 2.æ£€æµ‹heightForRowAtIndexPathä»£ç ä»å›¾ä¸­çº¢è‰²ç®­å¤´æ‰€ç¤º, å¯ä»¥çœ‹å‡º, è®¡ç®—é«˜åº¦çš„æ–¹æ³•:cellHeightå ç”¨äº†æ¯”è¾ƒå¤šçš„å¼€é”€.æŸ¥çœ‹å½“å‰çš„ä»£ç å‘ç°,æ¯æ¬¡æ»‘åŠ¨éƒ½ä¼šé‡å¤è®¡ç®—é«˜åº¦:self.baseChatCellTool.session = self.dataSource[indexPath.row];return self.baseChatCellTool.cellHeight; å› æ­¤, ç¬¬ä¸€æ„Ÿè§‰å°±æ˜¯åº”è¯¥å°†è®¡ç®—è¿‡çš„é«˜åº¦ç»™ç¼“å­˜èµ·æ¥,äºæ˜¯ä¹å°†ä»£ç ä¿®æ”¹ä¸º: LCSession *session = self.dataSource[indexPath.row]; if (!session.cellHeight) { self.baseChatCellTool.session = session; session.cellHeight = self.baseChatCellTool.cellHeight; dispatch_async(dispatch_get_global_queue(0, 0), ^{ [LCCachesTool addSession:session]; }); } return session.cellHeight; é‡æ–°è¿è¡Œé¡¹ç›®, å†æ¬¡æ£€æµ‹æˆ‘ä»¬å‘ç°cellForRowAtIndexPathä¾æ—§å ç”¨äº†æ¯”è¾ƒå¤šçš„å¼€é”€,ç‚¹å‡»æŸ¥çœ‹, å¦‚ç»¿è‰²æ¡†æ‰€ç¤º, å‘ç°, é‡Œé¢å…¨éƒ¨éƒ½ä¸º%0çš„å¼€é”€ æˆ‘ä»¬å°†Hide System Libratiesé€‰é¡¹å–æ¶ˆå‹¾é€‰, æ‰¾åˆ°ä¸ä¸Šå›¾ä¸­åŒæ ·çš„æ–¹æ³•setSession, å‘ç°æ˜¯UILabelè®¾ç½®å¯Œæ–‡æœ¬çš„æ—¶å€™, å ç”¨äº†å¤§é‡çš„å¼€é”€, è¿™ä¸ªè¯é¢˜, æˆ‘ä»¬æš‚ä¸”æ‰“ä½.ç»§ç»­çœ‹å›ä¸Šå›¾, æˆ‘ä¹ˆå‘ç°è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•å ç”¨äº†æ¯”è¾ƒå¤§çš„å¼€é”€:layoutSubviews, å½“æˆ‘ä»¬æ»šåŠ¨è§†å›¾çš„æ—¶å€™, å°±ä¼šè°ƒç”¨layoutSubviews, æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹, åœ¨æ­¤æ–¹æ³•ä¸­, åšäº†ä»€ä¹ˆäº‹æƒ…: 123456789101112131415161718192021222324252627[self.headerImageView mas_makeConstraints:^(MASConstraintMaker *make) &#123; make.right.equalTo(self.contentView).offset(-7); make.top.equalTo(self.contentView).offset(7); make.width.height.equalTo(@(46)); &#125;]; [self.nicknameLabel mas_makeConstraints:^(MASConstraintMaker *make) &#123; make.top.equalTo(self.headerImageView).offset(-2); make.right.equalTo(self.headerImageView.mas_left).offset(-15); &#125;]; [self.msgLabel mas_remakeConstraints:^(MASConstraintMaker *make) &#123; if (self.session.messageType == messageTypeImage || self.session.messageType == messageTypeMap) &#123; make.right.equalTo(self.headerImageView.mas_left).offset(-4); &#125; else &#123; make.right.equalTo(self.headerImageView.mas_left).offset(-20); &#125; make.top.equalTo(self.nicknameLabel.mas_bottom).offset(13); &#125;]; [self.backgroundMsgView mas_makeConstraints:^(MASConstraintMaker *make) &#123; make.edges.equalTo(self.msgLabel).insets(UIEdgeInsetsMake(-8, -10, -10, -15)); &#125;]; ..... é‡Œé¢éƒ½æ˜¯äº›å¸ƒå±€çš„ä»£ç . æˆ‘ä»¬çŸ¥é“, è‡ªåŠ¨å¸ƒå±€çš„æ¶ˆè€—æ˜¯æ˜‚è´µçš„, ç‰¹åˆ«æ˜¯æ¯æ¬¡æ»šåŠ¨éƒ½éœ€è¦å¸ƒå±€. ç”±æ­¤äº§ç”Ÿç¬¬ä¸€ä¸ªä¼˜åŒ–æ–¹æ¡ˆ: ç°æœ‰çš„è‡ªåŠ¨å¸ƒå±€æ›¿æ¢ä¸ºåæ ‡ç³»(frame), æˆ‘ä»¬ä¹Ÿéƒ½çŸ¥é“, åˆ©ç”¨frameè®¡ç®—æ˜¯ä¸€ä»¶éå¸¸ç—›è‹¦çš„äº‹æƒ…. å½“ç„¶, æœ€ç»ˆçš„æ–¹æ¡ˆ,åˆ©ç”¨coreTextæ’ç‰ˆ, è‚¯å®šæ˜¯åˆ©ç”¨frame, ä½†æ˜¯æ˜¯å·²ç»æå‰è®¡ç®—å¥½çš„frame. å½“å‰åŸºäºç³»ç»Ÿçš„UILabel, å’Œä¸ºäº†æ–¹ä¾¿ä¹¦å†™å¸ƒå±€ä»£ç , æˆ‘ä»¬ä»è¿™ä¸ªæ–¹å‘æ¥ä¼˜åŒ–, é¦–å…ˆè‡ªåŠ¨å¸ƒå±€æ˜¯éœ€è¦çš„, å…¶æ¬¡é¿å…è°ƒç”¨layoutSubViews(å› ä¸ºæ¯æ¬¡æ»šåŠ¨è§†å›¾éƒ½ä¼šè°ƒç”¨), åœ¨initæ–¹æ³•ä¸­, å¸ƒå±€ä¸€æ¬¡: [self layout]; é‡æ–°è¿è¡Œé¡¹ç›®, å†æ¬¡æ£€æµ‹:CPUæœ€é«˜ä½¿ç”¨ç‡ä¸º34%,å¹³å‡åœ¨23%å·¦å³ å¸§ç‡æä¿æŒåœ¨50~55 FPSæˆ‘ä»¬å‘ç°cellForRowAtIndexPathä¾æ—§å ç”¨äº†æ¯”è¾ƒå¤šçš„å¼€é”€,ç‚¹å‡»æŸ¥çœ‹, å‘ç°, é‡Œé¢å…¨éƒ¨éƒ½ä¸º%0çš„å¼€é”€, ç”±æ­¤å¯è§,è¿™äº›å¼€é”€åŸºæœ¬éƒ½å±äºç³»ç»Ÿçº§çš„å¼€é”€äº†. å¸¸è§çš„æ–‡æœ¬æ§ä»¶ ï¼ˆUILabelã€UITextView ç­‰ï¼‰ï¼Œå…¶æ’ç‰ˆå’Œç»˜åˆ¶éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹è¿›è¡Œçš„ï¼Œå½“æ˜¾ç¤ºå¤§é‡æ–‡æœ¬æ—¶ï¼ŒCPU çš„å‹åŠ›ä¼šéå¸¸å¤§ã€‚å¯¹æ­¤è§£å†³æ–¹æ¡ˆåªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯è‡ªå®šä¹‰æ–‡æœ¬æ§ä»¶ é‚£ä¹ˆå‘ç°åŸºæœ¬ä¹Ÿå°±åªæœ‰ä¸€æ¡è·¯å¯ä»¥èµ°äº†, é‚£å°±æ˜¯åŸºäºcoreTextå¯¹æ–‡æœ¬è¿›è¡Œå¼‚æ­¥çš„ç»˜åˆ¶.åŸºäºcoreTextå¯¹æ–‡æœ¬è¿›è¡Œå¼‚æ­¥çš„ç»˜åˆ¶æˆ‘ä»¬åç»­å†è¯´. coreTextä¼˜ç‚¹: å ç”¨å†…å­˜å°‘,å¯ä»¥é¢„å…ˆæ’ç‰ˆå¯¹è±¡, ä¿ç•™å¯¹è±¡ä¾›ç»˜åˆ¶ä½¿ç”¨, å¯¹è±¡åˆ›å»ºå¥½åï¼Œèƒ½ç›´æ¥è·å–æ–‡æœ¬çš„å®½é«˜ç­‰ä¿¡æ¯ï¼Œé¿å…äº†å¤šæ¬¡è®¡ç®—. ç»§ç»­æœç½—imageNamed:æˆ‘ä»¬å°†ä»£ç è¿˜åŸ,å‘ç°å¤šæ¬¡è°ƒç”¨[UIImage imageNamed:]å¯¹äºå†…å­˜çš„å¼€é”€ç›¸å¯¹è¾ƒå¤§, åœ¨åˆ›å»ºImageæˆ–è€…CGImageSourceå¯¹è±¡æ—¶,å›¾ç‰‡æ•°æ®å¹¶ä¸ä¼šç«‹å³è§£ç ,è€Œæ˜¯ç­‰åˆ°è®¾ç½®åˆ°ImageViewæˆ–è€…layer.contentsï¼Œlayerè¢«æäº¤åˆ°GPUä¹‹å‰,æ‰è§£ç ,å¹¶ä¸”è¿™äº›æ“ä½œéƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹è¿›è¡Œ,æ˜¯ç›¸å½“è€—æ€§èƒ½çš„.å› æ­¤åº”è¯¥å¼€å¯å­çº¿ç¨‹æŠŠå›¾ç‰‡ç»˜åˆ¶åˆ°CGBitmapContext,ç„¶åä»Bitmapç›´æ¥åˆ›å»ºå›¾ç‰‡, å¸¸è§çš„ç½‘ç»œå›¾ç‰‡åº“éƒ½è‡ªå¸¦è¿™äº›åŠŸèƒ½. 123456789// ç®€ç•¥æ€è·¯dispatch\\_async(backgroundQueue, ^&#123; CGContextRef ctx = CGBitmapContextCreate(...); CGImageRef img = CGBitmapContextCreateImage(ctx); CFRelease(ctx); dispatch_async(mainQueue, ^&#123; layer.contents = img; &#125;);&#125;); 1234567891011121314151617181920212223ä¾‹å¦‚AFNä¸­å¯¹äºå›¾ç‰‡çš„å¤„ç†: // éƒ¨åˆ†ä»£ç  CGContextRef context = CGBitmapContextCreate(NULL, width, height, bitsPerComponent, bytesPerRow, colorSpace, bitmapInfo); CGColorSpaceRelease(colorSpace); if (!context) &#123; CGImageRelease(imageRef); return image; &#125; CGContextDrawImage(context, CGRectMake(0.0f, 0.0f, width, height), imageRef); CGImageRef inflatedImageRef = CGBitmapContextCreateImage(context); CGContextRelease(context); UIImage *inflatedImage = [[UIImage alloc] initWithCGImage:inflatedImageRef scale:scale orientation:image.imageOrientation]; CGImageRelease(inflatedImageRef); CGImageRelease(imageRef); return inflatedImage; 12345678910111213141516171819202122232425262728293031323334353637ä¾‹å¦‚SDä¸­å¯¹äºå›¾ç‰‡çš„å¤„ç†: // Workaround for iOS anamorphic image if (partialImageRef) &#123; const size_t partialHeight = CGImageGetHeight(partialImageRef); CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceRGB(); CGContextRef bmContext = CGBitmapContextCreate(NULL, width, height, 8, width * 4, colorSpace, kCGBitmapByteOrderDefault | kCGImageAlphaPremultipliedFirst); CGColorSpaceRelease(colorSpace); if (bmContext) &#123; CGContextDrawImage(bmContext, (CGRect)&#123;.origin.x = 0.0f, .origin.y = 0.0f, .size.width = width, .size.height = partialHeight&#125;, partialImageRef); CGImageRelease(partialImageRef); partialImageRef = CGBitmapContextCreateImage(bmContext); CGContextRelease(bmContext); &#125; else &#123; CGImageRelease(partialImageRef); partialImageRef = nil; &#125; &#125; if (partialImageRef) &#123; UIImage *image = [UIImage imageWithCGImage:partialImageRef scale:1 orientation:orientation]; // å­˜å‚¨key NSString *key = [[SDWebImageManager sharedManager] cacheKeyForURL:self.request.URL]; UIImage *scaledImage = [self scaledImageForKey:key image:image]; if (self.shouldDecompressImages) &#123; image = [UIImage decodedImageWithImage:scaledImage]; &#125; else &#123; image = scaledImage; &#125; CGImageRelease(partialImageRef); dispatch_main_sync_safe(^&#123; // å›åˆ°ä¸»çº¿ç¨‹ if (self.completedBlock) &#123; self.completedBlock(image, nil, nil, NO); &#125; &#125;); &#125; æ¸²æŸ“æ—¶æœºCore Animation åœ¨ RunLoop ä¸­æ³¨å†Œäº†ä¸€ä¸ª Observer,ç›‘å¬äº† BeforeWaiting å’Œ Exit äº‹ä»¶.å½“ä¸€ä¸ªè§¦æ‘¸äº‹ä»¶åˆ°æ¥æ—¶,RunLoop è¢«å”¤é†’,App ä¸­çš„ä»£ç ä¼šæ‰§è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºå’Œè°ƒæ•´è§†å›¾å±‚çº§ã€è®¾ç½® UIView çš„ frameã€ä¿®æ”¹ CALayer çš„é€æ˜åº¦ã€ä¸ºè§†å›¾æ·»åŠ ä¸€ä¸ªåŠ¨ç”»;è¿™äº›æ“ä½œæœ€ç»ˆéƒ½ä¼šè¢« CALayer æ ‡è®°,å¹¶é€šè¿‡ CATransaction æäº¤åˆ°ä¸€ä¸ªä¸­é—´çŠ¶æ€å».å½“ä¸Šé¢æ‰€æœ‰æ“ä½œç»“æŸå,RunLoop å³å°†è¿›å…¥ä¼‘çœ ï¼ˆæˆ–è€…é€€å‡ºï¼‰æ—¶,å…³æ³¨è¯¥äº‹ä»¶çš„ Observer éƒ½ä¼šå¾—åˆ°é€šçŸ¥. è¿™ä¸ªå›è°ƒå‡½æ•°çš„è°ƒç”¨æ ˆå¤§æ¦‚æ˜¯è¿™æ ·: æ–‡æœ¬è®¡ç®—UILabel å†…éƒ¨çš„å®ç°æ–¹å¼ï¼šç”¨ [NSAttributedString boundingRectWithSize:options:context:] æ¥è®¡ç®—æ–‡æœ¬å®½é«˜,ç”¨ -[NSAttributedString drawWithRect:options:context:] æ¥ç»˜åˆ¶æ–‡æœ¬.ä¼˜åŒ–ç‚¹:æ”¾åˆ°å­çº¿ç¨‹è¿›è¡Œä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹. æ€»ç»“ä»ä¸Šé¢å¯çŸ¥,å‡ ä¸ªCPUèµ„æºæ¶ˆè€—çš„åŸå› : å¸ƒå±€è®¡ç®— è§†å›¾çš„å¸ƒå±€è®¡ç®—æ˜¯å¸¸è§æ¶ˆè€—CPUçš„èµ„æº. ä¸€èˆ¬åœ¨å­çº¿ç¨‹ä¸­æå‰è®¡ç®—å¥½è§†å›¾çš„å¸ƒå±€ã€å¯¹å¸ƒå±€è¿›è¡Œç¼“å­˜, åŸºæœ¬ä¸Šå°±æ²¡æœ‰å•¥é—®é¢˜äº†. Autolayout ç”±äºæ‰‹åŠ¨è®¡ç®—frameç­‰å±æ€§,æ¯”è¾ƒå¤æ‚ã€å¼€å‘æ•ˆç‡ç›¸å¯¹è¾ƒä½,è‡ªåŠ¨å¸ƒå±€å¾ˆæå¤§çš„æå‡å¼€å‘æ•ˆç‡, å¤æ‚çš„è§†å›¾ä½¿ç”¨è‡ªåŠ¨å¸ƒå±€ä¼šäº§ç”Ÿä¸¥é‡çš„æ€§èƒ½é—®é¢˜,éšç€è§†å›¾çš„æ•°é‡å¢é•¿, CPUçš„æ¶ˆè€—ä¼šå‘ˆæŒ‡æ•°çº§çš„æå‡.å…¶æœ€ç»ˆéƒ½ä¼šè½åˆ°å¯¹è§†å›¾çš„frame/bounds/center ç­‰å±æ€§çš„è°ƒæ•´. æ–‡æœ¬æ¸²æŸ“ å¸¸è§çš„ç³»ç»Ÿæ–‡æœ¬æ§ä»¶(UILabel, UITextViewâ€¦), å…¶æ’ç‰ˆå’Œç»˜åˆ¶éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ, å½“æœ‰å¤§é‡çš„æ–‡æœ¬/å¯Œæ–‡æœ¬/å›¾æ–‡æ··æ’ç­‰, å¯¹äºCPUçš„æ¶ˆè€—æ˜¯éå¸¸æ˜‚è´µçš„, åŒæ—¶ä¼´æœ‰ä¸¥é‡çš„ç•Œé¢å¡é¡¿ç°è±¡.å½“ä¸‹çš„è§£å†³æ–¹æ¡ˆæ˜¯åŸºäºCoreTextå¯¹æ–‡æœ¬è¿›è¡Œå¼‚æ­¥çš„ç»˜åˆ¶. å›¾åƒè§£ç  å›¾ç‰‡è®¾ç½®åˆ°UIImageView/layer.contentsï¼Œlayerè¢«æäº¤åˆ°GPUä¹‹å‰,æ‰è§£ç ,å¹¶ä¸”è¿™äº›æ“ä½œéƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹è¿›è¡Œ,æ˜¯ç›¸å½“è€—æ€§èƒ½çš„.å› æ­¤åº”è¯¥å¼€å¯å­çº¿ç¨‹æŠŠå›¾ç‰‡ç»˜åˆ¶åˆ°CGBitmapContext,ç„¶åä»Bitmapç›´æ¥åˆ›å»ºå›¾ç‰‡.","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"æ€§èƒ½ä¼˜åŒ–","slug":"æ€§èƒ½ä¼˜åŒ–","permalink":"https://github.com/icoderRo/tags/æ€§èƒ½ä¼˜åŒ–/"}]},{"title":"åŸºäºnetty LengthFieldBasedFrameDecoderç¼–è§£ç ","slug":"netty-socketç¼–è§£ç ","date":"2016-06-11T16:00:00.000Z","updated":"2017-08-17T14:51:22.000Z","comments":true,"path":"2016/06/12/netty-socketç¼–è§£ç /","link":"","permalink":"https://github.com/icoderRo/2016/06/12/netty-socketç¼–è§£ç /","excerpt":"å‰è¨€1234æœåŠ¡å™¨ä¼ è¾“åè®®åè®®: åŸºäºnetty LengthFieldBasedFrameDecoder(100000000,0,4,0,4) æ€»é•¿åº¦ = 4byte + åŒ…ä½“å†…å®¹æ¥æ”¶äºŒè¿›åˆ¶çš„jsonå­—ç¬¦ä¸² æ­£æ–‡æ€è·¯:1231.åœ¨å‘é€æ•°æ®åŒ…å‰, æ‹¼æ¥4ä¸ªå­—èŠ‚å¸¦æœ‰åŒ…ä½“å†…å®¹é•¿åº¦çš„æ•°æ®.2.åœ¨æ¥å—æ•°æ—¶, éœ€è¦è€ƒè™‘ ç²˜åŒ…å’ŒåŠåŒ…çš„æƒ…å†µ.æ ¹æ®åŒ…å¤´é•¿åº¦,åˆ¤æ–­åŒ… çš„å®Œæ•´æ€§.å°†å®Œæ•´çš„åŒ…è§£æå‡ºå»,ä¸å®Œæ•´çš„ç­‰å¾…ä¸‹ä¸€æ¬¡çš„æ•°æ®æ‹¼æ¥. è®¾è®¡1231.é‡‡ç”¨é¢å‘åè®®çš„æ–¹å¼ç¼–ç ä¸è§£ç 2.è‡ªå®šä¹‰ç¼–ç å™¨å’Œè§£ç å™¨, éµå®ˆåè®®, å®ç°åè®®ä¸­çš„æ–¹æ³•3.åŸºäºGCDAsyncSocket, å°è£…éœ€è¦ç”¨åˆ°çš„æ–¹æ³•","text":"å‰è¨€1234æœåŠ¡å™¨ä¼ è¾“åè®®åè®®: åŸºäºnetty LengthFieldBasedFrameDecoder(100000000,0,4,0,4) æ€»é•¿åº¦ = 4byte + åŒ…ä½“å†…å®¹æ¥æ”¶äºŒè¿›åˆ¶çš„jsonå­—ç¬¦ä¸² æ­£æ–‡æ€è·¯:1231.åœ¨å‘é€æ•°æ®åŒ…å‰, æ‹¼æ¥4ä¸ªå­—èŠ‚å¸¦æœ‰åŒ…ä½“å†…å®¹é•¿åº¦çš„æ•°æ®.2.åœ¨æ¥å—æ•°æ—¶, éœ€è¦è€ƒè™‘ ç²˜åŒ…å’ŒåŠåŒ…çš„æƒ…å†µ.æ ¹æ®åŒ…å¤´é•¿åº¦,åˆ¤æ–­åŒ… çš„å®Œæ•´æ€§.å°†å®Œæ•´çš„åŒ…è§£æå‡ºå»,ä¸å®Œæ•´çš„ç­‰å¾…ä¸‹ä¸€æ¬¡çš„æ•°æ®æ‹¼æ¥. è®¾è®¡1231.é‡‡ç”¨é¢å‘åè®®çš„æ–¹å¼ç¼–ç ä¸è§£ç 2.è‡ªå®šä¹‰ç¼–ç å™¨å’Œè§£ç å™¨, éµå®ˆåè®®, å®ç°åè®®ä¸­çš„æ–¹æ³•3.åŸºäºGCDAsyncSocket, å°è£…éœ€è¦ç”¨åˆ°çš„æ–¹æ³• æ–‡ä»¶ç»“æ„ åˆ†å—è®²è§£åè®® - LCSocketCoderProtocol12341.ç¼–ç åè®®:LCSocketEncoderProtocol2.è§£ç åè®®:LCSocketDecoderProtocol3.ç¼–ç å®Œæˆåçš„è¾“å‡ºåè®®:LCSocketEncoderOutputProtocol4.è§£ç å®Œæˆåçš„è¾“å‡ºåè®®:LCSocketDecoderOutputProtocol ç¼–ç å™¨ - LCSocketEncoder12341. éµå®ˆç¼–ç åè®®2.å®ç°åè®®ä¸­çš„æ–¹æ³•:- (void)encode:(id)object output (id&lt;LCSocketEncoderOutputProtocol&gt;)outputå…¶ä¸­, è¾“å‡ºoutputéµå®ˆ ç¼–ç è¾“å‡ºåè®® ç¼–ç å™¨ - LCSocketDecoder12341. éµå®ˆè§£ç åè®®2.å®ç°åè®®ä¸­çš„æ–¹æ³•:- (void)decode:(id)object output:(id&lt;LCSocketDecoderOutputProtocol&gt;)outputå…¶ä¸­, è¾“å‡ºoutputéµå®ˆ è§£ç è¾“å‡ºåè®® å¥—æ¥å­— - LCBaseSocket1231. åŸºäºGCDAsyncSocket2.å•ä¾‹åŒ–, æä¾›éœ€è¦ç»™å¤–ç•Œè®¿é—®çš„æ¥å£,å¦‚:\"é‡è¿\", \"æ–­å¼€è¿æ¥\". \"æ˜¯å¦æ­£åœ¨è¿æ¥\"ç­‰3.è®¾ç½®ä»£ç†å±æ€§ ç¼–ç å™¨ä»£ç è¯¦è§£ - LCSocketEncoder123456789101112131415161718192021222324252627281.åˆ¤æ–­æ•°æ®æ ¼å¼æ˜¯å¦å¯è§£æä¸ºjson if (![NSJSONSerialization isValidJSONObject:object]) &#123; [output didEndEncode:nil error:[NSError errorWithDomain:@\"æ•°æ®ä¸èƒ½è§£æä¸ºjson\" code:-1 userInfo:nil]]; return; &#125;2.å°†jsonæ•°æ®ç¼–ç ä¸ºNSData NSError *error = nil; NSData *contentData = [NSJSONSerialization dataWithJSONObject:object options:NSJSONWritingPrettyPrinted error:&amp;error]; NSString *contentStr = [[NSString alloc] initWithData:contentData encoding:NSUTF8StringEncoding]; contentData = [contentStr dataUsingEncoding:NSUTF8StringEncoding];3.åˆ¤æ–­ç¼–ç åçš„æ•°æ®é•¿åº¦ if (contentData.length &gt; 1000000 - countOfLengthByte) &#123; [output didEndEncode:nil error:[NSError errorWithDomain:@\"encoderçš„æ•°æ®å¤ªé•¿\" code:-1 userInfo:nil]]; return; &#125;4.å°†æ•°æ®é•¿åº¦, æ‹¼æ¥åˆ°åŒ…å¤´ NSUInteger contentDataLength = contentData.length; NSData *headData = [self dataForLength:contentDataLength byteCount:countOfLengthByte reverse:NO]; NSMutableData *data = [NSMutableData data]; [data appendData:headData]; [data appendData:contentData];5.åˆ†å‘æ•°æ® [output didEndEncode:data error:nil]; è§£ç å™¨ä»£ç è¯¦è§£ - LCSocketDecoder123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051521.åˆ¤æ–­æ•°æ®æ˜¯å¦ä¸ºNSDataç±»å‹if (![object isKindOfClass:[NSData class]]) &#123; [output didEndDecode:nil error:[NSError errorWithDomain:@\"å½“å‰æ•°æ®ç±»å‹éNSData\" code:-1 userInfo:nil]]; return; &#125;2.åˆå§‹åŒ–, å¹¶æˆªå–åŒ…å¤´æ•°æ® self.needAppend = NO; NSData *packetData = object; [self.tempData appendData:packetData]; packetData = [self.tempData copy]; NSData *headerData = [packetData subdataWithRange:NSMakeRange(0, countOfLengthByte)]; NSUInteger contentLength = [self lengthForData:headerData reverse:YES];3.åˆ¤æ–­æ˜¯å¦ç²˜åŒ…while (packetData.length &gt;= contentLength) &#123; &#125; 3.1 åˆ¤æ–­åŒ…çš„é•¿åº¦ if (contentLength &gt; 1000000 - countOfLengthByte) &#123; // æœåŠ¡å™¨å®šçš„... [output didEndDecode:nil error:[NSError errorWithDomain:@\"æ•°æ®å¤ªé•¿\" code:-1 userInfo:nil]]; return; &#125; 3.2æˆªå–åŒ…ä½“å†…å®¹ NSData *contentData = [packetData subdataWithRange:NSMakeRange(countOfLengthByte, contentLength)]; 3.3 è¾“å‡ºä¸€ä¸ªå®Œæ•´çš„åŒ…, æˆªå–å‰©ä½™çš„åŒ… [output didEndDecode:contentData error:nil]; packetData = [packetData subdataWithRange:NSMakeRange(contentLength + countOfLengthByte , packetData.length - contentLength - countOfLengthByte)]; 3.4 åˆ¤æ–­åŒ…å¤´é•¿åº¦, å¦‚æœå°äºè§„å®šçš„, åˆ™è·³å‡ºå¾ªç¯, ç­‰å¾…æ‹¼æ¥ if (packetData.length &lt; countOfLengthByte) &#123; if (self.tempData.length != 0) &#123; [self.tempData resetBytesInRange:NSMakeRange(0, self.tempData.length)]; [self.tempData setLength:0]; self.needAppend = YES; &#125; break; &#125; 3.5 æˆªå–åŒ…å¤´çš„æ•°æ®,è®¡ç®—é•¿åº¦ headerData = [packetData subdataWithRange:NSMakeRange(0, countOfLengthByte)]; contentLength = [self lengthForData:headerData reverse:YES]; 3.6.åªè¦æ‰§è¡Œäº†while, å°†tempDataçš„æ•°æ®æ¸…ç©º, æ‹¼æ¥æ–°çš„æ•°æ® if (self.tempData.length != 0) &#123; [self.tempData resetBytesInRange:NSMakeRange(0, self.tempData.length)]; [self.tempData setLength:0]; &#125; self.needAppend = YES; ä¸€äº›å°ç»†èŠ‚è®¡ç®—æ ¹æ®NSDataåŒ…å¤´çš„é•¿åº¦- lengthForDataæ‰«ç›²1234567891011121314NSData ä¸­çš„lengthä¸ºNSUIntegerç±»å‹æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ NSUIntegerä¸ºä½•ç‰©#if __LP64__ || (TARGET_OS_EMBEDDED &amp;&amp; !TARGET_OS_IPHONE) || TARGET_OS_WIN32 || NS_BUILD_32_LIKE_64typedef long NSInteger;typedef unsigned long NSUInteger;#elsetypedef int NSInteger;typedef unsigned int NSUInteger;#endifç›®å‰ä¸€èˆ¬éƒ½ä¸º64ä½æ“ä½œç³»ç»Ÿ, æ‰€ä»¥ NSUInteger å°±æ˜¯ unsigned long å äº†8bits1å­—èŠ‚(byte) = 8bits,ä¸¤è€…æ¢ç®—æ˜¯1ï¼š8çš„å…³ç³»ã€‚ç•¥å¸¦:ä¸€ä¸ªæ±‰å­—å äº†ä¸¤ä¸ªå­—èŠ‚ 12345678910111213141516171819202122232425262728- (NSUInteger)lengthForData:(NSData *)data&#123; NSUInteger dataLen = data.length; NSUInteger length = 0; int offset = 0; while (offset &lt; dataLen) &#123; NSUInteger tempVal = 0; [data getBytes:&amp;tempVal range:NSMakeRange(offset, 1)]; length += (tempVal &lt;&lt; (8 * offset)); offset++; &#125; return length;&#125;1.å°†æ•°æ®çš„é«˜ä½ä½, æ›´æ”¹ä¸ºä½ä½åœ¨å‰,é«˜ä½åœ¨å,å¦‚:&lt;00000045&gt; --&gt; &lt;45000000&gt;æ•°æ®ä»¥16è¿›åˆ¶çš„å½¢å¼å±•ç¤º,éªŒè¯:åˆ©ç”¨è®¡ç®—å™¨è½¬æ¢ä¸ºåè¿›åˆ¶ ç­‰äº 69.åé™„å›¾.2.åˆ©ç”¨NSData ä¸­çš„: - (void)getBytes:(void *)buffer range:(NSRange)rangeæ–¹æ³•è·å–æ¯ä¸€ä¸ªå­—èŠ‚3.(æ³¨æ„å½“å‰ä¸º:ä½ä½åœ¨å‰,é«˜ä½åœ¨å)å°†æ¯ä¸€ä¸ªå­—èŠ‚, æ ¹æ®å­—èŠ‚æ‰€å±çš„èŒƒå›´,ç»Ÿä¸€å¾€å·¦ä½ç§»ç›¸åº”çš„ 8 (1å­—èŠ‚(byte) = 8bits)çš„å€æ•°, ä¹Ÿå°±æ˜¯è¯´,å°†åé¢é«˜ä½çš„å­—èŠ‚,ç»Ÿä¸€å¤„ç†ä¸ºä½ä½çš„å­—èŠ‚, å°†ç»Ÿä¸€æ ¼å¼çš„å­—èŠ‚, ç›¸åŠ .åˆ©ç”¨%zd è¾“å‡ºæ¯ä¸€ä¸ªå­—èŠ‚çš„ åè¿›åˆ¶çš„å¤§å°.è¿›è¡Œæ£€éªŒ. é«˜ä½ä½äº’æ¢-dataWithReverse12345678910111213141516171819202122232425- (NSData *)dataWithReverse:(NSData *)data&#123; NSMutableData *dstData = [[NSMutableData alloc] initWithData:data]; NSUInteger count = data.length / 2; for (NSUInteger i = 0; i &lt; count; i++) &#123; NSRange head = NSMakeRange(i, 1); NSRange end = NSMakeRange(data.length - i - 1, 1); NSData *headData = [data subdataWithRange:head]; NSData *endData = [data subdataWithRange:end]; [dstData replaceBytesInRange:head withBytes:endData.bytes]; [dstData replaceBytesInRange:end withBytes:headData.bytes]; &#125; return dstData;&#125;1.ä¾‹ç”¨NSMutableData å­—èŠ‚äº’æ¢ çš„æ–¹æ³•- (void)replaceBytesInRange:(NSRange)range withBytes:(const void *)bytes;2.éå†æ•°æ®ä»æ”¶å°¾å¼€å§‹,ä¾æ¬¡å°†å­—èŠ‚äº’æ¢, ä¸€èˆ¬åŒ…å¤´æ‰€å å­—èŠ‚éƒ½ä¸ä¼šå¤ªå¤š, æ‰€ä»¥åªéœ€éå†å‡ æ¬¡å°±å¯ä»¥å®Œæˆ,éå†çš„æ¬¡æ•°ä¸ºå­—èŠ‚æ€»æ•°å‡åŠ å°†é•¿åº¦è½¬ä¸ºå å›ºå®šå­—èŠ‚æ•°çš„NSData - dataForLength1234567891011121314151617181920212223242526 NSMutableData *valData = [NSMutableData data]; NSUInteger templen = length; int offset = 0; while (offset &lt; byteCount) &#123; unsigned char valChar = 0xff &amp; templen; [valData appendBytes:&amp;valChar length:1]; templen = templen &gt;&gt; 8; offset++; &#125; return valData;1.åˆ©ç”¨:NSMutableData çš„æ–¹æ³•- (void)appendBytes:(const void *)bytes length:(NSUInteger)length;2.å°†æ•°æ® &amp; 0xff 0xffæ˜¯åå…­è¿›åˆ¶FFçš„è¡¨ç¤ºæ–¹æ³•ï¼Œå› ä¸ºä¸€ä¸ªåå…­è¿›åˆ¶æ•°å­—è½¬æ¢æˆäºŒè¿›åˆ¶æ˜¯å››ä½ï¼Œå³F=1111ï¼Œæ‰€ä»¥0xffå ç”¨ä¸€ä¸ªå­—èŠ‚, 8bits&amp;ç¬¦è¡¨ç¤ºçš„æ˜¯æŒ‰ä½æ•°è¿›è¡Œä¸ï¼ˆåŒä¸º1çš„æ—¶å€™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ï¼‰ä¿ç•™å7ä½ï¼Œé«˜ä½æ¸…é›¶,é¿å…ç¬¦å·ä½æ‰©å±•ï¼š3.whileå¾ªç¯çš„è¯´æ˜:é¦–å…ˆ, 0xff &amp; templen, åªä¿ç•™æœ€ä½çš„å­—èŠ‚, è·å–åˆ°æœ€ä½ä½çš„å­—èŠ‚, åˆ©ç”¨appendBytes, å°†æ­¤å­—èŠ‚æ·»åŠ è¿›å», è¿›è€Œå°†templenå¾€å³ç§»8ä½, ä¹Ÿå°±æ˜¯å‰”é™¤åˆšæ‰è®¡ç®—è¿‡çš„å­—èŠ‚, è·å–ç¬¬äºŒä¸ªå­—èŠ‚,å°†ç¬¬äºŒä¸ªå­—èŠ‚æ·»åŠ è¿›å».ä¾æ¬¡å¾€åç›´åˆ°å°†æ‰€æœ‰çš„åŒ…å¤´å­—èŠ‚æ·»åŠ å®Œæ¯•","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"socket","slug":"socket","permalink":"https://github.com/icoderRo/tags/socket/"}]},{"title":"å½•éŸ³ä¸æœ¬åœ°æ’­æ”¾","slug":"å°è£…å½•éŸ³ä¸æ’­æ”¾","date":"2016-03-30T16:00:00.000Z","updated":"2017-08-17T14:53:38.000Z","comments":true,"path":"2016/03/31/å°è£…å½•éŸ³ä¸æ’­æ”¾/","link":"","permalink":"https://github.com/icoderRo/2016/03/31/å°è£…å½•éŸ³ä¸æ’­æ”¾/","excerpt":"ç®€è¨€è¿‘æœŸç”±äºè¦å®ç°ä¸€ä¸ªæœ¬åœ°å½•éŸ³ä¸æ’­æ”¾çš„å°åŠŸèƒ½, æƒ³ç€æŠŠå½•éŸ³ä¸æ’­æ”¾é›†æˆåœ¨ä¸€ä¸ªç±»ä¸­, æä¾›ç»Ÿä¸€çš„æ¥å£, æ–¹ä¾¿å…¶ä»–åŒäº‹è°ƒç”¨. AVAudioRecorder ä¸ AVAudioPlayeréƒ½å±äºéŸ³é¢‘ä¸“ç”¨ç±»(Audio-only classes),è¿™äº›ç±»æ˜¯è¯¥æ¡†æ¶ä¸­æœ€å¤è€, ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„å‡ ä¸ªç±». AVAudioSessionAVAudioSessionæ˜¯åº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿä¹‹é—´æ‰®æ¼”ä¸­é—´äººçš„è§’è‰².è§„å®šäº†åº”ç”¨ç¨‹åº(app)ä¸ç³»ç»ŸéŸ³é¢‘è¡Œä¸ºäº¤äº’çš„è§„èŒƒ, ä¸€ä¸ªåº”ç”¨ç¨‹åºåªæœ‰ä¸€ä¸ªAVAudioSessionçš„å®ä¾‹.åº”ç”¨ç¨‹åºé€šè¿‡è®¾ç½®AVAudioSessionçš„å±æ€§å‘Šè¯‰ç³»ç»Ÿæƒ³åˆ°è¾¾çš„æ•ˆæœ, ç³»ç»Ÿä¼šç»¼åˆå…¶ä»–åº”ç”¨ç¨‹åºçš„AVAudioSessionå±æ€§æ¥å†³å®šç¡¬ä»¶è¾“å…¥/è¾“å‡º. AVAudioSessionçš„åˆ†ç±» åˆ†ç±» ä½œç”¨ æ˜¯å¦å…è®¸æ··éŸ³ éŸ³é¢‘è¾“å…¥ éŸ³é¢‘è¾“å‡º Ambient æ¸¸æˆã€æ•ˆç‡åº”ç”¨ç¨‹åº â˜‘ï¸ æ—  â˜‘ï¸ SoloAmbient(é»˜è®¤) æ¸¸æˆã€æ•ˆç‡åº”ç”¨ç¨‹åº æ—  æ—  â˜‘ï¸ Playback éŸ³é¢‘å’Œè§†é¢‘æ’­æ”¾å™¨ å¯é€‰ æ—  â˜‘ï¸ Record å½•éŸ³æœºã€éŸ³é¢‘æ•æ‰ æ—  â˜‘ï¸ æ—  PlayAndRecord VoIPã€è¯­éŸ³èŠå¤© å¯é€‰ â˜‘ï¸ â˜‘ï¸ AudioProcessing ç¦»çº¿ä¼šè¯å’Œå¤„ç† æ—  æ—  æ—  MultiRoute ä½¿ç”¨å¤–éƒ¨ç¡¬ä»¶çš„é«˜çº§A/Våº”ç”¨ç¨‹åº æ—  â˜‘ï¸ â˜‘ï¸ ä¸Šè¿°åˆ†ç±»æ‰€æä¾›çš„å‡ ç§å¸¸è§çš„è¡Œä¸ºå¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†çš„åœºæ™¯éœ€æ±‚, å¦‚æœè¿˜éœ€è¦æ›´å¤æ‚çš„åŠŸèƒ½, å…¶ä¸­çš„ä¸€äº›åˆ†ç±»å¯ä»¥é€šè¿‡optionså’Œmodesæ–¹æ³•è¿›ä¸€æ­¥è‡ªå®šä¹‰. é¡¹ç›®ä¸­ç”¨åˆ°äº†ä¸‰ç§çŠ¶æ€: 1234567891011switch (session) &#123; case audioSessionAudioRecord: category = AVAudioSessionCategoryRecord; break; case audioSessionPlay: category = AVAudioSessionCategoryPlayback; break; default: category = AVAudioSessionCategoryAmbient; break; &#125; åˆå§‹åŒ–çŠ¶æ€ä¸º:AVAudioSessionCategoryAmbientå½•éŸ³çŠ¶æ€ä¸º:AVAudioSessionCategoryRecordæ’­æ”¾çŠ¶æ€ä¸º:AVAudioSessionCategoryPlayback","text":"ç®€è¨€è¿‘æœŸç”±äºè¦å®ç°ä¸€ä¸ªæœ¬åœ°å½•éŸ³ä¸æ’­æ”¾çš„å°åŠŸèƒ½, æƒ³ç€æŠŠå½•éŸ³ä¸æ’­æ”¾é›†æˆåœ¨ä¸€ä¸ªç±»ä¸­, æä¾›ç»Ÿä¸€çš„æ¥å£, æ–¹ä¾¿å…¶ä»–åŒäº‹è°ƒç”¨. AVAudioRecorder ä¸ AVAudioPlayeréƒ½å±äºéŸ³é¢‘ä¸“ç”¨ç±»(Audio-only classes),è¿™äº›ç±»æ˜¯è¯¥æ¡†æ¶ä¸­æœ€å¤è€, ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„å‡ ä¸ªç±». AVAudioSessionAVAudioSessionæ˜¯åº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿä¹‹é—´æ‰®æ¼”ä¸­é—´äººçš„è§’è‰².è§„å®šäº†åº”ç”¨ç¨‹åº(app)ä¸ç³»ç»ŸéŸ³é¢‘è¡Œä¸ºäº¤äº’çš„è§„èŒƒ, ä¸€ä¸ªåº”ç”¨ç¨‹åºåªæœ‰ä¸€ä¸ªAVAudioSessionçš„å®ä¾‹.åº”ç”¨ç¨‹åºé€šè¿‡è®¾ç½®AVAudioSessionçš„å±æ€§å‘Šè¯‰ç³»ç»Ÿæƒ³åˆ°è¾¾çš„æ•ˆæœ, ç³»ç»Ÿä¼šç»¼åˆå…¶ä»–åº”ç”¨ç¨‹åºçš„AVAudioSessionå±æ€§æ¥å†³å®šç¡¬ä»¶è¾“å…¥/è¾“å‡º. AVAudioSessionçš„åˆ†ç±» åˆ†ç±» ä½œç”¨ æ˜¯å¦å…è®¸æ··éŸ³ éŸ³é¢‘è¾“å…¥ éŸ³é¢‘è¾“å‡º Ambient æ¸¸æˆã€æ•ˆç‡åº”ç”¨ç¨‹åº â˜‘ï¸ æ—  â˜‘ï¸ SoloAmbient(é»˜è®¤) æ¸¸æˆã€æ•ˆç‡åº”ç”¨ç¨‹åº æ—  æ—  â˜‘ï¸ Playback éŸ³é¢‘å’Œè§†é¢‘æ’­æ”¾å™¨ å¯é€‰ æ—  â˜‘ï¸ Record å½•éŸ³æœºã€éŸ³é¢‘æ•æ‰ æ—  â˜‘ï¸ æ—  PlayAndRecord VoIPã€è¯­éŸ³èŠå¤© å¯é€‰ â˜‘ï¸ â˜‘ï¸ AudioProcessing ç¦»çº¿ä¼šè¯å’Œå¤„ç† æ—  æ—  æ—  MultiRoute ä½¿ç”¨å¤–éƒ¨ç¡¬ä»¶çš„é«˜çº§A/Våº”ç”¨ç¨‹åº æ—  â˜‘ï¸ â˜‘ï¸ ä¸Šè¿°åˆ†ç±»æ‰€æä¾›çš„å‡ ç§å¸¸è§çš„è¡Œä¸ºå¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†çš„åœºæ™¯éœ€æ±‚, å¦‚æœè¿˜éœ€è¦æ›´å¤æ‚çš„åŠŸèƒ½, å…¶ä¸­çš„ä¸€äº›åˆ†ç±»å¯ä»¥é€šè¿‡optionså’Œmodesæ–¹æ³•è¿›ä¸€æ­¥è‡ªå®šä¹‰. é¡¹ç›®ä¸­ç”¨åˆ°äº†ä¸‰ç§çŠ¶æ€: 1234567891011switch (session) &#123; case audioSessionAudioRecord: category = AVAudioSessionCategoryRecord; break; case audioSessionPlay: category = AVAudioSessionCategoryPlayback; break; default: category = AVAudioSessionCategoryAmbient; break; &#125; åˆå§‹åŒ–çŠ¶æ€ä¸º:AVAudioSessionCategoryAmbientå½•éŸ³çŠ¶æ€ä¸º:AVAudioSessionCategoryRecordæ’­æ”¾çŠ¶æ€ä¸º:AVAudioSessionCategoryPlayback AVAudioRecorder AVAudioRecorderæ„å»ºä¸Audio Queue Servicesä¹‹ä¸Š, æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”ä»£ç ç®€å•æ˜“ç”¨çš„OCæ¥å£.æˆ‘ä»¬å¯ä»¥åœ¨iOSè®¾å¤‡ä¸Šä½¿ç”¨è¿™ä¸ªç±»æ¥ä»å†…ç½®çš„éº¦å…‹é£å½•åˆ¶éŸ³é¢‘, ä¹Ÿå¯ä»¥ä»å¤–éƒ¨éŸ³é¢‘è®¾å¤‡è¿›è¡Œå½•åˆ¶, æ¯”å¦‚è€³æœº, USBéº¦å…‹é£ç­‰. åˆ›å»ºAVAudioRecorder123- (nullable instancetype)initWithURL:(NSURL *)url settings:(NSDictionary&lt;NSString *, id&gt; *)settings error:(NSError **)outError; å¯è§åˆ›å»ºAVAudioRecorderå®ä¾‹, éœ€è¦ä¸‰ä¸ªå‚æ•° ç”¨äºè¡¨ç¤ºéŸ³é¢‘æµå†™å…¥æ–‡ä»¶çš„æœ¬åœ°æ–‡ä»¶URL åŒ…å«ç”¨äºé…ç½®å½•éŸ³ä¼šè¯é”®å€¼ä¿¡æ¯çš„NSDictionary ç”¨äºæ•æ‰é”™è¯¯çš„NSErroræŒ‡é’ˆ æœ¬åœ°æ–‡ä»¶URLä¼ å…¥ä¸€ä¸ªpath, å»é™¤PathExtension(è§„é¿), æ–°å¢PathExtension 123[NSURL fileURLWithPath:[[recordPath stringByDeletingPathExtension] stringByAppendingPathExtension:@\"wav\"]]; å½•éŸ³ä¼šè¯é”®å€¼ä¿¡æ¯NSDictionary123456789[[NSDictionary alloc] initWithObjectsAndKeys:[NSNumber numberWithFloat: 11025.0],AVSampleRateKey, //é‡‡æ ·ç‡ [NSNumber numberWithInt: kAudioFormatLinearPCM],AVFormatIDKey,[NSNumber numberWithInt:16],AVLinearPCMBitDepthKey,//é‡‡æ ·ä½æ•° [NSNumber numberWithInt: 2], AVNumberOfChannelsKey,//é€šé“çš„æ•°ç›®[NSNumber numberWithInt:AVAudioQualityMax], AVEncoderAudioQualityKey, // å½•éŸ³è´¨é‡nil]; éŸ³é¢‘æ ¼å¼ AVFormatIDKeyé”®å®šä¹‰äº†å†™å…¥å†…å®¹çš„éŸ³é¢‘æ ¼å¼,å¸¸ç”¨çš„éŸ³é¢‘æ ¼å¼æ‰€æ”¯æŒçš„å€¼: kAudioFormatLinearPCM kAudioFormatMPEG4AAC kAudioFormatAppleIMA4 kAudioFormatMPEGLayer3 kAudioFormatAMR â€¦. æŒ‡å®škAudioFormatLinearPCM ä¼šå°†æœªå‹ç¼©çš„éŸ³é¢‘æµå†™å…¥åˆ°æ–‡ä»¶ä¸­, è¿™ç§æ ¼å¼çš„ä¿çœŸåº¦æœ€é«˜,ç›¸åº”çš„æ–‡ä»¶ä¹Ÿæ˜¯æœ€å¤§.é€‰æ‹©AAC(kAudioFormatMPEG4AAC)æˆ–è€…kAudioFormatAppleIMA4çš„å‹ç¼©æ ¼å¼ä¼šç¼©å°æ–‡ä»¶, åŒæ—¶è¿˜èƒ½ä¿è¯é«˜è´¨é‡çš„éŸ³é¢‘å†…å®¹. å½•åˆ¶çš„éŸ³é¢‘æ ¼å¼å¿…é¡»å’Œå‚æ•°å®šä¹‰çš„æ–‡ä»¶ç±»å‹å…¼å®¹.ä¾‹å¦‚:å½•åˆ¶ä¸€ä¸ªaaa.wavçš„æ–‡ä»¶, é‚£ä¹ˆå½•åˆ¶çš„éŸ³é¢‘å¿…é¡»æ»¡è¶³WAVEçš„æ ¼å¼è¦æ±‚,å³LinerPCM. é‡‡æ ·ç‡ AVSampleRateKeyç”¨äºå®šä¹‰å½•éŸ³å™¨çš„é‡‡æ ·ç‡.è¾“å…¥çš„æ¨¡æ‹ŸéŸ³é¢‘ä¿¡å·æ¯ä¸€ç§’çš„é‡‡æ ·æ•°,æ˜¯å½±å“éŸ³é¢‘è´¨é‡å’ŒéŸ³é¢‘æ–‡ä»¶å¤§å°,éå¸¸é‡è¦çš„ä¸€ä¸ªå› ç´ ,é‡‡æ ·ç‡è¶Šå°,æ–‡ä»¶è¶Šå°,è´¨é‡è¶Šä½.æ ‡å‡†çš„é‡‡æ ·ç‡æœ‰:8000ã€16000ã€22050ã€44100 äººç±»å¯æ¥æ”¶çš„éŸ³é¢‘èŒƒå›´ä¸º20Hz-20KHz. éŸ³é¢‘æœ€ä½³çš„é‡‡æ ·ç‡ä¸ºæ‰€éœ€é‡‡æ ·å¯¹è±¡çš„æœ€é«˜é¢‘ç‡çš„ä¸¤å€;AMå¹¿æ’­ç±»å‹çš„é‡‡æ ·ç‡ä¸º8KHz;CDè´¨é‡çš„é‡‡æ ·ç‡ä¸º44.1KHz. é€šé“æ•° AVNumberOfChannelsKeyè®°å½•éŸ³é¢‘å†…å®¹çš„é€šé“æ•°.é»˜è®¤å€¼ä¸º1,å³ç”¨å•å£°é“å½•åˆ¶, è®¾ç½®ä¸º2ä½¿ç”¨ç«‹ä½“å£°å½•åˆ¶.ä¸€èˆ¬æƒ…å†µç”¨å•å£°é“å½•éŸ³ æŒ‡å®šæ ¼å¼çš„key AVEncoderAudioQualityKey - å½•éŸ³è´¨é‡ AVEncoderBitRateKey - éŸ³é¢‘æ¯”ç‰¹ç‡ AVEncoderBitRatePerChannelKey - æ¯æ¡é€šé“çš„éŸ³é¢‘æ¯”ç‰¹ç‡ â€¦ ç›‘å¬éº¦å…‹é£æ˜¯å¦å…è®¸ä½¿ç”¨1234567891011121314- (BOOL)checkMicrophoneAvailability&#123; __block BOOL open = NO; AVAudioSession *session = [AVAudioSession sharedInstance]; if ([session respondsToSelector:@selector(requestRecordPermission:)]) &#123; [session performSelector:@selector(requestRecordPermission:) withObject:^(BOOL status) &#123; open = status; &#125;]; &#125; else &#123; open = YES; &#125; return open;&#125; AVAudioPlayerAVAudioPlayeræ„å»ºäºCoreAudioä¸­çš„C-based Audio Queue Servicesçš„é¡¶å±‚, æä¾›äº†åœ¨Audio Queue Servicesæ‰€èƒ½æ‰¾åˆ°çš„æ ¸å¿ƒåŠŸèƒ½, ä¾‹å¦‚:æ’­æ”¾ã€å¾ªç¯ã€éŸ³é¢‘è®¡é‡, ä½¿ç”¨çš„æ˜¯éå¸¸å‹å¥½å¹¶ç®€å•çš„OCæ¥å£.AVAudioPlayeråªèƒ½æ’­æ”¾æœ¬åœ°éŸ³é¢‘, ä»ç½‘ç»œæµä¸­æ’­æ”¾éŸ³é¢‘ä½¿ç”¨AVPlayer.è¿™é‡Œæš‚ä¸”ä¸è®¨è®ºAVPlayer. åˆ›å»ºAVAudioPlayer12345- (nullable instancetype)initWithContentsOfURL:(NSURL *)url error:(NSError **)outError;- (nullable instancetype)initWithData:(NSData *)data error:(NSError **)outError; æˆ‘ä»¬é‡‡ç”¨URLçš„æ–¹å¼åˆ›å»º, åªéœ€è¦ä¼ å…¥ä¸€ä¸ªæœ¬åœ°URL URLå¿…é¡»åœ¨åº”ç”¨ç¨‹åºæ²™ç›’å†… 12345self.player = [[AVAudioPlayer alloc] initWithContentsOfURL:audioUrl error:&amp;error];[self.player prepareToPlay];[self.player play]; è°ƒç”¨prepareToPlayè¿™ä¸ªæ–¹æ³•æ˜¯å¯é€‰çš„, å½“è°ƒç”¨playæ–¹æ³•æ—¶ä¼šéšå½¢æ¿€æ´», ä¸è¿‡åœ¨åˆ›å»ºæ—¶è°ƒç”¨, å¯ä»¥é™ä½è°ƒç”¨playæ–¹æ³•å’Œå¬åˆ°å£°éŸ³è¾“å‡ºä¹‹é—´çš„å»¶æ—¶. å¤„ç†ä¸­æ–­äº‹ä»¶å½“æœ‰ç”µè¯æ‹¨æ‰“è¿›æ¥æˆ–è€…VoIPç”µè¯, æˆ‘ä»¬åº”è¯¥åšå‡ºåŠæ—¶çš„ååº”,ç›‘å¬AVAudioSessionInterruptionNotificationçŠ¶æ€ 1234[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(handleInterruption:) name:AVAudioSessionInterruptionNotification object:[AVAudioSession sharedInstance]]; å¦‚æœAVAudioSessionInterruptionTypeä¸ºAVAudioSessionInterruptionTypeBeganåˆ™åœæ­¢å½“å‰æ’­æ”¾.å¦‚æœtypeä¸ºAVAudioSessionInterruptionTypeEndedä¸”optionsä¸ºAVAudioSessionInterruptionOptionShouldResumeåˆ™é‡æ–°æ’­æ”¾. 1234567891011121314- (void)handleInterruption:(NSNotification *)note&#123; NSDictionary *info = note.userInfo; AVAudioSessionInterruptionType type = [info[AVAudioSessionInterruptionTypeKey] unsignedIntegerValue]; if (type == AVAudioSessionInterruptionTypeBegan) &#123; [self stopPlaying];// &#125; else &#123;// AVAudioSessionInterruptionOptions options = [info[AVAudioSessionInterruptionOptionKey] unsignedIntegerValue];// // if (options == AVAudioSessionInterruptionOptionShouldResume) &#123;// // é‡æ–°æ’­æ”¾// &#125; &#125;&#125; å¯¹çº¿è·¯æ”¹å˜çš„å“åº”åœ¨iOSè®¾å¤‡ä¸Šæ·»åŠ ,ç§»é™¤éŸ³é¢‘è¾“å…¥ã€è¾“å‡ºçº¿è·¯æ—¶, ä¼šå‘ç”Ÿçº¿è·¯çš„æ”¹å˜, å¦‚:ç”¨æˆ·æ’å…¥è€³æœºæˆ–æ–­å¼€USBéº¦å…‹é£ç­‰.è¿™äº›äº‹ä»¶çš„å‘ç”Ÿ, éŸ³é¢‘å°±ä¼šæ ¹æ®æƒ…å†µæ”¹å˜è¾“å…¥/è¾“å‡ºçº¿è·¯.ç›‘å¬AVAudioSessionRouteChangeNotificationçŠ¶æ€ 1234[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(handleRouteChange:) name:AVAudioSessionRouteChangeNotification object:[AVAudioSession sharedInstance]]; æ¥æ”¶é€šçŸ¥åå…ˆåˆ¤æ–­çº¿è·¯å˜æ›´å‘ç”Ÿçš„åŸå› , é€šè¿‡userInfoä¸­çš„AVAudioSessionRouteChangeReasonKeyæ¨æ–­ä¸åŒçš„äº‹ä»¶, ä¾‹å¦‚è€³æœºæ–­å¼€è¿™ä¸ªäº‹ä»¶çš„åŸå› ä¸º:AVAudioSessionRouteChangeReasonOldDeviceUnavailable, æ¥ç€è·å–æè¿°å‰ä¸€ä¸ªçº¿è·¯çš„ä¿¡æ¯AVAudioSessionRouteDescription, ä»çº¿è·¯çš„ç¬¬ä¸€ä¸ªè¾“å…¥æ¥å£åˆ¤æ–­å…¶æ˜¯å¦ä¸ºè€³æœºæ¥å£.å¦‚æœæ˜¯, åˆ™ä»£ç è€³æœºæ‹”å‡º, åœæ­¢æ’­æ”¾. 1234567891011121314151617- (void)handleRouteChange:(NSNotification *)note&#123; NSDictionary *info = note.userInfo; AVAudioSessionRouteChangeReason reason = [info[AVAudioSessionRouteChangeReasonKey] unsignedIntegerValue]; // è€³æœºæ–­å¼€çš„äº‹ä»¶ä¸ºä¾‹ if (reason == AVAudioSessionRouteChangeReasonOldDeviceUnavailable) &#123; AVAudioSessionRouteDescription *previousRoute = info[AVAudioSessionRouteChangePreviousRouteKey]; AVAudioSessionPortDescription *previousOutput = previousRoute.outputs.firstObject; NSString *portType = previousOutput.portType; if ([portType isEqualToString:AVAudioSessionPortHeadphones]) &#123; [self stopPlaying]; &#125; &#125;&#125; åˆ‡æ¢å¬ç­’å’Œæ‰¬å£°å™¨å½“æˆ‘ä»¬å°†æ‰‹æœºè´´è¿‘è€³æœµæ—¶å€™, å½“å‰è¯­éŸ³æ’­æ”¾åº”è¯¥æ˜¯å¬ç­’æ¨¡å¼, å½“æˆ‘ä»¬æ‹¿ç€æ‰‹æœºè§‚çœ‹æ—¶å€™, å½“å‰çš„è¯­éŸ³æ’­æ”¾åº”è¯¥æ˜¯æ‰¬å£°å™¨çš„æ¨¡å¼.æˆ‘ä»¬åº”è¯¥è·å–è®¾å¤‡çš„çº¢å¤–æ„Ÿåº”setProximityMonitoringEnabledçš„çŠ¶æ€ä¸ºYES, å¹¶ç›‘å¬çŠ¶æ€çš„æ›´æ”¹UIDeviceProximityStateDidChangeNotification 123456789101112- (void)changeProximityMonitorEnableState:(BOOL)enable &#123; [[UIDevice currentDevice] setProximityMonitoringEnabled:YES]; if ([UIDevice currentDevice].proximityMonitoringEnabled == YES) &#123; //ç›‘å¬è·ç¦»äº‹ä»¶ï¼Œå…ˆè®¾ç½®ä¸ºYESï¼Œå¦‚æœè®¾ç½®å®Œåè¿˜æ˜¯NOï¼Œè¯´æ˜å½“å‰è®¾å¤‡è¿‘è·ç¦»ä¼ æ„Ÿå™¨ä¸å¯ç”¨ if (enable) &#123; [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(sensorStateChange) name:UIDeviceProximityStateDidChangeNotification object:n &#125; else &#123; [[NSNotificationCenter defaultCenter] removeObserver:self name:UIDeviceProximityStateDidChangeNotification object:nil]; [[UIDevice currentDevice] setProximityMonitoringEnabled:NO]; &#125; &#125;&#125; ç›‘å¬çŠ¶æ€çš„æ”¹å˜ sensorStateChange å¦‚æœæ­¤æ—¶æ‰‹æœºé è¿‘é¢éƒ¨æ”¾åœ¨è€³æœµæ—ï¼Œé‚£ä¹ˆå£°éŸ³å°†é€šè¿‡å¬ç­’è¾“å‡ºï¼Œå¹¶å°†å±å¹•å˜æš—. 1234567891011121314- (void)sensorStateChange &#123; if ([[UIDevice currentDevice] proximityState] == YES) &#123; //é»‘å± [[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryPlayAndRecord error:nil]; &#125; else &#123; //æ²¡é»‘å±å¹• [[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryPlayback error:nil]; if (![self isPlaying]) &#123; //æ²¡æœ‰æ’­æ”¾äº†ï¼Œä¹Ÿæ²¡æœ‰åœ¨é»‘å±çŠ¶æ€ä¸‹ï¼Œå°±å¯ä»¥æŠŠè·ç¦»ä¼ æ„Ÿå™¨å…³äº† [[UIDevice currentDevice] setProximityMonitoringEnabled:NO]; &#125; &#125;&#125; Audio MeteringAudio Meteringå¯ä»¥è®©æˆ‘ä»¬è·å–åˆ°éŸ³é¢‘çš„å¹³å‡å€¼åˆ†è´å’Œå³°å€¼çš„åˆ†è´æ•°æ®.averagePowerForChannelå’ŒpeakPowerForChannelè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ªç”¨äºè¡¨ç¤ºå£°éŸ³åˆ†è´ç­‰çº§çš„æµ®ç‚¹å€¼. è¿™ä¸ªå€¼çš„èŒƒå›´æœ€å¤§åˆ†è´0dB - æœ€å°åˆ†è´æˆ–é™éŸ³ -160dB.æ¯æ¬¡éœ€è¦è¯»å–æœ€æ–°çš„å€¼, å¼€å¯ä¸€ä¸ªå®šæ—¶å™¨,æ‰§è¡Œå®šæ—¶å™¨çš„æ–¹æ³•,è°ƒç”¨updateMeters.æ ¹æ®averagePowerForChannelæ”¾å›çš„å€¼è¿›è¡Œè®¾ç½®. 1234567891011121314151617181920212223242526272829- (void)timerAction&#123; if (self.status == subTitleStatuesDefault) &#123; if ([LCAudioRecord recorder]) [[LCAudioRecord recorder] updateMeters]; float peakPower = [[LCAudioRecord recorder] averagePowerForChannel:0]; double ALPHA = 0.05; double value = pow(10, (ALPHA * peakPower)); if (value &lt; 0.1 ) &#123; self.bordImageView.image = [UIImage imageNamed:@\"è¯­éŸ³ä¸­-1\"]; &#125; else if (value &lt; 0.15) &#123; self.bordImageView.image = [UIImage imageNamed:@\"è¯­éŸ³ä¸­-2\"]; &#125; else if (value &lt; 0.25) &#123; self.bordImageView.image = [UIImage imageNamed:@\"è¯­éŸ³ä¸­-3\"]; &#125; else if (value &lt; 0.35) &#123; self.bordImageView.image = [UIImage imageNamed:@\"è¯­éŸ³ä¸­-4\"]; &#125; else if (value &lt; 0.9 ) &#123; self.bordImageView.image = [UIImage imageNamed:@\"è¯­éŸ³ä¸­-5\"]; &#125; &#125; self.seconds ++; if (self.seconds &gt;= 599.9) &#123; [self.class dismiss]; [[NSNotificationCenter defaultCenter] postNotificationName:@\"recordDUrationToolong\" object:nil]; &#125;&#125; å°è£…æ€è·¯: åˆ›å»ºä¸€ä¸ªAudioManagerç»Ÿä¸€ç®¡ç†audioRecordå’ŒaudioPlay å…ˆåˆ†åˆ«å®ç°audioRecordå’ŒaudioPlayç›¸å…³çš„æ–¹æ³• åŸºäºaudioRecordå’ŒaudioPlayæä¾›çš„æ–¹æ³• åœ¨AudioManager ç»Ÿä¸€è¿›è¡Œå°è£…æ¥å£. åˆ©ç”¨blockçš„å½¢å¼å›è°ƒ æœ€ç»ˆæ¥å£å½¢å¼: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051+ (instancetype)manager;#pragma mark - LCAudioRecord// åˆ¤æ–­éº¦å…‹é£æ˜¯å¦å¯ç”¨- (BOOL)checkMicrophoneAvailability; /** * å¼€å§‹å½•éŸ³ * */- (void)startRecordingWithFileName:(NSString *)fileName completion:(void(^)(NSError *error))completion;/** * åœæ­¢å½•éŸ³ * */- (void)stopRecordingWithCompletion:(void(^)(NSString *recordPath, NSInteger aDuration, NSError *error))completion;/** * å–æ¶ˆå½•éŸ³ */- (void)cancelRecording;/** * å½“å‰æ˜¯å¦æ­£åœ¨å½•éŸ³ * */- (BOOL)isRecording;#pragma mark - LCAudioPlay/** * æ’­æ”¾éŸ³é¢‘ * */- (void)playingWithRecordPath:(NSString *)recordPath completion:(void(^)(NSError *error))completion;/** * åœæ­¢æ’­æ”¾ * */- (void)stopPlaying;/** * å½“å‰æ˜¯å¦æ­£åœ¨æ’­æ”¾ * */-(BOOL)isPlaying; å½•éŸ³æŒ‡ç¤ºå™¨çš„æ¥å£: 12345678910typedef NS_ENUM(NSInteger, subTitleStatues) &#123; subTitleStatuesDefault, subTitleStatuesCancel,&#125;;@interface LCMetersRecordingView : UIView// æ ¹æ® çŠ¶æ€æ›´æ”¹ æ˜¾ç¤ºçš„å†…å®¹+ (void)subTitleLabelStatues:(subTitleStatues)statues;+ (void)show;+ (void)dismiss;@end å¦‚ä½•ä½¿ç”¨:1234567891011121314151.å¼€å§‹å½•éŸ³// æ£€æµ‹éº¦å…‹é£æ˜¯å¦å¯ç”¨[LCAudioManager manager] checkMicrophoneAvailability][[LCAudioManager manager] startRecordingWithFileName:[NSString recordFileName] completion:nil];2.ç»“æŸå½•éŸ³[[LCAudioManager manager] stopRecordingWithCompletion:^(NSString *recordPath, NSInteger aDuration, NSError *error) &#123; if (aDuration &lt; 1) &#123; [MBProgressHUD showError:@\"å½•éŸ³æ—¶é—´è¿‡çŸ­\"]; return ; &#125; if (!error) &#123; // å½•éŸ³æˆåŠŸ // æ‰§è¡Œä¸‹ä¸€æ­¥è®¡åˆ’ &#125; &#125;];","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"AVFoundation","slug":"AVFoundation","permalink":"https://github.com/icoderRo/tags/AVFoundation/"}]},{"title":"TCP/IPç½‘ç»œå®‰å…¨(å…­)","slug":"ç½‘ç»œå®‰å…¨","date":"2016-01-11T16:00:00.000Z","updated":"2017-08-17T15:03:04.000Z","comments":true,"path":"2016/01/12/ç½‘ç»œå®‰å…¨/","link":"","permalink":"https://github.com/icoderRo/2016/01/12/ç½‘ç»œå®‰å…¨/","excerpt":"###TCP/IPç½‘ç»œå®‰å…¨TCP/IPç›¸å…³çš„å®‰å…¨è¦ç´ å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ é˜²ç«å¢™ç»„ç»‡æœºæ„å†…éƒ¨çš„ç½‘ç»œä¸äº’è”ç½‘ç›¸è¿æ—¶, ä¸ºäº†é¿å…å†…éƒ¨ç½‘ç»œå—åˆ°éæ³•è®¿é—®çš„å¨èƒ, ä¼šè®¾ç½®é˜²ç«å¢™ã€‚ ä½¿ç”¨NATçš„æƒ…å†µä¸‹, ç”±äºé™å®šäº†å¯ä»¥ä»å¤–éƒ¨è®¿é—®çš„åœ°å€, å› æ­¤ä¹Ÿèƒ½èµ·åˆ°é˜²ç«å¢™çš„ä½œç”¨ã€‚ é˜²ç«å¢™æœ‰å¤šç§ç§ç±»å’Œå½¢æ€, ä¸“é—¨è¿‡æ»¤ç‰¹å®šæ•°æ®åŒ…çš„åŒ…è¿‡æ»¤é˜²ç«å¢™, æ•°æ®åˆ°è¾¾åº”ç”¨ä»¥åç”±åº”ç”¨å¤„ç†å¹¶æ‹’ç»éæ³•è®¿é—®çš„åº”ç”¨ç½‘å…³ã€‚é˜²ç«å¢™å¯ä»¥é™åˆ¶ä»äº’è”ç½‘è®¿é—®çš„ä¸»æœºä¸ªæ•°; å°†å®‰å…¨çš„ä¸»æœºå’Œå¯ä»¥æš´éœ²çš„ä¸»æœºåŠ ä»¥åŒºåˆ†, é’ˆå¯¹åè€…é›†ä¸­å®æ–½å®‰å…¨é˜²æŠ¤ã€‚ ä¸‹å›¾ä¸­, å¯¹è·¯ç”±å™¨è®¾ç½®äº†åªå‘å…¶å‘é€ç‰¹å®šåœ°å€å’Œç«¯å£å·çš„åŒ…, ä¹Ÿå°±æ˜¯è®¾ç½®äº†ä¸€ä¸ªåŒ…è¿‡æ»¤é˜²ç«å¢™ã€‚å½“ä»å¤–éƒ¨è¿‡æ¥TCPé€šä¿¡è¯·æ±‚æ—¶, åªå…è®¸å¯¹WebæœåŠ¡å™¨çš„TCP 80ç«¯å£å’Œé‚®ä»¶æœåŠ¡å™¨çš„TCP 25ç«¯å£è®¿é—®ã€‚å…¶ä»–æ‰€æœ‰ç±»å‹çš„åŒ…éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚æ­¤å¤–, å»ºç«‹TCPè¿æ¥çš„è¯·æ±‚åªå…è®¸ä»å†…ç½‘å‘èµ·, ä¸èƒ½ä»å¤–ç½‘ç›´æ¥è¿æ¥å†…ç½‘ã€‚","text":"###TCP/IPç½‘ç»œå®‰å…¨TCP/IPç›¸å…³çš„å®‰å…¨è¦ç´ å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ é˜²ç«å¢™ç»„ç»‡æœºæ„å†…éƒ¨çš„ç½‘ç»œä¸äº’è”ç½‘ç›¸è¿æ—¶, ä¸ºäº†é¿å…å†…éƒ¨ç½‘ç»œå—åˆ°éæ³•è®¿é—®çš„å¨èƒ, ä¼šè®¾ç½®é˜²ç«å¢™ã€‚ ä½¿ç”¨NATçš„æƒ…å†µä¸‹, ç”±äºé™å®šäº†å¯ä»¥ä»å¤–éƒ¨è®¿é—®çš„åœ°å€, å› æ­¤ä¹Ÿèƒ½èµ·åˆ°é˜²ç«å¢™çš„ä½œç”¨ã€‚ é˜²ç«å¢™æœ‰å¤šç§ç§ç±»å’Œå½¢æ€, ä¸“é—¨è¿‡æ»¤ç‰¹å®šæ•°æ®åŒ…çš„åŒ…è¿‡æ»¤é˜²ç«å¢™, æ•°æ®åˆ°è¾¾åº”ç”¨ä»¥åç”±åº”ç”¨å¤„ç†å¹¶æ‹’ç»éæ³•è®¿é—®çš„åº”ç”¨ç½‘å…³ã€‚é˜²ç«å¢™å¯ä»¥é™åˆ¶ä»äº’è”ç½‘è®¿é—®çš„ä¸»æœºä¸ªæ•°; å°†å®‰å…¨çš„ä¸»æœºå’Œå¯ä»¥æš´éœ²çš„ä¸»æœºåŠ ä»¥åŒºåˆ†, é’ˆå¯¹åè€…é›†ä¸­å®æ–½å®‰å…¨é˜²æŠ¤ã€‚ ä¸‹å›¾ä¸­, å¯¹è·¯ç”±å™¨è®¾ç½®äº†åªå‘å…¶å‘é€ç‰¹å®šåœ°å€å’Œç«¯å£å·çš„åŒ…, ä¹Ÿå°±æ˜¯è®¾ç½®äº†ä¸€ä¸ªåŒ…è¿‡æ»¤é˜²ç«å¢™ã€‚å½“ä»å¤–éƒ¨è¿‡æ¥TCPé€šä¿¡è¯·æ±‚æ—¶, åªå…è®¸å¯¹WebæœåŠ¡å™¨çš„TCP 80ç«¯å£å’Œé‚®ä»¶æœåŠ¡å™¨çš„TCP 25ç«¯å£è®¿é—®ã€‚å…¶ä»–æ‰€æœ‰ç±»å‹çš„åŒ…éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚æ­¤å¤–, å»ºç«‹TCPè¿æ¥çš„è¯·æ±‚åªå…è®¸ä»å†…ç½‘å‘èµ·, ä¸èƒ½ä»å¤–ç½‘ç›´æ¥è¿æ¥å†…ç½‘ã€‚ IDS(å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ)IDSæ£€æµ‹å·²ç»ä¾µå…¥å†…éƒ¨ç½‘ç»œè¿›è¡Œéæ³•è®¿é—®çš„æƒ…å†µ, å¹¶åŠæ—¶é€šçŸ¥ç»™ç½‘ç»œç®¡ç†å‘˜çš„ç³»ç»Ÿã€‚IDSæ ¹æ®ä¸åŒçš„ç”¨é€”å¯ä»¥æä¾›å„ç§ä¸åŒçš„åŠŸèƒ½ã€‚ä»è®¾ç½®å½¢å¼ä¸Šçœ‹, ä¸€èˆ¬åœ¨é˜²ç«å¢™æˆ–DMSç­‰è¾¹ç•Œè®¾å¤‡ä¸Šè¿›è¡Œè®¾ç½®ã€‚æœ‰äº†è¿™æ ·çš„ç›‘æ§ã€æ£€æµ‹è¾¹ç•Œçš„åŠŸèƒ½, å°±å¯ä»¥è®¾ç½®åœ¨ç½‘ç»œå†…éƒ¨ã€å…¨ç½‘æˆ–ä¸ªåˆ«ç‰¹æ®Šçš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç›‘æ§ã€‚ä»åŠŸèƒ½ä¸Šçœ‹, IDSæœ‰å®šæœŸé‡‡é›†æ—¥å¿—ã€é•¿æœŸç›‘æ§ã€é€šçŸ¥å¼‚å¸¸ç­‰åŠŸèƒ½ã€‚å¯ä»¥ç›‘æ§ç½‘ç»œä¸ŠæµåŠ¨çš„æ‰€æœ‰æ•°æ®åŒ…, ä¸é˜²ç«å¢™ç›¸è¾…ç›¸æˆã€‚ åŠ å¯†æŠ€æœ¯åŠ å¯†æŒ‡çš„æ˜¯åˆ©ç”¨å¯†é’¥å¯¹æ˜æ–‡çš„æ•°æ®é€šè¿‡ä¸€å®šçš„ç®—æ³•å˜æ¢æˆå¯†æ–‡çš„è¿‡ç¨‹, é€†åè¿‡ç¨‹å«è§£å¯†ã€‚ åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥å«åšå¯¹ç§°åŠ å¯†æ–¹å¼, åŠ å¯†å’Œè§£å¯†çš„è¿‡ç¨‹ä¸­ä½¿ç”¨ä¸åŒçš„å¯†é’¥å«åšéå¯¹ç§°åŠ å¯†ã€‚ å¯¹ç§°åŠ å¯†å¯¹ç§°åŠ å¯†æ–¹å¼åŒ…æ‹¬AESã€DESç­‰åŠ å¯†æ ‡å‡†, å¯¹ç§°åŠ å¯†çš„ä¼˜ç‚¹åœ¨äºåŠ è§£å¯†çš„æ•ˆç‡æ¯”è¾ƒé«˜, ç¼ºç‚¹åœ¨äºå¦‚ä½•ä¿è¯å¯†é’¥æ˜¯å®‰å…¨çš„ã€‚ éå¯¹ç§°åŠ å¯†éå¯¹ç§°åŠ å¯†ä¸­, åˆ©ç”¨å…¬é’¥(å…¬å¼€çš„å¯†é’¥)åŠ å¯†çš„æ•°æ®åªèƒ½é€šè¿‡ç§é’¥è§£å¯†, ä½¿ç”¨ç§é’¥åŠ å¯†çš„æ•°æ®å°±éœ€è¦å…¬é’¥è¿›è¡Œè§£å¯†ã€‚å…¬é’¥åŠ å¯†æ–¹æ³•ä¸­å¸¸è§çš„åŠ å¯†ç®—æ³•æ˜¯RSAç®—æ³•ã€‚ HTTPSHTTPSå…¶å®å°±æ˜¯å®‰å…¨çš„HTTP, ä¹Ÿå°±æ˜¯HTTPçš„å®‰å…¨å‡çº§ç‰ˆæœ¬, HTTPå±äºåº”ç”¨å±‚çš„åè®®, HTTPåè®®ä¹‹ä¸‹æ˜¯ä¼ è¾“åè®®TCP, HTTPSå°±æ˜¯åœ¨HTTPä¸TCPä¸­é—´åŠ å¤šäº†ä¸€å±‚åŠ å¯†å±‚TLS/SSLã€‚ TLS/SSLSSL/TLSåè®®çš„åŸºæœ¬æ€è·¯æ˜¯å®¢æˆ·ç«¯å…ˆå‘æœåŠ¡å™¨ç«¯ç´¢è¦å…¬é’¥ï¼Œç„¶åç”¨å…¬é’¥åŠ å¯†ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å¯†æ–‡åï¼Œç”¨è‡ªå·±çš„ç§é’¥è§£å¯†ã€‚é€šä¿—çš„è®², SSLæ˜¯ç”¨æ¥åŠ å¯†çš„, TLSæ˜¯SSLçš„å‡çº§ç‰ˆæœ¬ã€‚TLS/SSLåè®®è¿è¡Œæœºåˆ¶ HTTPä¸­åº”ç”¨å±‚ç›´æ¥å°†æ•°æ®ä¼ è¾“ç»™TCP, åœ¨HTTPSä¸­åº”ç”¨å±‚å°†æ•°æ®ä¼ è¾“ç»™TLS/SSLåŠ å¯†å, åœ¨ä¼ è¾“ç»™TCPè¿›è¡Œä¼ è¾“ã€‚ HTTPSåŠ å¯†é€šä¿¡ç®€ç•¥æµç¨‹HTTPSä¸­é‡‡ç”¨å¯¹ç§°åŠ å¯†æ–¹å¼, åœ¨å‘é€å…¶å…¬å…±å¯†é’¥æ—¶é‡‡ç”¨çš„æ˜¯å…¬é’¥åŠ å¯†æ–¹å¼ã€‚ 1.æµè§ˆå™¨è®¿é—®ç½‘ç«™, ç½‘ç«™å°†è‡ªå·±çš„è¯ä¹¦ç»™åˆ°æµè§ˆå™¨ 2.æµè§ˆå™¨ä»è¯ä¹¦ä¸­è·å–ç½‘ç«™çš„å…¬é’¥A 3.æµè§ˆå™¨ç”Ÿæˆä¸€ä¸ªå¯¹ç§°å¯†é’¥B, å¹¶ç”¨å…¬é’¥AåŠ å¯†å, ä¼ é€ç»™ç½‘ç«™ 4.ç½‘ç«™é€šè¿‡ç§é’¥è§£å¯†, æ‹¿åˆ°å¯¹ç§°å¯†é’¥B 5.ä¹‹åé€šä¿¡çš„æ•°æ®, éƒ½ä½¿ç”¨å¯†é’¥Bè¿›è¡ŒåŠ å¯† è¾¨åˆ«ä¼ªé€ çš„è¯ä¹¦ å®Œå…¨ä¼ªé€ çš„è¯ä¹¦ â€“ å¯¹è¯ä¹¦è¿›è¡Œæ£€æŸ¥1.è¯ä¹¦é¢å‘çš„æœºæ„æ˜¯ä¼ªé€ çš„, æµè§ˆå™¨ä¸è®¤è¯†, ç›´æ¥è®¤ä¸ºæ˜¯å±é™©è¯ä¹¦2.è¯ä¹¦é¢å‘æœºæ„ç¡®å®å­˜åœ¨, æ ¹æ®CAå, æ‰¾åˆ°å†…ç½®çš„CAæ ¹è¯ä¹¦ã€CAçš„å…¬é’¥, åˆ©ç”¨å…¬é’¥å¯¹ä¼ªé€ çš„è¯ä¹¦æ‘˜è¦è¿›è¡Œè§£å¯†, å¦‚æœè§£å¯†å¤±è´¥, åˆ™è®¤ä¸ºæ˜¯å±é™©è¯ä¹¦ã€‚ ç¯¡æ”¹è¿‡çš„è¯ä¹¦ â€“ å‡è®¾ä»£ç†é€šè¿‡æŸç§é€”å¾„, æ‹¿åˆ°XXçš„è¯ä¹¦, ç„¶åå°†è¯ä¹¦çš„å…¬é’¥å·å·ä¿®æ”¹æˆè‡ªå·±çš„ã€‚1.æ£€æŸ¥è¯ä¹¦, æ ¹æ®CAå, æ‰¾åˆ°å¯¹åº”çš„CAæ ¹è¯ä¹¦, ä»¥åŠCAçš„å…¬é’¥2.ç”¨CAçš„å…¬é’¥, å¯¹è¯ä¹¦çš„æ•°å­—ç­¾åè¿›è¡Œè§£å¯†, å¾—åˆ°å¯¹åº”çš„è¯ä¹¦æ‘˜è¦AA3.æ ¹æ®è¯ä¹¦ç­¾åä½¿ç”¨çš„hashç®—æ³•, è®¡ç®—å‡ºå½“å‰è¯ä¹¦çš„æ‘˜è¦BB4.å¯¹æ¯”ä¸¤ä¸ªæ‘˜è¦, å‘ç°ä¸ä¸€è‡´, åˆ™ä¸ºå±é™©çš„è¯ä¹¦ æµ…ææ•°å­—è¯ä¹¦ å‚è€ƒ: å›¾è§£TCP/IP http://www.jianshu.com/nb/3276500 HTTPç§‘æ™®æ‰«ç›²è´´","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://github.com/icoderRo/tags/ç½‘ç»œ/"}]},{"title":"TCP/UDP(äº”)","slug":"TCP:UDP","date":"2015-12-31T16:00:00.000Z","updated":"2017-08-17T14:51:43.000Z","comments":true,"path":"2016/01/01/TCP:UDP/","link":"","permalink":"https://github.com/icoderRo/2016/01/01/TCP:UDP/","excerpt":"TCP/UDPTCPä¸UDPæ˜¯ä¼ è¾“å±‚çš„ä¸¤ä¸ªä¸»è¦åè®®ã€‚TCPæä¾›å¯é çš„é€šä¿¡çš„ä¼ è¾“, è€ŒUDPé¢å‘æ— è¿æ¥çš„ä¸å¯é çš„é€šä¿¡ä¼ è¾“ã€‚ ç½‘ç»œå±‚ä¸­çš„IPé¦–éƒ¨ä¸­æœ‰ä¸€ä¸ªåè®®çš„å­—æ®µ, ç”¨æ¥æ ‡è¯†ç½‘ç»œå±‚çš„ä¸Šä¸€å±‚é‡‡ç”¨çš„æ˜¯å“ªä¸€ç§ä¼ è¾“å±‚çš„åè®®ã€‚æ ¹æ®è¿™ä¸ªå­—æ®µçš„åè®®å·, å°±å¯ä»¥è¯†åˆ«IPä¼ è¾“çš„æ•°æ®éƒ¨åˆ†æ˜¯TCPçš„å†…å®¹, è¿˜æ˜¯UDPçš„å†…å®¹ã€‚åŒç†,ä¼ è¾“å±‚ä½¿ç”¨ç«¯å£å·è¯†åˆ«åœ¨ä¼ è¾“å±‚çš„ä¸Šä¸€å±‚(åº”ç”¨å±‚)ä¸­è¦è¿›è¡Œå¤„ç†çš„ç¨‹åºã€‚ ç«¯å£å·æ•°æ®é“¾è·¯å’ŒIPåœ°å€, åˆ†åˆ«å¯¹åº”MACåœ°å€å’ŒIPåœ°å€ã€‚å‰è€…ç”¨æ¥è¯†åˆ«åŒä¸€é“¾è·¯ä¸­ä¸åŒçš„è®¡ç®—æœº, åè€…ç”¨æ¥è¯†åˆ«TCP/IPç½‘ç»œä¸­äº’è¿çš„ä¸»æœºå’Œè·¯ç”±å™¨ã€‚åœ¨ä¼ è¾“å±‚ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„åœ°å€æ¦‚å¿µ, é‚£å°±æ˜¯ç«¯å£å·ã€‚ç«¯å£å·ç”¨æ¥è¯†åˆ«åŒä¸€å°è®¡ç®—æœºä¸­è¿›è¡Œé€šä¿¡çš„ä¸åŒåº”ç”¨ç¨‹åº, ä¹Ÿå«åšç¨‹åºåœ°å€ã€‚ é€šä¿¡è¯†åˆ«ä»…ä»…å‡­ç›®æ ‡ç«¯å£è¯†åˆ«æŸä¸€ä¸ªé€šä¿¡æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚å¦‚ä¸‹å›¾: 1å’Œ2çš„é€šä¿¡æ˜¯åœ¨ä¸¤å°è®¡ç®—æœºä¸Šè¿›è¡Œçš„ã€‚ä»–ä»¬çš„ç›®æ ‡ç«¯å£å·éƒ½æ˜¯80, éœ€è¦æ ¹æ®æºç«¯å£å·è¿›è¡ŒåŒºåˆ†ã€‚3å’Œ1çš„ç›®æ ‡ç«¯å£å·å’Œæºç«¯å£å·å®Œå…¨ç›¸åŒ, ä½†æ˜¯ä»–ä»¬å„è‡ªçš„æºIPåœ°å€ä¸åŒã€‚å¦å¤–åè®®å·ä¸åŒ, ä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯ä¸¤ä¸ªä¸åŒçš„é€šä¿¡ã€‚ ç»¼ä¸Š, TCP/IPæˆ–UDP/IPé€šä¿¡ä¸­é€šå¸¸é‡‡ç”¨5ä¸ªä¿¡æ¯æ¥è¯†åˆ«ä¸€ä¸ªé€šä¿¡ã€‚åˆ†åˆ«æ˜¯: æºIPåœ°å€ã€ç›®æ ‡IPåœ°å€ã€åè®®å·ã€æºç«¯å£å·ã€ç›®æ ‡ç«¯å£å·ã€‚åªæœ‰5ä¸ªä¿¡æ¯ä¸€è‡´, æ‰è®¤ä¸ºæ˜¯åŒä¸€ä¸ªé€šä¿¡ã€‚","text":"TCP/UDPTCPä¸UDPæ˜¯ä¼ è¾“å±‚çš„ä¸¤ä¸ªä¸»è¦åè®®ã€‚TCPæä¾›å¯é çš„é€šä¿¡çš„ä¼ è¾“, è€ŒUDPé¢å‘æ— è¿æ¥çš„ä¸å¯é çš„é€šä¿¡ä¼ è¾“ã€‚ ç½‘ç»œå±‚ä¸­çš„IPé¦–éƒ¨ä¸­æœ‰ä¸€ä¸ªåè®®çš„å­—æ®µ, ç”¨æ¥æ ‡è¯†ç½‘ç»œå±‚çš„ä¸Šä¸€å±‚é‡‡ç”¨çš„æ˜¯å“ªä¸€ç§ä¼ è¾“å±‚çš„åè®®ã€‚æ ¹æ®è¿™ä¸ªå­—æ®µçš„åè®®å·, å°±å¯ä»¥è¯†åˆ«IPä¼ è¾“çš„æ•°æ®éƒ¨åˆ†æ˜¯TCPçš„å†…å®¹, è¿˜æ˜¯UDPçš„å†…å®¹ã€‚åŒç†,ä¼ è¾“å±‚ä½¿ç”¨ç«¯å£å·è¯†åˆ«åœ¨ä¼ è¾“å±‚çš„ä¸Šä¸€å±‚(åº”ç”¨å±‚)ä¸­è¦è¿›è¡Œå¤„ç†çš„ç¨‹åºã€‚ ç«¯å£å·æ•°æ®é“¾è·¯å’ŒIPåœ°å€, åˆ†åˆ«å¯¹åº”MACåœ°å€å’ŒIPåœ°å€ã€‚å‰è€…ç”¨æ¥è¯†åˆ«åŒä¸€é“¾è·¯ä¸­ä¸åŒçš„è®¡ç®—æœº, åè€…ç”¨æ¥è¯†åˆ«TCP/IPç½‘ç»œä¸­äº’è¿çš„ä¸»æœºå’Œè·¯ç”±å™¨ã€‚åœ¨ä¼ è¾“å±‚ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„åœ°å€æ¦‚å¿µ, é‚£å°±æ˜¯ç«¯å£å·ã€‚ç«¯å£å·ç”¨æ¥è¯†åˆ«åŒä¸€å°è®¡ç®—æœºä¸­è¿›è¡Œé€šä¿¡çš„ä¸åŒåº”ç”¨ç¨‹åº, ä¹Ÿå«åšç¨‹åºåœ°å€ã€‚ é€šä¿¡è¯†åˆ«ä»…ä»…å‡­ç›®æ ‡ç«¯å£è¯†åˆ«æŸä¸€ä¸ªé€šä¿¡æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚å¦‚ä¸‹å›¾: 1å’Œ2çš„é€šä¿¡æ˜¯åœ¨ä¸¤å°è®¡ç®—æœºä¸Šè¿›è¡Œçš„ã€‚ä»–ä»¬çš„ç›®æ ‡ç«¯å£å·éƒ½æ˜¯80, éœ€è¦æ ¹æ®æºç«¯å£å·è¿›è¡ŒåŒºåˆ†ã€‚3å’Œ1çš„ç›®æ ‡ç«¯å£å·å’Œæºç«¯å£å·å®Œå…¨ç›¸åŒ, ä½†æ˜¯ä»–ä»¬å„è‡ªçš„æºIPåœ°å€ä¸åŒã€‚å¦å¤–åè®®å·ä¸åŒ, ä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯ä¸¤ä¸ªä¸åŒçš„é€šä¿¡ã€‚ ç»¼ä¸Š, TCP/IPæˆ–UDP/IPé€šä¿¡ä¸­é€šå¸¸é‡‡ç”¨5ä¸ªä¿¡æ¯æ¥è¯†åˆ«ä¸€ä¸ªé€šä¿¡ã€‚åˆ†åˆ«æ˜¯: æºIPåœ°å€ã€ç›®æ ‡IPåœ°å€ã€åè®®å·ã€æºç«¯å£å·ã€ç›®æ ‡ç«¯å£å·ã€‚åªæœ‰5ä¸ªä¿¡æ¯ä¸€è‡´, æ‰è®¤ä¸ºæ˜¯åŒä¸€ä¸ªé€šä¿¡ã€‚ ç«¯å£å·çš„ç¡®å®š æ ‡å‡†æ—¢å®šçš„ç«¯å£å·è¿™ç§æ–¹æ³•ä¹Ÿå«é™æ€æ–¹æ³•, æŒ‡æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰å…¶æŒ‡å®šçš„ç«¯å£å·ã€‚çŸ¥åç«¯å£å·ä¸€èˆ¬ç”±0~1023çš„æ•°å­—åˆ†é…è€Œæˆ, åº”ç”¨ç¨‹åºéœ€è¦é¿å…ä½¿ç”¨çŸ¥åç«¯å£å·, å¯ä»¥ä½¿ç”¨1024~49151ä¹‹é—´çš„æ•°å­—ä½œä¸ºè‡ªå®šä¹‰ç«¯å£å·ã€‚ æ—¶åºåˆ†é…æ³•è¿™ç§æ–¹æ³•ä¹Ÿå«åŠ¨æ€æ–¹æ³•, æ­¤æ—¶æœåŠ¡ç«¯æœ‰å¿…è¦ç¡®å®šç›‘å¬ç«¯å£å·, ä½†æ˜¯æ¥å—æœåŠ¡çš„å®¢æˆ·ç«¯æ²¡å¿…è¦ç¡®å®šç«¯å£å·ã€‚å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå®Œå…¨ä¸ç”¨è‡ªå·±è®¾ç½®ç«¯å£å·, å…¨æƒäº¤ç»™æ“ä½œç³»ç»Ÿè¿›è¡Œåˆ†é…ã€‚æ“ä½œç³»ç»Ÿå¯ä»¥ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºåˆ†é…äº’ä¸å†²çªçš„ç«¯å£å·ã€‚ä¾‹å¦‚, æ¯éœ€è¦ä¸€ä¸ªæ–°çš„ç«¯å£å·, å°±åœ¨ä¹‹å‰åˆ†é…å·ç çš„åŸºç¡€ä¸ŠåŠ 1ã€‚åŠ¨æ€åˆ†é…çš„ç«¯å£å·çš„å–å€¼èŒƒå›´åœ¨49152~65535ä¹‹é—´ã€‚ UDPUDPä¸æä¾›å¤æ‚çš„æ§åˆ¶æœºåˆ¶, åˆ©ç”¨IPæä¾›é¢å‘æ— è¿æ¥çš„é€šä¿¡æœåŠ¡ã€‚å› æ­¤UDPä¸æ£€æŸ¥å¯¹ç«¯æ˜¯å¦å¯ä»¥é€šä¿¡, ç›´æ¥å°†UDPåŒ…å‘é€å‡ºå»ã€‚å³ä½¿æ˜¯å‡ºç°ç½‘ç»œæ‹¥å µçš„æƒ…å†µä¸‹, UDPä¹Ÿæ— æ³•è¿›è¡Œæµé‡æ§åˆ¶ç­‰é¿å…ç½‘ç»œæ‹¥å¡çš„è¡Œä¸ºã€‚æ­¤å¤–, ä¼ è¾“é€”ä¸­å‡ºç°ä¸¢åŒ…, UDPä¹Ÿä¸è´Ÿè´£é‡å‘ç­‰ã€‚UDPå¸¸ç”¨äºä¸€ä¸‹å‡ ä¸ªæ–¹é¢: åŒ…æ€»é‡è¾ƒå°‘çš„é€šä¿¡(DNSã€SNMPç­‰) è§†é¢‘ã€éŸ³é¢‘ç­‰å¤šåª’ä½“é€šä¿¡ é™å®šäºLANç­‰ç‰¹å®šç½‘ç»œä¸­çš„åº”ç”¨é€šä¿¡ å¹¿æ’­/å¤šæ’­é€šä¿¡ UDPé¦–éƒ¨UDPé¦–éƒ¨ç”±æºç«¯å£å·, ç›®æ ‡ç«¯å£å·, åŒ…é•¿å’Œæ ¡éªŒå’Œç»„æˆã€‚ æºç«¯å£å·: è¡¨ç¤ºå‘é€ç«¯å£å· ç›®æ ‡ç«¯å£å·: æ¥æ”¶ç«¯ç«¯å£å· åŒ…é•¿åº¦: ä¿å­˜UDPsé¦–éƒ¨å’Œæ•°æ®é•¿åº¦ä¹‹å’Œ æ ¡éªŒå’Œ: æ ¡éªŒå’Œç”¨æ¥åˆ¤æ–­æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦æŸå TCPTCPå¯¹æ•°æ®çš„ä¼ è¾“ã€å‘é€ã€é€šä¿¡éƒ½è¿›è¡Œäº†æ§åˆ¶çš„åè®®ã€‚å¯ä»¥è¿›è¡Œä¸¢åŒ…æ—¶çš„é‡å‘æ§åˆ¶, å¯ä»¥å¯¹æ¬¡åºä¹±æ‰çš„åˆ†åŒ…è¿›è¡Œé¡ºåºæ§åˆ¶, åªæœ‰åœ¨ç¡®è®¤é€šä¿¡å¯¹ç«¯å­˜åœ¨æ—¶æ‰ä¼šå‘é€æ•°æ®, ä»è€Œå¯ä»¥æ§åˆ¶é€šä¿¡æµé‡çš„æµªè´¹ã€‚TCPé€šè¿‡æ£€éªŒå’Œã€åºåˆ—å·ã€ç¡®è®¤åº”ç­”ã€é‡å‘æ§åˆ¶ã€è¿æ¥ç®¡ç†ä»¥åŠçª—å£æ§åˆ¶ç­‰æœºåˆ¶å®ç°å¯é æ€§ä¼ è¾“ã€‚ TCPé¦–éƒ¨TCPæ²¡æœ‰åŒ…é•¿åº¦å’Œæ•°æ®é•¿åº¦, å¯ç”±IPå±‚è·çŸ¥TCPçš„åŒ…é•¿åº¦, ç”±åŒ…é•¿å¯çŸ¥æ•°æ®çš„é•¿åº¦ã€‚ ç«¯å£å·: å‘é€ç«¯ç«¯å£å· ç›®æ ‡ç«¯å£å·: æ¥æ”¶ç«¯ç«¯å£å· åºåˆ—å·: å‘é€æ•°æ®çš„ä½ç½® ç¡®è®¤åº”ç­”å·: ä¸‹ä¸€æ¬¡åº”è¯¥æ”¶åˆ°çš„æ•°æ®çš„åºåˆ—å· æ•°æ®åç§»: è¡¨ç¤ºTCPä¼ è¾“çš„æ•°æ®éƒ¨åˆ†ä»åŒ…çš„å“ªä¸ªä½ç½®å¼€å§‹è®¡ç®— ä¿ç•™: ä¸ºä»¥åæ‰©å±•ä½¿ç”¨ æ§åˆ¶ä½: æ§åˆ¶å„ç§çŠ¶æ€ çª—å£å¤§å°: èƒ½å¤Ÿæ¥æ”¶çš„æ•°æ®å¤§å° æ ¡éªŒå’Œ: ä¸UDPç›¸ä¼¼ ç´§æ€¥æŒ‡é’ˆ: ä¸ç´§æ€¥æ•°æ®ç›¸å…³ é€‰é¡¹: ç”¨äºæé«˜TCPä¼ è¾“æ€§èƒ½, å°†æ•°æ®è°ƒæ•´ä¸º32ä½çš„æ•´æ•°å€ åºåˆ—å·ä¸ç¡®è®¤åº”ç­”åœ¨TCPä¸­, å½“å‘é€ç«¯çš„æ•°æ®åˆ°è¾¾æ¥æ”¶ç«¯æ—¶, æ¥æ”¶ç«¯ä¸»æœºä¼šè¿”å›ä¸€ä¸ªå·²æ”¶åˆ°æ¶ˆæ¯çš„é€šçŸ¥, è¿™ä¸ªæ¶ˆæ¯å«åšç¡®è®¤åº”ç­”(ACK), å¦å®šç¡®è®¤åº”ç­”(NACK)ã€‚TCPé€šè¿‡è‚¯å®šçš„ç¡®è®¤åº”ç­”(ACK)å®ç°å¯é çš„æ•°æ®ä¼ è¾“ã€‚å½“å‘é€ç«¯å°†æ•°æ®å‘å‡ºä¹‹åä¼šç­‰å¾…å¯¹ç«¯çš„ç¡®è®¤åº”ç­”ã€‚å¦‚æœæœ‰ç¡®è®¤åº”ç­”, è¯´æ˜æ•°æ®å·²ç»æˆåŠŸåˆ°è¾¾å¯¹ç«¯ã€‚åä¹‹, åˆ™æ•°æ®ä¸¢å¤±çš„å¯èƒ½æ€§å¾ˆå¤§ã€‚åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰ç­‰åˆ°ç¡®è®¤åº”ç­”, å‘é€ç«¯å°±å¯ä»¥è®¤ä¸ºæ•°æ®å·²ç»ä¸¢å¤±, å¹¶è¿›è¡Œé‡å‘ã€‚ç”±æ­¤, å³ä½¿äº§ç”Ÿäº†ä¸¢åŒ…, ä»ç„¶èƒ½å¤Ÿä¿è¯æ•°æ®èƒ½å¤Ÿåˆ°è¾¾å¯¹ç«¯, å®ç°å¯é ä¼ è¾“ã€‚ æœªæ”¶åˆ°ç¡®è®¤åº”ç­”å¹¶ä¸æ„å‘³ç€æ•°æ®ä¸€å®šä¸¢å¤±ã€‚ä¹Ÿå¯èƒ½æ˜¯æ•°æ®å¯¹æ–¹å·²ç»æ”¶åˆ°, åªæ˜¯ç¡®è®¤è¿”å›çš„ç¡®è®¤åº”ç­”åœ¨é€”ä¸­ä¸¢å¤±ã€‚è¿™ç§æƒ…å†µä¹Ÿä¼šå¯¼è‡´å‘é€ç«¯å› ä¸ºæ²¡æœ‰æ”¶åˆ°ç¡®è®¤åº”ç­”, ä»è€Œè¿›è¡Œé‡å‘æ•°æ®ã€‚ æ­¤å¤–, ä¹Ÿæœ‰å¯èƒ½å› ä¸ºä¸€äº›å…¶ä»–åŸå› å¯¼è‡´ç¡®è®¤åº”ç­”å»¶è¿Ÿåˆ°è¾¾, åœ¨æºä¸»æœºé‡å‘æ•°æ®ä»¥åæ‰åˆ°è¾¾çš„æƒ…å†µä¹Ÿç»å¸¸è§ã€‚æ­¤æ—¶, æºå‘é€ä¸»æœºåªè¦æŒ‰ç…§æ—¢å®šæœºåˆ¶é‡å‘æ•°æ®å³å¯ã€‚ä½†æ˜¯å¯¹äºç›®æ ‡ä¸»æœºæ¥è¯´, å®ƒä¼šåå¤æ”¶åˆ°ç›¸åŒçš„æ•°æ®ã€‚è€Œä¸ºäº†å¯¹ä¸Šå±‚åº”ç”¨æä¾›å¯é çš„ä¼ è¾“, å¿…é¡»å¾—æ”¾å¼ƒé‡å¤çš„æ•°æ®åŒ…ã€‚å› æ­¤éœ€è¦å¼•å…¥ä¸€ç§æœºåˆ¶, èƒ½å¤Ÿè¯†åˆ«æ˜¯å¦å·²ç»æ¥æ”¶æ•°æ®, åˆ¤æ–­æ˜¯å¦éœ€è¦æ¥æ”¶æ•°æ®ç­‰ã€‚åºåˆ—å·å¯ä»¥å®ç°ç¡®è®¤åº”ç­”å¤„ç†ã€é‡å‘æ§åˆ¶ä»¥åŠé‡å¤æ§åˆ¶ç­‰åŠŸèƒ½; åºåˆ—å·æ˜¯æŒ‰é¡ºåºç»™å‘é€æ•°æ®çš„æ¯ä¸€ä¸ªå­—èŠ‚éƒ½æ ‡ä¸Šå·ç çš„ç¼–å·ã€‚ æ¥æ”¶ç«¯æŸ¥è¯¢æ¥æ”¶æ•°æ®TCPé¦–éƒ¨ä¸­çš„åºåˆ—å·å’Œæ•°æ®é•¿åº¦, å°†è‡ªå·±ä¸‹ä¸€æ­¥åº”è¯¥æ¥æ”¶çš„åºå·ä½œä¸ºç¡®è®¤åº”ç­”è¿”é€å›å»ã€‚é€šè¿‡åºåˆ—å·å’Œç¡®è®¤åº”ç­”å·, TCPå¯ä»¥å®ç°å¯é çš„ä¼ è¾“ã€‚ è¿æ¥ç®¡ç†TCPæä¾›é¢å‘æœ‰è¿æ¥çš„é€šä¿¡ä¼ è¾“ã€‚é¢å‘æœ‰è¿æ¥æ˜¯æŒ‡åœ¨æ•°æ®é€šä¿¡å¼€å§‹ä¹‹å‰å…ˆåšå¥½é€šä¿¡ä¸¤ç«¯ä¹‹é—´çš„å‡†å¤‡å·¥ä½œã€‚TCPä¼šåœ¨æ•°æ®é€šä¿¡ä¹‹å‰, é€šè¿‡TCPé¦–éƒ¨å‘é€ä¸€ä¸ªSYNåŒ…ä½œä¸ºå»ºç«‹è¿æ¥çš„è¯·æ±‚ç­‰å¾…ç¡®è®¤åº”ç­”ã€‚å¦‚æœå¯¹ç«¯å‘æ¥ç¡®è®¤åº”ç­”, åˆ™è®¤ä¸ºå¯ä»¥è¿›è¡Œæ•°æ®é€šä¿¡ã€‚å¦‚æœå¯¹ç«¯çš„ç¡®è®¤åº”ç­”æœªèƒ½åˆ°è¾¾, å°±ä¸ä¼šè¿›è¡Œé€šä¿¡ã€‚åœ¨é€šä¿¡ç»“æŸçš„æ—¶å€™å›è¿›è¡Œæ–­å¼€è¿æ¥çš„å¤„ç†(FINåŒ…), ä¹Ÿå°±æ˜¯å‘é€ä¸€ä¸ªFINåŒ…, ç¡®è®¤æ–­å¼€è¿æ¥ã€‚å»ºç«‹ä¸€ä¸ªTCPè¿æ¥éœ€è¦å‘é€3ä¸ªåŒ…, ä¹Ÿå«åšâ€ä¸‰æ¬¡æ¡æ‰‹â€, æ–­å¼€TCPè¿æ¥éœ€è¦å‘é€4ä¸ªåŒ…, ä¹Ÿå«â€å››æ¬¡æŒ¥æ‰‹â€ã€‚æ‰€ä»¥ä¸€ä¸ªè¿æ¥çš„å»ºç«‹ä¸æ–­å¼€,è‡³å°‘éœ€è¦æ¥å›å‘é€7ä¸ªåŒ…æ‰èƒ½å®Œæˆã€‚ TCPä»¥æ®µä½å•ä½å‘é€æ•°æ®åœ¨å»ºç«‹TCPè¿æ¥çš„åŒæ—¶, ä¹Ÿå¯ä»¥ç¡®å®šå‘é€æ•°æ®åŒ…çš„å•ä½(æœ€å¤§æ¶ˆæ¯é•¿åº¦:æ®µ :MSS,)ã€‚MSSæ˜¯åœ¨ä¸‰æ¬¡æ¡æ‰‹çš„æ—¶å€™, åœ¨ä¸¤ç«¯ä¸»æœºä¹‹é—´è¢«è®¡ç®—å¾—å‡ºã€‚ä¸¤ç«¯çš„ä¸»æœºåœ¨å‘å‡ºå»ºç«‹è¿æ¥è¯·æ±‚æ—¶, ä¼šåœ¨TCPé¦–éƒ¨ä¸­å†™å…¥MSSé€‰é¡¹, å‘Šè¯‰å¯¹æ–¹è‡ªå·±çš„æ¥å£èƒ½å¤Ÿé€‚åº”çš„MSSçš„å¤§å°ã€‚ä¹‹å, åœ¨æ­¤ä¹‹é—´é€‰æ‹©ä¸€ä¸ªæœ€å°çš„MSSçš„å€¼ã€‚ #####çª—å£æ§åˆ¶TCPä»¥1ä¸ªæ®µä¸ºå•ä½, æ¯å‘ä¸€ä¸ªæ®µè¿›è¡Œä¸€æ¬¡ç¡®è®¤åº”ç­”çš„å¤„ç†, è¿™ç§ä¼ è¾“æ–¹å¼æœ‰ä¸€ä¸ªç¼ºç‚¹, åŒ…çš„å¾€è¿”æ—¶é—´è¶Šé•¿é€šä¿¡æ€§èƒ½è¶Šä½ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ TCPå¼•å…¥äº†çª—å£çš„æ¦‚å¿µ, ä½¿åœ¨å¾€è¿”æ—¶é—´è¾ƒé•¿çš„æƒ…å†µä¸‹, ä¹Ÿèƒ½æ§åˆ¶ç½‘ç»œæ€§èƒ½çš„ä¸‹é™ã€‚ç¡®è®¤åº”ç­”ä¸å†æ˜¯ä»¥æ¯ä¸ªåˆ†æ®µ, è€Œæ˜¯ä»¥æ›´å¤§çš„å•ä½è¿›è¡Œç¡®è®¤, è½¬å‘æ—¶é—´å°†ä¼šè¢«å¤§å¹…åº¦çš„ç¼©çŸ­ã€‚çª—å£å¤§å°:æŒ‡æ— éœ€ç­‰å¾…ç¡®è®¤åº”ç­”è€Œå¯ä»¥ç»§ç»­å‘é€æ•°æ®æ®µçš„æœ€å¤§å€¼ã€‚è¿™ä¸ªæœºåˆ¶çš„å®ç°ä½¿ç”¨äº†å¤§é‡çš„ç¼“å†²åŒºã€‚ å‘é€ç«¯ä¸»æœºåœ¨ç­‰åˆ°ç¡®è®¤åº”ç­”è¿”å›ä¹‹å‰, å¿…é¡»åœ¨ç¼“å†²åŒºä¸­ä¿ç•™è¿™éƒ¨åˆ†æ•°æ®ã€‚å½“æ•°æ®å‘å‡ºåè‹¥å¦‚æœŸæ”¶åˆ°ç¡®è®¤åº”ç­”å°±å¯ä»¥ä¸ç”¨å†è¿›è¡Œé‡å‘, æ­¤æ—¶æ•°æ®å°±å¯ä»¥ä»ç¼“å­˜åŒºæ¸…é™¤ã€‚æ”¶åˆ°ç¡®è®¤åº”ç­”çš„æƒ…å†µä¸‹, å°†çª—å£æ»‘åŠ¨åˆ°ç¡®è®¤åº”ç­”ä¸­çš„åºåˆ—å·çš„ä½ç½®ã€‚è¿™æ ·å¯ä»¥é¡ºåºåœ°å°†å¤šä¸ªæ®µåŒæ—¶å‘é€æé«˜é€šä¿¡æ€§èƒ½ã€‚è¿™ç§æœºåˆ¶ä¹Ÿè¢«ç§°ä¸ºæ»‘åŠ¨çª—å£æ§åˆ¶ã€‚ çª—å£æ§åˆ¶ä¸é‡å‘åœ¨ä½¿ç”¨çª—å£æ§åˆ¶ä¸­, å¤„ç†æ®µä¸¢å¤±çš„æƒ…å†µã€‚ ç¡®è®¤åº”ç­”æœªèƒ½è¿”å›çš„æƒ…å†µåœ¨è¿™ç§æƒ…å†µä¸‹, æ•°æ®å·²ç»åˆ°è¾¾å¯¹ç«¯, æ˜¯ä¸éœ€è¦è¿›è¡Œé‡å‘çš„ã€‚ æŸä¸ªæ®µä¸¢å¤±çš„æƒ…å†µæ¥æ”¶ä¸»æœºå¦‚æœæ”¶åˆ°ä¸€ä¸ªæœ¬åº”è¯¥æ¥æ”¶çš„åºå·ä»¥å¤–çš„æ•°æ®æ—¶, ä¼šé’ˆå¯¹å½“å‰ä¸ºæ­¢æ”¶åˆ°æ•°æ®è¿”å›ç¡®è®¤åº”ç­”ã€‚å‘é€ç«¯ä¸»æœºå¦‚æœè¿ç»­3æ¬¡æ”¶åˆ°åŒä¸€ä¸ªç¡®è®¤åº”ç­”, å°±ä¼šå°†å…¶æ‰€å¯¹åº”çš„æ•°æ®è¿›è¡Œé‡å‘ã€‚è¿™ç§æœºåˆ¶æ¯”ä¹‹å‰æåˆ°çš„è¶…æ—¶ç®¡ç†æ›´åŠ é«˜æ•ˆ, ä¹Ÿç§°ä½œé«˜é€Ÿé‡å‘æ§åˆ¶ã€‚ æµæ§åˆ¶æµæ§åˆ¶:è®©å‘é€ç«¯æ ¹æ®æ¥æ”¶ç«¯çš„å®é™…æ¥æ”¶èƒ½åŠ›æ§åˆ¶å‘é€çš„æ•°æ®é‡ã€‚æ¥æ”¶ç«¯ä¸»æœºå‘å‘é€ç«¯ä¸»æœºé€šçŸ¥è‡ªå·±å¯ä»¥æ¥æ”¶æ•°æ®çš„å¤§å°, äºæ˜¯å‘é€ç«¯ä¼šå‘é€ä¸è¶…è¿‡è¿™ä¸ªé™åº¦çš„æ•°æ®ã€‚è¯¥å¤§å°é™åº¦å°±è¢«ç§°ä½œçª—å£çš„å¤§å° ã€‚æ¥æ”¶ä¸»æœºå°†è‡ªå·±å¯ä»¥æ¥æ”¶çš„ç¼“å†²åŒºå¤§å°æ”¾å…¥è¿™ä¸ªå­—æ®µä¸­é€šçŸ¥ç»™å‘é€ç«¯ã€‚è¿™ä¸ªå­—æ®µçš„å€¼è¶Šå¤§, è¯´æ˜ç½‘ç»œçš„ååé‡è¶Šé«˜ã€‚æ¥æ”¶ç«¯çš„ç¼“å†²åŒºä¸€æ—¦é¢ä¸´æ•°æ®æº¢å‡ºæ—¶, çª—å£å¤§å°çš„å€¼ä¹Ÿä¼šéšä¹‹è¢«è®¾ç½®ä¸ºä¸€ä¸ªæ›´å°çš„å€¼é€šçŸ¥ç»™å‘é€ç«¯, ä»è€Œæ§åˆ¶æ•°æ®å‘é€é‡ã€‚ç®€è€Œè¨€ä¹‹, å‘é€ç«¯ä¸»æœºä¼šæ ¹æ®æ¥æ”¶ç«¯ä¸»æœºçš„æç¤º, å¯¹å‘é€çš„æ•°æ®é‡è¿›è¡Œæ§åˆ¶ã€‚ çª—å£æ¢æµ‹çš„æ•°æ®æ®µ, æ¬¡æ•°æ®æ®µä»…åŒ…å«ä¸€ä¸ªå­—èŠ‚ä»¥è·å–æœ€æ–°çš„çª—å£å¤§å°ä¿¡æ¯ã€‚ æ‹¥å¡æ§åˆ¶åœ¨ç½‘ç»œå‡ºç°æ‹¥å µæ—¶, å¦‚æœçªç„¶å‘é€ä¸€ä¸ªè¾ƒå¤§é‡çš„æ•°æ®, ææœ‰å¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªç½‘ç»œçš„ç˜«ç—ªã€‚TCPä¸ºäº†é˜²æ­¢è¯¥é—®é¢˜å¾—å‡ºç°, åœ¨é€šä¿¡ä¸€å¼€å§‹å°±ä¼šé€šè¿‡ä¸€ä¸ªå«åšæ…¢å¯åŠ¨çš„ç®—æ³•å¾—å‡ºçš„æ•°å€¼, å¯¹å‘é€æ•°æ®é‡è¿›è¡Œæ§åˆ¶ã€‚ é¦–å…ˆä¸ºäº†åœ¨å‘é€ç«¯è°ƒèŠ‚æ‰€è¦å‘é€çš„æ•°æ®çš„é‡, å®šä¹‰äº†ä¸€ä¸ªå«åšâ€æ‹¥å¡çš„çª—å£â€, åœ¨æ…¢å¯åŠ¨çš„æ—¶å€™, å°†è¿™ä¸ªæ‹¥å¡çª—å£çš„å¤§å°è®¾ç½®ä¸º1ä¸ªæ•°æ®æ®µ(1MSS)å‘é€æ•°æ®, ä¹‹åæ¯æ”¶åˆ°ä¸€æ¬¡ACK,å°±å°†æ‹¥å¡çª—å£çš„å€¼+1, åœ¨å‘é€æ•°æ®åŒ…æ—¶, å°†æ‹¥å¡çª—å£çš„å¤§å°ä¸æ¥æ”¶ç«¯ä¸»æœºçš„çª—å£å¤§å°åšæ¯”è¾ƒ, æŒ‰ç…§ä¸¤è€…ä¸­è¾ƒå°çš„å€¼, å‘é€æ¯”è¿™ä¸ªå€¼è¿˜è¦å°çš„æ•°æ®é‡ã€‚éšç€åŒ…çš„æ¯æ¬¡å¾€è¿”, æ‹¥å¡çª—å£ä¼šä»¥1ã€2ã€4ç­‰æŒ‡æ•°å‡½æ•°çš„å¢é•¿, æ‹¥å µçŠ¶å†µæ¿€å¢ç”šè‡³å¯¼è‡´ç½‘ç»œæ‹¥å¡çš„å‘ç”Ÿã€‚ä¸ºäº†é˜²æ­¢è¿™äº›, å¼•å…¥äº†æ…¢å¯åŠ¨é˜€å€¼çš„æ¦‚å¿µã€‚åªè¦æ‹¥å¡çª—å£çš„å€¼è¶…è¿‡è¿™ä¸ªé˜€å€¼, ä¼šæŒ‰ç…§æŸç§è§„åˆ™æ§åˆ¶æ‹¥å¡çª—å£çš„æ•°é‡ã€‚ æ€è€ƒä¸‰æ¬¡æ¡æ‰‹äºŒæ¬¡æ¡æ‰‹:åœ¨ç½‘ç»œè¯·æ±‚ä¸­, å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€äº†ä¸€ä¸ªSYNåŒ…,è¯·æ±‚å»ºç«‹è¿æ¥ã€‚ç”±äºå»¶è¿Ÿ, æœåŠ¡ç«¯æ²¡æœ‰åŠæ—¶æ”¶åˆ°åŒ…; äºæ˜¯å®¢æˆ·ç«¯é‡æ–°å‘é€ä¸€ä¸ªSYNåŒ…ã€‚å‡è®¾æœåŠ¡ç«¯æ¥æ”¶äº†ç¬¬äºŒä¸ªSYNåŒ…, å»ºç«‹äº†é€šä¿¡, ä¸€æ®µæ—¶é—´åé€šä¿¡ç»“æŸ, è¿æ¥è¢«å…³é—­ã€‚è¿™æ—¶å€™æœ€åˆè¢«å‘é€çš„SYNåŒ…åˆšè¢«æœåŠ¡ç«¯æ¥æ”¶, æœåŠ¡ç«¯å‘å›ACKå,å°±ä¼šå»ºç«‹è¿æ¥, ç”±äºæ˜¯å‰ä¸€æ¬¡çš„è¿æ¥è¯·æ±‚, å¹¶æ²¡æœ‰è¢«ä½¿ç”¨, è¿™æ ·å°±å¯¼è‡´æœåŠ¡ç«¯å»ºç«‹äº†ä¸€ä¸ªç©ºçš„è¿æ¥ã€‚ä¸‰æ¬¡æ¡æ‰‹: æœåŠ¡ç«¯å‘å›ACKå, å®¢æˆ·ç«¯ä¼šä¸¢å¼ƒè¿™ä¸ªæ•°æ®åŒ…, ä¸ä¼šå’ŒæœåŠ¡ç«¯è¿›è¡Œç¬¬ä¸‰æ¬¡çš„æ¡æ‰‹, å› æ­¤å¯ä»¥é¿å…æœåŠ¡ç«¯ç©ºçš„è¿æ¥ã€‚ å»ºç«‹ACKç¡®è®¤åŒ…ä¸¢å¤±TCPåè®®å¤„ç†ä¸¢åŒ…çš„ä¸€èˆ¬æ–¹æ³•ï¼ŒæœåŠ¡ç«¯ä¼šé‡æ–°å‘å®¢æˆ·ç«¯å‘é€æ•°æ®åŒ…ï¼Œç›´è‡³æ”¶åˆ° ACK ç¡®è®¤ä¸ºæ­¢ã€‚å®é™…ä¸Šè¿™ç§åšæ³•æœ‰å¯èƒ½é­åˆ°SYNæ³›æ´ªæ”»å‡»ã€‚æ‰€è°“çš„æ³›æ´ªæ”»å‡»ï¼Œæ˜¯æŒ‡å‘é€æ–¹ä¼ªé€ å¤šä¸ª IP åœ°å€ï¼Œæ¨¡æ‹Ÿä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ã€‚å½“æœåŠ¡å™¨è¿”å› ACK åï¼Œæ”»å‡»æ–¹æ•…æ„ä¸ç¡®è®¤ï¼Œä»è€Œä½¿å¾—æœåŠ¡å™¨ä¸æ–­é‡å‘ ACKã€‚ç”±äºæœåŠ¡å™¨é•¿æ—¶é—´å¤„äºåŠè¿æ¥çŠ¶æ€ï¼Œæœ€åæ¶ˆè€—è¿‡å¤šçš„ CPU å’Œå†…å­˜èµ„æºå¯¼è‡´æ­»æœºã€‚æ­£ç¡®åšæ³•:æœåŠ¡ç«¯å‘é€RSTæŠ¥æ–‡, è¿›å…¥å…³é—­çŠ¶æ€, è¿™ä¸ªRSTæ•°æ®åŒ…çš„TCPé¦–éƒ¨ä¸­, æ§åˆ¶ä½ä¸­çš„RSTä½è¢«è®¾ç½®ä¸º1, è¡¨ç¤ºè¿æ¥ä¿¡æ¯å…¨éƒ¨è¢«åˆå§‹åŒ–, åŸæœ‰çš„TCPé€šä¿¡ä¸èƒ½ç»§ç»­; å®¢æˆ·ç«¯å¦‚æœè¿˜æƒ³é‡æ–°å»ºç«‹TCPè¿æ¥, å°±å¿…é¡»é‡æ–°å¼€å§‹ç¬¬ä¸€æ¬¡æ¡æ‰‹ã€‚ å…³é—­è¿æ¥çš„æœ€åä¸€ä¸ªACKä¸¢å¤±å®é™…ä¸Šï¼Œåœ¨ç¬¬ä¸‰æ­¥ä¸­ï¼Œå®¢æˆ·ç«¯æ”¶åˆ° FIN åŒ…æ—¶ï¼Œå®ƒä¼šè®¾ç½®ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œç­‰å¾…ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´ã€‚å¦‚æœå®¢æˆ·ç«¯è¿”å›çš„ ACK ä¸¢å¤±ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯è¿˜ä¼šé‡å‘ FIN å¹¶é‡ç½®è®¡æ—¶å™¨ã€‚å‡è®¾åœ¨è®¡æ—¶å™¨å¤±æ•ˆå‰æœåŠ¡å™¨é‡å‘çš„ FIN åŒ…æ²¡æœ‰åˆ°è¾¾å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°±ä¼šè¿›å…¥ CLOSE çŠ¶æ€ï¼Œä»è€Œå¯¼è‡´æœåŠ¡ç«¯æ°¸è¿œæ— æ³•æ”¶åˆ° ACK ç¡®è®¤ï¼Œä¹Ÿå°±æ— æ³•å…³é—­è¿æ¥ã€‚ TCPä¸UDPçš„åŒºåˆ«TCPæ˜¯é¢å‘è¿æ¥çš„ã€å¯é çš„æµåè®®, åœ¨ä½¿ç”¨TCPåè®®ä¼ è¾“æ•°æ®ä¹‹å‰éœ€è¦ç¡®è®¤å‘é€æ–¹å’Œæ¥æ”¶æ–¹çš„è¿æ¥æ˜¯å»ºç«‹çš„, å»ºç«‹è¿æ¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹, å…³é—­è¿æ¥éœ€è¦å››æ¬¡æŒ¥æ‰‹ã€‚æµå°±æ˜¯æŒ‡ä¸é—´æ–­çš„æ•°æ®ç»“æ„ã€‚TCPä¸ºæä¾›å¯é æ€§ä¼ è¾“, å®è¡Œâ€é¡ºåºæ§åˆ¶â€æˆ–â€é‡å‘æ§åˆ¶â€æœºåˆ¶;è¿˜å…·å¤‡â€æµé‡æ§åˆ¶â€, â€œæ‹¥å¡æ§åˆ¶â€, æé«˜ç½‘ç»œåˆ©ç”¨ç‡ç­‰ä¼—å¤šåŠŸèƒ½ã€‚ UDPæ˜¯ä¸å…·æœ‰å¯é æ€§çš„æ•°æ®æŠ¥åè®®ã€‚UDPå¯ä»¥ç¡®ä¿å‘é€æ¶ˆæ¯çš„å¤§å°, ä¸èƒ½ä¿è¯æ¶ˆæ¯çš„æ˜¯å¦ä¼šåˆ°è¾¾ç›®æ ‡ä¸»æœºã€‚å› æ­¤, éœ€è¦åœ¨åº”ç”¨è‡ªè¡Œæ§åˆ¶é‡å‘ç­‰æœºåˆ¶ã€‚ TCPç”¨äºåœ¨ä¼ è¾“å±‚æœ‰éœ€è¦å®ç°å¯é ä¼ è¾“çš„æƒ…å†µã€‚ç”±äºå®ƒæ˜¯é¢å‘æœ‰è¿æ¥å¹¶ä¸”å…·å¤‡é¡ºåºæ§åˆ¶ã€é‡å‘æ§åˆ¶ç­‰æœºåˆ¶çš„, æ‰€ä»¥å®ƒå¯ä»¥ä¸ºåº”ç”¨æä¾›å¯é çš„ä¼ è¾“, ç”±æ­¤å†³å®šäº†TCPéœ€è¦åˆ¶å®šå¾ˆå¤šå¤æ‚çš„è§„èŒƒ, æ‰€ä»¥ä¼ è¾“æ•ˆç‡ä¸å¦‚UDPåè®®, ä¸é€‚åˆå®æ—¶çš„éŸ³è§†é¢‘ä¼ è¾“ã€‚åœ¨å¦ä¸€æ–¹é¢, UDPä¸»è¦ç”¨äºé‚£äº›å¯¹é«˜é€Ÿä¼ è¾“å’Œå®æ—¶æ€§æœ‰è¾ƒé«˜è¦æ±‚çš„é€šä¿¡æˆ–å¹¿æ’­é€šä¿¡ã€‚ å‚è€ƒ: http://www.jianshu.com/nb/3276500 å›¾è§£TCP/IP","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://github.com/icoderRo/tags/ç½‘ç»œ/"}]},{"title":"IPç›¸å…³çš„åè®®(å››)","slug":"IPç›¸å…³çš„åè®®","date":"2015-12-23T16:00:00.000Z","updated":"2017-08-17T14:50:53.000Z","comments":true,"path":"2015/12/24/IPç›¸å…³çš„åè®®/","link":"","permalink":"https://github.com/icoderRo/2015/12/24/IPç›¸å…³çš„åè®®/","excerpt":"IPç›¸å…³çš„åè®®IPçš„ç›®çš„æ˜¯è®©æœ€ç»ˆç›®æ ‡ä¸»æœºæ”¶åˆ°æ•°æ®åŒ…, ä½†æ˜¯åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ä»…ä»…æœ‰IPæ˜¯æ— æ³•å®ç°é€šä¿¡çš„ã€‚å¿…é¡»è¿˜æœ‰èƒ½å¤Ÿè§£æä¸»æœºåç§°å’ŒMACåœ°å€çš„åŠŸèƒ½, ä»¥åŠæ•°æ®åŒ…åœ¨å‘é€è¿‡ç¨‹ä¸­å¼‚å¸¸æƒ…å†µå¤„ç†çš„åŠŸèƒ½ã€‚ DNSæˆ‘ä»¬å¹³å¸¸åœ¨è®¿é—®æŸä¸ªç½‘ç«™æ—¶, åŸŸå(åŸŸåæ˜¯æŒ‡ä¸ºäº†è¯†åˆ«ä¸»æœºåç§°å’Œç»„ç»‡æœºæ„åç§°çš„ä¸€ç§å…·æœ‰åˆ†å±‚çš„åç§°ã€‚æ¯”å¦‚åœ¨åŸŸå bnu.edu.cnä¸­ï¼Œneuæ˜¯ä¸»æœºåï¼Œedu å’Œ cn æ˜¯ä¸åŒå±‚æ¬¡ä¸‹çš„æœºæ„å), è€Œä¸æ˜¯ä½¿ç”¨IPåœ°å€ã€‚èƒ½å¤Ÿè¿™æ ·åšæ˜¯å› ä¸ºæœ‰äº†DNSã€‚DNSå¯ä»¥å°†è‡ªèº«å…·æœ‰æ„ä¹‰çš„åŸŸåè‡ªåŠ¨è½¬æ¢ä¸ºå…·ä½“çš„IPåœ°å€ã€‚ åœ¨Windows/Unixä¸­æŸ¥æ‰¾åŸŸåå¯¹åº”çš„IPåœ°å€å¯ä»¥è¾“å…¥nslookup åŸŸå DNSæŸ¥è¯¢ä»¥è®¿é—®www.ietf.orgä¸ºä¾‹,æ­¤æ—¶çš„DNSæŸ¥è¯¢æµç¨‹å¦‚å›¾æ‰€ç¤º: è§£æå™¨ä¸ºäº†æŸ¥è¯¢IPåœ°å€, å‘åŸŸåæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢å¤„ç†ã€‚æ¥æ”¶è¿™ä¸ªæŸ¥è¯¢è¯·æ±‚çš„åŸŸåæœåŠ¡å™¨é¦–å…ˆä¼šåœ¨è‡ªå·±çš„æ•°æ®åº“è¿›è¡ŒæŸ¥æ‰¾ã€‚å¦‚æœæœ‰è¯¥åŸŸåæ‰€å¯¹åº”çš„IPåœ°å€å°±è¿”å›, å¦‚æœæ²¡æœ‰, åˆ™åŸŸåæœåŠ¡å™¨å†å‘ä¸Šä¸€å±‚è·ŸåŸŸåæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢å¤„ç†ã€‚è§£æå™¨å’ŒåŸŸåæœåŠ¡å™¨å°†æœ€æ–°äº†è§£åˆ°çš„ä¿¡æ¯æš‚æ—¶ä¿å­˜åœ¨ç¼“å­˜é‡Œã€‚è¿™æ ·, å¯ä»¥å‡å°‘æ¯æ¬¡æŸ¥è¯¢æ—¶çš„æ€§èƒ½æ¶ˆè€—ã€‚","text":"IPç›¸å…³çš„åè®®IPçš„ç›®çš„æ˜¯è®©æœ€ç»ˆç›®æ ‡ä¸»æœºæ”¶åˆ°æ•°æ®åŒ…, ä½†æ˜¯åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ä»…ä»…æœ‰IPæ˜¯æ— æ³•å®ç°é€šä¿¡çš„ã€‚å¿…é¡»è¿˜æœ‰èƒ½å¤Ÿè§£æä¸»æœºåç§°å’ŒMACåœ°å€çš„åŠŸèƒ½, ä»¥åŠæ•°æ®åŒ…åœ¨å‘é€è¿‡ç¨‹ä¸­å¼‚å¸¸æƒ…å†µå¤„ç†çš„åŠŸèƒ½ã€‚ DNSæˆ‘ä»¬å¹³å¸¸åœ¨è®¿é—®æŸä¸ªç½‘ç«™æ—¶, åŸŸå(åŸŸåæ˜¯æŒ‡ä¸ºäº†è¯†åˆ«ä¸»æœºåç§°å’Œç»„ç»‡æœºæ„åç§°çš„ä¸€ç§å…·æœ‰åˆ†å±‚çš„åç§°ã€‚æ¯”å¦‚åœ¨åŸŸå bnu.edu.cnä¸­ï¼Œneuæ˜¯ä¸»æœºåï¼Œedu å’Œ cn æ˜¯ä¸åŒå±‚æ¬¡ä¸‹çš„æœºæ„å), è€Œä¸æ˜¯ä½¿ç”¨IPåœ°å€ã€‚èƒ½å¤Ÿè¿™æ ·åšæ˜¯å› ä¸ºæœ‰äº†DNSã€‚DNSå¯ä»¥å°†è‡ªèº«å…·æœ‰æ„ä¹‰çš„åŸŸåè‡ªåŠ¨è½¬æ¢ä¸ºå…·ä½“çš„IPåœ°å€ã€‚ åœ¨Windows/Unixä¸­æŸ¥æ‰¾åŸŸåå¯¹åº”çš„IPåœ°å€å¯ä»¥è¾“å…¥nslookup åŸŸå DNSæŸ¥è¯¢ä»¥è®¿é—®www.ietf.orgä¸ºä¾‹,æ­¤æ—¶çš„DNSæŸ¥è¯¢æµç¨‹å¦‚å›¾æ‰€ç¤º: è§£æå™¨ä¸ºäº†æŸ¥è¯¢IPåœ°å€, å‘åŸŸåæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢å¤„ç†ã€‚æ¥æ”¶è¿™ä¸ªæŸ¥è¯¢è¯·æ±‚çš„åŸŸåæœåŠ¡å™¨é¦–å…ˆä¼šåœ¨è‡ªå·±çš„æ•°æ®åº“è¿›è¡ŒæŸ¥æ‰¾ã€‚å¦‚æœæœ‰è¯¥åŸŸåæ‰€å¯¹åº”çš„IPåœ°å€å°±è¿”å›, å¦‚æœæ²¡æœ‰, åˆ™åŸŸåæœåŠ¡å™¨å†å‘ä¸Šä¸€å±‚è·ŸåŸŸåæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢å¤„ç†ã€‚è§£æå™¨å’ŒåŸŸåæœåŠ¡å™¨å°†æœ€æ–°äº†è§£åˆ°çš„ä¿¡æ¯æš‚æ—¶ä¿å­˜åœ¨ç¼“å­˜é‡Œã€‚è¿™æ ·, å¯ä»¥å‡å°‘æ¯æ¬¡æŸ¥è¯¢æ—¶çš„æ€§èƒ½æ¶ˆè€—ã€‚ ARPåœ¨ç½‘ç»œå±‚, åªè¦ç¡®å®šäº†IPåœ°å€, å°±å¯ä»¥å‘è¿™ä¸ªç›®æ ‡åœ°å€å‘é€IPæ•°æ®æŠ¥ã€‚åœ¨æ•°æ®é“¾è·¯å±‚, è¿›è¡Œé€šä¿¡æ—¶éœ€è¦äº†è§£æ¯ä¸ªIPåœ°å€å¤šå¯¹åº”çš„MACåœ°å€ã€‚ARPæ˜¯ä¸€ç§è§£å†³åœ°å€é—®é¢˜å¾—åè®®,æ ¹æ®ç›®æ ‡IPåœ°å€ä¸ºçº¿ç´¢,ç”¨æ¥å®šä½ä¸‹ä¸€ä¸ªæ¥æ”¶æ•°æ®åˆ†åŒ…çš„ç½‘ç»œè®¾å¤‡å¯¹åº”çš„MACåœ°å€ã€‚ ARPå·¥ä½œæœºåˆ¶ARPå€ŸåŠ©ARPè¯·æ±‚ä¸ARPå“åº”ä¸¤ç§ç±»å‹çš„åŒ…ç¡®å®šMACåœ°å€ã€‚ ä¸»æœºAä¸ºäº†è·å–ä¸»æœºBçš„MACåœ°å€, èµ·åˆè¦é€šè¿‡å¹¿æ’­å‘é€ä¸€ä¸ªARPè¯·æ±‚åŒ…ã€‚è¿™ä¸ªåŒ…ä¸­åŒ…å«äº†æƒ³è¦äº†è§£å…¶MACåœ°å€çš„ä¸»æœºIPåœ°å€ã€‚ä¹Ÿå°±æ˜¯ä¹¦, ARPè¯·æ±‚åŒ…ä¸­å·²ç»åŒ…å«äº†ä¸»æœºBçš„IPåœ°å€ã€‚ç”±äºå¹¿æ’­çš„åŒ…å¯ä»¥è¢«åŒä¸€ä¸ªé“¾è·¯ä¸Šæ‰€æœ‰çš„ä¸»æœºæˆ–è·¯ç”±å™¨æ¥æ”¶, å› æ­¤ARPè¯·æ±‚åŒ…ä¹Ÿå°±ä¼šè¢«åŒä¸€ä¸ªé“¾è·¯ä¸Šæ‰€æœ‰çš„ä¸»æœºå’Œè·¯ç”±å™¨è¿›è¡Œè§£æã€‚å¦‚æœARPè¯·æ±‚åŒ…ä¸­çš„ç›®æ ‡IPåœ°å€ä¸è‡ªå·±çš„IPåœ°å€ä¸€è‡´, é‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å°±å°†è‡ªå·±çš„MACåœ°å€å¡å…¥ARPå“åº”åŒ…, è¿”å›ç»™ä¸»æœºAã€‚ä¸»æœºAå°†è·å–åˆ°çš„MACåœ°å€ç¼“å­˜ä¸€æ®µæ—¶é—´, ä»¥å‡å°‘ARPåŒ…çš„å‘é€ä¸æµé‡çš„æµªè´¹ã€‚ RARPæ˜¯å°†ARPåè¿‡æ¥, ä»MACåœ°å€å®šä½IPåœ°å€çš„ä¸€ç§åè®®ã€‚ä»£ç†ARP, é€šå¸¸ARPåŒ…ä¼šè¢«è·¯ç”±å™¨éš”ç¦», ä½†æ˜¯é‡‡ç”¨ä»£ç†ARPçš„è·¯ç”±å™¨å¯ä»¥å°†ARPè¯·æ±‚è½¬å‘ç»™é‚»è¿‘çš„ç½‘æ®µã€‚ç”±æ­¤, ä¸¤ä¸ªä»¥ä¸Šç½‘æ®µçš„èŠ‚ç‚¹ä¹‹é—´å¯ä»¥åƒåœ¨åŒä¸€ä¸ªç½‘æ®µä¸­ä¸€æ ·è¿›è¡Œé€šä¿¡ã€‚ ICMPICMPçš„ä¸»è¦åŠŸèƒ½: ç¡®è®¤IPåŒ…æ˜¯å¦æˆåŠŸé€è¾¾ç›®æ ‡åœ°å€, é€šçŸ¥å‘é€è¿‡ç¨‹å½“ä¸­IPåŒ…è¢«åºŸå¼ƒçš„å…·ä½“åŸå› , æ”¹å–„ç½‘ç»œè®¾ç½®ç­‰ã€‚å› æ­¤å¯ä»¥ç›‘å¬ç½‘ç»œæ˜¯å¦æ­£å¸¸ã€è®¾ç½®æ˜¯å¦æœ‰è¯¯ä»¥åŠè®¾å¤‡æœ‰ä½•å¼‚å¸¸ç­‰ä¿¡æ¯ã€‚ ICMPçš„æ¶ˆæ¯å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç±»: ä¸€ç±»æ˜¯é€šçŸ¥å‡ºé”™åŸå› çš„é”™è¯¯æ¶ˆæ¯, å¦ä¸€ç±»æ˜¯ç”¨äºè¯Šæ–­çš„æŸ¥è¯¢æ¶ˆæ¯ã€‚ ICMPçš„ä¸»è¦æ¶ˆæ¯ ICMPç›®æ ‡ä¸å¯è¾¾æ¶ˆæ¯(ç±»å‹3)IPè·¯ç”±å™¨æ— æ³•å°†IPæ•°æ®æŠ¥å‘é€ç»™ç›®æ ‡åœ°å€æ—¶, ä¼šç»™å‘é€ç«¯ä¸»æœºè¿”å›ä¸€ä¸ªç›®æ ‡ä¸å¯è¾¾çš„ICMPæ¶ˆæ¯, å¹¶åœ¨è¿™ä¸ªæ¶ˆæ¯ä¸­æ˜¾ç¤ºä¸å¯è¾¾çš„å…·ä½“åŸå› ã€‚ ICMPé‡å®šå‘æ¶ˆæ¯(ç±»å‹5)å¦‚æœè·¯ç”±å™¨å‘ç°å‘é€ç«¯ä¸»æœºä½¿ç”¨äº†æ¬¡ä¼˜çš„è·¯å¾„å‘é€æ•°æ®, é‚£ä¹ˆå®ƒä¼šè¿”å›ä¸€ä¸ªICMPé‡å®šå‘çš„æ¶ˆæ¯ç»™è¿™ä¸ªä¸»æœºã€‚åœ¨è¿™ä¸ªæ¶ˆæ¯ä¸­åŒ…å«äº†æœ€åˆé€‚çš„è·¯ç”±ä¿¡æ¯å’Œæºæ•°æ®ã€‚å¤šæ•°æƒ…å†µä¸‹ç”±äºè¿™ç§é‡å®šå‘æ¶ˆæ¯æˆä¸ºå¼•å‘é—®é¢˜çš„åŸå› , æ‰€ä»¥ä¸€èˆ¬ä¸è¿›è¡Œè¿™ç§è®¾ç½®ã€‚ ICMPè¶…æ—¶æ¶ˆæ¯(ç±»å‹11)IPåŒ…ä¸­æœ‰ä¸€ä¸ªå­—æ®µå«åšTTL, å®ƒçš„å€¼ä¼šéšç€æ¯ç»è¿‡ä¸€æ¬¡è·¯ç”±å™¨å°±ä¼šå‡1, å‡åˆ°0è¯¥IPåŒ…å°±ä¼šè¢«ä¸¢å¼ƒã€‚æ­¤æ—¶, IPè·¯ç”±å™¨å°†ä¼šå‘é€ä¸€ä¸ªICMPè¶…æ—¶çš„æ¶ˆæ¯ç»™å‘é€ç«¯ä¸»æœº, å¹¶é€šçŸ¥è¯¥åŒ…å·²è¢«ä¸¢å¼ƒã€‚è®¾ç½®IPåŒ…ç”Ÿå­˜å‘¨æœŸçš„ä¸»è¦ç›®çš„, æ˜¯ä¸ºäº†åœ¨è·¯ç”±æ§åˆ¶å‘ç”Ÿå¾ªç¯çŠ¶å†µæ—¶,é¿å…IPåŒ…æ— ä¼‘æ­¢çš„åœ¨ç½‘ç»œä¸Šè¢«è½¬å‘; æ­¤å¤–å¯ä»¥åˆ©ç”¨TTLæ§åˆ¶åŒ…çš„åˆ°è¾¾èŒƒå›´ã€‚ ICMPå›é€æ¶ˆæ¯(ç±»å‹0ã€8)ç”¨äºæ‰€å‘é€çš„æ•°æ®åŒ…æ˜¯å¦å·²ç»æˆåŠŸåˆ°è¾¾å¯¹ç«¯çš„ä¸€ç§æ¶ˆæ¯ã€‚å¯ä»¥å‘å¯¹ç«¯ä¸»æœºå‘é€å›é€è¯·æ±‚çš„æ¶ˆæ¯, ä¹Ÿå¯ä»¥æ¥æ”¶å¯¹ç«¯ä¸»æœºå‘å›æ¥çš„å›é€åº”ç­”æ¶ˆæ¯ã€‚pingå°±æ˜¯åˆ©ç”¨è¿™ä¸ªæ¶ˆæ¯å®ç°çš„ã€‚ DHCPDHCPå®ç°äº†è‡ªåŠ¨è®¾ç½®IPåœ°å€ã€ç»Ÿä¸€ç®¡ç†IPåœ°å€çš„åˆ†é…,ä¹Ÿå°±æ˜¯è¯´,DHCPå®ç°äº†å³æ’å³ç”¨ã€‚ DHCPå·¥ä½œæœºåˆ¶ NATNATæ˜¯ç”¨äºåœ¨æœ¬åœ°ç½‘ç»œä¸­ä½¿ç”¨ç§æœ‰åœ°å€, åœ¨è¿æ¥åˆ°äº’è”ç½‘æ—¶è½¬è€Œä½¿ç”¨å…¨å±€IPåœ°å€çš„æŠ€æœ¯ã€‚é™¤äº†å¯ä»¥è½¬æ¢IPåœ°å€å¤–, è¿˜å¯ä»¥è½¬æ¢TCPã€UDPç«¯å£å·çš„NAPTæŠ€æœ¯, ç”±æ­¤å¯ä»¥å®ç°ç”¨ä¸€ä¸ªå…¨å±€IPåœ°å€ä¸å¤šä¸ªä¸»æœºçš„é€šä¿¡ã€‚ NATå·¥ä½œæœºåˆ¶åœ¨NAT(NAPT)çš„è·¯ç”±å™¨å†…éƒ¨, æœ‰ä¸€å¼ è‡ªåŠ¨ç”Ÿæˆçš„ç”¨æ¥è½¬æ¢åœ°å€çš„è¡¨ã€‚å½“ç§æœ‰ç½‘ç»œå†…çš„å¤šå°æœºå™¨åŒæ—¶ä¸å¤–éƒ¨è¿›è¡Œé€šä¿¡, ä»…ä»…è½¬æ¢IPåœ°å€, å…¨å±€IPåœ°å€å¯èƒ½ä¼šå‡ºç°ä¸å¤Ÿç”¨çš„æƒ…å†µ, è¿™æ—¶é‡‡ç”¨å’Œç«¯å£å·ä¸€èµ·è½¬æ¢çš„æ–¹å¼(NAPT)å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ NAPTå·¥ä½œæœºåˆ¶è½¬æ¢è¡¨åœ¨NATè·¯ç”±å™¨ä¸Šè‡ªåŠ¨ç”Ÿæˆ, ä»¥TCPä¸ºä¾‹, åœ¨å»ºç«‹TCPè¿æ¥çš„é¦–æ¬¡æ¡æ‰‹æ—¶çš„SYNåŒ…ä¸€ç»å‘å‡º, å°±ä¼šç”Ÿæˆè¿™ä¸ªè¡¨ã€‚è€Œåæ”¶åˆ°å…³é—­è¿æ¥æ—¶å‘å‡ºçš„FINåŒ…çš„ç¡®è®¤åº”ç­”åå°±ä»è¡¨ä¸­è¢«åˆ é™¤ã€‚ NAT-PTNAT-PTæ˜¯å°†IPv6çš„é¦–éƒ¨è½¬æ¢ä¸ºIPv4çš„é¦–éƒ¨çš„ä¸€ç§æŠ€æœ¯ã€‚è®©é‚£äº›åªæœ‰IPv6åœ°å€çš„ä¸»æœºä¹Ÿèƒ½å¤Ÿä¸IPv4åœ°å€çš„å…¶ä»–ä¸»æœºè¿›è¡Œé€šä¿¡ã€‚ NATçš„æ½œåœ¨é—®é¢˜ æ— æ³•ä»NATçš„å¤–éƒ¨å‘å†…éƒ¨æœåŠ¡å»ºç«‹è¿æ¥ è½¬æ¢è¡¨çš„ç”Ÿæˆä¸è½¬æ¢æ“ä½œéƒ½ä¼šäº§ç”Ÿä¸€å®šå¼€é”€ é€šä¿¡è¿‡ç¨‹ä¸­ä¸€æ—¦NATé‡åˆ°å¼‚å¸¸éœ€è¦é‡æ–°å¯åŠ¨, æ‰€æœ‰çš„TCPè¿æ¥éƒ½ä¼šè¢«é‡ç½®ã€‚ è§£å†³NATçš„æ½œåœ¨é—®é¢˜ 1.æ”¹ç”¨IPv6 2.â€NATç©¿è¶Šâ€ IPéš§é“IPéš§é“ä¸­å¯ä»¥å°†IPv6çš„åŒ…åˆæˆä¸ºä¸€ä¸ªæ•°æ®, å†è¿½åŠ ä¸€ä¸ªIPv4çš„é¦–éƒ¨å, è®©IPv4çš„ç½‘ç»œè¯†åˆ«ã€‚è¿™ç§åœ¨ç½‘ç»œå±‚çš„é¦–éƒ¨åé¢ç»§ç»­è¿½åŠ ç½‘ç»œå±‚é¦–éƒ¨çš„é€šä¿¡æ–¹å¼å°±å«åšâ€IPéš§é“â€ã€‚ æ˜¾ç¤ºæ‹¥å¡é€šçŸ¥(ECN)ECNä¸ºå®ç°æ‹¥å¡é€šçŸ¥çš„åŠŸèƒ½, å°†IPé¦–éƒ¨çš„TOSå­—æ®µç½®æ¢ä¸ºENCå­—æ®µ, å¹¶åœ¨TCPé¦–éƒ¨çš„ä¿ç•™ä½ä¸­è¿½åŠ æ‹¥å¡çª—å£å‡å°‘(CWR)å’ŒECEè¡¨ç¤ºã€‚ ECNçš„æœºåˆ¶æ¦‚æ‹¬èµ·æ¥å°±æ˜¯åœ¨å‘é€åŒ…çš„IPé¦–éƒ¨ä¸­è®°å½•è·¯ç”±å™¨æ˜¯å¦é‡åˆ°æ‹¥å¡, å¹¶åœ¨è¿”å›åŒ…çš„TCPé¦–éƒ¨ä¸­é€šçŸ¥æ˜¯å¦å‘ç”Ÿè¿‡æ‹¥å¡ã€‚æ‹¥å¡æ£€æŸ¥åœ¨ç½‘ç»œå±‚(IP)è¿›è¡Œ, è€Œæ‹¥å¡é€šçŸ¥åˆ™åœ¨ä¼ è¾“å±‚(TCP)è¿›è¡Œã€‚ å‚è€ƒ: å›¾è§£TCP/IP","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://github.com/icoderRo/tags/ç½‘ç»œ/"}]},{"title":"IPåè®®(ä¸‰)","slug":"IPåè®®","date":"2015-12-17T16:00:00.000Z","updated":"2017-08-17T14:51:07.000Z","comments":true,"path":"2015/12/18/IPåè®®/","link":"","permalink":"https://github.com/icoderRo/2015/12/18/IPåè®®/","excerpt":"IPåè®®IP(IPv4ã€IPv6)ç›¸å½“äºå‚è€ƒæ¨¡å‹ä¸­çš„ç¬¬ä¸‰å±‚â€“ç½‘ç»œå±‚ã€‚ ç½‘ç»œå±‚çš„ä¸»è¦ä½œç”¨æ˜¯: å®ç°ç»ˆç«¯èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡; ä¹Ÿå«åšç‚¹å¯¹ç‚¹é€šä¿¡ã€‚ ä¸»æœº: é…ç½®æœ‰IPåœ°å€, ä¸è¿›è¡Œè·¯ç”±æ§åˆ¶è·¯ç”±å™¨: æ—¢é…æœ‰IPåœ°å€, åˆå…·æœ‰è·¯ç”±æ§åˆ¶èƒ½åŠ›èŠ‚ç‚¹: ä¸»æœºå’Œè·¯ç”±å™¨çš„ç»Ÿç§° æ•°æ®é“¾è·¯å±‚çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨äº’è¿åŒä¸€ç§æ•°æ®é“¾è·¯çš„èŠ‚ç‚¹ä¹‹é—´è¿›è¡ŒåŒ…çš„ä¼ é€’ã€‚è€Œä¸€æ—¦è·¨è¶Šå¤šç§æ•°æ®é“¾è·¯, å°±éœ€è¦å€ŸåŠ©ç½‘ç»œå±‚ã€‚ç½‘ç»œå±‚å¯ä»¥è·¨è¶Šä¸åŒçš„æ•°æ®é“¾è·¯, åœ¨ä¸åŒçš„æ•°æ®é“¾è·¯ä¸Šä¹Ÿèƒ½å®ç°ä¸¤ç«¯èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®åŒ…ä¼ è¾“ã€‚ ###IPåœ°å€æ•°æ®é“¾è·¯å±‚çš„MACåœ°å€æ˜¯ç”¨æ¥æ ‡è¯†åŒä¸€ä¸ªé“¾è·¯ä¸­ä¸åŒè®¡ç®—æœºçš„ä¸€ç§è¯†åˆ«ç ã€‚ä½œä¸ºç½‘ç»œå±‚çš„IP, ä¹Ÿæœ‰è¿™ç§åœ°å€ä¿¡æ¯, å«åšIPåœ°å€ã€‚IPåœ°å€ç”¨äºåœ¨è¿æ¥åˆ°ç½‘ç»œä¸­çš„æ‰€æœ‰ä¸»æœºä¸­è¯†åˆ«å‡ºè¿›è¡Œé€šä¿¡çš„ç›®æ ‡åœ°å€, åœ¨TCP/IPé€šä¿¡ä¸­æ‰€æœ‰çš„ä¸»æœº/è·¯ç”±å™¨éƒ½å¿…é¡»è®¾å®šè‡ªå·±çš„IPåœ°å€, ç”¨IPåœ°å€è¯†åˆ«ä¸»æœºå’Œè·¯ç”±å™¨ã€‚ ä¸è®ºä¸»æœºä¸å“ªç§æ•°æ®é“¾è·¯è¿æ¥, å…¶IPåœ°å€çš„å½¢å¼éƒ½ä¿æŒä¸å˜, åœ¨ç½‘æ¡¥/äº¤æ¢æœºé›†çº¿å™¨ç­‰ç‰©ç†å±‚æˆ–æ•°æ®é“¾è·¯å±‚çš„æ•°æ®åŒ…è½¬å‘è®¾å¤‡ä¸­, ä¸éœ€è¦è®¾ç½®IPåœ°å€, å› ä¸ºè¿™äº›è®¾å¤‡åªè´Ÿè´£å°†IPåŒ…è½¬åŒ–ä¸º0ã€1çš„æ¯”ç‰¹æµè½¬å‘æˆ–è€…æ•°æ®é“¾è·¯å¸§çš„æ•°æ®éƒ¨åˆ†è¿›è¡Œè½¬å‘, å› è€Œä¸éœ€è¦å¯¹åº”IPåè®®ã€‚","text":"IPåè®®IP(IPv4ã€IPv6)ç›¸å½“äºå‚è€ƒæ¨¡å‹ä¸­çš„ç¬¬ä¸‰å±‚â€“ç½‘ç»œå±‚ã€‚ ç½‘ç»œå±‚çš„ä¸»è¦ä½œç”¨æ˜¯: å®ç°ç»ˆç«¯èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡; ä¹Ÿå«åšç‚¹å¯¹ç‚¹é€šä¿¡ã€‚ ä¸»æœº: é…ç½®æœ‰IPåœ°å€, ä¸è¿›è¡Œè·¯ç”±æ§åˆ¶è·¯ç”±å™¨: æ—¢é…æœ‰IPåœ°å€, åˆå…·æœ‰è·¯ç”±æ§åˆ¶èƒ½åŠ›èŠ‚ç‚¹: ä¸»æœºå’Œè·¯ç”±å™¨çš„ç»Ÿç§° æ•°æ®é“¾è·¯å±‚çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨äº’è¿åŒä¸€ç§æ•°æ®é“¾è·¯çš„èŠ‚ç‚¹ä¹‹é—´è¿›è¡ŒåŒ…çš„ä¼ é€’ã€‚è€Œä¸€æ—¦è·¨è¶Šå¤šç§æ•°æ®é“¾è·¯, å°±éœ€è¦å€ŸåŠ©ç½‘ç»œå±‚ã€‚ç½‘ç»œå±‚å¯ä»¥è·¨è¶Šä¸åŒçš„æ•°æ®é“¾è·¯, åœ¨ä¸åŒçš„æ•°æ®é“¾è·¯ä¸Šä¹Ÿèƒ½å®ç°ä¸¤ç«¯èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®åŒ…ä¼ è¾“ã€‚ ###IPåœ°å€æ•°æ®é“¾è·¯å±‚çš„MACåœ°å€æ˜¯ç”¨æ¥æ ‡è¯†åŒä¸€ä¸ªé“¾è·¯ä¸­ä¸åŒè®¡ç®—æœºçš„ä¸€ç§è¯†åˆ«ç ã€‚ä½œä¸ºç½‘ç»œå±‚çš„IP, ä¹Ÿæœ‰è¿™ç§åœ°å€ä¿¡æ¯, å«åšIPåœ°å€ã€‚IPåœ°å€ç”¨äºåœ¨è¿æ¥åˆ°ç½‘ç»œä¸­çš„æ‰€æœ‰ä¸»æœºä¸­è¯†åˆ«å‡ºè¿›è¡Œé€šä¿¡çš„ç›®æ ‡åœ°å€, åœ¨TCP/IPé€šä¿¡ä¸­æ‰€æœ‰çš„ä¸»æœº/è·¯ç”±å™¨éƒ½å¿…é¡»è®¾å®šè‡ªå·±çš„IPåœ°å€, ç”¨IPåœ°å€è¯†åˆ«ä¸»æœºå’Œè·¯ç”±å™¨ã€‚ ä¸è®ºä¸»æœºä¸å“ªç§æ•°æ®é“¾è·¯è¿æ¥, å…¶IPåœ°å€çš„å½¢å¼éƒ½ä¿æŒä¸å˜, åœ¨ç½‘æ¡¥/äº¤æ¢æœºé›†çº¿å™¨ç­‰ç‰©ç†å±‚æˆ–æ•°æ®é“¾è·¯å±‚çš„æ•°æ®åŒ…è½¬å‘è®¾å¤‡ä¸­, ä¸éœ€è¦è®¾ç½®IPåœ°å€, å› ä¸ºè¿™äº›è®¾å¤‡åªè´Ÿè´£å°†IPåŒ…è½¬åŒ–ä¸º0ã€1çš„æ¯”ç‰¹æµè½¬å‘æˆ–è€…æ•°æ®é“¾è·¯å¸§çš„æ•°æ®éƒ¨åˆ†è¿›è¡Œè½¬å‘, å› è€Œä¸éœ€è¦å¯¹åº”IPåè®®ã€‚ IPåœ°å€çš„å®šä¹‰IPv4åœ°å€ç”±32ä½æ­£æ•´æ•°æ¥è¡¨ç¤º, IPåœ°å€åœ¨è®¡ç®—æœºå†…éƒ¨ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼è¢«å¤„ç†, ä¸ºäº†æ–¹ä¾¿ç®¡ç†, å°†32ä½çš„IPåœ°å€ä»¥æ¯8ä½ä¸€ç»„, åˆ†æˆ4ç»„,æ¯ç»„ä»¥.éš”å¼€, å†å°†æ¯ç»„æ•°è½¬æ¢ä¸ºåè¿›åˆ¶æ•°ã€‚ å°†è¡¨ç¤ºæˆIPåœ°å€çš„æ•°å­—æ•´ä½“è®¡ç®—, ä¼šå¾—å‡ºå¤§çº¦43äº¿å°è®¡ç®—æœºå…è®¸è¿æ¥åˆ°ç½‘ç»œã€‚å®é™…ä¸Š, IPåœ°å€ä¸æ˜¯æ ¹æ®ä¸»æœºå°æ•°æ¥é…ç½®çš„, è€Œæ˜¯æ¯ä¸€å°ä¸»æœºä¸Šçš„æ¯ä¸€å—ç½‘å¡éƒ½å¾—è®¾ç½®IPåœ°å€, é€šå¸¸ä¸€å—ç½‘å¡åªè®¾ç½®ä¸€ä¸ªIPåœ°å€, ä¸€å—ç½‘å¡ä¹Ÿå¯ä»¥é…ç½®å¤šä¸ªIPåœ°å€ã€‚ä¸€å°è·¯ç”±å™¨é€šå¸¸éƒ½ä¼šé…ç½®ä¸¤ä¸ªä»¥ä¸Šçš„ç½‘å¡, å› æ­¤å¯ä»¥è®¾ç½®ä¸¤ä¸ªä»¥ä¸Šçš„IPåœ°å€ã€‚ IPåœ°å€çš„ç»„æˆIPåœ°å€ç”±ç½‘ç»œæ ‡è¯†(ç½‘ç»œåœ°å€)å’Œä¸»æœºæ ‡è¯†(ä¸»æœºåœ°å€)ä¸¤éƒ¨åˆ†ç»„æˆã€‚ ç½‘ç»œæ ‡è¯†åœ¨æ•°æ®é“¾è·¯çš„æ¯ä¸ªæ®µé…ç½®ä¸åŒçš„å€¼ã€‚ç½‘ç»œæ ‡è¯†å¿…é¡»ä¿è¯äº’ç›¸è¿æ¥çš„æ¯ä¸ªæ®µçš„åœ°å€ä¸é‡å¤ã€‚è€Œç›¸åŒæ®µå†…ç›¸è¿çš„ä¸»æœºå¿…é¡»æœ‰ç›¸åŒçš„ç½‘ç»œåœ°å€ã€‚IPåœ°å€çš„ä¸»æœºæ ‡è¯†åˆ™ä¸å…è®¸åœ¨åŒä¸€ä¸ªç½‘æ®µå†…é‡å¤å‡ºç°ã€‚å› æ­¤, å¯ä»¥é€šè¿‡è®¾ç½®ç½‘ç»œåœ°å€å’Œä¸»æœºåœ°å€, åœ¨ç›¸äº’è¿æ¥çš„æ•´ä¸ªç½‘ç»œä¸­ä¿è¯æ¯å°ä¸»æœºçš„IPåœ°å€éƒ½ä¸ä¼šç›¸äº’é‡å , å³IPåœ°å€å…·æœ‰äº†å”¯ä¸€æ€§ã€‚ å¦‚ä½•åŒºåˆ†ç½‘ç»œæ ‡è¯†å’Œä¸»æœºæ ‡è¯†, æœ‰ä¸¤ç§ç±»å‹, ä¸€ç§æ˜¯åˆ†ç±», å¦ä¸€ç§æ˜¯ä¹Ÿæ˜¯ç°åœ¨ä¸»æµçš„æ–¹å¼å­ç½‘æ©ç (ç½‘ç»œå‰ç¼€) IPåœ°å€åˆ†ç±»IPåœ°å€åˆ†ä¸ºå››ä¸ªçº§åˆ«, æ ¹æ®IPåœ°å€ä¸­çš„ç¬¬1ä½~ç¬¬4ä½çš„æ¯”ç‰¹ä½å¯¹å…¶ç½‘ç»œæ ‡è¯†å’Œä¸»æœºæ ‡è¯†è¿›è¡ŒåŒºåˆ†, å…±åˆ†ä¸ºAã€Bã€Cã€Då››ç±»ã€‚ Aç±»åœ°å€æ˜¯é¦–ä½ä»¥â€0â€å¼€å¤´çš„åœ°å€ã€‚ä»ç¬¬1ä½~ç¬¬8ä½æ˜¯ç½‘ç»œæ ‡è¯†, å24ä½æ˜¯ä¸»æœºæ ‡è¯†ã€‚ Bç±»åœ°å€æ˜¯å‰ä¸¤ä½ä»¥â€10â€å¼€å¤´çš„åœ°å€ã€‚ä»ç¬¬1ä½~ç¬¬16ä½æ˜¯ç½‘ç»œæ ‡è¯†, å16ä½æ˜¯ä¸»æœºæ ‡è¯†ã€‚ Cç±»åœ°å€æ˜¯å‰ä¸‰ä½ä»¥â€110â€å¼€å¤´çš„åœ°å€ã€‚ä»ç¬¬1ä½~ç¬¬24ä½æ˜¯ç½‘ç»œæ ‡è¯†, å8ä½æ˜¯ä¸»æœºæ ‡è¯†ã€‚ Dç±»åœ°å€æ˜¯å‰å››ä½ä»¥â€1110â€å¼€å¤´çš„åœ°å€ã€‚ä»ç¬¬1ä½~ç¬¬32ä½æ˜¯ç½‘ç»œæ ‡è¯†, æ²¡æœ‰ä¸»æœºæ ‡è¯†, å¸¸ç”¨äºå¤šæ’­ã€‚ å…¨éƒ¨ä¸º0çš„ä¸»æœºåœ°å€: ä»£è¡¨ç½‘ç»œ/IPåœ°å€ä¸å¯è·çŸ¥ã€‚å…¨éƒ¨ä¸º1çš„ä¸»æœºåœ°å€: é€šå¸¸ç”¨äºå¹¿æ’­åœ°å€ã€‚åœ¨åˆ†é…ä¸»æœºåœ°å€, åº”è¯¥å»æ‰è¿™ä¸¤ç§æƒ…å†µ, å› æ­¤Cç±»åœ°å€çš„æ¯ä¸ªç½‘æ®µæœ€å¤šåªèƒ½æœ‰256-2ä¸ªä¸»æœºåœ°å€ã€‚ å­ç½‘æ©ç åˆ†ç±»é€ æˆæµªè´¹? ä¾‹å¦‚, åœ¨æ¶æ„Bç±»å‹çš„IPç½‘ç»œæ—¶, å¯ä»¥ä½¿ç”¨çš„ä¸»æœºæ ‡è¯†å¤§çº¦æœ‰6ä¸‡å¤šä¸ª, ä¹Ÿå°±æ„å‘³ç€, ä¸€ä¸ªé“¾è·¯å†…å…è®¸6ä¸‡å¤šå°è®¡ç®—æœºè¿æ¥; å®é™…ç½‘ç»œæ¶æ„ä¸­, ä¸ä¼šå†åŒä¸€ä¸ªé“¾è·¯ä¸Šè¿æ¥6ä¸‡å¤šå°è®¡ç®—æœº, æ‰€ä»¥A/Bç±»åœ°å€ä¼šé€ æˆæµªè´¹ã€‚ é€šè¿‡å­ç½‘æ©ç ç»†åˆ†å‡ºæ¯”Aã€Bã€Cã€Dåˆ†ç±»æ›´ç»†ç²’åº¦çš„ç½‘ç»œã€‚å°±æ˜¯å°†åŸæ¥åˆ†ç±»ä¸­çš„ä¸»æœºåœ°å€éƒ¨åˆ†ç”¨ä½œå­ç½‘åœ°å€, ç½‘ç»œåœ°å€åˆ†ä¸ºå¤šä¸ªç‰©ç†ç½‘ç»œçš„ä¸€ç§æœºåˆ¶ã€‚ å¼•å…¥å­ç½‘ä»¥å, ä¸€ä¸ªIPåœ°å€å°±æœ‰äº†ä¸¤ç§è¯†åˆ«ç , ä¸€ç§æ˜¯åŸæ¥çš„IPåœ°å€æœ¬èº«, å¦ä¸€ä¸ªæ˜¯è¡¨ç¤ºç½‘ç»œéƒ¨åˆ†çš„å­ç½‘æ©ç ã€‚ å­ç½‘æ©ç ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºçš„è¯, ä¹Ÿæ˜¯ä¸€ä¸ª32ä½çš„æ•°å­—ã€‚å®ƒå¯¹åº”çš„IPåœ°å€ç½‘ç»œæ ‡è¯†éƒ¨åˆ†çš„ä½å…¨éƒ¨ä¸ºâ€1â€, å¯¹åº”IPåœ°å€ä¸»æœºæ ‡è¯†çš„éƒ¨åˆ†åˆ™å…¨éƒ¨ä¸ºâ€0â€ã€‚ç”±æ­¤ä¸€ä¸ªIPåœ°å€å¯ä»¥ä¸å†å—é™äºè‡ªå·±çš„ç±»åˆ«, è€Œæ˜¯å¯ä»¥ç”¨è¿™æ ·çš„å­ç½‘æ©ç è‡ªç”±åœ°å®šä½è‡ªå·±çš„ç½‘ç»œæ ‡è¯†é•¿åº¦ã€‚å­ç½‘æ©ç å¿…é¡»æ˜¯IPåœ°å€çš„é¦–é¡µå¼€å§‹è¿ç»­ä¸ºâ€1â€ã€‚ å­ç½‘æ©ç æœ‰ä¸¤ç§è¡¨ç¤ºæ–¹å¼, ä¸€ç§æ˜¯å°†IPåœ°å€ä¸å­ç½‘æ©ç åœ°å€åˆ†åˆ«ç”¨ä¸¤è¡Œæ¥è¡¨ç¤º; å¦å¤–ä¸€ç§æ˜¯åœ¨IPåœ°å€çš„åé¢è¿½åŠ ç½‘ç»œåœ°å€çš„ä½æ•°, ç”¨â€/â€œéš”å¼€ã€‚ åœ°å€è¡¨ç¤º åè¿›åˆ¶ IPåœ°å€ 172.20.100.52 å­ç½‘æ©ç  255.255.255.192 åœ°å€è¡¨ç¤º åè¿›åˆ¶ ä½æ•° IPåœ°å€ 172.20.100.52 /26 172.20.0.0/26 ä¸172.20/26æ˜¯åŒä¸€ä¸ªæ„æ€, å¯ä»¥çœç•¥åé¢çš„â€0â€CIDR: é‡‡ç”¨ä»»æ„é•¿åº¦åˆ†å‰²IPåœ°å€çš„ç½‘ç»œæ ‡è¯†å’Œä¸»æœºæ ‡è¯†, ä¹Ÿå«æ— ç±»å‹åŸŸé—´é€‰è·¯ã€‚åœ¨CIDRè¢«åº”ç”¨åˆ°äº’è”ç½‘çš„åˆæœŸ, ç½‘ç»œå†…éƒ¨é‡‡ç”¨å›ºå®šé•¿åº¦çš„å­ç½‘æ©ç æœºåˆ¶, é‡‡ç”¨ç»Ÿä¸€çš„æ ‡æ³¨, å°±éš¾ä»¥æ¶æ„ä¸€ä¸ªé«˜æ•ˆçš„ç½‘ç»œç»“æ„, ä¸ºæ­¤äººä»¬æå‡ºç»„ç»‡å†…è¦ä½¿ç”¨å¯å˜é•¿åº¦çš„ã€é«˜æ•ˆçš„IPåœ°å€åˆ†é…æ–¹å¼ã€‚VLSM: å¯å˜é•¿åº¦å­ç½‘æ©ç , å¯ä»¥å°†ç½‘ç»œåœ°å€åˆ†ä¸ºä¸»æœºæ•°500ä¸ªæ—¶å­ç½‘æ©ç é•¿åº¦ä½/23, ä¸»æœºæ•°ä½50ä¸ªæ—¶å­ç½‘æ©ç é•¿åº¦ä½/26, æœ‰äº†CIDRå’ŒVLSMæŠ€æœ¯, ç›¸å¯¹ç¼“è§£äº†å…¨å±€IPåœ°å€ä¸å¤Ÿç”¨çš„é—®é¢˜, ä½†æ— æ³•æ”¹å˜IPv4çš„åœ°å€ç»å¯¹æ•°æ˜¯æœ‰é™çš„é—®é¢˜ã€‚ å…¨å±€åœ°å€ä¸ç§æœ‰åœ°å€éšç€äº’è”ç½‘çš„è¿…é€Ÿæ™®åŠ, IPåœ°å€ä¸è¶³çš„é—®é¢˜æ—¥è¶‹æ˜¾è‘—, å¦‚æœä¸€ç›´æŒ‰ç…§ç°è¡Œçš„æ–¹æ³•é‡‡ç”¨å”¯ä¸€åœ°å€çš„è¯(æ¯ä¸€å°ä¸»æœº/è·¯ç”±å™¨å¿…é¡»é…æœ‰ä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€), ä¼šæœ‰IPåœ°å€è€—å°½çš„å±é™©ã€‚äºæ˜¯å‡ºç°äº†ä¸€ç§æ–°çš„æŠ€æœ¯ã€‚å®ƒä¸è¦æ±‚ä¸ºæ¯ä¸€å°ä¸»æœº/è·¯ç”±å™¨åˆ†é…ä¸€ä¸ªå›ºå®šçš„IPåœ°å€, è€Œæ˜¯åœ¨å¿…è¦çš„æ—¶å€™ä¸ºç›¸åº”æ•°é‡çš„è®¾å¤‡åˆ†é…å”¯ä¸€çš„IPåœ°å€ã€‚å¯¹äºé‚£äº›æ²¡æœ‰è¿æ¥ç½‘ç»œçš„ç‹¬ç«‹ç½‘ç»œä¸­çš„ä¸»æœº, åªè¦ä¿è¯åœ¨è¿™ä¸ªç½‘ç»œå†…åœ°å€å”¯ä¸€, å¯ä»¥ä¸ç”¨è€ƒè™‘äº’è”ç½‘å³å¯é…ç½®ç›¸åº”çš„IPåœ°å€ã€‚ä¸è¿‡è®©æ¯ä¸ªç‹¬ç«‹çš„ç½‘ç»œå„è‡ªéšæ„é…ç½®IPåœ°å€ä¹Ÿä¼šå‡ºç°é—®é¢˜(å†²çª)ã€‚äºæ˜¯ä¹å‡ºç°äº†ç§æœ‰çš„ç½‘ç»œIPåœ°å€: åŒ…å«åœ¨è¿™ä¸ªèŒƒå›´å†…çš„IPåœ°å€éƒ½å±äºç§æœ‰IP, åœ¨æ­¤ä¹‹å¤–çš„IPåœ°å€ç§°ä¸ºå…¨å±€IPã€‚ ç§æœ‰IPæœ€æ—©æ²¡æœ‰è®¡åˆ’è¿æ¥äº’è”ç½‘, åªç”¨äºäº’è”ç½‘ä¹‹å¤–çš„ç‹¬ç«‹ç½‘ç»œã€‚éšç€NAT/NAPT(èƒ½å¤Ÿäº’æ¢ç§æœ‰IPå’Œå…¨å±€IP)æŠ€æœ¯çš„è¯ç”Ÿ, é…æœ‰ç§æœ‰åœ°å€çš„ä¸»æœºä¸é…æœ‰å…¨å±€åœ°å€çš„äº’è”ç½‘ä¸»æœºå®ç°äº†é€šä¿¡ã€‚ ä¼ä¸šå†…éƒ¨åŸºæœ¬åœ¨æ¯ä¸ªç»ˆç«¯ä¸Šè®¾ç½®ç§æœ‰IP, åœ¨è·¯ç”±å™¨(å®½å¸¦è·¯ç”±å™¨)/æœåŠ¡å™¨ä¸Šè®¾ç½®å…¨å±€IP, é…æœ‰ç§æœ‰IPåœ°å€çš„ä¸»æœºé€šè¿‡è”ç½‘æ—¶, é€šè¿‡NATè¿›è¡Œé€šä¿¡ã€‚ç§æœ‰IPåœ°å€ç»“åˆNATæŠ€æœ¯å·²æˆä¸ºç°åœ¨è§£å†³IPåœ°å€åˆ†é…é—®é¢˜çš„ä¸»æµæ–¹æ¡ˆã€‚ IPv4é¦–éƒ¨é€šè¿‡IPè¿›è¡Œé€šä¿¡æ—¶, éœ€è¦åœ¨æ•°æ®çš„å‰é¢åŠ å…¥IPé¦–éƒ¨çš„ä¿¡æ¯ã€‚IPé¦–éƒ¨ä¸­åŒ…å«ç€ç”¨äºIPåè®®è¿›è¡Œå‘åŒ…æ§åˆ¶æ—¶æ‰€æœ‰çš„å¿…è¦ä¿¡æ¯ã€‚ ç‰ˆæœ¬(Version)ç”±4æ¯”ç‰¹æ„æˆ, è¡¨ç¤ºæ ‡è¯†IPé¦–éƒ¨çš„ç‰ˆæœ¬å·, IPv4çš„ç‰ˆæœ¬å·å³ä¸º4, å› æ­¤åœ¨è¿™ä¸ªå­—æ®µä¸Šçš„å€¼ä¹Ÿæ˜¯â€4â€ã€‚ é¦–éƒ¨é•¿åº¦(IHL: Internet Header Length)ç”±4æ¯”ç‰¹æ„æˆ, è¡¨æ˜IPé¦–éƒ¨çš„å¤§å°, å•ä½ä¸º4å­—èŠ‚(32æ¯”ç‰¹), å¯¹äºæ²¡æœ‰å¯é€‰é¡¹çš„IPåŒ…, é¦–éƒ¨é•¿åº¦åˆ™è®¾ç½®ä¸ºâ€5â€ã€‚ åŒºåˆ†æœåŠ¡(TOS: Type Of Service)ç”±8æ¯”ç‰¹æ„æˆ, ç”¨æ¥è¡¨æ˜æœåŠ¡è´¨é‡, ç”±äºå®ç°TOSæ§åˆ¶æå…¶å¤æ‚, TOSåŸºæœ¬æ²¡æœ‰è¢«æŠ•å…¥ä½¿ç”¨ã€‚ æ€»é•¿åº¦(Total Length)è¡¨ç¤ºIPé¦–éƒ¨ä¸æ•°æ®éƒ¨åˆ†åˆèµ·æ¥çš„æ€»å­—èŠ‚æ•°ã€‚è¯¥å­—æ®µé•¿16æ¯”ç‰¹ã€‚å› æ­¤IPåŒ…çš„æœ€å¤§é•¿åº¦ä¸º65535å­—èŠ‚ã€‚ æ ‡è¯†(ID: Identification)ç”±16æ¯”ç‰¹æ„æˆ, ç”¨äºåˆ†ç‰‡é‡ç»„ã€‚åŒä¸€ä¸ªåˆ†ç‰‡çš„æ ‡è¯†å€¼ç›¸åŒ, ä¸åŒåˆ†ç‰‡çš„æ ‡è¯†å€¼ä¸åŒã€‚æ¯å‘é€ä¸€ä¸ªIPåŒ…, å®ƒçš„å€¼ä¹Ÿé€æ¸é€’å¢ã€‚å¦‚æœIDç›¸åŒ, ä½†æ˜¯ç›®æ ‡åœ°å€ã€æºåœ°å€æˆ–åè®®ä¸åŒçš„è¯, ä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯ä¸åŒçš„åˆ†ç‰‡ã€‚ æ ‡å¿—(Flags)ç”±3æ¯”ç‰¹æ„æˆ, è¡¨ç¤ºåŒ…è¢«åˆ†ç‰‡çš„ç›¸å…³ä¿¡æ¯ã€‚ æ¯”ç‰¹ å«ä¹‰ 0 æœªä½¿ç”¨ã€‚ç›®å‰å¿…é¡»ä¸º0 1 æŒ‡ç¤ºæ˜¯å¦è¿›è¡Œåˆ†ç‰‡, 0:å¯ä»¥åˆ†ç‰‡, 1:ä¸èƒ½åˆ†ç‰‡ 2 åŒ…è¢«åˆ†ç‰‡çš„æƒ…å†µä¸‹, è¡¨ç¤ºæ˜¯å¦ä¸ºæœ€åä¸€ä¸ªåŒ…, 0:æœ€åä¸€ä¸ªåˆ†ç‰‡çš„åŒ…, 1:åˆ†ç‰‡ä¸­æ®µçš„åŒ… ç‰‡åç§»(FO: Fragment Offset)ç”±13æ¯”ç‰¹æ„æˆ, ç”¨æ¥æ ‡è¯†è¢«åˆ†ç‰‡çš„æ¯ä¸€ä¸ªåˆ†æ®µç›¸å¯¹äºåŸå§‹æ•°æ®çš„ä½ç½®ã€‚ç¬¬ä¸€ä¸ªåˆ†ç‰‡å¯¹åº”çš„å€¼ä¸º0ã€‚ ç”Ÿå­˜æ—¶é—´(TTL: Time To Live)ç”±8æ¯”ç‰¹æ„æˆ, æŒ‡å¯ä»¥ä¸­è½¬å¤šå°‘ä¸ªè·¯ç”±å™¨çš„æ„æ€, æ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨, TTLä¼šå‡å°‘1, çŸ¥é“å˜æˆ0åˆ™ä¸¢å¼ƒè¯¥åŒ…ã€‚ä¸ºäº†é¿å…IPåŒ…åœ¨ç½‘ç»œå†…æ— é™ä¼ é€’ã€‚ åè®®(Protocol)ç”±8æ¯”ç‰¹æ„æˆ, è¡¨ç¤ºIPé¦–éƒ¨çš„ä¸‹ä¸€ä¸ªé¦–éƒ¨å±äºå“ªä¸ªåè®®ã€‚ é¦–éƒ¨å’Œæ ¡éªŒ(Header Checksum)ç”±16æ¯”ç‰¹æ„æˆ, ä¹Ÿå«IPé¦–éƒ¨æ ¡éªŒå’Œ,ä¸»è¦ç”¨æ¥ç¡®ä¿IPæ•°æ®æŠ¥ä¸è¢«ç ´åã€‚è¯¥å­—æ®µåªæ ¡éªŒæ•°æ®æŠ¥çš„é¦–é¡µ, ä¸æ ¡éªŒæ•°æ®éƒ¨åˆ†ã€‚æ ¡éªŒå’Œçš„è®¡ç®—è¿‡ç¨‹, é¦–å…ˆè¦å°†è¯¥æ ¡éªŒå’Œçš„æ‰€æœ‰ä½ç½®è®¾ç½®ä¸º0, ç„¶åä»¥16æ¯”ç‰¹ä¸ºå•ä½åˆ’åˆ†IPé¦–éƒ¨, å¹¶ç”¨1è¡¥æ•°è®¡ç®—æ‰€æœ‰16ä½å­—çš„å’Œã€‚æœ€åå°†æ‰€å¾—åˆ°è¿™ä¸ªå’Œçš„1è¡¥æ•°èµ‹ç»™é¦–éƒ¨æ ¡éªŒå’Œå­—æ®µã€‚ æºåœ°å€(Source Address)ç”±32æ¯”ç‰¹æ„æˆ, è¡¨ç¤ºå‘é€ç«¯IPåœ°å€ã€‚ ç›®æ ‡åœ°å€(Destination Address)ç”±32æ¯”ç‰¹æ„æˆ, è¡¨ç¤ºæ¥æ”¶ç«¯IPåœ°å€ã€‚ å¯é€‰é¡¹(Options)é•¿åº¦å¯å˜, é€šå¸¸åªåœ¨è¿›è¡Œå®éªŒæˆ–è¯Šæ–­æ—¶ä½¿ç”¨ã€‚è¯¥å­—æ®µåŒ…å«å¦‚ä¸‹å‡ ç‚¹ä¿¡æ¯: å®‰å…¨çº§åˆ«, æºè·¯å¾„, è·¯å¾„è®°å½•, æ—¶é—´æˆ³ã€‚ å¡«å……(Padding)ä¹Ÿå«å¡«è¡¥ç‰©, åœ¨æœ‰å¯é€‰é¡¹çš„æƒ…å†µä¸‹, é¦–éƒ¨é•¿åº¦å¯èƒ½ä¸æ˜¯32æ¯”ç‰¹çš„æ•´æ•°å€ã€‚ä¸ºæ­¤, é€šè¿‡å‘å­—æ®µå¡«å……ä¸º0, è°ƒæ•´é¦–éƒ¨é•¿åº¦ä¸º32æ¯”ç‰¹çš„æ•´æ•°å€ã€‚ æ•°æ®(Data)å­˜å…¥æ•°æ®ã€‚å°†IPä¸Šå±‚åè®®çš„é¦–éƒ¨ä¹Ÿä½œä¸ºæ•°æ®è¿›è¡Œå¤„ç†ã€‚ è·¯ç”±æ§åˆ¶å‘é€æ•°æ®åŒ…æ—¶ä½¿ç”¨çš„åœ°å€å°±æ˜¯ç½‘ç»œå±‚çš„åœ°å€, ä¹Ÿå°±æ˜¯IPåœ°å€ã€‚ç„¶è€Œä»…ä»…æœ‰IPåœ°å€è¿˜ä¸è¶³ä»¥å®ç°å°†æ•°æ®åŒ…å‘é€åˆ°å¯¹ç«¯ç›®æ ‡åœ°å€, åœ¨å‘é€è¿‡ç¨‹ä¸­è¿˜éœ€è¦ç±»ä¼¼â€æŒ‡æ˜è·¯ç”±å™¨æˆ–ä¸»æœºâ€çš„ä¿¡æ¯, ä»¥ä¾¿å‘å¾€ç›®æ ‡åœ°å€ã€‚ä¿å­˜è¿™ç§ä¿¡æ¯çš„å°±æ˜¯è·¯ç”±æ§åˆ¶è¡¨ã€‚å®ç°IPé€šä¿¡çš„ä¸»æœºå’Œè·¯ç”±å™¨éƒ½å¿…é¡»æŒæœ‰ä¸€å¼ è¿™æ ·çš„è¡¨ã€‚è·¯ç”±æ§åˆ¶è¡¨çš„å½¢æˆæ–¹å¼æœ‰ä¸¤ç§: é™æ€è·¯ç”±æ§åˆ¶:ç®¡ç†å‘˜æ‰‹åŠ¨è®¾ç½®ã€‚ åŠ¨æ€è·¯ç”±æ§åˆ¶: è·¯ç”±å™¨ä¸å…¶ä»–è·¯ç”±å™¨ç›¸äº’äº¤æ¢ä¿¡æ¯æ—¶è‡ªåŠ¨åˆ·æ–°ã€‚ IPåœ°å€ä¸è·¯ç”±æ§åˆ¶IPåœ°å€çš„ç½‘ç»œåœ°å€éƒ¨åˆ†ç”¨äºè¿›è¡Œè·¯ç”±æ§åˆ¶ã€‚è·¯ç”±æ§åˆ¶è¡¨ä¸­è®°å½•ç€ç½‘ç»œåœ°å€ä¸ä¸‹ä¸€æ­¥åº”è¯¥å‘é€è‡³è·¯ç”±å™¨çš„åœ°å€, åœ¨å‘é€IPåŒ…æ—¶, é¦–å…ˆè¦ç¡®å®šIPé¦–éƒ¨ä¸­çš„ç›®æ ‡åœ°å€, å†ä»è·¯ç”±æ§åˆ¶è¡¨ä¸­æ‰¾åˆ°ä¸è¯¥åœ°å€å…·æœ‰ç›¸åŒç½‘ç»œåœ°å€çš„è®°å½•, æ ¹æ®è¯¥è®°å½•å°†IPåŒ…è½¬å‘ç»™ç›¸åº”çš„ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ã€‚å¦‚æœè·¯ç”±æ§åˆ¶è¡¨ä¸­å­˜åœ¨å¤šæ¡ç›¸åŒçš„ç½‘è·¯åœ°å€è®°å½•, å°±é€‰æ‹©ä¸€ä¸ªç›¸åŒä½æ•°æœ€å¤šçš„åœ°å€ã€‚ é»˜è®¤è·¯ç”±å¦‚æœä¸€å¼ è·¯ç”±è¡¨ä¸­åŒ…å«æ‰€æœ‰çš„ç½‘ç»œåŠå…¶å­ç½‘çš„ä¿¡æ¯, å°†ä¼šé€ æˆæµªè´¹ã€‚è¿™æ—¶, é»˜è®¤è·¯ç”±æ˜¯ä¸é”™çš„é€‰æ‹©, é»˜è®¤è·¯ç”±æŒ‡è·¯ç”±è¡¨ä¸­ä»»ä½•ä¸€ä¸ªåœ°å€éƒ½èƒ½ä¸ä¹‹åŒ¹é…ã€‚é»˜è®¤è·¯ç”±ä¸€èˆ¬æ ‡è®°ä¸º0.0.0.0/0æˆ–default, è¿™é‡Œçš„0.0.0.0/0å¹¶ä¸æ˜¯æŒ‡IPåœ°å€æ˜¯0.0.0.0, è€Œæ˜¯åçš„â€/0â€, æ‰€ä»¥å¹¶æ²¡æœ‰æ ‡è¯†IPåœ°å€ã€‚å®ƒåªæ˜¯ä¸ºäº†é¿å…äººä»¬è¯¯è®¤ä¸º0.0.0.0æ˜¯IPåœ°å€ã€‚æœ‰æ—¶é»˜è®¤è·¯ç”±ä¹Ÿè¢«æ ‡è®°ä¸ºdefault, åœ¨è®¡ç®—æœºå†…éƒ¨å’Œè·¯ç”±åè®®çš„å‘é€è¿‡ç¨‹ä¸­è¿˜æ˜¯ä»¥0.0.0.0/0è¿›è¡Œå¤„ç†ã€‚ ä¸»æœºè·¯ç”±â€œIPåœ°å€/32â€ä¹Ÿè¢«ç§°ä¸ºä¸»æœºè·¯ç”±ã€‚ä¾‹å¦‚: 192.168.153.15/32å°±æ˜¯ä¸€ç§ä¸»æœºè·¯ç”±ã€‚å®ƒçš„æ„æ€æ˜¯æ•´ä¸ªIPåœ°å€çš„æ‰€æœ‰ä½éƒ½å°†ä¼šå‚ä¸è·¯ç”±; è¿›è¡Œä¸»æœºè·¯ç”±, æ„å‘³ç€è¦åŸºäºä¸»æœºä¸Šç½‘å¡é…ç½®çš„IPåœ°å€æœ¬èº«(ç½‘ç»œåœ°å€+ ä¸»æœºåœ°å€), è€Œä¸æ˜¯åŸºäºè¯¥åœ°å€çš„ç½‘ç»œåœ°å€éƒ¨åˆ†è¿›è¡Œè·¯ç”±ã€‚ ç¯å›åœ°å€ç¯å›åœ°å€æ˜¯åœ¨åŒä¸€å°è®¡ç®—æœºä¸Šçš„ç¨‹åºä¹‹é—´è¿›è¡Œç½‘ç»œé€šä¿¡æ—¶æ‰€ä½¿ç”¨çš„ä¸€ä¸ªé»˜è®¤åœ°å€ã€‚è®¡ç®—æœºä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„IPåœ°å€127.0.0.1ä½œä¸ºç¯å›åœ°å€ã€‚ä¸è¯¥åœ°å€å±€å…·æœ‰ç›¸åŒæ„ä¹‰çš„æ˜¯ä¸€ä¸ªå«åšlocalhostçš„ä¸»æœºåã€‚ä½¿ç”¨è¿™ä¸ªIPæˆ–ä¸»æœºåæ—¶, æ•°æ®åŒ…ä¸ä¼šæµå‘ç½‘ç»œã€‚ è·¯ç”±æ§åˆ¶è¡¨çš„èšåˆåˆ©ç”¨ç½‘ç»œåœ°å€çš„æ¯”ç‰¹åˆ†å¸ƒå¯ä»¥æœ‰æ•ˆåœ°è¿›è¡Œåˆ†å±‚é…ç½®ã€‚å¯¹å†…å¯ä»¥æœ‰å¤šä¸ªå­ç½‘æ©ç , å¯¹å¤–å‘ˆç°çš„ä¹Ÿæ˜¯åŒä¸€ä¸ªç½‘ç»œçš„åœ°å€ã€‚é€šè¿‡è·¯ç”±ä¿¡æ¯çš„èšåˆå¯ä»¥æœ‰æ•ˆçš„å‡å°‘è·¯ç”±è¡¨çš„æ¡ç›®ã€‚ èƒ½å¤Ÿç¼©å°è·¯ç”±è¡¨çš„å¤§å°æ˜¯å®ƒçš„æœ€å¤§ä¼˜åŠ¿ã€‚è·¯ç”±è¡¨è¶Šå¤§, ç®¡ç†å®ƒæ‰€éœ€è¦çš„å†…å­˜å’ŒCPUä¹Ÿå°±è¶Šå¤š, å¹¶ä¸”æŸ¥æ‰¾è·¯ç”±è¡¨çš„æ—¶é—´ä¹Ÿä¼šè¶Šé•¿, å¯¼è‡´è½¬å‘IPæ•°æ®åŒ…çš„æ€§èƒ½ä¸‹é™, æ„å»ºå¤§è§„æ¨¡ã€é«˜æ€§èƒ½ç½‘ç»œéœ€è¦å°½å¯èƒ½æ¶ˆå‡è·¯ç”±è¡¨çš„å¤§å°ã€‚ è·¯ç”±èšåˆå¯ä»¥å°†å·²çŸ¥çš„è·¯ç”±ä¿¡æ¯ä¼ é€ç»™å‘¨å›´å…¶ä»–çš„è·¯ç”±å™¨, ä»¥è¾¾åˆ°æ§åˆ¶è·¯ç”±ä¿¡æ¯çš„ç›®çš„ã€‚ IPåˆ†å‰²/æ„æˆå¤„ç†æ•°æ®é“¾è·¯ä¸MTUæ¯ç§æ•°æ®é“¾è·¯çš„æœ€å¤§ä¼ è¾“å•å…ƒ(MTU)éƒ½ä¸å°½ç›¸åŒ, IPå±äºæ•°æ®é“¾è·¯çš„ä¸Šä¸€å±‚, å¿…é¡»ä¸å—é™ä¸ä¸åŒçš„æ•°æ®é“¾è·¯çš„MTUå¤§å°ã€‚ IPæŠ¥æ–‡çš„åˆ†ç‰‡ä¸é‡ç»„ä»»ä½•ä¸€å°ä¸»æœºéƒ½æœ‰å¿…è¦å¯¹IPåˆ†ç‰‡è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚åˆ†ç‰‡å¾€å¾€åœ¨ç½‘ç»œä¸Šé‡è§æ¯”è¾ƒå¤§çš„æŠ¥æ–‡æ— æ³•ä¸€ä¸‹å­å‘é€å‡ºå»çš„æ—¶å€™æ‰ä¼šè¿›è¡Œå¤„ç†ã€‚ ç”±äºä»¥å¤ªç½‘çš„é»˜è®¤MTUæ˜¯1500å­—èŠ‚, å› æ­¤4342å­—èŠ‚çš„IPæ•°æ®æŠ¥æ— æ³•å†ä¸€ä¸ªå¸§å½“ä¸­å‘é€å®Œæˆã€‚å› æ­¤, è·¯ç”±å™¨å°†IPæ•°æ®æŠ¥åˆ’åˆ†æˆäº†3ä¸ªåˆ†ç‰‡è¿›è¡Œå‘é€ã€‚ç»è¿‡åˆ†ç‰‡ä¹‹åçš„IPæ•°æ®æŠ¥åœ¨è¢«é‡ç»„çš„æ—¶å€™, åªèƒ½æœ‰ç›®æ ‡ä¸»æœºè¿›è¡Œ, è·¯ç”±å™¨åªåšåˆ†ç‰‡, ä½†ä¸ä¼šè¿›è¡Œé‡ç»„ã€‚ è·¯å¾„MTUå‘ç°åˆ†ç‰‡æœºåˆ¶æœ‰å®ƒçš„ä¸è¶³ã€‚é¦–å…ˆ, è·¯ç”±å™¨çš„å¤„ç†è´Ÿè·åŠ é‡ã€‚éšç€æ—¶ä»£çš„å˜è¿, è®¡ç®—æœºç½‘ç»œçš„ç‰©ç†ä¼ è¾“é€Ÿåº¦ä¸æ–­ä¸Šå‡ã€‚è¿™äº›é«˜é€Ÿçš„é“¾è·¯, å¯¹è·¯ç”±å™¨å’Œè®¡ç®—æœºç½‘ç»œæå‡ºäº†æ›´é«˜çš„è¦æ±‚ã€‚å¦ä¸€æ–¹é¢, éšç€äººä»¬å¯¹ç½‘ç»œå®‰å…¨çš„è¦æ±‚æé«˜, è·¯ç”±å™¨éœ€è¦åšçš„å…¶ä»–å¤„ç†ä¹Ÿè¶Šæ¥è¶Šå¤š, å› æ­¤, åªè¦å…è®¸, æ˜¯ä¸å¸Œæœ›ç”±è·¯ç”±å™¨è¿›è¡ŒIPæ•°æ®åŒ…çš„åˆ†ç‰‡å¤„ç†ã€‚ è·¯å¾„MTU: æŒ‡çš„æ˜¯ä»å‘é€ç«¯ä¸»æœºåˆ°æ¥æ”¶ç«¯ä¸»æœºä¹‹é—´ä¸éœ€è¦åˆ†ç‰‡æ—¶çš„æœ€å¤§MTUå¤§å°ã€‚ä¹Ÿå°±æ˜¯, è·¯å¾„ä¸­å­˜åœ¨çš„æ‰€æœ‰æ•°æ®é“¾è·¯ä¸­æœ€å°çš„ä¼ è¾“å•å…ƒã€‚ è·¯å¾„MTUå‘ç°: ä»å‘é€ç«¯ä¸»æœºæŒ‰ç…§MTUçš„å¤§å°, æå‰å°†æ•°æ®æŠ¥åˆ†ç‰‡åè¿›è¡Œå‘é€ã€‚è¿›è¡Œè·¯å¾„MTUå‘ç°, å°±å¯ä»¥é¿å…åœ¨è·¯ç”±å™¨ä¸Šè¿›è¡Œåˆ†ç‰‡å¤„ç†ã€‚ä¹Ÿå¯ä»¥åœ¨TCPä¸­å‘é€æ›´å¤§çš„åŒ…ã€‚å¾ˆå¤šæ“ä½œç³»ç»Ÿéƒ½å·²ç»å®ç°äº†è·¯å¾„MTUå‘ç°çš„åŠŸèƒ½ã€‚ è·¯å¾„MTUå‘ç°çš„å·¥ä½œåŸç†: é¦–å…ˆåœ¨å‘é€ç«¯ä¸»æœºå‘é€IPæ•°æ®æŠ¥æ—¶å°†å…¶é¦–éƒ¨çš„åˆ†ç‰‡ç¦æ­¢æ ‡å¿—ä½è®¾ç½®ä¸º1ã€‚æ ¹æ®è¿™ä¸ªæ ‡å¿—ä½, é€”ä¸­çš„è·¯ç”±å™¨å³ä½¿é‡åˆ°éœ€è¦åˆ†ç‰‡æ‰èƒ½å¤„ç†çš„å¤§åŒ…, ä¹Ÿä¸ä¼šå»åˆ†ç‰‡, è€Œæ˜¯å°†åŒ…ä¸¢å¼ƒã€‚éšå, é€šè¿‡ICMPçš„ä¸å¯è¾¾æ¶ˆæ¯å°†æ•°æ®é“¾è·¯ä¸Šçš„MTUçš„å€¼ç»™å‘é€ç«¯ä¸»æœºã€‚è·å¾—ICMPé€šçŸ¥çš„MTUå€¼å, å‘é€ç«¯ä¸»æœºå°†å®ƒè®¾ç½®ä¸ºå½“å‰MTUã€‚å‘é€ç«¯ä¸»æœºæ ¹æ®å½“å‰æ–°è®¾ç½®çš„MTUå¯¹æ•°æ®æŠ¥è¿›è¡Œåˆ†ç‰‡å¤„ç†ã€‚å¦‚æ­¤åå¤, ç›´åˆ°æ•°æ®æŠ¥è¢«å‘é€åˆ°ç›®æ ‡ä¸»æœºå, æ²¡æœ‰åœ¨æ”¶åˆ°ä»»ä½•ICMPçš„å›é¦ˆ, è¿™æ ·å°±è®¤ä¸ºæœ€åä¸€æ¬¡ICMPé€šçŸ¥çš„MTUå€¼æ˜¯ä¸€ä¸ªåˆé€‚çš„MTUå€¼ã€‚MTUå€¼æœ€å°‘å¯ä»¥ç¼“å­˜10åˆ†é’Ÿ, åœ¨è¿™10åˆ†é’Ÿå†…ä½¿ç”¨åˆšåˆšå¾—åˆ°çš„MTU, è¶…è¿‡10åˆ†é’Ÿä»¥ååˆ™é‡æ–°æ ¹æ®é“¾è·¯ä¸Šçš„MTUåšä¸€æ¬¡è·¯å¾„MTUå‘ç°ã€‚ UDP TCP å‚è€ƒ: å›¾è§£TCP/IP","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://github.com/icoderRo/tags/ç½‘ç»œ/"}]},{"title":"æ•°æ®é“¾è·¯å±‚(äºŒ)","slug":"æ•°æ®é“¾è·¯å±‚","date":"2015-12-12T16:00:00.000Z","updated":"2017-08-17T15:03:44.000Z","comments":true,"path":"2015/12/13/æ•°æ®é“¾è·¯å±‚/","link":"","permalink":"https://github.com/icoderRo/2015/12/13/æ•°æ®é“¾è·¯å±‚/","excerpt":"æ•°æ®é“¾è·¯å±‚æ•°æ®é“¾è·¯, æŒ‡OSIå‚è€ƒæ¨¡å‹ä¸­çš„æ•°æ®é“¾è·¯å±‚, æœ‰æ—¶ä¹ŸæŒ‡ä»¥å¤ªç½‘ã€æ— çº¿å±€åŸŸç½‘ç­‰é€šä¿¡æ‰‹æ®µã€‚ æ•°æ®é“¾è·¯å±‚çš„åè®®å®šä¹‰äº†é€šè¿‡é€šä¿¡åª’ä»‹äº’è¿çš„è®¾å¤‡ä¹‹é—´çš„ä¼ è¾“è§„èŒƒã€‚é€šä¿¡åª’ä»‹åŒ…æ‹¬åŒç»çº¿ç”µç¼†ã€åŒè½´ç”µç¼†ã€å…‰çº¤ã€ç”µæ³¢ä»¥åŠçº¢å¤–çº¿ç­‰ä»‹è´¨ã€‚æ­¤å¤–, å„ä¸ªè®¾å¤‡ä¹‹é—´æœ‰æ—¶ä¹Ÿä¼šé€šè¿‡äº¤æ¢æœºã€ç½‘æ¡¥ä¸­ç»§å™¨ç­‰ä¸­è½¬æ•°æ®ã€‚ OSIå‚è€ƒæ¨¡å‹ä¸­æ•°æ®é“¾è·¯å±‚çš„ç›¸å…³æŠ€æœ¯åŒ…æ‹¬MACå¯»å€(ç‰©ç†å¯»å€)ã€ä»‹è´¨å…±äº«ã€ç¯è·¯æ£€æµ‹ã€è™šæ‹Ÿå±€åŸŸç½‘(VLAN)ç­‰ã€‚æ•°æ®é“¾è·¯çš„ä¼ è¾“æ–¹å¼æœ‰ ä»¥å¤ªç½‘ã€æ— çº¿å±€åŸŸç½‘(WLAN), ç‚¹å¯¹ç‚¹åè®®(PPP)ã€‚ MACåœ°å€MACåœ°å€ç”¨äºè¯†åˆ«æ•°æ®é“¾è·¯ä¸­äº’è¿çš„èŠ‚ç‚¹, ä»¥å¤ªç½‘æˆ–FDDI(å…‰çº¤åˆ†å¸ƒå¼æ•°æ®æ¥å£)ã€æ— çº¿LANã€è“ç‰™ç­‰è®¾å¤‡æ ¹æ®ç›¸å…³è§„èŒƒä½¿ç”¨MACåœ°å€ã€‚ MACåœ°å€é•¿48æ¯”ç‰¹, åœ¨ä½¿ç”¨ç½‘å¡çš„æƒ…å†µä¸‹, MACåœ°å€ä¸€èˆ¬éƒ½æ˜¯ä¼šçƒ§å…¥ROMä¸­ã€‚å› æ­¤, ä»»ä½•ä¸€ä¸ªç½‘å¡çš„MACåœ°å€éƒ½æ˜¯å”¯ä¸€çš„ã€‚","text":"æ•°æ®é“¾è·¯å±‚æ•°æ®é“¾è·¯, æŒ‡OSIå‚è€ƒæ¨¡å‹ä¸­çš„æ•°æ®é“¾è·¯å±‚, æœ‰æ—¶ä¹ŸæŒ‡ä»¥å¤ªç½‘ã€æ— çº¿å±€åŸŸç½‘ç­‰é€šä¿¡æ‰‹æ®µã€‚ æ•°æ®é“¾è·¯å±‚çš„åè®®å®šä¹‰äº†é€šè¿‡é€šä¿¡åª’ä»‹äº’è¿çš„è®¾å¤‡ä¹‹é—´çš„ä¼ è¾“è§„èŒƒã€‚é€šä¿¡åª’ä»‹åŒ…æ‹¬åŒç»çº¿ç”µç¼†ã€åŒè½´ç”µç¼†ã€å…‰çº¤ã€ç”µæ³¢ä»¥åŠçº¢å¤–çº¿ç­‰ä»‹è´¨ã€‚æ­¤å¤–, å„ä¸ªè®¾å¤‡ä¹‹é—´æœ‰æ—¶ä¹Ÿä¼šé€šè¿‡äº¤æ¢æœºã€ç½‘æ¡¥ä¸­ç»§å™¨ç­‰ä¸­è½¬æ•°æ®ã€‚ OSIå‚è€ƒæ¨¡å‹ä¸­æ•°æ®é“¾è·¯å±‚çš„ç›¸å…³æŠ€æœ¯åŒ…æ‹¬MACå¯»å€(ç‰©ç†å¯»å€)ã€ä»‹è´¨å…±äº«ã€ç¯è·¯æ£€æµ‹ã€è™šæ‹Ÿå±€åŸŸç½‘(VLAN)ç­‰ã€‚æ•°æ®é“¾è·¯çš„ä¼ è¾“æ–¹å¼æœ‰ ä»¥å¤ªç½‘ã€æ— çº¿å±€åŸŸç½‘(WLAN), ç‚¹å¯¹ç‚¹åè®®(PPP)ã€‚ MACåœ°å€MACåœ°å€ç”¨äºè¯†åˆ«æ•°æ®é“¾è·¯ä¸­äº’è¿çš„èŠ‚ç‚¹, ä»¥å¤ªç½‘æˆ–FDDI(å…‰çº¤åˆ†å¸ƒå¼æ•°æ®æ¥å£)ã€æ— çº¿LANã€è“ç‰™ç­‰è®¾å¤‡æ ¹æ®ç›¸å…³è§„èŒƒä½¿ç”¨MACåœ°å€ã€‚ MACåœ°å€é•¿48æ¯”ç‰¹, åœ¨ä½¿ç”¨ç½‘å¡çš„æƒ…å†µä¸‹, MACåœ°å€ä¸€èˆ¬éƒ½æ˜¯ä¼šçƒ§å…¥ROMä¸­ã€‚å› æ­¤, ä»»ä½•ä¸€ä¸ªç½‘å¡çš„MACåœ°å€éƒ½æ˜¯å”¯ä¸€çš„ã€‚ MACåœ°å€ä¸­3~24ä½è¡¨ç¤ºå‚å•†è¯†åˆ«ç , æ¯ä¸ªNICå‚å•†éƒ½æœ‰ç‰¹å®šå”¯ä¸€çš„è¯†åˆ«æ•°å­—, 25~48ä½æ˜¯å‚å•†å†…éƒ¨ä¸ºè¯†åˆ«æ¯ä¸ªç½‘å¡äºŒç”¨, å¯ä»¥ä¿è¯å…¨ä¸–ç•Œä¸ä¼šæœ‰ç›¸åŒçš„MACåœ°å€çš„ç½‘å¡IEEE802.3åˆ¶å®šMACåœ°å€è§„èŒƒæ—¶æ²¡æœ‰é™å®šæ•°æ®é“¾è·¯çš„ç±»å‹, å³ä¸è®ºå“ªç§æ•°æ®é“¾è·¯çš„ç½‘ç»œ(ä»¥å¤ªç½‘ã€FDDIã€ATMã€æ— çº¿LANã€è“ç‰™ç­‰), éƒ½ä¸ä¼šæœ‰ç›¸åŒçš„MACåœ°å€å‡ºç°ã€‚ ä¾‹å¦‚ä¸€å°ä¸»æœºæ˜¯å¯åŠ¨å¤šä¸ªè™šæ‹Ÿæœº, ç”±è™šæ‹Ÿè½¯ä»¶è‡ªå·±è®¾å®šMACåœ°å€ç»™å¤šä¸ªè™šæ‹Ÿç½‘å¡, è¿™å°±å¾ˆéš¾ä¿è¯æ‰€ç”Ÿæˆçš„MACåœ°å€æ˜¯å”¯ä¸€çš„ã€‚å®é™…ä¸Š, å³ä½¿MACåœ°å€ç›¸åŒ, åªè¦ä¸æ˜¯åŒå±äºä¸€ä¸ªæ•°æ®é“¾è·¯å°±ä¸ä¼šå‡ºç°é—®é¢˜ã€‚ æ ¹æ®MACåœ°å€è½¬å‘åœ¨ä½¿ç”¨åŒè½´ç”µç¼†çš„ä»¥å¤ªç½‘ç­‰ä»‹è´¨å…±äº«ç½‘ç»œä¸­, åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€å°ä¸»æœºå‘é€æ•°æ®, å½“è¿ç½‘çš„ä¸»æœºæ•°é‡å¢åŠ æ—¶, é€šä¿¡æ€§èƒ½ä¼šæ˜æ˜¾ä¸‹é™ã€‚è‹¥å°†é›†çº¿å™¨/é›†ä¸­å™¨ç­‰è®¾å¤‡ä»¥æ˜Ÿå‹è¿æ¥, å°±å‡ºç°äº†ä¸€æ¬¾æ–°çš„ç½‘ç»œè®¾å¤‡â€“äº¤æ¢é›†çº¿å™¨, è¿™æ˜¯ä¸€ç§å°†éä»‹è´¨å…±äº«å‹ç½‘ç»œä¸­æ‰€ä½¿ç”¨çš„äº¤æ¢æœºç”¨åœ¨ä»¥å¤ªç½‘ä¸­çš„æŠ€æœ¯, äº¤æ¢é›†çº¿å™¨ä¹Ÿå«åšä»¥å¤ªç½‘äº¤æ¢æœºã€‚ ä»¥å¤ªç½‘äº¤æ¢æœºå°±æ˜¯æŒæœ‰å¤šä¸ªç«¯å£çš„ç½‘æ¡¥ã€‚æ ¹æ®æ•°æ®é“¾è·¯å±‚ä¸­æ¯ä¸ªå¸§çš„ç›®æ ‡MACåœ°å€, å†³å®šä»å“ªä¸ªç½‘ç»œæ¥å£å‘é€æ•°æ®ã€‚æ‰€å‚è€ƒçš„, ç”¨ä»¥è®°å½•å‘é€æ¥å£çš„è¡¨å«åšè½¬å‘è¡¨ã€‚ è½¬å‘è¡¨çš„å†…å®¹ä¸éœ€è¦ä½¿ç”¨è€…åœ¨æ¯ä¸ªç»ˆç«¯æˆ–äº¤æ¢æœºä¸Šæ‰‹å·¥è®¾ç½®, è€Œæ˜¯å¯ä»¥è‡ªåŠ¨ç”Ÿæˆã€‚æ•°æ®é“¾è·¯å±‚çš„æ¯ä¸ªé€šè¿‡ç‚¹åœ¨æ¥åˆ°åŒ…æ—¶, ä¼šä»ä¸­å°†æºMACåœ°å€ä»¥åŠæ›¾ç»æ¥æ”¶è¯¥åœ°å€å‘é€çš„æ•°æ®åŒ…çš„æ¥å£ä½œä¸ºå¯¹åº”å…³ç³»ä¸€ä¸€è®°å½•åˆ°è½¬å‘è¡¨ã€‚ä»¥æŸä¸ªMACåœ°å€ä½œä¸ºæºåœ°å€çš„åŒ…ç”±æŸä¸€æ¥å£æ¥æ”¶, å®è´¨ä¸Šå¯ä»¥ç†è§£ä¸ºè¯¥MACåœ°å€å°±æ˜¯è¯¥æ¥å£çš„ç›®æ ‡ã€‚å› æ­¤ä¹Ÿå¯ä»¥è¯´, ä»¥è¯¥MACåœ°å€ä½œä¸ºç›®æ ‡åœ°å€çš„åŒ…, ç»ç”±æ”¹æ¥å£é€å‡ºå³å¯ã€‚è¿™ä¸€è¿‡ç¨‹ä¹Ÿå«è‡ªå­¦è¿‡ç¨‹ã€‚ ç”±äºMACåœ°å€æ²¡æœ‰å±‚æ¬¡æ€§, è½¬å‘è¡¨ä¸­çš„å…¥å£ä¸ªæ•°ä¸æ•´ä¸ªæ•°æ®é“¾è·¯ä¸­æ‰€æœ‰ç½‘ç»œè®¾å¤‡çš„æ•°é‡æœ‰å…³ã€‚å½“è®¾å¤‡æ•°é‡å¢åŠ æ—¶, è½¬å‘è¡¨ä¹Ÿä¼šéšä¹‹å˜å¤§, æ£€ç´¢è½¬å‘è¡¨æ‰€ç”¨çš„æ—¶é—´ä¹Ÿå°±è¶Šæ¥è¶Šé•¿ã€‚å½“è¿æ¥å¤šä¸ªç»ˆç«¯æ—¶, æœ‰å¿…è¦å°†ç½‘ç»œåˆ†æˆå¤šä¸ªæ•°æ®é“¾è·¯ äº¤æ¢æœºè½¬å‘æ–¹å¼æœ‰ä¸¤ç§, ä¸€ç§å«å­˜å‚¨è½¬å‘, å¦ä¸€ç§å«ç›´é€šè½¬å‘ã€‚ å­˜å‚¨è½¬å‘æ–¹å¼æ£€æŸ¥ä»¥å¤ªç½‘æ•°æ®å¸§æœ«å°¾çš„FCSä½ååœ¨è¿›è¡Œè½¬å‘, å¯ä»¥é¿å…å‘é€è¢«ç ´åçš„å¸§æˆ–å™ªå£°å¯¼è‡´çš„é”™è¯¯å¸§ã€‚ ç›´é€šè½¬å‘æ–¹å¼ä¸­ä¸éœ€è¦å°†æ•´ä¸ªå¸§å…¨éƒ¨æ¥æ”¶ä¸‹æ¥ä»¥åå†è¿›è¡Œè½¬å‘, åªéœ€è¦å¾—çŸ¥ç›®æ ‡åœ°å€å³å¯å¼€å§‹è½¬å‘ã€‚æ‰€ä»¥, å…·æœ‰å»¶è¿Ÿè¾ƒçŸ­çš„ä¼˜åŠ¿, ä½†æ˜¯ç¼ºå°‘äº†æ ¡éªŒ, æ‰€ä»¥ä¼šå¯¼è‡´æœ‰å¯èƒ½å‘é€é”™è¯¯çš„å¸§ã€‚ ç¯è·¯æ£€æµ‹æŠ€æœ¯é€šè¿‡ç½‘æ¡¥è¿æ¥ç½‘ç»œæ—¶, ä¸€æ—¦å‡ºç°ç¯è·¯è¯¥å¦‚ä½•å¤„ç†? è¿™ä¸ç½‘ç»œçš„æ‹“æ‰‘ç»“æ„(æ€»çº¿å‹ã€ç¯å‹ã€æ˜Ÿå‹ã€æ··åˆå‹)å’Œæ‰€ä½¿ç”¨çš„ç½‘æ¡¥ç§ç±»æœ‰ç›´æ¥å…³ç³»ã€‚æœ€åçš„æƒ…å†µä¸‹, æ•°æ®å¸§ä¼šåœ¨ç¯è·¯ä¸­è¢«ä¸€è€Œå†å†è€Œä¸‰åœ°æŒç»­è½¬å‘, è€Œä¸€æ—¦è¿™ç§æ•°æ®å¸§è¶Šç§¯è¶Šå¤šå°†ä¼šå¯¼è‡´ç½‘ç»œç˜«ç—ªã€‚ è§£å†³ç½‘ç»œä¸­çš„ç¯è·¯é—®é¢˜ã€‚å…·ä½“æœ‰ç”Ÿæˆæ ‘ä¸æºè·¯ç”±ä¸¤ç§æ–¹å¼ã€‚ ç”Ÿæˆæ ‘æ¯ä¸ªç½‘æ¡¥å¿…é¡»åœ¨1~10ç§’å†…äº’ç›¸äº¤æ¢BPDUåŒ…, ä»è€Œåˆ¤æ–­å“ªäº›ç«¯å£ä½¿ç”¨, å“ªäº›ç«¯å£æ²¡æœ‰è¢«ä½¿ç”¨, ä»¥ä¾¿æ¶ˆé™¤ç¯è·¯ã€‚ä¸€æ—¦å‘ç”Ÿæ•…éšœ, åˆ™è‡ªåŠ¨åˆ‡æ¢é€šä¿¡çº¿è·¯, åˆ©ç”¨é‚£äº›æ²¡æœ‰è¢«ä½¿ç”¨çš„ç«¯å£ç»§ç»­è¿›è¡Œä¼ è¾“ã€‚ ç”Ÿæˆæ ‘æ–¹æ³•æœ‰ä¸€ä¸ªå¼Šç«¯, å°±æ˜¯åœ¨å‘ç”Ÿæ•…éšœåˆ‡æ¢ç½‘ç»œæ—¶éœ€è¦å‡ åç§’çš„æ—¶é—´ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, å¯ä»¥åˆ©ç”¨RSTPçš„æ–¹æ³•, å°†å‘ç”Ÿé—®é¢˜æ—¶çš„æ¢å¤æ—¶é—´ç¼©çŸ­åˆ°å‡ ç§’ä»¥å†…ã€‚ æºè·¯ç”±æ³•æºè·¯ç”±æ³•æœ€æ—©ç”±IBMæå‡º, å·²è§£å†³ä»¤ç‰Œç¯ç½‘ç»œçš„é—®é¢˜, è¯¥æ–¹å¼å¯ä»¥åˆ¤æ–­å‘é€æ•°æ®çš„æºåœ°å€æ˜¯é€šè¿‡å“ªä¸ªç½‘æ¡¥å®ç°ä¼ è¾“çš„, å¹¶å°†å¸§å†™å…¥RIF, ç½‘æ¡¥åˆ™æ ¹æ®è¿™ä¸ªRIFä¿¡æ¯å‘é€å¸§ç»™ç›®æ ‡åœ°å€ã€‚å› æ­¤, åŠæ—¶ç½‘æ¡¥ä¸­å‡ºç°äº†ç¯è·¯, æ•°æ®å¸§ä¹Ÿä¸ä¼šè¢«åå¤è½¬å‘ã€‚ VLANåœ¨è¿›è¡Œç½‘ç»œç®¡ç†æ—¶å€™, ç»å¸¸ä¼šé‡åˆ°åˆ†æ•£ç½‘ç»œè´Ÿè½½ã€å˜æ¢éƒ¨ç½²ç½‘ç»œè®¾å¤‡çš„ä½ç½®çš„æƒ…å†µ; å› æ­¤, æœ‰æ—¶å€™ä¸å¾—ä¸ä¿®æ”¹ç½‘ç»œçš„æ‹“æ‰‘ç»“æ„, è¿™ä¹Ÿå°±æ„å‘³ç€å¿…é¡»è¿›è¡Œç¡¬ä»¶çº¿è·¯çš„æ”¹é€ ã€‚ç„¶è€Œ, å¦‚æœé‡‡ç”¨å¸¦æœ‰VLANæŠ€æœ¯çš„ç½‘æ¡¥, å°±ä¸ç”¨å®é™…ä¿®æ”¹ç½‘ç»œå¸ƒçº¿, åªéœ€è¦ä¿®æ”¹ç½‘ç»œçš„ç»“æ„å³å¯ã€‚VLANæŠ€æœ¯é™„åŠ åˆ°ç½‘æ¡¥/2å±‚äº¤æ¢æœºä¸Š, å°±å¯ä»¥åˆ‡æ–­æ‰€æœ‰VLANä¹‹é—´çš„é€šä¿¡ã€‚ç›¸æ¯”äºä¸€èˆ¬çš„ç½‘æ¡¥/2å±‚äº¤æ¢æœº, VLANå¯ä»¥è¿‡æ»¤å¤šä½™çš„åŒ…, æé«˜ç½‘ç»œçš„æ‰¿è½½æ•ˆç‡ã€‚ æ•°æ®é“¾è·¯ æ•°æ®é“¾è·¯åç§° ä»‹è´¨ä¼ è¾“é€Ÿç‡ ç”¨é€” ä»¥å¤ªç½‘ 10 Mbps~1000Gbps LANã€MAN è“ç‰™ 5.5Mbps~150Mbps LAN å…‰çº¤é€šé“ 133Mbps~4Gbps SAN FDDI 100Mbps LANã€MAN IEEE1394 100Mbps~800Mbps é¢å‘å®¶åº­ HtPPI 800Mbpsã€1.6Gbps ä¸¤å°è®¡ç®—æœºä¹‹é—´çš„è¿æ¥ ä»¤ç‰Œç¯ 4Mbpsã€16Mbps LAN ATM 25Mbpsã€155Mbpsã€622Mbpsã€2.4GHz LAN ~WAN å‚è€ƒ: å›¾è§£TCP/IP","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://github.com/icoderRo/tags/ç½‘ç»œ/"}]},{"title":"TCP/IPåè®®åˆ†å±‚æ¨¡å‹(ä¸€)","slug":"TCP:IPåè®®åˆ†å±‚æ¨¡å‹","date":"2015-11-27T16:00:00.000Z","updated":"2017-08-17T15:04:13.000Z","comments":true,"path":"2015/11/28/TCP:IPåè®®åˆ†å±‚æ¨¡å‹/","link":"","permalink":"https://github.com/icoderRo/2015/11/28/TCP:IPåè®®åˆ†å±‚æ¨¡å‹/","excerpt":"TCP/IPåè®®åˆ†å±‚æ¨¡å‹TCP/IPæ˜¯ç›®å‰è®¡ç®—æœºç½‘ç»œä¸­ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„åè®®;ä¸‹é¢ä»‹ç»ä¸€ä¸‹TCP/IPåè®®åˆ†å±‚æ¨¡å‹ã€‚ 1.TCP/IPä¸OSIå‚è€ƒæ¨¡å‹ ç‰©ç†å±‚(ç¡¬ä»¶)ç‰©ç†å±‚: è´Ÿè´£0ã€1æ¯”ç‰¹æµä¸ç”µå‹çš„é«˜ä½ã€ç¯çš„é—ªç­ä¹‹é—´çš„å‘¼å”¤ã€‚å¯¹åº”TCP/IPåˆ†å±‚æ¨¡å‹ä¸­çš„ç¡¬ä»¶å±‚;è¿™ç§ç¡¬ä»¶ç›¸å½“äºä»¥å¤ªç½‘æˆ–ç”µè¯çº¿è·¯ç­‰ç‰©ç†è®¾å¤‡ã€‚ æ•°æ®é“¾è·¯å±‚(ç½‘å¡å±‚)ç½‘ç»œæ¥å£å±‚åˆ©ç”¨ä»¥å¤ªç½‘ä¸­çš„æ•°æ®é“¾è·¯å±‚è¿›è¡Œé€šä¿¡, å±äºæ¥å£å±‚ã€‚ä¹Ÿå°±æ˜¯è¯´, æŠŠå®ƒå½“åšæ˜¯è®©ç½‘å¡(NIC)èµ·ä½œç”¨çš„é©±åŠ¨ç¨‹åº; é©±åŠ¨ç¨‹åºæ˜¯åœ¨æ“ä½œç³»ç»Ÿä¸ç¡¬ä»¶ä¹‹é—´èµ·æ¡¥æ¢ä½œç”¨çš„è½¯ä»¶,ä¹Ÿå°±æ˜¯è¯´, æƒ³è¦ä½¿ç”¨è¿™äº›ç¡¬ä»¶, éœ€è¦å®‰è£…å¯¹åº”çš„é©±åŠ¨è½¯ä»¶ã€‚ ç°åœ¨å¾ˆå¤šè®¡ç®—æœºçš„æ“ä½œç³»ç»Ÿä¸­å·²ç»å†…ç½®å®‰è£…å¥½äº†å¯¹åº”çš„ç½‘å¡é©±åŠ¨ç¨‹åº, å¯ä»¥å®ç°å³æ’å³æ‹”ã€‚","text":"TCP/IPåè®®åˆ†å±‚æ¨¡å‹TCP/IPæ˜¯ç›®å‰è®¡ç®—æœºç½‘ç»œä¸­ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„åè®®;ä¸‹é¢ä»‹ç»ä¸€ä¸‹TCP/IPåè®®åˆ†å±‚æ¨¡å‹ã€‚ 1.TCP/IPä¸OSIå‚è€ƒæ¨¡å‹ ç‰©ç†å±‚(ç¡¬ä»¶)ç‰©ç†å±‚: è´Ÿè´£0ã€1æ¯”ç‰¹æµä¸ç”µå‹çš„é«˜ä½ã€ç¯çš„é—ªç­ä¹‹é—´çš„å‘¼å”¤ã€‚å¯¹åº”TCP/IPåˆ†å±‚æ¨¡å‹ä¸­çš„ç¡¬ä»¶å±‚;è¿™ç§ç¡¬ä»¶ç›¸å½“äºä»¥å¤ªç½‘æˆ–ç”µè¯çº¿è·¯ç­‰ç‰©ç†è®¾å¤‡ã€‚ æ•°æ®é“¾è·¯å±‚(ç½‘å¡å±‚)ç½‘ç»œæ¥å£å±‚åˆ©ç”¨ä»¥å¤ªç½‘ä¸­çš„æ•°æ®é“¾è·¯å±‚è¿›è¡Œé€šä¿¡, å±äºæ¥å£å±‚ã€‚ä¹Ÿå°±æ˜¯è¯´, æŠŠå®ƒå½“åšæ˜¯è®©ç½‘å¡(NIC)èµ·ä½œç”¨çš„é©±åŠ¨ç¨‹åº; é©±åŠ¨ç¨‹åºæ˜¯åœ¨æ“ä½œç³»ç»Ÿä¸ç¡¬ä»¶ä¹‹é—´èµ·æ¡¥æ¢ä½œç”¨çš„è½¯ä»¶,ä¹Ÿå°±æ˜¯è¯´, æƒ³è¦ä½¿ç”¨è¿™äº›ç¡¬ä»¶, éœ€è¦å®‰è£…å¯¹åº”çš„é©±åŠ¨è½¯ä»¶ã€‚ ç°åœ¨å¾ˆå¤šè®¡ç®—æœºçš„æ“ä½œç³»ç»Ÿä¸­å·²ç»å†…ç½®å®‰è£…å¥½äº†å¯¹åº”çš„ç½‘å¡é©±åŠ¨ç¨‹åº, å¯ä»¥å®ç°å³æ’å³æ‹”ã€‚ ç½‘ç»œå±‚(äº’è”ç½‘å±‚)ç½‘ç»œå±‚ä½¿ç”¨IPåè®®, IPåè®®åŸºäºIPåœ°å€è½¬å‘åˆ†åŒ…æ•°æ®ã€‚å°±æ˜¯å°†åˆ†ç»„æ•°æ®åŒ…å‘é€åˆ°ç›®çš„ä¸»æœº, é€šè¿‡äº’è”ç½‘å±‚, å¯ä»¥æŠ½è±¡ç”šè‡³å¿½ç•¥ç½‘ç»œç»“æ„çš„ç»†èŠ‚(å¿½ç•¥æ›´åº•å±‚çš„ç½‘ç»œç»“æ„)ã€‚è¿æ¥äº’è”ç½‘çš„æ‰€æœ‰ä¸»æœºè·Ÿè·¯ç”±å™¨éƒ½å¿…é¡»å®ç°IPçš„åŠŸèƒ½; ç½‘æ¡¥ã€ä¸­ç»§å™¨ã€é›†çº¿å™¨ä¸ä¸€å®šè¦å®ç°TCP/TPåŠŸèƒ½ã€‚ IPæ˜¯è·¨è¶Šç½‘ç»œæ¥ä¼ é€æ•°æ®åŒ…, ä½¿æ•´ä¸ªäº’è”ç½‘éƒ½èƒ½æ”¶åˆ°æ•°æ®çš„åè®®; IPåè®®ä½¿ç”¨IPåœ°å€ä½œä¸ºä¸»æœºçš„æ ‡è¯†ã€‚é€šè¿‡IP, ç›¸äº’é€šä¿¡çš„ä¸»æœºä¹‹é—´ä¸è®ºç»è¿‡æ€æ ·çš„åº•å±‚æ•°æ®é“¾è·¯éƒ½èƒ½å¤Ÿå®ç°é€šä¿¡, å®ƒä¸å…·å¤‡é‡å‘çš„æœºåˆ¶(TCPæ§åˆ¶é‡å‘), å±äºéå¯é æ€§ä¼ è¾“åè®®ã€‚ ICMPåè®®è§„å®šï¼šç›®çš„ä¸»æœºå¿…é¡»è¿”å›ICMPå›é€åº”ç­”æ¶ˆæ¯(ACK)ç»™å‘é€ä¸»æœºã€‚å¦‚æœæºä¸»æœºåœ¨ä¸€å®šæ—¶é—´å†…æ”¶åˆ°åº”ç­”ï¼Œåˆ™è®¤ä¸ºä¸»æœºå¯è¾¾ã€‚(ping ç”¨çš„å°±æ˜¯ICMPåè®®)ã€‚ ARP ä»åˆ†ç»„æ•°æ®åŒ…ä¸­çš„IPåœ°å€ä¸­è§£æå‡ºMACåœ°å€çš„ä¸€ç§åè®®ã€‚ ä¼ è¾“å±‚ä¼ è¾“å±‚æœ€ä¸»è¦çš„åŠŸèƒ½å°±æ˜¯èƒ½å¤Ÿè®©åº”ç”¨ç¨‹åºä¹‹é—´å®ç°é€šä¿¡ã€‚è®¡ç®—æœºå†…éƒ¨é€šå¸¸è¿è¡Œç€å¤šä¸ªç¨‹åº, åŸºäºç«¯å£å·åŒºåˆ†å“ªäº›ç¨‹åºä¸å“ªäº›ç¨‹åºåœ¨è¿›è¡Œé€šä¿¡,ä¼ è¾“ä¾§æœ‰ä¸¤ä¸ªä»£è¡¨æ€§çš„åè®®TCP/UPDã€‚ TCP æ˜¯ä¸€ç§é¢å‘æœ‰è¿æ¥çš„å¯é çš„ä¼ è¾“å±‚çš„åè®®ã€‚å®ƒå¯ä»¥ä¿è¯ä¸¤ç«¯ä¸»æœºçš„é€šä¿¡å¯è¾¾ã€‚TCPèƒ½å¤Ÿæ­£ç¡®å¤„ç†åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„ä¸¢åŒ…ã€ä¼ è¾“é¡ºåºä¹±æ‰çš„å¼‚å¸¸çš„æƒ…å†µ, è¿˜èƒ½å¤Ÿæœ‰æ•ˆçš„åˆ©ç”¨å¸¦å®½, ç¼“è§£ç½‘ç»œçš„æ‹¥å µã€‚ UDP æ˜¯ä¸€ç§é¢å‘æ— è¿æ¥çš„ä¸å¯é çš„ä¼ è¾“å±‚åè®®ã€‚UDPä¸ä¼šå…³æ³¨å¯¹ç«¯æ˜¯å¦æ¥æ”¶åˆ°äº†æ•°æ®, å¸¸ç”¨äºå¤šæ’­ã€å¹¿æ’­é€šä¿¡ä»¥åŠè§†é¢‘é€šä¿¡ç­‰å¤šåª’ä½“é¢†åŸŸ(UDP + RTP/RTCP/RTMP) åº”ç”¨å±‚(ä¼šè¯å±‚ä»¥ä¸Šçš„åˆ†å±‚)TCP/IPåˆ†å±‚ä¸­, å°†OSIå‚è€ƒæ¨¡å‹ä¸­çš„ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚å’Œåº”ç”¨å±‚çš„åŠŸèƒ½éƒ½é›†ä¸­åˆ°äº†åº”ç”¨ç¨‹åºä¸­å®ç°ã€‚æ–‡ä»¶ä¼ è¾“(FTP), è¿œç¨‹ç™»å½•(TENNET/SSH), ç½‘ç»œç®¡ç†(SNMP) 2.ç½‘ç»œæ„æˆè¦ç´  ç½‘å¡ä»»ä¸€è®¡ç®—æœºè”ç½‘æ—¶, éƒ½å¿…é¡»è¦ä½¿ç”¨ç½‘å¡(NIC)/LANå¡/ç½‘ç»œé€‚é…å™¨ã€‚å¾ˆå¤šè®¡ç®—æœºéƒ½å†…ç½®äº†LANç«¯å£, è¯´æ˜è®¡ç®—æœºåœ¨å‡ºå‚è®¾ç½®ä¸­å°±å…·å¤‡äº†ä»¥å¤ªç½‘çš„ç«¯å£ã€‚ ä¸­ç»§å™¨ä¸­ç»§å™¨(Repeater)æ˜¯åœ¨ç‰©ç†å±‚é¢ä¸Šå»¶é•¿ç½‘ç»œçš„è®¾å¤‡ã€‚ç”±ç”µç¼†ä¼ è¿‡æ¥çš„ç”µä¿¡å·/å…‰ä¿¡å·ç»ç”±ä¸­ç»§å™¨çš„æ³¢å½¢è°ƒæ•´å’Œæ”¾å¤§å†ä¼ ç»™å¦ä¸€ä¸ªç”µç¼†ã€‚ é€šè¿‡ä¸­ç»§å™¨è€Œè¿›è¡Œçš„ç½‘ç»œå»¶é•¿, å…¶è·ç¦»ä¹Ÿå¹¶éå¯ä»¥æ— é™æ‰©å¤§; ä¾‹å¦‚ä¸€ä¸ª10Mbpsçš„ä»¥å¤ªç½‘æœ€å¤šå¯ä»¥ç”¨4ä¸ªä¸­ç»§å™¨åˆ†æ®µè¿æ¥, è€Œä¸€ä¸ª100Mbpsçš„ä»¥å¤ªç½‘åˆ™å¯¹å¤šåªèƒ½è¿æ¥ä¸¤ä¸ªä¸­ç»§å™¨ã€‚ æœ‰äº›ä¸­ç»§å™¨å¯ä»¥æä¾›å¤šä¸ªç«¯å£æœåŠ¡, è¿™ç§ä¸­ç»§å™¨è¢«ç§°ä¸ºä¸­ç»§é›†çº¿å™¨/é›†çº¿å™¨/Hubã€‚å› æ­¤, é›†çº¿å™¨ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯å¤šä¸ªä¸­ç»§å™¨, æ¯ä¸ªç«¯å£éƒ½å¯ä»¥æˆä¸ºä¸€ä¸ªä¸­ç»§å™¨ã€‚ ç½‘æ¡¥/2å±‚äº¤æ¢æœºç½‘æ¡¥èƒ½å¤Ÿè¯†åˆ«æ•°æ®é“¾è·¯ä¸­çš„æ•°æ®å¸§, å¹¶å°†è¿™äº›æ•°æ®å¸§ä¸´æ—¶å­˜å‚¨äºå†…å­˜, å†é‡æ–°ç”Ÿæˆä¿¡å·ä½œä¸ºä¸€ä¸ªå…¨æ–°çš„å¸§è½¬å‘ç»™ç›¸è¿çš„å¦ä¸€ä¸ªç½‘æ®µ, ç”±äºèƒ½å¤Ÿå­˜å‚¨è¿™äº›æ•°æ®å¸§, ç½‘æ¡¥èƒ½å¤Ÿè¿æ¥ä¼ è¾“é€Ÿç‡å®Œå…¨ä¸åŒçš„æ•°æ®é“¾è·¯, å¹¶ä¸”ä¸é™åˆ¶è¿æ¥ç½‘æ®µçš„ä¸ªæ•°ã€‚æ•°æ®é“¾è·¯çš„æ•°æ®å¸§ä¸­æœ‰ä¸€ä¸ªæ•°æ®ä½å«åšFCS, ç”¨ä»¥æ ¡éªŒæ•°æ®æ˜¯å¦æ­£ç¡®é€åˆ°ç›®çš„åœ°ã€‚ç½‘æ¡¥é€šè¿‡æ£€æŸ¥è¿™ä¸ªåŸŸä¸­çš„å€¼, å°†é‚£äº›æŸåçš„æ•°æ®ä¸¢å¼ƒ, ä»è€Œé¿å…å‘é€ç»™å…¶ä»–ç½‘æ®µã€‚ ä»¥å¤ªç½‘ä¸­ä½¿ç”¨çš„äº¤æ¢é›†çº¿å™¨, åŸºæœ¬ä¹Ÿå±äºç½‘æ¡¥çš„ä¸€ç§, äº¤æ¢é›†çº¿å™¨ä¸­è¿æ¥ç”µç¼†çš„æ¯ä¸ªç«¯å£éƒ½èƒ½æä¾›ç±»ä¼¼ç½‘æ¡¥çš„åŠŸèƒ½ã€‚ è·¯ç”±å™¨/3å±‚äº¤æ¢æœºè·¯ç”±å™¨æ˜¯åœ¨ç½‘ç»œå±‚é¢ä¸Šè¿æ¥ä¸¤ä¸ªç½‘ç»œã€å¹¶å¯¹åˆ†ç»„æ•°æ®æŠ¥æ–‡è¿›è¡Œè½¬å‘çš„è®¾å¤‡ã€‚ç½‘æ¡¥æ˜¯æ ¹æ®MACåœ°å€è¿›è¡Œå¤„ç†, è€Œè·¯ç”±å™¨/3å±‚äº¤æ¢æœºåˆ™æ˜¯æ ¹æ®IPåœ°å€è¿›è¡Œå¤„ç†çš„ã€‚å› æ­¤, TCP/IPä¸­ç½‘ç»œå±‚çš„åœ°å€å°±æˆä¸ºäº†IPåœ°å€ã€‚ è·¯ç”±å™¨å¯ä»¥è¿æ¥ä¸åŒçš„æ•°æ®é“¾è·¯ã€‚ä¾‹å¦‚è¿æ¥ä¸¤ä¸ªä»¥å¤ªç½‘, æˆ–è€…è¿æ¥ä¸€ä¸ªä»¥å¤ªç½‘ä¸ä¸€ä¸ªFDDIã€‚å®¶/åŠå…¬å®¤ä½¿ç”¨çš„å®½å¸¦è·¯ç”±å™¨ä¹Ÿæ˜¯è·¯ç”±å™¨çš„ä¸€ç§ã€‚è·¯ç”±å™¨è¿˜æœ‰åˆ†æ‹…ç½‘ç»œè´Ÿè´£çš„ä½œç”¨, ç”šè‡³å…·æœ‰ç½‘ç»œå®‰å…¨çš„åŠŸèƒ½ã€‚ 4~7å±‚äº¤æ¢æœº4~7å±‚äº¤æ¢æœºè´Ÿè´£å¤„ç†ä»ä¼ è¾“å±‚åˆ°åº”ç”¨å±‚çš„æ•°æ®ã€‚ä»¥TCPç­‰åè®®çš„ä¼ è¾“å±‚åŠå…¶ä¸Šé¢çš„åº”ç”¨å±‚ä¸ºåŸºç¡€, åˆ†ææ”¶å‘æ•°æ®, å¹¶å¯¹å…¶è¿›è¡Œç‰¹å®šçš„å¤„ç†ã€‚4~7å±‚äº¤æ¢æœºçš„å¯ä»¥è¿›è¡Œå¸¦å®½æ§åˆ¶, ä¼˜å…ˆå¤„ç†å¯¹å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„é€šä¿¡è¯·æ±‚, æ”¾ç¼“å¤„ç†åƒé‚®ä»¶æˆ–æ•°æ®è½¬å‘ç­‰ç¨æœ‰å»¶è¿Ÿä¹Ÿå¹¶æ— å¤§ç¢çš„é€šä¿¡è¯·æ±‚ã€‚è´Ÿè½½å‡è¡¡å™¨ã€å¹¿åŸŸç½‘åŠ é€Ÿå™¨ã€é˜²ç«å¢™ç­‰éƒ½æ˜¯æ˜¯4~7å±‚äº¤æ¢æœºçš„ä¸€ä¸­ã€‚ ç½‘å…³ç½‘å…³è´Ÿè´£å¤„ç†ä¼ è¾“å±‚åˆ°åº”ç”¨å±‚çš„æ•°æ®è¿›è¡Œè½¬æ¢å’Œè½¬å‘çš„è®¾å¤‡ã€‚ä¸4~7å±‚äº¤æ¢æœºä¸€æ ·éƒ½æ˜¯å¤„ç†ä¼ è¾“å±‚åŠä»¥ä¸Šçš„æ•°æ®, ä½†æ˜¯ç½‘å…³ä¸ä»…è½¬å‘æ•°æ®è¿˜è´Ÿè´£å¯¹æ•°æ®è¿›è¡Œè½¬æ¢,é€šå¸¸ä¼šä½¿ç”¨ä¸€ä¸ªè¡¨ç¤ºå±‚æˆ–åº”ç”¨å±‚ç½‘å…³, åœ¨ä¸¤ä¸ªä¸èƒ½ç›´æ¥è¿›è¡Œé€šä¿¡çš„åè®®ä¹‹é—´è¿›è¡Œç¿»è¯‘, å®ç°ä¸¤ç«¯çš„é€šä¿¡ã€‚ ä»£ç†æœåŠ¡å™¨å¯ä»¥æ§åˆ¶ç½‘ç»œæµé‡å’Œå®‰å…¨, å±äºç½‘å…³çš„ä¸€ç§ å‚è€ƒ: å›¾è§£TCP/IP","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://github.com/icoderRo/tags/ç½‘ç»œ/"}]},{"title":"è°åŠ¨äº†æˆ‘çš„å¥¶é…ª","slug":"è°åŠ¨äº†æˆ‘çš„å¥¶é…ª","date":"2015-11-22T16:00:00.000Z","updated":"2017-08-17T15:04:37.000Z","comments":true,"path":"2015/11/23/è°åŠ¨äº†æˆ‘çš„å¥¶é…ª/","link":"","permalink":"https://github.com/icoderRo/2015/11/23/è°åŠ¨äº†æˆ‘çš„å¥¶é…ª/","excerpt":"ç®€è¨€ä¸´å‡ºå‘,æƒ³èµ·è€å¤§èµ é€çš„ä¸€æœ¬ä¹¦,ã€Šè°åŠ¨äº†æˆ‘çš„å¥¶é…ªã€‹, äºæ˜¯ä¹æ‚„ç„¶ç¿»èµ·äº†è¿™æœ¬ä¹¦â€¦","text":"ç®€è¨€ä¸´å‡ºå‘,æƒ³èµ·è€å¤§èµ é€çš„ä¸€æœ¬ä¹¦,ã€Šè°åŠ¨äº†æˆ‘çš„å¥¶é…ªã€‹, äºæ˜¯ä¹æ‚„ç„¶ç¿»èµ·äº†è¿™æœ¬ä¹¦â€¦ ç®€è¿°ã€Šè°åŠ¨äº†æˆ‘çš„å¥¶é…ªã€‹å†™çš„æ˜¯ä¸ªå¯çˆ±çš„å¯“è¨€æ•…äº‹,æ¯é¡µéƒ½é…æœ‰ä¸»äººç¿æ»‘ç¨½å¯çˆ±ä¸ªæ€§é²œæ˜çš„æ¼«ç”»å½¢è±¡ã€‚ä¹¦ä¸­ä¸»è¦è®²è¿°4ä¸ªâ€œäººç‰©â€ï¼šä¸¤åªå°è€é¼ â€œå—…å—…â€ã€â€œåŒ†åŒ†â€å’Œä¸¤ä¸ªå°çŸ®äººâ€œå“¼å“¼â€ã€â€œå”§å”§â€ã€‚ä»–ä»¬ç”Ÿæ´»åœ¨ä¸€ä¸ªè¿·å®«é‡Œ,å¥¶é…ªæ˜¯ä»–ä»¬è¦è¿½å¯»çš„ä¸œè¥¿ã€‚æœ‰ä¸€å¤©,ä»–ä»¬åŒæ—¶å‘ç°äº†ä¸€ä¸ªå‚¨é‡ä¸°å¯Œçš„å¥¶é…ªä»“åº“,ä¾¿åœ¨å…¶å‘¨å›´æ„ç­‘èµ·è‡ªå·±çš„å¹¸ç¦ç”Ÿæ´»ã€‚å¾ˆä¹…ä¹‹åçš„æŸå¤©,å¥¶é…ªçªç„¶ä¸è§äº†ï¼è¿™ä¸ªçªå¦‚å…¶æ¥çš„å˜åŒ–ä½¿ä»–ä»¬çš„å¿ƒæ€æš´éœ²æ— ç–‘ï¼šå—…å—…,åŒ†åŒ†éšå˜åŒ–è€ŒåŠ¨,ç«‹åˆ»ç©¿ä¸Šå§‹ç»ˆæŒ‚åœ¨è„–å­ä¸Šçš„é‹å­,å¼€å§‹å‡ºå»å†å¯»æ‰¾,å¹¶å¾ˆå¿«å°±æ‰¾åˆ°äº†æ›´æ–°é²œæ›´ä¸°å¯Œçš„å¥¶é…ªï¼›ä¸¤ä¸ªå°çŸ®äººå“¼å“¼å’Œå”§å”§é¢å¯¹å˜åŒ–å´çŠ¹è±«ä¸å†³,çƒ¦æ¼ä¸›ç”Ÿ,å§‹ç»ˆæ— æ³•æ¥å—å¥¶é…ªå·²ç»æ¶ˆå¤±çš„æ®‹é…·ç°å®.ç»è¿‡æ¿€çƒˆçš„æ€æƒ³æ–—äº‰,å”§å”§ç»ˆäºå†²ç ´äº†æ€æƒ³çš„æŸç¼š,ç©¿ä¸Šä¹…ç½®ä¸ç”¨çš„è·‘é‹,é‡æ–°è¿›å…¥æ¼†é»‘çš„è¿·å®«,å¹¶æœ€ç»ˆæ‰¾åˆ°äº†æ›´å¤šæ›´å¥½çš„å¥¶é…ª,è€Œå“¼å“¼å´ä»åœ¨å¯¹è‹å¤©çš„è¿½é—®ä¸­éƒéƒå¯¡æ¬¢â€¦â€¦ ç•™è¨€å¢™åœ¨è¿™æœ¬ä¹¦ä¸­ï¼Œæœ‰å¾ˆå¤šçš„è‡³ç†åè¨€ï¼Œä¹Ÿæœ‰å¾ˆå¤šå‘äººæ·±æ€çš„åœ°æ–¹ï¼ŒæŠŠä»–ä»¬æ‘˜æŠ„ä¸‹æ¥ï¼Œæ—¶å¸¸è­¦é†’æ‡’æƒ°çš„è‡ªå·±ï¼š å¦‚æœä¸æ”¹å˜ï¼Œå°±ä¼šè¢«æ·˜æ±° ç»å¸¸é—»é—»ä½ çš„å¥¶é…ªï¼Œä½ å°±ä¼šçŸ¥é“å®ƒä»€ä¹ˆæ—¶å€™å¼€å§‹å˜è´¨ å½“ä½ å®¢æœäº†è‡ªå·±çš„ææƒ§æ—¶ï¼Œä½ å°±ä¼šæ„Ÿåˆ°è½»æ¾è‡ªåœ¨ åœ¨å‘ç°å¥¶é…ªä¹‹å‰ï¼Œæƒ³è±¡æ­£åœ¨äº«å—å¥¶é…ªï¼Œä¼šå¸®è‡ªå·±æ‰¾åˆ°æ–°çš„å¥¶é…ª è¶Šæ—©æ”¾å¼ƒæ—§çš„å¥¶é…ªï¼Œå°±è¶Šæ—©å‘ç°æ–°çš„å¥¶é…ª åœ¨è¿·å®«ä¸­æœç´¢æ¯”åœç•™åœ¨æ²¡æœ‰å¥¶é…ªçš„åœ°æ–¹æ›´å®‰å…¨ æŠ›å¼ƒæ—§çš„è§‚å¿µ, æ‰èƒ½æ‰¾åˆ°æ–°çš„å¥¶é…ª åªè¦ç›¸ä¿¡è‡ªå·±èƒ½å¤Ÿæ‰¾åˆ°å¹¶ä¸”äº«ç”¨æ–°çš„å¥¶é…ª,ä½ å°±ä¼šæ”¹å˜è‡ªå·±çš„è¡Œä¸º åŠæ—©æ³¨æ„ç»†å°çš„å˜åŒ–ï¼Œè¿™ä¼šæœ‰åŠ©äºä½ é€‚åº”å³å°†æ¥ä¸´çš„å¤§å˜åŒ– å°æ‚Ÿå½“æˆ‘ä»¬åœ¨ä¸ºè‡ªå·±çš„äº‹ä¸š,ç”Ÿæ´»åšå‡ºé€‰æ‹©æ—¶,å¿…é¡»å……åˆ†åœ°çƒ­çˆ±è‡ªå·±å–œæ¬¢å¹²çš„äº‹,çƒ­çˆ±æ‰ä¼šåŠªåŠ›å»é’»ç ”,åŠªåŠ›é’»ç ”å¿…ä¼šæœ‰ä½œä¸º;é€‰æ‹©è‡ªå·±æœ‰èƒ½åŠ›å¹²çš„äº‹,é€‰æ‹©ä¸€ç»ç¡®å®š,å°±è¦å¼ƒè€Œä¸èˆåœ°å»å¥‹æ–—,ä»ä¸€ç‚¹ä¸€æ»´åšèµ·,ä»æœ€å°çš„äº‹åšèµ·,åŠªåŠ›åšåˆ°æœ€å¥½,åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¢é•¿æ‰å¹²,æ ‘ç«‹ä¿¡å¿ƒã€‚ä¹…è€Œä¹…ä¹‹,å¿…å®šä¼šæœ‰æ‰€ä½œä¸º,æœ‰æ‰€å‘å±•,æœ‰æ‰€åˆ›é€ ï¼ æˆ‘ä»¬è¦è®°ä½ï¼šåˆ«äººä»ä¼šä¸æ–­åœ°æ‹¿èµ°ä½ çš„â€œå¥¶é…ªâ€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åšå¥½è¿…é€Ÿæ”¹å˜çš„å‡†å¤‡ï¼Œä¸æ–­åœ°å»é€‚åº”å˜åŒ–ã€äº«å—å˜åŒ–ã€‚ ã€Šè°åŠ¨äº†æˆ‘çš„å¥¶é…ªã€‹å‘Šè¯‰æˆ‘ä¸€ä¸ªæœ€ç®€å•çš„åº”å¯¹æ–¹æ³•,é‚£å°±æ˜¯æŠŠè·‘é‹æŒ‚åœ¨è„–å­ä¸Š,æ—¶åˆ»å‡†å¤‡ç©¿ä¸Šå®ƒ,åœ¨åƒå˜ä¸‡åŒ–çš„ä¸–ç•Œé‡Œå¥”è·‘è¿½å¯»,å»è¿½å¯»å…¶ä»–æ›´æ–°é²œçš„å¥¶é…ªâ€¦â€¦","categories":[{"name":"é˜…è¯»","slug":"é˜…è¯»","permalink":"https://github.com/icoderRo/categories/é˜…è¯»/"}],"tags":[{"name":"å¯“è¨€æ•…äº‹","slug":"å¯“è¨€æ•…äº‹","permalink":"https://github.com/icoderRo/tags/å¯“è¨€æ•…äº‹/"}]},{"title":"3Dè½®æ’­å›¾","slug":"3Dè½®æ’­å›¾","date":"2015-09-23T16:00:00.000Z","updated":"2017-08-17T14:52:17.000Z","comments":true,"path":"2015/09/24/3Dè½®æ’­å›¾/","link":"","permalink":"https://github.com/icoderRo/2015/09/24/3Dè½®æ’­å›¾/","excerpt":"ç®€ä»‹åœ¨å¼€å‘ä¸€äº›é¡¹ç›®çš„é¦–é¡µ,æˆ–è€…éœ€è¦ä¿¡æ¯å±•ç¤ºç±»ç•Œé¢çš„æ—¶å€™,å¾€å¾€éœ€è¦ç”¨åˆ°è½®æ’­å›¾æ•ˆæœ. å¸¸è§çš„è½®æ’­å›¾éƒ½æ˜¯ä»¥2Dçš„å½¢å¼, å¹³é¢å±•ç¤º, å¯¹äº3Dæ—‹è½¬çš„çš„è½®æ’­å›¾, åˆåº”è¯¥å¦‚ä½•å®ç°. æ€è·¯ 2Dè½®æ’­å›¾ ä¸€ç§æ˜¯åˆ©ç”¨collectionViewå®ç°æ— é™æ»šåŠ¨,å› ä¸ºcollectionViewæœ¬èº«å­˜åœ¨ç€å¤ç”¨çš„é—®é¢˜,æ‰€ä»¥ä¸ç”¨æ‹…å¿ƒå†…å­˜çš„æ¶ˆè€—é—®é¢˜. å¦å¤–ä¸€ç§å°±æ˜¯åŸºäºscrollViewæ¥å®ç°, æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ‰5å¼ å›¾ç‰‡.æœ€ç®€å•çš„å°±æ˜¯æˆ‘ä»¬ç›´æ¥åˆ›å»º5+2ä¸ªï¼Œä¹Ÿå°±æ˜¯7ä¸ªimageView.è€Œæˆ‘ä»¬çš„å­˜æ”¾é¡ºåºä¸ºï¼Œå›¾ç‰‡5ï¼Œå›¾ç‰‡1ã€å›¾ç‰‡2ã€å›¾ç‰‡3ã€å›¾ç‰‡4ã€å›¾ç‰‡5ã€å›¾ç‰‡1ã€‚é»˜è®¤æ˜¾ç¤ºç¬¬2å¼ ï¼ˆå›¾ç‰‡1,ä¸€ç›´å‘å³æ»‘åŠ¨åˆ°ç¬¬6å¼ ï¼ˆå›¾ç‰‡5),å†å‘å³æ»‘åŠ¨æ˜¾ç¤ºç¬¬7å¼ ï¼ˆå›¾ç‰‡1ï¼‰æ˜¾ç¤ºå®Œæˆå,å°†UIScrollViewçš„contentOffsetè®¾ç½®åˆ°ç¬¬2ä¸ªimageViewä¸Šï¼ˆå›¾ç‰‡1,è¿™æ—¶å€™ä¾¿å¯ç»§ç»­å‘å³æ»‘åŠ¨å®ç°å¾ªç¯çš„æ•ˆæœ;åŒç†ï¼Œå‘å·¦æ»‘åŠ¨æ—¶,æ»‘åŠ¨åˆ°ç¬¬1å¼ ï¼ˆå›¾ç‰‡5ï¼‰å,å°†UIScrollViewçš„contentOffsetè®¾ç½®åˆ°ç¬¬6ä¸ªimageViewä¸Šï¼ˆå›¾ç‰‡5),è¿™æ ·ä¾¿å¯ä»¥ç»§ç»­å‘å·¦æ»‘åŠ¨å®ç°å¾ªç¯æ•ˆæœ. 3Dè½®æ’­å›¾ é¦–å…ˆ, 3Dç¿»è½¬æ•ˆæœ, æˆ‘ä»¬ä¼šæƒ³åˆ°å¯èƒ½ä¼šä¸åŠ¨ç”»ç›¸å…³, è¿™ç§è½®æ’­å›¾çš„åˆ‡æ¢æœ‰ç‚¹ç±»ä¼¼è½¬åœºåŠ¨ç”»(CATransition), æˆ‘ä»¬å»æŸ¥ä¸€ä¸‹CATransitionç›¸å…³èµ„æ–™, å‘ç°å…¶typeæœ‰ä¸€ä¸ªcubeå±æ€§æœ‰3Dç¿»æ»šçš„æ•ˆæœ.æ¥ä¸‹æ¥, ç›´æ¥ä¸Šä»£ç çœ‹çœ‹.","text":"ç®€ä»‹åœ¨å¼€å‘ä¸€äº›é¡¹ç›®çš„é¦–é¡µ,æˆ–è€…éœ€è¦ä¿¡æ¯å±•ç¤ºç±»ç•Œé¢çš„æ—¶å€™,å¾€å¾€éœ€è¦ç”¨åˆ°è½®æ’­å›¾æ•ˆæœ. å¸¸è§çš„è½®æ’­å›¾éƒ½æ˜¯ä»¥2Dçš„å½¢å¼, å¹³é¢å±•ç¤º, å¯¹äº3Dæ—‹è½¬çš„çš„è½®æ’­å›¾, åˆåº”è¯¥å¦‚ä½•å®ç°. æ€è·¯ 2Dè½®æ’­å›¾ ä¸€ç§æ˜¯åˆ©ç”¨collectionViewå®ç°æ— é™æ»šåŠ¨,å› ä¸ºcollectionViewæœ¬èº«å­˜åœ¨ç€å¤ç”¨çš„é—®é¢˜,æ‰€ä»¥ä¸ç”¨æ‹…å¿ƒå†…å­˜çš„æ¶ˆè€—é—®é¢˜. å¦å¤–ä¸€ç§å°±æ˜¯åŸºäºscrollViewæ¥å®ç°, æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ‰5å¼ å›¾ç‰‡.æœ€ç®€å•çš„å°±æ˜¯æˆ‘ä»¬ç›´æ¥åˆ›å»º5+2ä¸ªï¼Œä¹Ÿå°±æ˜¯7ä¸ªimageView.è€Œæˆ‘ä»¬çš„å­˜æ”¾é¡ºåºä¸ºï¼Œå›¾ç‰‡5ï¼Œå›¾ç‰‡1ã€å›¾ç‰‡2ã€å›¾ç‰‡3ã€å›¾ç‰‡4ã€å›¾ç‰‡5ã€å›¾ç‰‡1ã€‚é»˜è®¤æ˜¾ç¤ºç¬¬2å¼ ï¼ˆå›¾ç‰‡1,ä¸€ç›´å‘å³æ»‘åŠ¨åˆ°ç¬¬6å¼ ï¼ˆå›¾ç‰‡5),å†å‘å³æ»‘åŠ¨æ˜¾ç¤ºç¬¬7å¼ ï¼ˆå›¾ç‰‡1ï¼‰æ˜¾ç¤ºå®Œæˆå,å°†UIScrollViewçš„contentOffsetè®¾ç½®åˆ°ç¬¬2ä¸ªimageViewä¸Šï¼ˆå›¾ç‰‡1,è¿™æ—¶å€™ä¾¿å¯ç»§ç»­å‘å³æ»‘åŠ¨å®ç°å¾ªç¯çš„æ•ˆæœ;åŒç†ï¼Œå‘å·¦æ»‘åŠ¨æ—¶,æ»‘åŠ¨åˆ°ç¬¬1å¼ ï¼ˆå›¾ç‰‡5ï¼‰å,å°†UIScrollViewçš„contentOffsetè®¾ç½®åˆ°ç¬¬6ä¸ªimageViewä¸Šï¼ˆå›¾ç‰‡5),è¿™æ ·ä¾¿å¯ä»¥ç»§ç»­å‘å·¦æ»‘åŠ¨å®ç°å¾ªç¯æ•ˆæœ. 3Dè½®æ’­å›¾ é¦–å…ˆ, 3Dç¿»è½¬æ•ˆæœ, æˆ‘ä»¬ä¼šæƒ³åˆ°å¯èƒ½ä¼šä¸åŠ¨ç”»ç›¸å…³, è¿™ç§è½®æ’­å›¾çš„åˆ‡æ¢æœ‰ç‚¹ç±»ä¼¼è½¬åœºåŠ¨ç”»(CATransition), æˆ‘ä»¬å»æŸ¥ä¸€ä¸‹CATransitionç›¸å…³èµ„æ–™, å‘ç°å…¶typeæœ‰ä¸€ä¸ªcubeå±æ€§æœ‰3Dç¿»æ»šçš„æ•ˆæœ.æ¥ä¸‹æ¥, ç›´æ¥ä¸Šä»£ç çœ‹çœ‹. ä¸Šä»£ç  åˆ›å»ºä¸€ä¸ªimageView, ç”¨æ¥è£…è½½å›¾ç‰‡, å®ç°å›¾ç‰‡çš„3Dç¿»è½¬, å°±æ˜¯ç»™å½“å‰è¿™ä¸ªimageViewæ·»åŠ 3DåŠ¨ç”»å.åœ¨å°†é‡Œé¢çš„imageç»™æ›¿æ¢. 123456789101112- (UIImageView *)imageV&#123; if (!_imageV) &#123; UIImageView *imageView = [[UIImageView alloc] initWithFrame:CGRectMake(0, 0, Width, Height)]; imageView.backgroundColor = [UIColor lightGrayColor]; imageView.userInteractionEnabled = YES; _imageV = imageView; [self addSubview:_imageV]; &#125; return _imageV;&#125; è®¾ç½®imageViewçš„é»˜è®¤å›¾ç‰‡ä¸ºç¬¬ä¸€å¼ å›¾, å¹¶ç»™å½“å‰è§†å›¾æ·»åŠ å‘å·¦å’Œå‘å³è½»æ‰«çš„æ‰‹åŠ¿. 12345678910self.imageV.image = [UIImage imageNamed:self.imagArr[self.currentPage]]; UISwipeGestureRecognizer *rightRe = [[UISwipeGestureRecognizer alloc] initWithTarget:self action:@selector(swipFromRight)];[rightRe setDirection:UISwipeGestureRecognizerDirectionLeft]; UISwipeGestureRecognizer *leftRe = [[UISwipeGestureRecognizer alloc] initWithTarget:self action:@selector(swipFromLeft)];[leftRe setDirection:UISwipeGestureRecognizerDirectionRight]; [self.imageV addGestureRecognizer:rightRe];[self.imageV addGestureRecognizer:leftRe]; æ·»åŠ pageControl, ç”¨ä»¥æ˜¾ç¤ºå½“å‰å›¾ç‰‡çš„index 12345678910111213141516- (UIPageControl *)pageControl&#123; if (!_pageControl) &#123; UIPageControl *pageControl = [[UIPageControl alloc] init]; pageControl.numberOfPages = self.imagArr.count; CGSize size = [pageControl sizeForNumberOfPages:self.imagArr.count]; pageControl.frame = CGRectMake(0, 0, size.width, size.height); pageControl.center = CGPointMake(self.center.x, Height-10); pageControl.currentPageIndicatorTintColor = [UIColor whiteColor]; pageControl.pageIndicatorTintColor = [UIColor grayColor]; _pageControl = pageControl; [self addSubview:_pageControl]; &#125; return _pageControl;&#125; æ·»åŠ å®šæ—¶å™¨, è®©imageViewæŒ‰ç…§ä¸€å®šçš„èŠ‚å¥, è‡ªåŠ¨è½®æ’­. 123456789- (NSTimer *)timer&#123; if (!_timer) &#123; _timer = [NSTimer timerWithTimeInterval:3 target:self selector:@selector(swipFromRight) userInfo:nil repeats:YES]; [[NSRunLoop currentRunLoop] addTimer:_timer forMode:NSRunLoopCommonModes]; &#125; return _timer;&#125; NSRunLoopCommonModes: ä¸å—å½“å‰çº¿ç¨‹çš„å½±å“. å®ç°ç›‘å¬æ–¹æ³• 1234567891011121314151617181920212223242526272829303132- (void)swipFromRight&#123; self.currentPage++; if (self.currentPage &gt;= self.imagArr.count) self.currentPage = 0; self.pageControl.currentPage = self.currentPage; self.imageV.image = [UIImage imageNamed:self.imagArr[self.currentPage]]; CATransition *transition = [[CATransition alloc] init]; transition.type = @&quot;cube&quot;; transition.subtype = kCATransitionFromRight; transition.duration = 1.5; transition.delegate = self; [self.imageV.layer addAnimation:transition forKey:nil]; &#125;- (void)swipFromLeft&#123; self.currentPage--; if (self.currentPage &lt; 0) self.currentPage = self.imagArr.count -1; self.pageControl.currentPage = self.currentPage; self.imageV.image = [UIImage imageNamed:self.imagArr[self.currentPage]]; CATransition *transition2 = [[CATransition alloc] init]; transition2.type = @&quot;cube&quot;; transition2.subtype = kCATransitionFromLeft; transition2.duration = 1.5; transition2.delegate = self; [self.imageV.layer addAnimation:transition2 forKey:nil];&#125; æ ¸å¿ƒåŠ¨ç”», éƒ½æ˜¯æ·»åŠ åˆ°è§†å›¾çš„layerä¸Š. è¿™æ ·ä¹‹å, è¿˜ä¼šæœ‰é—®é¢˜, ä¾‹å¦‚:3ç§’åˆ‡æ¢ä¸€å¼ å›¾ç‰‡, å½“2.9ç§’çš„æ—¶å€™, æ‰‹åŠ¨åˆ‡æ¢äº†æ–°çš„å›¾ç‰‡, åœ¨0.1ç§’å, å®šæ—¶å™¨åˆä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨åˆ‡æ¢ä¸€å¼ æ–°çš„å›¾ç‰‡. æˆ‘ä»¬æƒ³åšåˆ°, å½“æ‰‹åŠ¨åˆ‡æ¢å›¾ç‰‡å, ä»ç„¶éœ€è¦ç­‰å¾…3ç§’, å®šæ—¶å™¨æ‰ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸‹ä¸€å¼ å›¾ç‰‡.æˆ‘ä»¬ç›‘å¬CAAnimationDelegateæ–¹æ³•:animationDidStart: å’ŒanimationDidStop: CAAnimationåœ¨åˆ†ç±»ä¸­å®šä¹‰äº†ä»£ç†æ–¹æ³•,æ˜¯ç»™NSObjectæ·»åŠ çš„åˆ†ç±»,æ‰€ä»¥ä»»ä½•å¯¹è±¡,æˆä¸ºCAAnimationçš„ä»£ç†,éƒ½å¯ä»¥ã€‚ åŠ¨ç”»å¼€å§‹æ—¶å€™è°ƒç”¨animationDidStart:, ç¦ç”¨äº¤äº’ 123456789- (void)animationDidStart:(CAAnimation *)anim&#123; if (self.timer) &#123; [self.timer invalidate]; self.timer = nil; &#125; self.imageV.userInteractionEnabled = NO;&#125; åŠ¨ç”»åœæ­¢çš„æ—¶å€™è°ƒç”¨animationDidStop:, å¼€å¯äº¤äº’, é‡ç½®timer 1234567891011- (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag&#123; if (self.timer) &#123; [self.timer invalidate]; self.timer = nil; [self timer]; &#125; self.imageV.userInteractionEnabled = YES;&#125; ä»å¤–éƒ¨ä¼ å…¥éœ€è¦æµè§ˆçš„å›¾ç‰‡æ•°ç»„, è®¾ç½®frameå³å¯. 12LCBannerView *banerV = [[LCBannerView alloc] initWithFrame:CGRectMake(0, 64, self.view.bounds.size.width, 180) imageArray:@[@&quot;1&quot;,@&quot;2&quot;,@&quot;3&quot;,@&quot;4&quot;]];[self.view addSubview:banerV]; æºç 12345#import &lt;UIKit/UIKit.h&gt;@interface LCBannerView : UIView- (instancetype)initWithFrame:(CGRect)frame imageArray:(NSArray *)imageArray;@end 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141#import &quot;LCBannerView.h&quot;#define Width self.frame.size.width#define Height self.frame.size.height@interface LCBannerView ()@property (nonatomic, weak) UIImageView *imageV;@property (nonatomic, strong) NSArray *imagArr;@property (nonatomic, weak) UIPageControl *pageControl;@property (nonatomic, assign) NSInteger currentPage;@property (nonatomic, strong) NSTimer *timer;@end@implementation LCBannerView#pragma mark -lazy- (UIImageView *)imageV&#123; if (!_imageV) &#123; UIImageView *imageView = [[UIImageView alloc] initWithFrame:CGRectMake(0, 0, Width, Height)]; imageView.backgroundColor = [UIColor lightGrayColor]; imageView.userInteractionEnabled = YES; _imageV = imageView; [self addSubview:_imageV]; &#125; return _imageV;&#125;- (NSTimer *)timer&#123; if (!_timer) &#123; _timer = [NSTimer timerWithTimeInterval:3 target:self selector:@selector(swipFromRight) userInfo:nil repeats:YES]; [[NSRunLoop currentRunLoop] addTimer:_timer forMode:NSRunLoopCommonModes]; &#125; return _timer;&#125;- (UIPageControl *)pageControl&#123; if (!_pageControl) &#123; UIPageControl *pageControl = [[UIPageControl alloc] init]; pageControl.numberOfPages = self.imagArr.count; CGSize size = [pageControl sizeForNumberOfPages:self.imagArr.count]; pageControl.frame = CGRectMake(0, 0, size.width, size.height); pageControl.center = CGPointMake(self.center.x, Height-10); pageControl.currentPageIndicatorTintColor = [UIColor whiteColor]; pageControl.pageIndicatorTintColor = [UIColor grayColor]; _pageControl = pageControl; [self addSubview:_pageControl]; &#125; return _pageControl;&#125;#pragma mark -lifeCycle- (instancetype)initWithFrame:(CGRect)frame imageArray:(NSArray *)imageArray&#123; if (self = [super initWithFrame:frame]) &#123; self.currentPage = 0; self.imagArr = imageArray; self.imageV.image = [UIImage imageNamed:self.imagArr[self.currentPage]]; UISwipeGestureRecognizer *rightRe = [[UISwipeGestureRecognizer alloc] initWithTarget:self action:@selector(swipFromRight)]; [rightRe setDirection:UISwipeGestureRecognizerDirectionLeft]; UISwipeGestureRecognizer *leftRe = [[UISwipeGestureRecognizer alloc] initWithTarget:self action:@selector(swipFromLeft)]; [leftRe setDirection:UISwipeGestureRecognizerDirectionRight]; [self.imageV addGestureRecognizer:rightRe]; [self.imageV addGestureRecognizer:leftRe]; [self timer]; [self pageControl]; &#125; return self;&#125;- (void)swipFromRight&#123; self.currentPage++; if (self.currentPage &gt;= self.imagArr.count) self.currentPage = 0; self.pageControl.currentPage = self.currentPage; self.imageV.image = [UIImage imageNamed:self.imagArr[self.currentPage]]; CATransition *transition = [[CATransition alloc] init]; transition.type = @&quot;cube&quot;; transition.subtype = kCATransitionFromRight; transition.duration = 1.5; transition.delegate = self; [self.imageV.layer addAnimation:transition forKey:nil]; &#125;- (void)swipFromLeft&#123; self.currentPage--; if (self.currentPage &lt; 0) self.currentPage = self.imagArr.count -1; self.pageControl.currentPage = self.currentPage; self.imageV.image = [UIImage imageNamed:self.imagArr[self.currentPage]]; CATransition *transition2 = [[CATransition alloc] init]; transition2.type = @&quot;cube&quot;; transition2.subtype = kCATransitionFromLeft; transition2.duration = 1.5; transition2.delegate = self; [self.imageV.layer addAnimation:transition2 forKey:nil];&#125;#pragma mark -CAAnimationDelegate- (void)animationDidStart:(CAAnimation *)anim&#123; if (self.timer) &#123; [self.timer invalidate]; self.timer = nil; &#125; self.imageV.userInteractionEnabled = NO;&#125;- (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag&#123; if (self.timer) &#123; [self.timer invalidate]; self.timer = nil; [self timer]; &#125; self.imageV.userInteractionEnabled = YES;&#125;@end å¯ä»¥æä¾›æ›´å¤šçš„å±æ€§å’Œæ–¹å¼,ä¾‹å¦‚:åˆ©ç”¨KVCå¯ä»¥è®¾ç½®currentPageIndicatorTintColorä¸ºå›¾ç‰‡ç­‰. å¯ä»¥æä¾›ç½‘ç»œå›¾ç‰‡,å’Œç›‘å¬imageViewçš„ç‚¹å‡».å¯ä»¥å°†â€cubeâ€æ›¿æ¢æˆâ€fadeâ€æ•ˆæœç­‰ç­‰,æœ‰éœ€è¦çš„çœ‹å®˜å¯ä»¥è‡ªè¡Œå°è£….ä»£ç ä¸å¤š, demoå°±ä¸å‘äº†.","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"animation","slug":"animation","permalink":"https://github.com/icoderRo/tags/animation/"}]},{"title":"å°è£… tabBar","slug":"å°è£…tabBar","date":"2015-07-09T16:00:00.000Z","updated":"2017-08-17T14:54:03.000Z","comments":true,"path":"2015/07/10/å°è£…tabBar/","link":"","permalink":"https://github.com/icoderRo/2015/07/10/å°è£…tabBar/","excerpt":"è‡ªå®šä¹‰TabBarController123è‡ªå®šä¹‰ç»§æ‰¿äºUITabBarControlleråˆ©ç”¨KVC æ›¿æ¢ç³»ç»Ÿçš„tabBaråˆ©ç”¨appearance å…¨å±€ç»Ÿä¸€è®¾ç½®UITabBarItem 1[self setValue:[[LCTabBar alloc] init] forKeyPath:@\"tabBar\"]; 123456789NSMutableDictionary *normalAttrs = [NSMutableDictionary dictionary]; normalAttrs[NSForegroundColorAttributeName] = [UIColor grayColor]; normalAttrs[NSFontAttributeName] = [UIFont systemFontOfSize:12]; NSMutableDictionary *selectedAttrs = [NSMutableDictionary dictionary]; selectedAttrs[NSForegroundColorAttributeName] = [UIColor darkGrayColor]; UITabBarItem *item = [UITabBarItem appearance]; [item setTitleTextAttributes:normalAttrs forState:UIControlStateNormal]; [item setTitleTextAttributes:selectedAttrs forState:UIControlStateSelected];","text":"è‡ªå®šä¹‰TabBarController123è‡ªå®šä¹‰ç»§æ‰¿äºUITabBarControlleråˆ©ç”¨KVC æ›¿æ¢ç³»ç»Ÿçš„tabBaråˆ©ç”¨appearance å…¨å±€ç»Ÿä¸€è®¾ç½®UITabBarItem 1[self setValue:[[LCTabBar alloc] init] forKeyPath:@\"tabBar\"]; 123456789NSMutableDictionary *normalAttrs = [NSMutableDictionary dictionary]; normalAttrs[NSForegroundColorAttributeName] = [UIColor grayColor]; normalAttrs[NSFontAttributeName] = [UIFont systemFontOfSize:12]; NSMutableDictionary *selectedAttrs = [NSMutableDictionary dictionary]; selectedAttrs[NSForegroundColorAttributeName] = [UIColor darkGrayColor]; UITabBarItem *item = [UITabBarItem appearance]; [item setTitleTextAttributes:normalAttrs forState:UIControlStateNormal]; [item setTitleTextAttributes:selectedAttrs forState:UIControlStateSelected]; è‡ªå®šä¹‰tabBar123è‡ªå®šä¹‰ç»§æ‰¿äºUITabBaråˆå§‹åŒ–å¸ƒå±€ ä¸­é—´æœ‰çº¿æ¡çš„tabBar è§£å†³æ–¹æ¡ˆ: å¸ƒå±€å­æ§ä»¶åœ°æ–¹, å°†ä¸­é—´æŒ‰é’® bringSubviewToFront 123456789101112131415161718192021222324252627282930313233- (void)layoutSubviews&#123; [super layoutSubviews]; CGFloat width = self.width; CGFloat height = self.height; self.plusButton.center = CGPointMake(width * 0.5, height * 0.5); self.plusButton.y = -20; int index = 0; CGFloat tabBarButtonW = width / 5; CGFloat tabBarButtonH = height; CGFloat tabBarButtonY = 0; for (UIView *tabBarButton in self.subviews) &#123; if (![NSStringFromClass(tabBarButton.class) isEqualToString:@\"UITabBarButton\"]) continue; CGFloat tabBarButtonX = index * tabBarButtonW; if (index &gt;= 2) &#123; tabBarButtonX += tabBarButtonW; &#125; tabBarButton.frame = CGRectMake(tabBarButtonX, tabBarButtonY, tabBarButtonW, tabBarButtonH); index++; &#125; [self bringSubviewToFront:self.plusButton];&#125; ä¸­é—´æŒ‰é’® è¶…å‡ºtabBarçš„èŒƒå›´ä¸èƒ½å“åº”ç‚¹å‡»äº‹ä»¶ è§£å†³æ–¹æ¡ˆ: é‡å†™ç³»ç»Ÿçš„hitTestæ–¹æ³•, ä¸äº†è§£çš„çœ‹å®˜å¯ä»¥å»æŸ¥æŸ¥äº‹ä»¶ä¼ é€’å’Œå“åº”è€…é“¾æ¡ 1234567891011121314151617- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event &#123; if (self.isHidden == NO) &#123; // å½“å‰ç•Œé¢ tabBaræ˜¾ç¤º CGPoint newPoint = [self convertPoint:point toView:self.plusButton]; if ( [self.plusButton pointInside:newPoint withEvent:event]) &#123; // ç‚¹ å±äºæŒ‰é’®èŒƒå›´ return self.plusButton; &#125;else&#123; return [super hitTest:point withEvent:event]; &#125; &#125; else &#123; return [super hitTest:point withEvent:event]; &#125;&#125; å½“ç„¶ä¹Ÿå¯ä»¥å»é™¤tabBarä¸Šçš„çº¿æ¡ , è®¾ç½®ShadowImageå±æ€§, å¯¼èˆªæ åŒç†[self.tabBarController.tabBar setBackgroundImage:[UIImage new]];[self.tabBarController.tabBar setShadowImage:[UIImage new]];","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[]},{"title":"runloopç†è®º","slug":"runloopæµ…è¯´","date":"2015-05-04T16:00:00.000Z","updated":"2017-08-17T15:05:14.000Z","comments":true,"path":"2015/05/05/runloopæµ…è¯´/","link":"","permalink":"https://github.com/icoderRo/2015/05/05/runloopæµ…è¯´/","excerpt":"RunLoopåŸºæœ¬æ¦‚å¿µæ¦‚å¿µ:ç¨‹åºçš„è¿è¡Œå¾ªç¯,é€šä¿—çš„æ¥è¯´å°±æ˜¯è·‘åœˆ. åŸºæœ¬ä½œç”¨ï¼ˆä½œç”¨é‡å¤§ï¼‰ ä¿æŒç¨‹åºçš„æŒç»­è¿è¡Œ(iosç¨‹åºä¸ºä»€ä¹ˆèƒ½ä¸€ç›´æ´»ç€ä¸ä¼šæ­») å¤„ç†appä¸­çš„å„ç§äº‹ä»¶ï¼ˆæ¯”å¦‚è§¦æ‘¸äº‹ä»¶ã€å®šæ—¶å™¨äº‹ä»¶ã€NSTimerã€‘ã€selectoräº‹ä»¶ã€é€‰æ‹©å™¨Â·performSelectorÂ·Â·Â·ã€‘ï¼‰ èŠ‚çœCPUèµ„æºï¼Œæé«˜ç¨‹åºæ€§èƒ½ï¼Œæœ‰äº‹æƒ…å°±åšäº‹æƒ…ï¼Œæ²¡äº‹æƒ…å°±ä¼‘æ¯ é‡è¦è¯´æ˜ å¦‚æœæ²¡æœ‰Runloop,é‚£ä¹ˆç¨‹åºä¸€å¯åŠ¨å°±ä¼šé€€å‡ºï¼Œä»€ä¹ˆäº‹æƒ…éƒ½åšä¸äº†ã€‚ å¦‚æœæœ‰äº†Runloopï¼Œé‚£ä¹ˆç›¸å½“äºåœ¨å†…éƒ¨æœ‰ä¸€ä¸ªæ­»å¾ªç¯ï¼Œèƒ½å¤Ÿä¿è¯ç¨‹åºçš„æŒç»­è¿è¡Œ mainå‡½æ•°ä¸­çš„Runloop åœ¨UIApplicationå‡½æ•°å†…éƒ¨å°±å¯åŠ¨äº†ä¸€ä¸ªRunloop,è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªintç±»å‹çš„å€¼ è¿™ä¸ªé»˜è®¤å¯åŠ¨çš„Runloopæ˜¯è·Ÿä¸»çº¿ç¨‹ç›¸å…³è”çš„ Runloopå¯¹è±¡ åœ¨iOSå¼€å‘ä¸­æœ‰ä¸¤å¥—apiæ¥è®¿é—®Runloop ç¬¬ä¸€ç§:foundationæ¡†æ¶ã€NSRunloopã€‘ ç¬¬äºŒç§:core foundationæ¡†æ¶ã€CFRunloopRefã€‘ NSRunLoopå’ŒCFRunLoopReféƒ½ä»£è¡¨ç€RunLoopå¯¹è±¡,å®ƒä»¬æ˜¯ç­‰ä»·çš„ï¼Œå¯ä»¥äº’ç›¸è½¬æ¢ NSRunLoopæ˜¯åŸºäºCFRunLoopRefçš„ä¸€å±‚OCåŒ…è£…ï¼Œæ‰€ä»¥è¦äº†è§£RunLoopå†…éƒ¨ç»“æ„ï¼Œéœ€è¦å¤šç ”ç©¶CFRunLoopRefå±‚é¢çš„APIï¼ˆCore Foundationå±‚é¢ï¼‰ Runloopä¸çº¿ç¨‹ Runloopå’Œçº¿ç¨‹çš„å…³ç³»ï¼šä¸€ä¸ªRunloopå¯¹åº”ç€ä¸€æ¡å”¯ä¸€çš„çº¿ç¨‹ å¦‚ä½•è®©å­çº¿ç¨‹ä¸æ­» ç»™è¿™æ¡å­çº¿ç¨‹å¼€å¯ä¸€ä¸ªRunloop Runloopçš„åˆ›å»ºï¼šä¸»çº¿ç¨‹Runloopå·²ç»åˆ›å»ºå¥½äº†ï¼Œå­çº¿ç¨‹çš„runloopéœ€è¦æ‰‹åŠ¨åˆ›å»º Runloopçš„ç”Ÿå‘½å‘¨æœŸï¼šåœ¨ç¬¬ä¸€æ¬¡è·å–æ—¶åˆ›å»ºï¼Œåœ¨çº¿ç¨‹ç»“æŸæ—¶é”€æ¯ æ‹¿åˆ°å½“å‰åº”ç”¨ç¨‹åºçš„ä¸»Runloopï¼ˆä¸»çº¿ç¨‹å¯¹åº”çš„Runloopï¼‰ æ–¹æ³•ä¸€: NSRunloop NSRunLoop * runloop1 = [NSRunLoop mainRunLoop]; æ–¹æ³•äºŒ: CFRunLoopRef1CFRunLoopRef runloop2 = CFRunLoopGetMain(); æ³¨æ„ï¼šå¼€ä¸€ä¸ªå­çº¿ç¨‹åˆ›å»ºrunloop,ä¸æ˜¯é€šè¿‡alloc initæ–¹æ³•åˆ›å»ºï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡è°ƒç”¨currentRunLoopæ–¹æ³•æ¥åˆ›å»ºï¼Œå®ƒæœ¬èº«æ˜¯ä¸€ä¸ªæ‡’åŠ è½½çš„ã€‚","text":"RunLoopåŸºæœ¬æ¦‚å¿µæ¦‚å¿µ:ç¨‹åºçš„è¿è¡Œå¾ªç¯,é€šä¿—çš„æ¥è¯´å°±æ˜¯è·‘åœˆ. åŸºæœ¬ä½œç”¨ï¼ˆä½œç”¨é‡å¤§ï¼‰ ä¿æŒç¨‹åºçš„æŒç»­è¿è¡Œ(iosç¨‹åºä¸ºä»€ä¹ˆèƒ½ä¸€ç›´æ´»ç€ä¸ä¼šæ­») å¤„ç†appä¸­çš„å„ç§äº‹ä»¶ï¼ˆæ¯”å¦‚è§¦æ‘¸äº‹ä»¶ã€å®šæ—¶å™¨äº‹ä»¶ã€NSTimerã€‘ã€selectoräº‹ä»¶ã€é€‰æ‹©å™¨Â·performSelectorÂ·Â·Â·ã€‘ï¼‰ èŠ‚çœCPUèµ„æºï¼Œæé«˜ç¨‹åºæ€§èƒ½ï¼Œæœ‰äº‹æƒ…å°±åšäº‹æƒ…ï¼Œæ²¡äº‹æƒ…å°±ä¼‘æ¯ é‡è¦è¯´æ˜ å¦‚æœæ²¡æœ‰Runloop,é‚£ä¹ˆç¨‹åºä¸€å¯åŠ¨å°±ä¼šé€€å‡ºï¼Œä»€ä¹ˆäº‹æƒ…éƒ½åšä¸äº†ã€‚ å¦‚æœæœ‰äº†Runloopï¼Œé‚£ä¹ˆç›¸å½“äºåœ¨å†…éƒ¨æœ‰ä¸€ä¸ªæ­»å¾ªç¯ï¼Œèƒ½å¤Ÿä¿è¯ç¨‹åºçš„æŒç»­è¿è¡Œ mainå‡½æ•°ä¸­çš„Runloop åœ¨UIApplicationå‡½æ•°å†…éƒ¨å°±å¯åŠ¨äº†ä¸€ä¸ªRunloop,è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªintç±»å‹çš„å€¼ è¿™ä¸ªé»˜è®¤å¯åŠ¨çš„Runloopæ˜¯è·Ÿä¸»çº¿ç¨‹ç›¸å…³è”çš„ Runloopå¯¹è±¡ åœ¨iOSå¼€å‘ä¸­æœ‰ä¸¤å¥—apiæ¥è®¿é—®Runloop ç¬¬ä¸€ç§:foundationæ¡†æ¶ã€NSRunloopã€‘ ç¬¬äºŒç§:core foundationæ¡†æ¶ã€CFRunloopRefã€‘ NSRunLoopå’ŒCFRunLoopReféƒ½ä»£è¡¨ç€RunLoopå¯¹è±¡,å®ƒä»¬æ˜¯ç­‰ä»·çš„ï¼Œå¯ä»¥äº’ç›¸è½¬æ¢ NSRunLoopæ˜¯åŸºäºCFRunLoopRefçš„ä¸€å±‚OCåŒ…è£…ï¼Œæ‰€ä»¥è¦äº†è§£RunLoopå†…éƒ¨ç»“æ„ï¼Œéœ€è¦å¤šç ”ç©¶CFRunLoopRefå±‚é¢çš„APIï¼ˆCore Foundationå±‚é¢ï¼‰ Runloopä¸çº¿ç¨‹ Runloopå’Œçº¿ç¨‹çš„å…³ç³»ï¼šä¸€ä¸ªRunloopå¯¹åº”ç€ä¸€æ¡å”¯ä¸€çš„çº¿ç¨‹ å¦‚ä½•è®©å­çº¿ç¨‹ä¸æ­» ç»™è¿™æ¡å­çº¿ç¨‹å¼€å¯ä¸€ä¸ªRunloop Runloopçš„åˆ›å»ºï¼šä¸»çº¿ç¨‹Runloopå·²ç»åˆ›å»ºå¥½äº†ï¼Œå­çº¿ç¨‹çš„runloopéœ€è¦æ‰‹åŠ¨åˆ›å»º Runloopçš„ç”Ÿå‘½å‘¨æœŸï¼šåœ¨ç¬¬ä¸€æ¬¡è·å–æ—¶åˆ›å»ºï¼Œåœ¨çº¿ç¨‹ç»“æŸæ—¶é”€æ¯ æ‹¿åˆ°å½“å‰åº”ç”¨ç¨‹åºçš„ä¸»Runloopï¼ˆä¸»çº¿ç¨‹å¯¹åº”çš„Runloopï¼‰ æ–¹æ³•ä¸€: NSRunloop NSRunLoop * runloop1 = [NSRunLoop mainRunLoop]; æ–¹æ³•äºŒ: CFRunLoopRef1CFRunLoopRef runloop2 = CFRunLoopGetMain(); æ³¨æ„ï¼šå¼€ä¸€ä¸ªå­çº¿ç¨‹åˆ›å»ºrunloop,ä¸æ˜¯é€šè¿‡alloc initæ–¹æ³•åˆ›å»ºï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡è°ƒç”¨currentRunLoopæ–¹æ³•æ¥åˆ›å»ºï¼Œå®ƒæœ¬èº«æ˜¯ä¸€ä¸ªæ‡’åŠ è½½çš„ã€‚ Runloopè¿è¡ŒåŸç† è‹¹æœå®˜æ–¹çš„è¿è¡ŒåŸç†å›¾ Runloopå’Œç›¸å…³ç±»ä¹‹é—´çš„å…³ç³»å›¾ RunLoopäº”ä¸ªç›¸å…³çš„ç±» CFRunloopRef CFRunloopModeRefã€Runloopçš„è¿è¡Œæ¨¡å¼ã€‘ CFRunloopSourceRefã€Runloopè¦å¤„ç†çš„äº‹ä»¶æºã€‘ CFRunloopTimerRefã€Timeräº‹ä»¶ã€‘ CFRunloopObserverRefã€Runloopçš„è§‚å¯Ÿè€…ï¼ˆç›‘å¬è€…ï¼‰ã€‘ CFRunloopRef CFRunloopModeRefä»£è¡¨ç€Runloopçš„è¿è¡Œæ¨¡å¼ ä¸€ä¸ªRunloopä¸­å¯ä»¥æœ‰å¤šä¸ªmode,ä¸€ä¸ªmodeé‡Œé¢åˆå¯ä»¥æœ‰å¤šä¸ª source/observer/timerç­‰ç­‰ æ¯æ¬¡runloopå¯åŠ¨çš„æ—¶å€™ï¼Œåªèƒ½æŒ‡å®šä¸€ä¸ªmode,è¿™ä¸ªmodeè¢«ç§°ä¸ºè¯¥Runloopçš„å½“å‰mode å¦‚æœéœ€è¦åˆ‡æ¢mode,åªèƒ½å…ˆé€€å‡ºå½“å‰Runloop,å†é‡æ–°æŒ‡å®šä¸€ä¸ªmodeè¿›å…¥ è¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†åˆ†å‰²ä¸åŒç»„çš„å®šæ—¶å™¨ç­‰ï¼Œè®©ä»–ä»¬ç›¸äº’ä¹‹é—´ä¸å—å½±å“ ç³»ç»Ÿé»˜è®¤æ³¨å†Œäº†5ä¸ªmode ç¬¬ä¸€ç§æ¨¡å¼: kCFRunLoopDefaultModeï¼šAppçš„é»˜è®¤Modeï¼Œé€šå¸¸ä¸»çº¿ç¨‹æ˜¯åœ¨è¿™ä¸ªModeä¸‹è¿è¡Œ ç¬¬äºŒç§æ¨¡å¼: UITrackingRunLoopModeï¼šç•Œé¢è·Ÿè¸ª Modeï¼Œç”¨äº ScrollView è¿½è¸ªè§¦æ‘¸æ»‘åŠ¨ï¼Œä¿è¯ç•Œé¢æ»‘åŠ¨æ—¶ä¸å—å…¶ä»– Mode å½±å“ ç¬¬ä¸‰ç§æ¨¡å¼: UIInitializationRunLoopMode: åœ¨åˆšå¯åŠ¨ App æ—¶ç¬¬è¿›å…¥çš„ç¬¬ä¸€ä¸ª Modeï¼Œå¯åŠ¨å®Œæˆåå°±ä¸å†ä½¿ç”¨ ç¬¬å››ç§æ¨¡å¼: GSEventReceiveRunLoopMode: æ¥å—ç³»ç»Ÿäº‹ä»¶çš„å†…éƒ¨ Modeï¼Œé€šå¸¸ç”¨ä¸åˆ° ç¬¬äº”ç§æ¨¡å¼: kCFRunLoopCommonModes: è¿™æ˜¯ä¸€ä¸ªå ä½ç”¨çš„Modeï¼Œä¸æ˜¯ä¸€ç§çœŸæ­£çš„Mode CFRunloopTimerRef runloopä¸€å¯åŠ¨å°±ä¼šé€‰ä¸­ä¸€ç§æ¨¡å¼ï¼Œå½“é€‰ä¸­äº†ä¸€ç§æ¨¡å¼ä¹‹åå…¶å®ƒçš„æ¨¡å¼å°±ä¸ä¼šå‚ä¸ã€‚ä¸€ä¸ªmodeé‡Œé¢å¯ä»¥æ·»åŠ å¤šä¸ªNSTimer,ä¹Ÿå°±æ˜¯è¯´ä»¥åå½“åˆ›å»ºNSTimerçš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šå®ƒæ˜¯åœ¨ä»€ä¹ˆæ¨¡å¼ä¸‹è¿è¡Œçš„ã€‚ å®ƒæ˜¯åŸºäºæ—¶é—´çš„è§¦å‘å™¨ï¼Œè¯´ç›´ç™½ç‚¹é‚£å°±æ˜¯æ—¶é—´åˆ°äº†æˆ‘å°±è§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œè§¦å‘ä¸€ä¸ªæ“ä½œã€‚åŸºæœ¬ä¸Šè¯´çš„å°±æ˜¯NSTimer . NSTimer è°ƒç”¨äº†scheduledTimeræ–¹æ³•ï¼Œé‚£ä¹ˆä¼šè‡ªåŠ¨æ·»åŠ åˆ°å½“å‰çš„runloopé‡Œé¢å»ï¼Œå’Œrunloopçš„è¿è¡Œæ¨¡å¼kCFRunLoopDefaultModeæœ‰æ—¶å€™éœ€è¦ä¿®æ”¹æ¨¡å¼,è¾¾åˆ°ç±»ä¼¼åœ¨åå°æŒç»­è¿è¡Œçš„æ•ˆæœ,ä¸å—å¤–ç•Œçš„å½±å“ 12NSTimer *timer = [NSTimer scheduledTimerWithTimeInterval:2.0 target:self selector:@selector(run) userInfo:nil repeats:YES];[[NSRunLoop currentRunLoop] addTimer:timer forMode:NSRunLoopCommonModes]; CFRunloopSourceRef äº‹ä»¶æºä¹Ÿå°±æ˜¯è¾“å…¥æºï¼Œæœ‰ä¸¤ç§åˆ†ç±»æ¨¡å¼ï¼› ä¸€ç§æ˜¯æŒ‰ç…§è‹¹æœå®˜æ–¹æ–‡æ¡£è¿›è¡Œåˆ’åˆ†çš„ å¦ä¸€ç§æ˜¯åŸºäºå‡½æ•°çš„è°ƒç”¨æ ˆæ¥è¿›è¡Œåˆ’åˆ†çš„ï¼ˆsource0å’Œsource1ï¼‰ã€‚ è‹¹æœå®˜æ–¹æ–‡æ¡£ Port-Based Sources Custom Input Sources Cocoa Perform Selector Sources å‡½æ•°çš„è°ƒç”¨æ ˆ Source0ï¼šéåŸºäºPortçš„ Source1ï¼šåŸºäºPortçš„ CFRunLoopObserverRef CFRunLoopObserverRefæ˜¯è§‚å¯Ÿè€…ï¼Œèƒ½å¤Ÿç›‘å¬RunLoopçš„çŠ¶æ€æ”¹å˜ 12345//åˆ›å»ºä¸€ä¸ªrunloopç›‘å¬è€… CFRunLoopObserverRef observer = CFRunLoopObserverCreateWithHandler(CFAllocatorGetDefault(),kCFRunLoopAllActivities, YES, 0, ^(CFRunLoopObserverRef observer, CFRunLoopActivity activity) &#123; NSLog(@â€ç›‘å¬runloopçŠ¶æ€æ”¹å˜â€”%zdâ€,activity); &#125;); //ä¸ºrunloopæ·»åŠ ä¸€ä¸ªç›‘å¬è€… CFRunLoopAddObserver(CFRunLoopGetCurrent(), observer, kCFRunLoopDefaultMode); CFRelease(observer); ç›‘å¬çš„çŠ¶æ€ 12345678typedef CF_OPTIONS(CFOptionFlags, CFRunLoopActivity) &#123; kCFRunLoopEntry = (1UL &lt;&lt; 0), //å³å°†è¿›å…¥Runloop kCFRunLoopBeforeTimers = (1UL &lt;&lt; 1), //å³å°†å¤„ç†NSTimer kCFRunLoopBeforeSources = (1UL &lt;&lt; 2), //å³å°†å¤„ç†Sources kCFRunLoopBeforeWaiting = (1UL &lt;&lt; 5), //å³å°†è¿›å…¥ä¼‘çœ  kCFRunLoopAfterWaiting = (1UL &lt;&lt; 6), //åˆšä»ä¼‘çœ ä¸­å”¤é†’ kCFRunLoopExit = (1UL &lt;&lt; 7), //å³å°†é€€å‡ºrunloop kCFRunLoopAllActivities = 0x0FFFFFFFU //æ‰€æœ‰çŠ¶æ€æ”¹å˜ &#125;; RunLoopè¿è¡Œé€»è¾‘ ä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªrunLoop,ä¸»çº¿ç¨‹çš„runloopæ˜¯ç¨‹åºä¸€å¯åŠ¨,é»˜è®¤å°±åˆ›å»ºä¸€ä¸ªrunloop,åˆ›å»ºå¥½äº†ä¹‹åå°±ä¼šç»™å®ƒæ·»åŠ ä¸€äº›é»˜è®¤çš„æ¨¡å¼,æ¯ä¸ªæ¨¡å¼é‡Œé¢ä¼šæœ‰å¾ˆå¤šçš„ source /timer/observer ,æ·»åŠ å¥½è¿™äº›æ¨¡å¼å,observerå°±ä¼šç›‘å¬ä¸»çº¿ç¨‹çš„runloop,è¿›å…¥runloopå,å°±å¼€å§‹å¤„ç†äº‹ä»¶,å…ˆå¤„ç†timer,å†å¤„ç†source0,source0å¤„ç†å®Œä¹‹åå†å¤„ç†source1,å½“æŠŠè¿™äº›æ‰€æœ‰çš„äº‹ä»¶åå¤çš„å¤„ç†å®Œä¹‹å,å¦‚æœæ²¡æœ‰äº‹ä»¶äº†,é‚£ä¹ˆrunloopå°±ä¼šè¿›å…¥ç¡çœ çŠ¶æ€,å½“ç”¨æˆ·åˆè§¦å‘äº†æ–°çš„äº‹ä»¶,å°±ä¼šå”¤é†’runloop,å”¤é†’runloopåå›åˆ°ç¬¬äºŒæ­¥,é‡æ–°å¤„ç†æ–°çš„timer,æ–°çš„source0,æ–°çš„source1,å¤„ç†å®Œåå°±ç¡çœ ,ä¸€ç›´åå¤,å½“æˆ‘ä»¬æŠŠç¨‹åºå…³é—­æˆ–è€…å¼ºé€€,è¿™ä¸ªæ—¶å€™observerå°±ä¼šç›‘å¬éƒ½runloopé€€å‡ºäº†. observeræ˜¯ç›‘å¬runloopçš„çŠ¶æ€. timer / source/CFRunLoopRefåˆ›å»ºä¸€ä¸ªtimerå¿…é¡»æ·»åŠ åˆ°runloop æ‰ä¼šæ‰§è¡Œ,æ·»åŠ çš„æ—¶å€™è¦æŒ‡å®šæ¨¡å¼ defaultæ¨¡å¼ ,ä¸å¯¹ç¨‹åºåšä»»ä½•æ“ä½œ timerå°±ä¼šåå°è¿è¡Œ ,å½“æˆ‘è¿›è¡Œæ“ä½œçš„æ—¶å€™runloopæ¨¡å¼å°±ä¼šä»é»˜è®¤æ¨¡å¼åˆ‡æ¢åˆ°å…¶ä»–æ¨¡å¼,å‡å¦‚è¯´æˆ‘æ“ä½œscrollerView å®ƒå°±ä¼šä»defaultæ¨¡å¼åˆ‡æ¢åˆ°trackingæ¨¡å¼è€Œroonloop åŒä¸€æ—¶åˆ»åªèƒ½æ‰§è¡Œä¸€ç§æ¨¡å¼.å½“åœ¨åˆ›å»ºtimeræ—¶æŒ‡å®š Comment ä»…ä»…æ˜¯ä¸ªæ ‡è®°,é»˜è®¤å’Œè¿½è¸ª,é‚£ä¹ˆtimerå°±ä¼šéšç€è§¦å‘çš„æ¨¡å¼ä¸åŒè¿›è¡Œ é»˜è®¤å’Œè¿½è¸ªæ¨¡å¼çš„é€‰æ‹© Sourcesourceä¸€èˆ¬æ˜¯ä¸ä¼šå»æ“ä½œçš„,ç¬¬ä¸€ç§æ˜¯åŸºäºè‡ªå®šä¹‰çš„,ç¬¬äºŒç§æ˜¯åŸºäºç«¯å£çš„,ç¬¬ä¸‰ç§æ˜¯åŸºäºPerformselectçš„é€šè¿‡å‡½æ•°è°ƒç”¨æ ˆæ¥å¯¹sourceåˆ†ç±»:åˆ†ä¸ºsource0 source1 :(1)source0æ˜¯éåŸºäºç«¯å£çš„,æ˜¯ç”¨æˆ·è‡ªå·±æ‰‹åŠ¨è§¦å‘çš„æ“ä½œ,æ¯”å¦‚è§¦æ‘¸æ»‘åŠ¨ç­‰æ“ä½œ.(2)Source1æ˜¯ç³»ç»Ÿå†…éƒ¨çš„ä¸€äº›ç«¯å£è§¦å‘çš„äº‹ä»¶(3)å­çº¿ç¨‹çš„runloopéœ€è¦æ‰‹åŠ¨åˆ›å»º,éœ€è¦æ‰‹åŠ¨å¼€å¯ è‡ªåŠ¨é‡Šæ”¾æ± ç¬¬ä¸€æ¬¡åˆ›å»º:æ˜¯åœ¨runloopè¿›å…¥çš„æ—¶å€™åˆ›å»º å¯¹åº”çš„çŠ¶æ€ = KCFRunLoopEntryæœ€åä¸€ä¸ªé€€å‡º,æ˜¯åœ¨runloopé€€å‡ºçš„æ—¶å€™ å¯¹åº”çš„çŠ¶æ€ = KCFRunLoopExit å…¶ä»–çš„åˆ›å»ºå’Œé‡Šæ”¾å³å°†è¿›å…¥ç¡çœ çš„æ—¶å€™,å…ˆé‡Šæ”¾ä¸Šä¸€æ¬¡åˆ›å»ºçš„è‡ªåŠ¨é‡Šæ”¾æ± ,ç„¶åå†åˆ›å»ºä¸€ä¸ªæ–°çš„é‡Šæ”¾æ± ","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"runloop","slug":"runloop","permalink":"https://github.com/icoderRo/tags/runloop/"}]},{"title":"è½¬åœºåŠ¨ç”» - UIPresentationController","slug":"è½¬åœºåŠ¨ç”»1","date":"2015-03-19T16:00:00.000Z","updated":"2017-08-17T14:55:51.000Z","comments":true,"path":"2015/03/20/è½¬åœºåŠ¨ç”»1/","link":"","permalink":"https://github.com/icoderRo/2015/03/20/è½¬åœºåŠ¨ç”»1/","excerpt":"ç®€ä»‹ä¸€äº›è®¾è®¡è‰¯å¥½çš„è½¬åœºåŠ¨ç”», ä¸ä»…ä»…èƒ½èµ·åˆ°ç‚«é…·ç¾è§‚çš„ä½œç”¨è¿˜èƒ½æå¤§çš„å¼•å¯¼ç”¨æˆ·.åœ¨iOS8ä¸­, è‹¹æœç»™æˆ‘ä»¬å¸¦æ¥äº†ä¸€ä¸ªæ–°çš„ç±»UIPresentationController, é‡Œé¢çš„ä»£ç ä¸å¤š, æä¾›äº†4ä¸ªæ–¹æ³•å‚ä¸è½¬åœº, ä»è€Œå®ç°å¯¹è½¬åœºè¿‡ç¨‹çš„ç»†è‡´æ§åˆ¶: 1234567891011//åœ¨prsentè½¬åœºå³å°†å¼€å§‹çš„æ—¶å€™è¢«è°ƒç”¨çš„- (void)presentationTransitionWillBegin;//åœ¨prsentè½¬åœºç»“æŸæ—¶è¢«è°ƒç”¨çš„- (void)presentationTransitionDidEnd:(BOOL)completed;//åœ¨dismissè½¬åœºå³å°†å¼€å§‹çš„æ—¶å€™è¢«è°ƒç”¨çš„- (void)dismissalTransitionWillBegin;//åœ¨dismissè½¬åœºç»“æŸæ—¶è¢«è°ƒç”¨çš„- (void)dismissalTransitionDidEnd:(BOOL)completed; ç®€è¿°åè®®UIViewControllerTransitioningDelegateè‡ªå®šä¹‰è½¬åœºçš„ç¬¬ä¸€æ­¥ä¾¿æ˜¯æä¾›è½¬åœºä»£ç†,å‘Šè¯‰ç³»ç»Ÿä½¿ç”¨æˆ‘ä»¬æä¾›çš„ä»£ç†è€Œä¸æ˜¯ç³»ç»Ÿçš„é»˜è®¤ä»£ç†æ¥æ‰§è¡Œè½¬åœº.æš‚æ—¶ä¸ä½¿ç”¨æ‰‹åŠ¿ç›¸å…³çš„æ“ä½œ.ç®—ä¸‹æ¥,å°±åªæœ‰ä¸‰ä¸ªæ–¹æ³•äº†. presentationControllerForPresentedViewController:.. æ­¤æ–¹æ³•æä¾›ä¸€ä¸ªUIPresentationController, è¿™ä¸ªæ§åˆ¶å™¨æˆ‘ä»¬å¯ä»¥å‚è€ƒUIPopoverPresentationControllerçš„æ–¹å¼, è‡ªå®šä¹‰ä¸€ä¸ªç»§æ‰¿äºUIPresentationControllerçš„æ§åˆ¶å™¨. animationControllerForPresentedController: æä¾›åœ¨presentingæ—¶å€™çš„è½¬åœºåŠ¨ç”» animationControllerForDismissedController: æä¾›åœ¨dismissæ—¶å€™çš„è½¬åœºåŠ¨ç”»","text":"ç®€ä»‹ä¸€äº›è®¾è®¡è‰¯å¥½çš„è½¬åœºåŠ¨ç”», ä¸ä»…ä»…èƒ½èµ·åˆ°ç‚«é…·ç¾è§‚çš„ä½œç”¨è¿˜èƒ½æå¤§çš„å¼•å¯¼ç”¨æˆ·.åœ¨iOS8ä¸­, è‹¹æœç»™æˆ‘ä»¬å¸¦æ¥äº†ä¸€ä¸ªæ–°çš„ç±»UIPresentationController, é‡Œé¢çš„ä»£ç ä¸å¤š, æä¾›äº†4ä¸ªæ–¹æ³•å‚ä¸è½¬åœº, ä»è€Œå®ç°å¯¹è½¬åœºè¿‡ç¨‹çš„ç»†è‡´æ§åˆ¶: 1234567891011//åœ¨prsentè½¬åœºå³å°†å¼€å§‹çš„æ—¶å€™è¢«è°ƒç”¨çš„- (void)presentationTransitionWillBegin;//åœ¨prsentè½¬åœºç»“æŸæ—¶è¢«è°ƒç”¨çš„- (void)presentationTransitionDidEnd:(BOOL)completed;//åœ¨dismissè½¬åœºå³å°†å¼€å§‹çš„æ—¶å€™è¢«è°ƒç”¨çš„- (void)dismissalTransitionWillBegin;//åœ¨dismissè½¬åœºç»“æŸæ—¶è¢«è°ƒç”¨çš„- (void)dismissalTransitionDidEnd:(BOOL)completed; ç®€è¿°åè®®UIViewControllerTransitioningDelegateè‡ªå®šä¹‰è½¬åœºçš„ç¬¬ä¸€æ­¥ä¾¿æ˜¯æä¾›è½¬åœºä»£ç†,å‘Šè¯‰ç³»ç»Ÿä½¿ç”¨æˆ‘ä»¬æä¾›çš„ä»£ç†è€Œä¸æ˜¯ç³»ç»Ÿçš„é»˜è®¤ä»£ç†æ¥æ‰§è¡Œè½¬åœº.æš‚æ—¶ä¸ä½¿ç”¨æ‰‹åŠ¿ç›¸å…³çš„æ“ä½œ.ç®—ä¸‹æ¥,å°±åªæœ‰ä¸‰ä¸ªæ–¹æ³•äº†. presentationControllerForPresentedViewController:.. æ­¤æ–¹æ³•æä¾›ä¸€ä¸ªUIPresentationController, è¿™ä¸ªæ§åˆ¶å™¨æˆ‘ä»¬å¯ä»¥å‚è€ƒUIPopoverPresentationControllerçš„æ–¹å¼, è‡ªå®šä¹‰ä¸€ä¸ªç»§æ‰¿äºUIPresentationControllerçš„æ§åˆ¶å™¨. animationControllerForPresentedController: æä¾›åœ¨presentingæ—¶å€™çš„è½¬åœºåŠ¨ç”» animationControllerForDismissedController: æä¾›åœ¨dismissæ—¶å€™çš„è½¬åœºåŠ¨ç”» UIViewControllerAnimatedTransitioningä¸¤ä¸ªå¿…é¡»å®ç°çš„æ–¹æ³•, å’Œä¸€ä¸ªå¯é€‰æ–¹æ³• transitionDuration: è½¬åœºåŠ¨ç”»æ—¶é—´ animateTransition: è½¬åœºæ—¶, ç›¸å¯¹åº”çš„viewåšä½•å˜åŒ–. animationEnded: åŠ¨ç”»ç»“æŸæ—¶, è°ƒç”¨ UIViewControllerContextTransitioningæä¾›è½¬åœºä¸­éœ€è¦çš„æ•°æ®,éµå®ˆåè®®,\b å¯ä»¥è·å–presentedViewå’ŒpresentingView, containerViewç­‰ç­‰ã€‚ å‡ ä¸ªå¸¸ç”¨çš„å±æ€§ viewControllerForKey: å’Œ viewForKey: è·å–ç›¸åº”çš„æ§åˆ¶å™¨å’Œview finalFrameForViewController: å’Œ initialFrameForViewController: è·å–å¯¹åº”è§†å›¾çš„frame transitionDuration: è·å–è½¬åœºåŠ¨ç”»æ—¶é—´ UIViewControllerTransitionCoordinatoråœ¨è½¬åœºåŠ¨ç”»å‘ç”Ÿçš„æ—¶,å¹¶è¡Œæ‰§è¡Œå…¶ä»–è‡ªå®šä¹‰çš„åŠ¨ç”»,èµ·åˆ°åè°ƒå’Œè¾…åŠ©çš„ä½œç”¨,ä¸»è¦åœ¨ Modal è½¬åœºå’Œäº¤äº’è½¬åœºå–æ¶ˆæ—¶ä½¿ç”¨,éµå®ˆåè®®. animateAlongsideTransition:completion: ä¸åŠ¨ç”»æ§åˆ¶å™¨ä¸­çš„è½¬åœºåŠ¨ç”»åŒæ­¥ï¼Œæ‰§è¡Œå…¶ä»–åŠ¨ç”» animateAlongsideTransitionInView:animation:completion: ä¸åŠ¨ç”»æ§åˆ¶å™¨ä¸­çš„è½¬åœºåŠ¨ç”»åŒæ­¥ï¼Œåœ¨æŒ‡å®šçš„è§†å›¾å†…æ‰§è¡ŒåŠ¨ç”» demoæ¼”ç¤ºåˆ›å»ºfromVCå’ŒtoVCtoVCéœ€è¦è®¾ç½®modalPresentationStyleä¸ºè‡ªå®šä¹‰æ¨¡å¼UIModalPresentationCustom,ä¸ºä»£ç†UIViewControllerTransitioningDelegate, å®ç°ä»£ç†ä¸­çš„æ–¹æ³•: 12345678910111213141516#pragma mark - UIViewControllerTransitioningDelegate- (UIPresentationController *)presentationControllerForPresentedViewController:(UIViewController *)presented presentingViewController:(UIViewController *)presenting sourceViewController:(UIViewController *)source&#123; return [[LCPresentationController alloc] initWithPresentedViewController:presented presentingViewController:presenting];&#125;- (id&lt;UIViewControllerAnimatedTransitioning&gt;)animationControllerForPresentedController:(UIViewController *)presented presentingController:(UIViewController *)presenting sourceController:(UIViewController *)source&#123; return [LCPresentAnimation new];&#125;- (id&lt;UIViewControllerAnimatedTransitioning&gt;)animationControllerForDismissedController:(UIViewController *)dismissed&#123; return [LCDismissAnimation new];&#125; æ ¹æ®ä»£ç†æ–¹æ³•ä¸­çš„æç¤º, åˆ›å»ºå¯¹åº”çš„æ§åˆ¶å™¨. åˆ›å»ºUIPresentationControllerå¯ä»¥å‚è€ƒUIPopoverPresentationControllerçš„æ–¹å¼, è‡ªå®šä¹‰ä¸€ä¸ªç»§æ‰¿äºUIPresentationControllerçš„æ§åˆ¶å™¨.å¹¶å®ç°å¯¹åº”çš„æ–¹æ³•: presentè½¬åœºå³å°†å¼€å§‹è½¬åœºå³å°†å¼€å§‹çš„æ—¶å€™, æˆ‘ä»¬ç»™containerViewæ·»åŠ ä¸€ä¸ªèƒŒæ™¯å›¾.å¹¶è®¾ç½®é€æ˜åº¦ä¸º0;åˆ©ç”¨animateAlongsideTransition:completion:å¹¶è¡Œå¤„ç† 12345678910- (void)presentationTransitionWillBegin&#123; self.bgView.alpha = 0.0; self.transitionCoordinator = self.presentingViewController.transitionCoordinator; [self.transitionCoordinator animateAlongsideTransition:^(id&lt;UIViewControllerTransitionCoordinatorContext&gt; context) &#123; self.bgView.alpha = 0.7; self.presentingViewController.view.transform = CGAffineTransformScale(self.presentingViewController.view.transform, 0.9, 0.9); self.presentingViewController.view.layer.cornerRadius = 8.0; &#125; completion:nil];&#125; prsentè½¬åœºç»“æŸ è½¬åœºåœæ­¢çš„æ—¶å€™,å¦‚æœæœªå®Œæˆè½¬åœº, åˆ™å°†èƒŒæ™¯è§†å›¾ä»çˆ¶æ§ä»¶ç§»é™¤ 123456- (void)presentationTransitionDidEnd:(BOOL)completed&#123; if (!completed) &#123; [self.bgView removeFromSuperview]; &#125;&#125; dismissè½¬åœºå³å°†å¼€å§‹åŒç†åˆ©ç”¨animateAlongsideTransition:completion:å¹¶è¡Œå¤„ç†, å°†è§†å›¾å¤åŸ 123456789- (void)dismissalTransitionWillBegin&#123; self.transitionCoordinator = self.presentingViewController.transitionCoordinator; [self.transitionCoordinator animateAlongsideTransition:^(id&lt;UIViewControllerTransitionCoordinatorContext&gt; context) &#123; self.bgView.alpha = 0; self.presentingViewController.view.transform = CGAffineTransformIdentity; self.presentingViewController.view.layer.cornerRadius = 1.0; &#125; completion:nil];&#125; dismissè½¬åœºç»“æŸå¦‚æœdismissè½¬åœºæˆåŠŸ, åˆ™å°†èƒŒæ™¯è§†å›¾ç§»é™¤. 123456- (void)dismissalTransitionDidEnd:(BOOL)completed&#123; if (completed) &#123; [self.bgView removeFromSuperview]; &#125;&#125; frameOfPresentedViewInContainerView è¿”å›presentedViewçš„frame åˆ›å»ºpresetAnimationåˆ›å»ºä¸€ä¸ªç±», éµå®ˆUIViewControllerAnimatedTransitioning, å®ç°æ–¹æ³•å³å¯ 12345678910111213141516171819202122232425262728- (NSTimeInterval)transitionDuration:(id&lt;UIViewControllerContextTransitioning&gt;)transitionContext&#123; return 0.7f;&#125;- (void)animateTransition:(id&lt;UIViewControllerContextTransitioning&gt;)transitionContext&#123; UIViewController *toVC = [transitionContext viewControllerForKey:UITransitionContextToViewControllerKey]; UIView *toView = [transitionContext viewForKey:UITransitionContextToViewKey]; CGRect finalFrame = [transitionContext finalFrameForViewController:toVC]; toView.frame = CGRectOffset(finalFrame, 0, finalFrame.size.height); UIView *containerView = [transitionContext containerView]; [containerView addSubview:toVC.view]; NSTimeInterval duration = [self transitionDuration:transitionContext]; [UIView animateWithDuration:duration delay:0.0f usingSpringWithDamping:0.7f initialSpringVelocity:0.0 options:UIViewAnimationOptionCurveLinear animations:^&#123; toView.frame = finalFrame; &#125; completion:^(BOOL finished) &#123; if (finished) &#123; [transitionContext completeTransition:![transitionContext transitionWasCancelled]]; &#125; &#125;];&#125; ä¸å¤–ä¹å°±æ˜¯, è·å–æ§åˆ¶å™¨å’Œè§†å›¾, åˆå§‹åŒ–frame,æ‰§è¡ŒåŠ¨ç”»ä¿®æ”¹frame; åˆ›å»ºdismissAnimationåŒç†åˆ›å»ºä¸€ä¸ªç±», éµå®ˆUIViewControllerAnimatedTransitioning, å®ç°æ–¹æ³• 12345678910111213141516171819202122- (NSTimeInterval)transitionDuration:(id &lt;UIViewControllerContextTransitioning&gt;)transitionContext&#123; return 0.3f;&#125;- (void)animateTransition:(id &lt;UIViewControllerContextTransitioning&gt;)transitionContext&#123; UIViewController *fromVC = [transitionContext viewControllerForKey:UITransitionContextFromViewControllerKey]; CGRect initFrame = [transitionContext initialFrameForViewController:fromVC]; CGRect finalFrame = CGRectOffset(initFrame, 0, initFrame.size.height); [UIView animateWithDuration:[self transitionDuration:transitionContext] delay:0 options:UIViewAnimationOptionCurveLinear animations:^&#123; fromVC.view.frame = finalFrame; &#125; completion:^(BOOL finished) &#123; if (finished) &#123; [transitionContext completeTransition:![transitionContext transitionWasCancelled]]; &#125; &#125;];&#125; å‘ç‚¹: åœ¨modalæ¨¡å¼ä¸‹, containerViewä¸éœ€è¦addSubview:, å¦‚æœaddäº†, ä¼šå‡ºç°é»‘å±. æ•ˆæœå›¾ æ¯”è¾ƒç®€å•, éœ€è¦demoçš„å¯ä»¥åŠ QQç¾¤: 475814382","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"animation","slug":"animation","permalink":"https://github.com/icoderRo/tags/animation/"}]},{"title":"propertyå±æ€§","slug":"propertyå‚æ•°","date":"2014-05-12T16:00:00.000Z","updated":"2017-08-17T14:56:31.000Z","comments":true,"path":"2014/05/13/propertyå‚æ•°/","link":"","permalink":"https://github.com/icoderRo/2014/05/13/propertyå‚æ•°/","excerpt":"@propertyæ•…äº‹Objective-Cç‰¹æœ‰çš„ä¸€ä¸ªå…³é”®å­—@Propertyï¼Œå®ƒå±äºç¼–è¯‘å™¨ä¸€ä¸ªç‰¹æ€§ï¼Œç¼–è¯‘å™¨ç¼–è¯‘@propertyæ—¶ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆæˆå‘˜å˜é‡çš„setå’Œgetæ–¹æ³•. Xcode4.5ä¹‹å‰ï¼Œ@propertyä¼šå°†å…¶è½¬æ¢ä¸ºæˆå‘˜å˜é‡setã€getæ–¹æ³•çš„å£°æ˜ï¼Œ@synthesizeä¼šå®ç°æˆå‘˜å˜é‡çš„setã€getæ–¹æ³•ï¼Œæ‰€ä»¥XCode4.5ä¹‹å‰ï¼Œ@propertyä¸@synthesizeæ˜¯é…å¯¹ä½¿ç”¨ã€‚ åœ¨Xcode4.5ä»¥åï¼Œ@propertyå…³é”®å­—ï¼Œå°†è‡ªåŠ¨ç”Ÿæˆæˆå‘˜å˜é‡çš„å£°æ˜ã€ç›¸åº”setã€getæ–¹æ³•çš„å£°æ˜ä¸å®ç°ã€‚ @propertyç”¨æ³•æˆ‘ä»¬å‡è®¾åˆ›å»ºä¸€ä¸ªäººç±»Person, åœ¨ä¸ä½¿ç”¨@propertyå…³é”®å­—çš„æƒ…å†µä¸‹, çœ‹çœ‹æ˜¯å¦‚ä½•ä¹¦å†™çš„. 123456789101112131415161718192021@interface Person : NSObject &#123; NSString *_name; &#125; - (void) setName:(NSString *)name; - (NSString *) name; @end @implementation Person -(void)setName:(NSString *)name &#123; _name = name; &#125; -(NSString *)name &#123; return _name; &#125; @end @propertyå…³é”®å­—,åœ¨Xcode4.5ä¹‹å‰çš„å†™æ³•: 1234567891011@interface Person :NSObject @property NSString *name; @end @implementation Person @synthesize name = _name; @end @synthesize name = _name, å¦‚æœçœç•¥, ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¸®ä½ åŠ ä¸Šgetter å’Œ setter æ–¹æ³•çš„å®ç°ï¼Œå¹¶ä¸”é»˜è®¤ä¼šå»è®¿é—®_nameè¿™ä¸ªæˆå‘˜å˜é‡ï¼Œå¦‚æœæ‰¾ä¸åˆ°_nameè¿™ä¸ªæˆå‘˜å˜é‡ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå«åš _nameçš„ç§æœ‰æˆå‘˜å˜é‡ï¼ˆå…¶ä»–ç±»ä¸å¯è®¿é—®ï¼ˆåŒ…æ‹¬å­ç±»ï¼‰ï¼‰ã€‚","text":"@propertyæ•…äº‹Objective-Cç‰¹æœ‰çš„ä¸€ä¸ªå…³é”®å­—@Propertyï¼Œå®ƒå±äºç¼–è¯‘å™¨ä¸€ä¸ªç‰¹æ€§ï¼Œç¼–è¯‘å™¨ç¼–è¯‘@propertyæ—¶ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆæˆå‘˜å˜é‡çš„setå’Œgetæ–¹æ³•. Xcode4.5ä¹‹å‰ï¼Œ@propertyä¼šå°†å…¶è½¬æ¢ä¸ºæˆå‘˜å˜é‡setã€getæ–¹æ³•çš„å£°æ˜ï¼Œ@synthesizeä¼šå®ç°æˆå‘˜å˜é‡çš„setã€getæ–¹æ³•ï¼Œæ‰€ä»¥XCode4.5ä¹‹å‰ï¼Œ@propertyä¸@synthesizeæ˜¯é…å¯¹ä½¿ç”¨ã€‚ åœ¨Xcode4.5ä»¥åï¼Œ@propertyå…³é”®å­—ï¼Œå°†è‡ªåŠ¨ç”Ÿæˆæˆå‘˜å˜é‡çš„å£°æ˜ã€ç›¸åº”setã€getæ–¹æ³•çš„å£°æ˜ä¸å®ç°ã€‚ @propertyç”¨æ³•æˆ‘ä»¬å‡è®¾åˆ›å»ºä¸€ä¸ªäººç±»Person, åœ¨ä¸ä½¿ç”¨@propertyå…³é”®å­—çš„æƒ…å†µä¸‹, çœ‹çœ‹æ˜¯å¦‚ä½•ä¹¦å†™çš„. 123456789101112131415161718192021@interface Person : NSObject &#123; NSString *_name; &#125; - (void) setName:(NSString *)name; - (NSString *) name; @end @implementation Person -(void)setName:(NSString *)name &#123; _name = name; &#125; -(NSString *)name &#123; return _name; &#125; @end @propertyå…³é”®å­—,åœ¨Xcode4.5ä¹‹å‰çš„å†™æ³•: 1234567891011@interface Person :NSObject @property NSString *name; @end @implementation Person @synthesize name = _name; @end @synthesize name = _name, å¦‚æœçœç•¥, ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¸®ä½ åŠ ä¸Šgetter å’Œ setter æ–¹æ³•çš„å®ç°ï¼Œå¹¶ä¸”é»˜è®¤ä¼šå»è®¿é—®_nameè¿™ä¸ªæˆå‘˜å˜é‡ï¼Œå¦‚æœæ‰¾ä¸åˆ°_nameè¿™ä¸ªæˆå‘˜å˜é‡ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå«åš _nameçš„ç§æœ‰æˆå‘˜å˜é‡ï¼ˆå…¶ä»–ç±»ä¸å¯è®¿é—®ï¼ˆåŒ…æ‹¬å­ç±»ï¼‰ï¼‰ã€‚12345678910111213141516171819 @property NSString *name;ä»£è¡¨ç”Ÿæˆäº†_nameæˆå‘˜å˜é‡å’Œset/getæ–¹æ³•çš„å£°æ˜ç­‰ä»·äºä¸‹é¢çš„ä»£ç ; &#123; NSString *_name; &#125; - (void) setName:(NSString *)name; - (NSString *) name; @synthesize name = _name;åˆ™ç­‰ä»·äºå®ç°äº†set/getæ–¹æ³•, ç­‰ä»·äºä¸‹é¢çš„ä»£ç ; -(void)setName:(NSString *)name &#123; _name = name; &#125; -(NSString *)name &#123; return _name; &#125; - @propertyå…³é”®å­—,åœ¨Xcode4.5ä¹‹åçš„å†™æ³•: 123456789@interface Person : NSObject @property NSString *name; @end @implementation Person @end çœç•¥@synthesize, ç³»ç»Ÿè‡ªåŠ¨ä¼šå¸®æˆ‘ä»¬ç”Ÿæˆ_nameçš„setterå’Œgetteræ–¹æ³• @propertyå‚æ•° ç¬¬ä¸€ç»„ï¼šretain assign copy strong weak unsafe_unretained autoreleasing ç¬¬äºŒç»„ï¼šreadwrite readonly ç¬¬ä¸‰ç»„ï¼šnonatomic atomic ç¬¬å››ç»„ï¼šsetter getter ç¬¬ä¸€ç»„ç”¨äºï¼šsetæ–¹æ³•å†…å­˜ç®¡ç† assignï¼ˆé»˜è®¤å‚æ•°ï¼‰ï¼šç”Ÿæˆç›´æ¥èµ‹å€¼çš„setæ–¹æ³•ï¼ˆä¸è€ƒè™‘å†…å­˜ç®¡ç†ï¼‰ï¼Œé€‚ç”¨äºéOCå¯¹è±¡ï¼ˆåŸºæœ¬æ•°æ®ç±»å‹ã€å¤åˆæ•°æ®ç±»å‹ï¼‰ retainï¼šç”Ÿæˆç¬¦åˆå†…å­˜ç®¡ç†çš„setæ–¹æ³•ï¼ˆreleaseæ—§å€¼ï¼Œretainæ–°å€¼ï¼‰ï¼Œé€‚ç”¨äºOCå¯¹è±¡çš„æˆå‘˜å˜é‡ copyï¼šç”Ÿæˆç¬¦åˆå†…å­˜ç®¡ç†çš„setæ–¹æ³•ï¼ˆreleaseæ—§å€¼ï¼Œcopyæ–°å€¼ï¼‰ï¼Œé€‚ç”¨äºNSStringã€NSArrayç­‰ä¸å¯å˜å¯¹è±¡ã€‚ Strongï¼šå¼ºå¼•ç”¨ï¼Œå†³å®šäº†å¯¹è±¡çš„å­˜äº¡ï¼ˆä¸€ä¸ªå¯¹è±¡å¦‚æœæ²¡æœ‰å¼ºæŒ‡é’ˆæŒ‡å‘ï¼ˆå¼•ç”¨è®¡æ•°å™¨ä¸º0ï¼‰æ—¶ï¼Œå¯¹è±¡å°†è¢«é”€æ¯ï¼Œé‡Šæ”¾å†…å­˜ï¼‰ï¼Œå…¶æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œç›¸å½“äºè¯¥å¯¹è±¡åšäº†ä¸€æ¬¡retainæ“ä½œã€‚é€‚ç”¨äºOCå¯¹è±¡ weakï¼šå¼±å¼•ç”¨ï¼Œå…¶å­˜åœ¨ä¸å¦æ— æ‰€è°“ï¼ˆå¼±æŒ‡é’ˆæŒ‡å‘å¯¹è±¡ä¸å¦ï¼ˆå¯¹è±¡å¼•ç”¨è®¡ç®—å™¨ä¸å˜ï¼‰ï¼‰ï¼Œé€‚ç”¨äºOCå¯¹è±¡ unsafe_unretainedï¼šæ˜¯unretained,ä¸weakæœ‰ç‚¹ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒæ˜¯unsafeçš„ weakä¸Strongä¸€èˆ¬åœ¨å¼€å¯ARCæœºåˆ¶ä¸‹ä½¿ç”¨ Strongï¼šå¼ºå¼•ç”¨ï¼Œå†³å®šäº†å¯¹è±¡çš„å­˜äº¡ï¼ˆä¸€ä¸ªå¯¹è±¡å¦‚æœæ²¡æœ‰å¼ºæŒ‡é’ˆæŒ‡å‘ï¼ˆå¼•ç”¨è®¡æ•°å™¨ä¸º0ï¼‰æ—¶ï¼Œå¯¹è±¡å°†è¢«é”€æ¯ï¼Œé‡Šæ”¾å†…å­˜ï¼‰ï¼Œå…¶æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œç›¸å½“äºè¯¥å¯¹è±¡åšäº†ä¸€æ¬¡retainæ“ä½œã€‚ éARCçš„retainï¼Œç›¸å½“äºARCçš„strongï¼Œå¼±å¼•ç”¨ç›¸å½“äºassign ä½¿ç”¨copyå‚æ•°ä¸ä½¿ç”¨retainå‚æ•°äº§ç”Ÿçš„setæ–¹æ³•ä¸€è‡´ï¼ˆå°†ç”Ÿæˆsetæ–¹æ³•ä¸­çš„retainæ”¹ä¸ºcopyå³å¯ï¼‰ ç¬¬äºŒç»„ï¼ˆreadwrite readonlyï¼‰ç”¨äºï¼šæ˜¯å¦è¦ç”Ÿæˆsetæ–¹æ³• readwriteï¼ˆé»˜è®¤å‚æ•°ï¼‰ï¼šåŒæ—¶ç”Ÿæˆsetã€getæ–¹æ³•çš„å£°æ˜ä¸å®ç° readonlyï¼šåªç”Ÿæˆgetæ–¹æ³•çš„å£°æ˜ä¸å®ç°ï¼ˆä¸ç”Ÿæˆsetçš„æ–¹æ³•çš„å£°æ˜ä¸å®ç°ï¼‰ ç¬¬ä¸‰ç»„ï¼ˆnonatomic atomicï¼‰ç”¨äºï¼šå¤šçº¿ç¨‹ç®¡ç† atomicï¼ˆé»˜è®¤å‚æ•°ï¼‰ï¼šåŸå­æ€§ï¼Œæ€§èƒ½ä½ï¼ˆä¸€èˆ¬å¼€å‘OCä¸­çš„APPä¸æ¨èä½¿ç”¨ï¼Œåšé‡‘èç­‰é«˜å®‰å…¨çš„æ—¶å€™ä½¿ç”¨ï¼‰ nonatomicï¼šéåŸå­æ€§ï¼Œæ€§èƒ½é«˜ï¼ˆå¼ºçƒˆæ¨èä½¿ç”¨ï¼Œæ€§èƒ½é«˜ï¼‰ atomicï¼šï¼ˆåŸå­æ€§æ“ä½œï¼‰å°±æ˜¯ä¸€ä¸ªæ“ä½œæ‰§è¡Œè¿‡ç¨‹ä¸èƒ½è¢«ä¸­æ–­, è¦ä¸å°±æ‰§è¡Œå®Œ, è¦ä¸å°±ä¸æ‰§è¡Œï¼ˆä¸€ä¸ªæ“ä½œä¸å¯ä»¥è¢«ä¸­é€”cpuæš‚åœç„¶åè°ƒåº¦ï¼‰ã€‚å¦‚æœä¸€ä¸ªæ“ä½œæ˜¯åŸå­æ€§çš„, é‚£ä¹ˆåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹, å°±ä¸ä¼šå‡ºç°å˜é‡è¢«ä¿®æ”¹ç­‰å¥‡æ€ªçš„é—®é¢˜ï¼ˆä¿è¯æ•°æ®åŒæ­¥ï¼‰ã€‚åŸå­æ“ä½œå°±æ˜¯ä¸å¯å†åˆ†çš„æ“ä½œï¼Œåœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­åŸå­æ“ä½œæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå®ƒå¸¸å¸¸ç”¨æ¥å®ç°ä¸€äº›åŒæ­¥æœºåˆ¶ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€äº›å¸¸è§çš„å¤šçº¿ç¨‹Bugçš„æºå¤´ã€‚ nonatomicï¼šï¼ˆéåŸå­æ€§æ“ä½œï¼‰æ“ä½œæ˜¯ç›´æ¥ä»å†…å­˜ä¸­å–æ•°å€¼ï¼ˆä¸è€ƒè™‘å…¶æ˜¯å¦è¢«å ç”¨ï¼‰ï¼Œå› ä¸ºå®ƒæ˜¯ä»å†…å­˜ä¸­å–å¾—æ•°æ®ï¼Œå®ƒå¹¶æ²¡æœ‰ä¸€ä¸ªåŠ é”çš„ä¿æŠ¤æ¥ç”¨äºcpuä¸­çš„å¯„å­˜å™¨è®¡ç®—Valueï¼Œå®ƒåªæ˜¯å•çº¯çš„ä»å†…å­˜åœ°å€ä¸­ï¼Œå½“å‰çš„å†…å­˜å­˜å‚¨çš„æ•°æ®ç»“æœæ¥è¿›è¡Œä½¿ç”¨ã€‚åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯æé«˜æ€§èƒ½ï¼Œä½†æ— æ³•ä¿è¯æ•°æ®åŒæ­¥ã€‚ ç¬¬å››ç»„ï¼ˆsetter getterï¼‰ç”¨äºï¼šsetã€getæ–¹æ³•é‡å‘½åï¼ˆå¸¸ç”¨äºBOOLç±»å‹çš„æˆå‘˜å˜é‡çš„getæ–¹æ³•,BOOLæ–¹æ³•å¸¸ä»¥iså¼€å¤´ï¼‰ setterï¼šç»™æˆå‘˜å˜é‡çš„setæ–¹æ³•é‡å‘½åï¼Œsetæ–¹æ³•é»˜è®¤å‘½åï¼š- ï¼ˆvoidï¼‰ setæˆå‘˜å˜é‡åï¼ˆæˆå‘˜å˜é‡åé¦–å­—æ¯å¤§å†™ï¼‰ï¼šï¼ˆæˆå‘˜å˜é‡æ•°æ®ç±»å‹ï¼‰æˆå‘˜å˜é‡å getterï¼šç»™æˆå‘˜å˜é‡çš„setæ–¹æ³•é‡å‘½åï¼Œgetæ–¹æ³•é»˜è®¤å‘½åï¼š- ï¼ˆæˆå‘˜å˜é‡æ•°æ®ç±»å‹ï¼‰ æˆå‘˜å˜é‡å","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"Objective-C","slug":"Objective-C","permalink":"https://github.com/icoderRo/tags/Objective-C/"}]},{"title":"é›†åˆæ“ä½œ","slug":" é›†åˆæ“ä½œ","date":"2014-03-21T16:00:00.000Z","updated":"2017-08-17T14:51:54.000Z","comments":true,"path":"2014/03/22/ é›†åˆæ“ä½œ/","link":"","permalink":"https://github.com/icoderRo/2014/03/22/ é›†åˆæ“ä½œ/","excerpt":"NSArrayåˆ›å»ºNSArrayå¸¸è§„åˆ›å»º 123NSArray *arr = [[NSArray alloc] init];NSArray *arr = [NSArray arrayWithObject:@&quot;lc&quot;];NSArray *arr = [NSArray arrayWithObjects:@&quot;lc&quot;, æ•°ç»„ä¸­çš„nilæ˜¯ç»“æŸç¬¦ æ•°ç»„ç®€å†™ 12NSArray *arr = [NSArray arrayWithObjects:@&quot;lcc&quot;, @&quot;lc&quot;, @&quot;cccc&quot;, nil];NSArray *arr = @[@&quot;lcc&quot;, @&quot;lc&quot;, @&quot;c&quot;]; è¯­æ³•ç³– NSArrayçš„éå†for-iä¼ ç»Ÿéå† 123for (int i = 0; i &lt; arr.count; ++i) &#123; NSLog(@&quot;arr[%i] = %@&quot;, i, arr[i]); &#125; for-in 123for (NSString *obj in arr) &#123; NSLog(@&quot;obj = %@&quot;, obj); &#125; ä¸å¯åœ¨éå†çš„æ—¶å€™, ä¿®æ”¹é‡Œé¢çš„æ•°æ® è¿­ä»£å™¨éå† 123456[arr enumerateObjectsUsingBlock:^(id obj, NSUInteger idx, BOOL *stop) &#123; if (idx == 1) &#123; *stop = YES; &#125; NSLog(@&quot;obj = %@, idx = %lu&quot;, obj, idx); &#125;]; æ•°ç»„æ‰€æœ‰å…ƒç´ è°ƒç”¨ç»Ÿä¸€çš„æ–¹æ³• 123[arr makeObjectsPerformSelector:@selector(say)];[arr makeObjectsPerformSelector:@selector(sayWithName:) withObject:@&quot;aa&quot;]; æ•°ç»„ä¸­ç»Ÿä¸€è°ƒç”¨æ–¹æ³•","text":"NSArrayåˆ›å»ºNSArrayå¸¸è§„åˆ›å»º 123NSArray *arr = [[NSArray alloc] init];NSArray *arr = [NSArray arrayWithObject:@&quot;lc&quot;];NSArray *arr = [NSArray arrayWithObjects:@&quot;lc&quot;, æ•°ç»„ä¸­çš„nilæ˜¯ç»“æŸç¬¦ æ•°ç»„ç®€å†™ 12NSArray *arr = [NSArray arrayWithObjects:@&quot;lcc&quot;, @&quot;lc&quot;, @&quot;cccc&quot;, nil];NSArray *arr = @[@&quot;lcc&quot;, @&quot;lc&quot;, @&quot;c&quot;]; è¯­æ³•ç³– NSArrayçš„éå†for-iä¼ ç»Ÿéå† 123for (int i = 0; i &lt; arr.count; ++i) &#123; NSLog(@&quot;arr[%i] = %@&quot;, i, arr[i]); &#125; for-in 123for (NSString *obj in arr) &#123; NSLog(@&quot;obj = %@&quot;, obj); &#125; ä¸å¯åœ¨éå†çš„æ—¶å€™, ä¿®æ”¹é‡Œé¢çš„æ•°æ® è¿­ä»£å™¨éå† 123456[arr enumerateObjectsUsingBlock:^(id obj, NSUInteger idx, BOOL *stop) &#123; if (idx == 1) &#123; *stop = YES; &#125; NSLog(@&quot;obj = %@, idx = %lu&quot;, obj, idx); &#125;]; æ•°ç»„æ‰€æœ‰å…ƒç´ è°ƒç”¨ç»Ÿä¸€çš„æ–¹æ³• 123[arr makeObjectsPerformSelector:@selector(say)];[arr makeObjectsPerformSelector:@selector(sayWithName:) withObject:@&quot;aa&quot;]; æ•°ç»„ä¸­ç»Ÿä¸€è°ƒç”¨æ–¹æ³• NSArrayçš„æ’åº Foundationæ¡†æ¶ä¸­çš„å¯¹è±¡ 12NSArray *arr = @[@10, @20, @5, @7, @15];NSArray *newArr = [arr sortedArrayUsingSelector:@selector(compare:)]; ä½¿ç”¨compareæ–¹æ³•å¯¹æ•°ç»„ä¸­çš„å…ƒç´ è¿›è¡Œæ’åº,é‚£ä¹ˆæ•°ç»„ä¸­çš„å…ƒç´ ä¸èƒ½æ˜¯è‡ªå®šä¹‰å¯¹è±¡ è‡ªå®šä¹‰å¯¹è±¡ 1234567891011121314151617181920212223242526Person *p1 = [Person new];p1.age = 10;Person *p2 = [Person new];p2.age = 20;Person *p3 = [Person new];p3.age = 5;Person *p4 = [Person new];p4.age = 7;NSArray *arr = @[p1, p2, p3, p4];NSArray *newArr = [arr sortedArrayWithOptions:NSSortStable usingComparator:^NSComparisonResult(Person *obj1, Person *obj2) &#123; return obj1.age &gt; obj2.age; if (obj1.age &gt; obj2.age) &#123; return NSOrderedDescending; &#125;else if(obj1.age &lt; obj2.age)&#123; return NSOrderedAscending; &#125;else&#123; return NSOrderedSame; &#125; &#125;]; é»˜è®¤ä¼šæŒ‰ç…§å‡åºæ’åºä¸èƒ½ä½¿ç”¨compare:æ–¹æ³•å¯¹è‡ªå®šä¹‰å¯¹è±¡è¿›è¡Œæ’åº NSArray-&gt;NSStringè½¬æ¢å°†æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ æ‹¼æ¥ 12345678910// ç”¨-å°†æ‰€æœ‰çš„å…ƒç´ è¿æ¥èµ·æ¥ç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²NSArray *arr = @[@&quot;aa&quot;, @&quot;bb&quot;, @&quot;cc&quot;];NSMutableString *strM = [NSMutableString string];for (NSString *str in arr) &#123; [strM appendString:str]; [strM appendString:@&quot;-&quot;]; &#125; [strM deleteCharactersInRange:NSMakeRange(strM.length - 1, 1)]; ç­‰ä»·äº NSString *str = [arr componentsJoinedByString:@â€-â€œ]; å­—ç¬¦ä¸²åˆ‡å‰² 12NSString *str1 = @&quot;lc-lcc-ccc&quot;;NSArray *arr1 = [str1 componentsSeparatedByString:@&quot;-&quot;]; NSArrayæ–‡ä»¶è¯»å†™å°†æ•°ç»„å†™å…¥åˆ°æ–‡ä»¶ä¸­ 12NSArray *arr = @[@&quot;aa&quot;, @&quot;bb&quot;, @&quot;cc&quot;];BOOL flag = [arr writeToFile:@&quot;/Users/lc/Desktop/abc.plist&quot; atomically:YES]; å°†ä¸€ä¸ªæ•°ç»„å†™å…¥åˆ°æ–‡ä»¶ä¸­ä¹‹å, æœ¬è´¨æ˜¯å†™å…¥äº†ä¸€ä¸ªXMLæ–‡ä»¶,ä¸€èˆ¬æƒ…å†µä¸‹å°†XMLæ–‡ä»¶çš„æ‰©å±•åä¿å­˜ä¸ºplist ä»æ–‡ä»¶ä¸­è¯»å–ä¸€ä¸ªæ•°ç»„ 1NSArray *newArray = [NSArray arrayWithContentsOfFile:@&quot;/Users/lc/Desktop/abc.plist&quot;]; NSMutableArrayåˆ›å»º1NSMutableArray *arrM = [NSMutableArray array]; æ·»åŠ 12[arrM addObject:@&quot;lcc&quot;];[arrM addObjectsFromArray:@[@&quot;lcc&quot;, @&quot;lll&quot;]]; [arrM addObject:@[@â€lccâ€, @â€cccâ€]];å°†æ•´ä¸ªæ•°ç»„ä½œä¸ºä¸€ä¸ªå…ƒç´ æ·»åŠ  æ’å…¥12345[arrM insertObject:@&quot;ccc&quot; atIndex:1];NSRange range = NSMakeRange(2, 2);NSIndexSet *set = [NSIndexSet indexSetWithIndexesInRange:range];[arrM insertObjects:@[@&quot;A&quot;, @&quot;B&quot;] atIndexes:set]; æ’å…¥ä¸€ç»„æ•°æ®, æŒ‡å®šæ•°ç»„éœ€è¦æ’å…¥çš„ä½ç½®, å’Œæ’å…¥å¤šå°‘ä¸ª åˆ é™¤123[arrM removeObjectAtIndex:0];[arrM removeLastObject];[arrM removeObject:@&quot;A&quot;]; æ›¿æ¢123[arrM replaceObjectAtIndex:1 withObject:@&quot;K&quot;];arrM[0] = @&quot;K&quot;; è·å–1[arrM objectAtIndex:0] NSDictionaryåˆ›å»º123456NSDictionary *dict = [NSDictionary dictionaryWithObject:@&quot;lcc&quot; forKey:@&quot;name&quot;];NSDictionary *dict = [NSDictionary dictionaryWithObjects:@[@&quot;lcc&quot;, @&quot;30&quot;, @&quot;1.75&quot;] forKeys:@[@&quot;name&quot;, @&quot;age&quot;, @&quot;height&quot;]];NSDictionary *dict = @&#123;@&quot;name&quot;: @&quot;lcc&quot;&#125;;NSDictionary *dict = @&#123;@&quot;name&quot;:@&quot;lcc&quot;, @&quot;age&quot;:@&quot;30&quot;, @&quot;height&quot;:@&quot;1.75&quot;&#125;; å¼€å‘ä¸­å¸¸åˆ©ç”¨è¯­æ³•ç³–çš„æ–¹å¼ éå†12345678910111213141516NSDictionary *dict = @&#123;@&quot;name&quot;:@&quot;lcc&quot;, @&quot;age&quot;:@&quot;30&quot;, @&quot;height&quot;:@&quot;1.75&quot;&#125;; for (int i = 0; i &lt; dict.count; ++i) &#123; NSArray *keys = [dict allKeys]; NSString *key = keys[i]; NSString *value = dict[key]; &#125; for (NSString *key in dict) &#123; NSString *value = dict[key]; NSLog(@&quot;key = %@, value = %@&quot;, key, value); &#125; [dict enumerateKeysAndObjectsUsingBlock:^(id key, id obj, BOOL *stop) &#123; NSLog(@&quot;key = %@, value = %@&quot;, key, obj); &#125;]; æ–‡ä»¶è¯»å†™123456// å†™NSDictionary *dict = @&#123;@&quot;name&quot;:@&quot;lcc&quot;, @&quot;age&quot;:@&quot;30&quot;, @&quot;height&quot;:@&quot;1.75&quot;&#125;;[dict writeToFile:@&quot;/Users/lc/Desktop/11.plist&quot; atomically:YES];// è¯»NSDictionary *newDict = [NSDictionary dictionaryWithContentsOfFile:@&quot;/Users/lc/Desktop/11.plist&quot;]; å­—å…¸å’Œæ•°ç»„ä¸åŒ, å­—å…¸ä¸­ä¿å­˜çš„æ•°æ®æ˜¯æ— åºçš„ NSMutableDictionaryåˆ›å»º1NSMutableDictionary *dictM = [NSMutableDictionary dictionary]; æ·»åŠ 123[dictM setObject:@&quot;lcc&quot; forKey:@&quot;name&quot;];[dictM setValuesForKeysWithDictionary:@&#123;@&quot;age&quot;:@&quot;30&quot;, @&quot;height&quot;:@&quot;1.75&quot;&#125;]; è·å–1dictM[@&quot;name&quot;] åˆ é™¤123[dictM removeObjectForKey:@&quot;name&quot;];[dictM removeObjectsForKeys:@[@&quot;age&quot;, @&quot;height&quot;]]; ä¿®æ”¹12[dictM setObject:@&quot;88&quot; forKey:@&quot;age&quot;];dictM[@&quot;age&quot;] = @&quot;88&quot;; åˆ©ç”¨setObjectæ–¹æ³•ç»™åŒåçš„keyèµ‹å€¼, é‚£ä¹ˆæ–°å€¼ä¼šè¦†ç›–æ—§å€¼ é¢˜å¤–è¯ä¸å¯å˜æ•°ç»„å’Œå¯å˜æ•°ç»„,è½¬æ¢12NSMutableArray *arr = @[].mutableCopy;NSArray *arr1 = arr.copy; å­—å…¸ä¹Ÿæ˜¯åŒç† 12NSMutableDictionary *mutDic = @&#123;&#125;.mutableCopy;NSDictionary *dict = mutDic.copy;","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"Objective-C","slug":"Objective-C","permalink":"https://github.com/icoderRo/tags/Objective-C/"}]},{"title":"å­—ç¬¦ä¸²æ“ä½œ","slug":"å­—ç¬¦ä¸²æ“ä½œ","date":"2014-03-05T16:00:00.000Z","updated":"2017-08-17T14:56:17.000Z","comments":true,"path":"2014/03/06/å­—ç¬¦ä¸²æ“ä½œ/","link":"","permalink":"https://github.com/icoderRo/2014/03/06/å­—ç¬¦ä¸²æ“ä½œ/","excerpt":"NSStringåˆ›å»ºNSString ç›´æ¥åˆ›å»º 1NSString *str1 = @&quot;lc&quot; é€šè¿‡@â€â€åˆ›å»ºå­—ç¬¦ä¸², é‚£ä¹ˆä¼šå°†å­—ç¬¦ä¸²æ”¾åˆ°å¸¸é‡åŒºä¸­,å­—ç¬¦ä¸²å¸¸é‡, åªè¦å†…å®¹ç›¸åŒ, ä¸ä¼šé‡å¤åˆ›å»º allocæˆ–è€…ç±»æ–¹æ³•åˆ›å»º 1234NSString *str2 = [[NSString alloc] initWithString:@&quot;lc&quot;];NSString *str3 = [NSString stringWithFormat:@&quot;lcc&quot;];NSString *str3 = [[NSString alloc] initWithString:@&quot;lcc&quot;];NSString *str3 = [NSString stringWithFormat:@&quot;age is %i&quot;, 10]; é€šè¿‡allocæˆ–è€…ç±»å·¥å‚æ–¹æ³•åˆ›å»º, é‚£ä¹ˆä¼šå°†å­—ç¬¦ä¸²æ”¾åˆ°å †åŒºä¸­ å­—ç¬¦ä¸²æ–‡ä»¶è¯»å†™ ä»æ–‡ä»¶ä¸­è¯»å–å­—ç¬¦ä¸² 123NSString *path = @&quot;/Users/lc/Desktop/lc.txt&quot;;NSError *error = nil;NSString *str = [NSString stringWithContentsOfFile:path encoding:NSUTF8StringEncoding error:&amp;error]; encoding: ç¼–ç è‹±æ–‡ iOS-5988-1 ä¸­æ–‡ GBK GBK2312,UTF-8;â€¦..OfFile(å…¨è·¯å¾„) å°†å­—ç¬¦ä¸²å†™å…¥åˆ°æ–‡ä»¶ä¸­ 1234567NSString *str = @&quot;iOS&quot;;NSString *path2 = @&quot;/Users/lc/Desktop/lc.txt&quot;;BOOL flag = [str writeToFile:path2 atomically:YES encoding:NSUTF8StringEncoding error:nil];NSString *str = @&quot;abcdef&quot;;NSURL *url = [NSURL fileURLWithPath:@&quot;/Users/lc/Desktop/123.txt&quot;];[str writeToURL:url atomically:YES encoding:NSUTF8StringEncoding error:nil]; atomically å¦‚æœä¼ å…¥YES, å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶çš„è¿‡ç¨‹ä¸­å¦‚æœæ²¡æœ‰å†™å®Œ, é‚£ä¹ˆä¸ä¼šç”Ÿæˆæ–‡ä»¶ å¦‚æœä¼ å…¥NO, å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶çš„è¿‡ç¨‹ä¸­å¦‚æœæ²¡æœ‰å†™å®Œ, ä¼šç”Ÿæˆæ–‡ä»¶ NSString -&gt; NSURL 123NSString *path = @&quot;file://æœ¬æœºIP/Users/lc/Desktop/123.txt&quot;;path = [path stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding];NSURL *url = [NSURL URLWithString:path]; å¦‚æœè®¿é—®æœ¬æœºçš„æ–‡ä»¶, å¯ä»¥çœç•¥ä¸»æœºåœ°å€ NSString *path = @â€file:///Users/lc/Desktop/123.txtâ€; NSURL -&gt; NSString 123456NSURL *url = [NSURL fileURLWithPath:@&quot;/Users/lc/Desktop/123.txt&quot;];NSError *error = nil;NSString *str = [NSString stringWithContentsOfURL:url encoding:NSUTF8StringEncoding error:&amp;error];NSURL *url = [NSURL URLWithString:@&quot;http://www.baidu.com&quot;];NSString *str = [NSString stringWithContentsOfURL:url encoding:NSUTF8StringEncoding error:nil];","text":"NSStringåˆ›å»ºNSString ç›´æ¥åˆ›å»º 1NSString *str1 = @&quot;lc&quot; é€šè¿‡@â€â€åˆ›å»ºå­—ç¬¦ä¸², é‚£ä¹ˆä¼šå°†å­—ç¬¦ä¸²æ”¾åˆ°å¸¸é‡åŒºä¸­,å­—ç¬¦ä¸²å¸¸é‡, åªè¦å†…å®¹ç›¸åŒ, ä¸ä¼šé‡å¤åˆ›å»º allocæˆ–è€…ç±»æ–¹æ³•åˆ›å»º 1234NSString *str2 = [[NSString alloc] initWithString:@&quot;lc&quot;];NSString *str3 = [NSString stringWithFormat:@&quot;lcc&quot;];NSString *str3 = [[NSString alloc] initWithString:@&quot;lcc&quot;];NSString *str3 = [NSString stringWithFormat:@&quot;age is %i&quot;, 10]; é€šè¿‡allocæˆ–è€…ç±»å·¥å‚æ–¹æ³•åˆ›å»º, é‚£ä¹ˆä¼šå°†å­—ç¬¦ä¸²æ”¾åˆ°å †åŒºä¸­ å­—ç¬¦ä¸²æ–‡ä»¶è¯»å†™ ä»æ–‡ä»¶ä¸­è¯»å–å­—ç¬¦ä¸² 123NSString *path = @&quot;/Users/lc/Desktop/lc.txt&quot;;NSError *error = nil;NSString *str = [NSString stringWithContentsOfFile:path encoding:NSUTF8StringEncoding error:&amp;error]; encoding: ç¼–ç è‹±æ–‡ iOS-5988-1 ä¸­æ–‡ GBK GBK2312,UTF-8;â€¦..OfFile(å…¨è·¯å¾„) å°†å­—ç¬¦ä¸²å†™å…¥åˆ°æ–‡ä»¶ä¸­ 1234567NSString *str = @&quot;iOS&quot;;NSString *path2 = @&quot;/Users/lc/Desktop/lc.txt&quot;;BOOL flag = [str writeToFile:path2 atomically:YES encoding:NSUTF8StringEncoding error:nil];NSString *str = @&quot;abcdef&quot;;NSURL *url = [NSURL fileURLWithPath:@&quot;/Users/lc/Desktop/123.txt&quot;];[str writeToURL:url atomically:YES encoding:NSUTF8StringEncoding error:nil]; atomically å¦‚æœä¼ å…¥YES, å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶çš„è¿‡ç¨‹ä¸­å¦‚æœæ²¡æœ‰å†™å®Œ, é‚£ä¹ˆä¸ä¼šç”Ÿæˆæ–‡ä»¶ å¦‚æœä¼ å…¥NO, å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶çš„è¿‡ç¨‹ä¸­å¦‚æœæ²¡æœ‰å†™å®Œ, ä¼šç”Ÿæˆæ–‡ä»¶ NSString -&gt; NSURL 123NSString *path = @&quot;file://æœ¬æœºIP/Users/lc/Desktop/123.txt&quot;;path = [path stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding];NSURL *url = [NSURL URLWithString:path]; å¦‚æœè®¿é—®æœ¬æœºçš„æ–‡ä»¶, å¯ä»¥çœç•¥ä¸»æœºåœ°å€ NSString *path = @â€file:///Users/lc/Desktop/123.txtâ€; NSURL -&gt; NSString 123456NSURL *url = [NSURL fileURLWithPath:@&quot;/Users/lc/Desktop/123.txt&quot;];NSError *error = nil;NSString *str = [NSString stringWithContentsOfURL:url encoding:NSUTF8StringEncoding error:&amp;error];NSURL *url = [NSURL URLWithString:@&quot;http://www.baidu.com&quot;];NSString *str = [NSString stringWithContentsOfURL:url encoding:NSUTF8StringEncoding error:nil]; å­—ç¬¦ä¸²æ¯”è¾ƒ æ¯”è¾ƒå­—ç¬¦ä¸²å†…å®¹æ˜¯å¦ç›¸åŒ 1BOOL flag = [str1 isEqualToString:str2]; flag = (str1 == str2);æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²çš„â€åœ°å€â€æ˜¯å¦ç›¸åŒ æ¯”è¾ƒå­—ç¬¦ä¸²çš„å¤§å° 12345678910111213switch ([str1 compare:str2]) &#123; case NSOrderedAscending: NSLog(@&quot;str1å°äºstr2&quot;); break; case NSOrderedSame: NSLog(@&quot;str1ç­‰äºstr2&quot;); break; case NSOrderedDescending: NSLog(@&quot;str1å¤§äºstr2&quot;); break; default: break; &#125; * å¿½ç•¥å¤§å°å†™è¿›è¡Œæ¯”è¾ƒ 12345678910111213switch ([str1 caseInsensitiveCompare:str2]) &#123; case NSOrderedAscending: NSLog(@&quot;str1å°äºstr2&quot;); break; case NSOrderedSame: NSLog(@&quot;str1ç­‰äºstr2&quot;); break; case NSOrderedDescending: NSLog(@&quot;str1å¤§äºstr2&quot;); break; default: break; &#125; å­—ç¬¦ä¸²æœç´¢ åˆ¤æ–­ä»¥ä»€ä¹ˆå¼€å¤´ 123456if ([str hasPrefix:@&quot;http://&quot;]) &#123; NSLog(@&quot;æ˜¯ä¸€ä¸ªURL&quot;); &#125;else &#123; NSLog(@&quot;ä¸æ˜¯ä¸€ä¸ªURL&quot;); &#125; æœ¬è´¨å°±æ˜¯ä»å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹åŒ¹é…, åªè¦ä¸åŒ¹é…å°±è¿”å›NO åˆ¤æ–­ä»¥ä»€ä¹ˆç»“å°¾ 12345if ([str hasSuffix:@&quot;.gif&quot;]) &#123; NSLog(@&quot;åŠ¨æ€å›¾ç‰‡&quot;); &#125;else&#123; NSLog(@&quot;ä¸æ˜¯åŠ¨æ€å›¾ç‰‡&quot;); &#125; æœ¬è´¨å°±æ˜¯ä»å­—ç¬¦ä¸²çš„æœ€åä¸€ä¸ªå­—ç¬¦å¼€å§‹åŒ¹é…, åªè¦ä¸åŒ¹é…å°±è¿”å›NO åˆ¤æ–­å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«XX 123456789 NSString *str = @&quot;abcd&quot;; NSRange range = [str rangeOfString:@&quot;lc&quot;];// if (range.location == NSNotFound) &#123; if (range.length == 0)&#123; NSLog(@&quot;strä¸­æ²¡æœ‰éœ€è¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²&quot;); &#125;else&#123; NSLog(@&quot;strä¸­æœ‰éœ€è¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²&quot;); NSLog(@&quot;location = %lu, length = %lu&quot;, range.location, range.length); &#125; åªè¦strä¸­åŒ…å«è¯¥å­—ç¬¦ä¸², é‚£ä¹ˆå°±ä¼šè¿”å›è¯¥å­—ç¬¦ä¸²åœ¨strä¸­çš„èµ·å§‹ä½ç½®ä»¥åŠè¯¥å­—ç¬¦ä¸²çš„é•¿åº¦ locationä»0å¼€å§‹ , lengthä»1å¼€å§‹ å¦‚æœsträ¸­æ²¡æœ‰éœ€è¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸², é‚£ä¹ˆè¿”å›çš„rangeçš„length=0, location = NSNotFound å­—ç¬¦ä¸²æˆªå–NSString *str = @&quot;&lt;head&gt;å°è¥¿å“¥&lt;/head&gt;&quot;; åŠ¨æ€è·å–æˆªå–çš„èµ·å§‹ä½ç½® 1NSUInteger location = [str rangeOfString:@&quot;&gt;&quot;].location + 1; * åŠ¨æ€è·å–æˆªå–çš„é•¿åº¦ 1234NSUInteger length = [str rangeOfString:@&quot;&lt;&quot; options:NSBackwardsSearch].location - location;NSUInteger length = [str rangeOfString:@&quot;&lt;/&quot;].location - location;NSRange range = NSMakeRange(location, length);NSString *newStr = [str substringWithRange:range]; &gt; options:NSBackwardsSearch:ä»åå¾€å‰ 1NSString *newStr = [str substringFromIndex:6]; &gt; ä»ä»€ä¹ˆåœ°æ–¹å¼€å§‹æˆªå–, ä¸€ç›´æˆªå–åˆ°æœ€å 1NSString *newStr = [str substringToIndex:6]; &gt; ä»å¼€å¤´å¼€å§‹æˆªå–, ä¸€ç›´æˆªå–åˆ°ä»€ä¹ˆä½ç½® å­—ç¬¦ä¸²çš„æ›¿æ¢ æ›¿æ¢ 1[str stringByReplacingOccurrencesOfString:@&quot;&amp;&quot; withString:@&quot;/&quot;] &gt; å°†&amp;ç¬¦å·æ›¿æ¢ä¸º/ * å»ç©ºæ ¼ 1[str stringByReplacingOccurrencesOfString:@&quot; &quot; withString:@&quot;&quot;]; * åˆ é™¤å­—ç¬¦ä¸²å¤´å°¾ç©ºç™½ 12 NSCharacterSet *set = [NSCharacterSet whitespaceCharacterSet];NSString *newStr = [str stringByTrimmingCharactersInSet:set]; * è¿”å›å¤§å†™å­—ç¬¦ä¸² 12NSCharacterSet *set = [NSCharacterSet uppercaseLetterCharacterSet]; NSString *newStr = [str stringByTrimmingCharactersInSet:set]; ... å­—ç¬¦ä¸²ä¸è·¯å¾„ åˆ¤æ–­æ˜¯å¦æ˜¯ç»å¯¹è·¯å¾„ 1[str isAbsolutePath] åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä»¥/å¼€å¤´ è·å–æ–‡ä»¶è·¯å¾„ä¸­çš„æœ€åä¸€ä¸ªç›®å½• 1[str lastPathComponent]; è·å–è·¯å¾„ä¸­æœ€åä¸€ä¸ª/åé¢çš„å†…å®¹ åˆ é™¤æ–‡ä»¶è·¯å¾„ä¸­çš„æœ€åä¸€ä¸ªç›®å½• 1[str stringByDeletingLastPathComponent]; åˆ é™¤æœ€åä¸€ä¸ª/åé¢çš„å†…å®¹, â€œ/â€œä¹Ÿä¼šè¢«åˆ é™¤ ç»™æ–‡ä»¶è·¯å¾„æ·»åŠ ä¸€ä¸ªç›®å½• 1[str stringByAppendingPathComponent:@&quot;lcc&quot;]; å°±æ˜¯åœ¨å­—ç¬¦ä¸²çš„æœ«å°¾åŠ ä¸Šä¸€ä¸ªâ€/â€œ å’ŒæŒ‡å®šçš„å†…å®¹ å¦‚æœè·¯å¾„åé¢å·²ç»æœ‰äº†/, é‚£ä¹ˆå°±ä¸ä¼šæ·»åŠ äº† å¦‚æœè·¯å¾„åé¢æœ‰å¤šä¸ª/, é‚£ä¹ˆä¼šè‡ªåŠ¨åˆ é™¤å¤šä½™çš„/, åªä¿ç•™ä¸€ä¸ª è·å–è·¯å¾„ä¸­æ–‡ä»¶çš„æ‰©å±•å 1[str pathExtension]; ä»å­—ç¬¦ä¸²çš„æœ«å°¾å¼€å§‹æŸ¥æ‰¾., æˆªå–ç¬¬ä¸€ä¸ª.åé¢çš„å†…å®¹ åˆ é™¤è·¯å¾„ä¸­æ–‡ä»¶çš„æ‰©å±•å 1[str stringByDeletingPathExtension]; ä»å­—ç¬¦ä¸²çš„æœ«å°¾å¼€å§‹æŸ¥æ‰¾.,åˆ é™¤ç¬¬ä¸€ä¸ªâ€.â€å’Œåé¢çš„å†…å®¹ ç»™æ–‡ä»¶è·¯å¾„æ·»åŠ ä¸€ä¸ªæ‰©å±•å 1[str stringByAppendingPathExtension:@&quot;jpg&quot;]; åœ¨å­—ç¬¦ä¸²çš„æœ«å°¾åŠ ä¸Šä¸€ä¸ª.å’ŒæŒ‡å®šçš„å†…å®¹ å­—ç¬¦ä¸²æ›¿æ¢ å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™ 1[str uppercaseString]; * å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™ 1[str lowercaseString]; * å°†å­—ç¬¦ä¸²çš„é¦–å­—ç¬¦è½¬æ¢ä¸ºå¤§å†™ 1[str capitalizedString]; * å­—ç¬¦ä¸²ä¸åŸºæœ¬æ•°æ®ç±»å‹çš„è½¬æ¢ 1234NSString *str1 = @&quot;110&quot;; NSString *str2 = @&quot;120&quot;; int value1 = [str1 intValue]; int value2 = [str2 intValue]; * Cè¯­è¨€å­—ç¬¦ä¸²å’ŒOCå­—ç¬¦ä¸²ä¹‹é—´çš„è½¬æ¢ 12345char *cStr = &quot;lcc&quot;; NSString *str = [NSString stringWithUTF8String:cStr]; NSString *newStr = @&quot;lccc&quot;; const char *cStr2 = [newStr UTF8String]; NSMutableStringåˆ›å»ºNSMutableString åˆ›å»ºç©ºå­—ç¬¦ä¸²,åœ¨append 12345 NSMutableString *str = [NSMutableString string]; æˆ–è€… NSMutableString *str = [[NSMutableString alloc] init]; [str appendString:@&quot;lcc&quot;]; ç›´æ¥èµ‹å€¼ 123strM = [NSMutableString alloc] initWithFormat:&lt;#(NSString *), ...#&gt;strM = [NSMutableString stringWithFormat:&lt;#(NSString *), ...#&gt;] NSMutableStringå¢åˆ æ”¹ æ·»åŠ  12[strM appendString:@&quot;/image&quot;];[strM appendFormat:@&quot;/age is %i&quot;, 10]; åˆ é™¤å­—ç¬¦ä¸² 12NSRange range = [strM rangeOfString:@&quot;520&quot;];[strM deleteCharactersInRange:range]; åˆ©ç”¨rangeOfStringæŸ¥æ‰¾å‡º520åœ¨å­—ç¬¦ä¸²ä¸­çš„ä½ç½® deleteCharactersInRangeæ–¹æ³•åˆ é™¤æŒ‡å®šçš„rangeçš„å­—ç¬¦ä¸² æ’å…¥å­—ç¬¦ä¸² 12NSRange range = [strM rangeOfString:@&quot;520&quot;];[strM insertString:@&quot;love&quot; atIndex:range.location]; insertString : éœ€è¦æ’å…¥çš„å­—ç¬¦ä¸² atIndex: ä»å“ªé‡Œå¼€å§‹æ’å…¥ å­—ç¬¦ä¸²ä¸­æ›¿æ¢ 1[strM replaceOccurrencesOfString:@&quot;520&quot; withString:@&quot;530&quot; options:0 range:NSMakeRange(0, strM.length)]; å¦‚æœæ˜¯è°ƒç”¨NSStringçš„å­—ç¬¦ä¸²æ›¿æ¢æ–¹æ³•, ä¸ä¼šä¿®æ”¹åŸæœ‰å­—ç¬¦ä¸², è€Œæ˜¯ç”Ÿäº§ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸² NSString *newStr =[strM stringByReplacingOccurrencesOfString:@&quot;520&quot; withString:@&quot;530&quot;]; OccurrencesOfString: éœ€è¦æ›¿æ¢çš„å­—ç¬¦ä¸² withString: ç”¨ä»€ä¹ˆæ›¿æ¢ options: æ›¿æ¢æ—¶çš„æœç´¢æ–¹å¼ range: æœç´¢çš„èŒƒå›´ è¿”å›å€¼: ä»£è¡¨æ›¿æ¢äº†å¤šå°‘ä¸ªå­—ç¬¦ä¸²","categories":[{"name":"iOS","slug":"iOS","permalink":"https://github.com/icoderRo/categories/iOS/"}],"tags":[{"name":"Objective-C","slug":"Objective-C","permalink":"https://github.com/icoderRo/tags/Objective-C/"}]}]}