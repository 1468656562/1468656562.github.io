<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>realm-swift3.0 | simonå°ğŸ“šåŠ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="æ•°æ®åº“" />
  
  
  
  
  <meta name="description" content="Realm-Swift3.0
ç®€ä»‹Realm äº2014 å¹´7æœˆå‘å¸ƒï¼Œæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ç§»åŠ¨æ•°æ®åº“å¼•æ“ï¼Œä¸“é—¨ä¸ºç§»åŠ¨åº”ç”¨çš„æ•°æ®æŒä¹…åŒ–è€Œç”Ÿã€‚å…¶ç›®çš„æ˜¯è¦å–ä»£ Core Data å’Œ SQLite,æ”¯æŒJavaã€Objective-Cã€JavaScriptã€Swiftã€Xamarinå¹³å°
Realmçš„ä¼˜ç‚¹åœ¨å®˜æ–¹ä¸Šæœ‰å¾ˆå¤šçš„è¯´æ˜, ç•¥ä¸¾ä¸¤ç‚¹:
1.æ˜“ä¸Šæ‰‹:æƒ³æ¯”äºCore Data å’ŒSQLite, Realmçš„">
<meta property="og:type" content="article">
<meta property="og:title" content="Realm-Swift3.0">
<meta property="og:url" content="https://github.com/icoderRo/2017/01/20/RealmSwift/index.html">
<meta property="og:site_name" content="simonå°ğŸ“šåŠ">
<meta property="og:description" content="Realm-Swift3.0
ç®€ä»‹Realm äº2014 å¹´7æœˆå‘å¸ƒï¼Œæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ç§»åŠ¨æ•°æ®åº“å¼•æ“ï¼Œä¸“é—¨ä¸ºç§»åŠ¨åº”ç”¨çš„æ•°æ®æŒä¹…åŒ–è€Œç”Ÿã€‚å…¶ç›®çš„æ˜¯è¦å–ä»£ Core Data å’Œ SQLite,æ”¯æŒJavaã€Objective-Cã€JavaScriptã€Swiftã€Xamarinå¹³å°
Realmçš„ä¼˜ç‚¹åœ¨å®˜æ–¹ä¸Šæœ‰å¾ˆå¤šçš„è¯´æ˜, ç•¥ä¸¾ä¸¤ç‚¹:
1.æ˜“ä¸Šæ‰‹:æƒ³æ¯”äºCore Data å’ŒSQLite, Realmçš„">
<meta property="og:image" content="https://ww3.sinaimg.cn/large/006tKfTcgy1fimyuw95jdj30g7083ta2.jpg">
<meta property="og:image" content="https://ww2.sinaimg.cn/large/006tKfTcgy1fin1d9jycxj317d0qmwim.jpg">
<meta property="og:updated_time" content="2017-08-17T14:45:09.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Realm-Swift3.0">
<meta name="twitter:description" content="Realm-Swift3.0
ç®€ä»‹Realm äº2014 å¹´7æœˆå‘å¸ƒï¼Œæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ç§»åŠ¨æ•°æ®åº“å¼•æ“ï¼Œä¸“é—¨ä¸ºç§»åŠ¨åº”ç”¨çš„æ•°æ®æŒä¹…åŒ–è€Œç”Ÿã€‚å…¶ç›®çš„æ˜¯è¦å–ä»£ Core Data å’Œ SQLite,æ”¯æŒJavaã€Objective-Cã€JavaScriptã€Swiftã€Xamarinå¹³å°
Realmçš„ä¼˜ç‚¹åœ¨å®˜æ–¹ä¸Šæœ‰å¾ˆå¤šçš„è¯´æ˜, ç•¥ä¸¾ä¸¤ç‚¹:
1.æ˜“ä¸Šæ‰‹:æƒ³æ¯”äºCore Data å’ŒSQLite, Realmçš„">
<meta name="twitter:image" content="https://ww3.sinaimg.cn/large/006tKfTcgy1fimyuw95jdj30g7083ta2.jpg">
  
    <link rel="alternate" href="/atom.xml" title="simonå°ğŸ“šåŠ" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/dialog.css">
  

  
    <link rel="stylesheet" href="/css/header-post.css" >
  

  
  
  

</head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 margin-top: 0px;"  
                href="#" data-toggle="modal" data-target="#myModal" >
                  <img width="124px" height="124px" alt="Hike News" src="/css/images/mylogo.jpg">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">Home</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">Archives</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">About</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div></li>
            </div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="[post]-RealmSwift" style="width: 75%; float:left;" class="article article-type-[post]" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      Realm-Swift3.0
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/01/20/RealmSwift/" class="article-date">
	  <time datetime="2017-01-19T16:00:00.000Z" itemprop="datePublished">2017-01-20</time>
	</a>

      
    <a class="article-category-link" href="/categories/iOS/">iOS</a>

      
	<a class="article-views">
	<span id="busuanzi_container_page_pv">
		PV:<span id="busuanzi_value_page_pv"></span>
	</span>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<h2 id="Realm-Swift3-0"><a href="#Realm-Swift3-0" class="headerlink" title="Realm-Swift3.0"></a>Realm-Swift3.0</h2><p><img src="https://ww3.sinaimg.cn/large/006tKfTcgy1fimyuw95jdj30g7083ta2.jpg" alt=""></p>
<h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>Realm äº2014 å¹´7æœˆå‘å¸ƒï¼Œæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ç§»åŠ¨æ•°æ®åº“å¼•æ“ï¼Œä¸“é—¨ä¸ºç§»åŠ¨åº”ç”¨çš„æ•°æ®æŒä¹…åŒ–è€Œç”Ÿã€‚å…¶ç›®çš„æ˜¯è¦å–ä»£ Core Data å’Œ SQLite,æ”¯æŒJavaã€Objective-Cã€JavaScriptã€Swiftã€Xamarinå¹³å°</p>
<p>Realmçš„ä¼˜ç‚¹åœ¨å®˜æ–¹ä¸Šæœ‰å¾ˆå¤šçš„è¯´æ˜, ç•¥ä¸¾ä¸¤ç‚¹:</p>
<p><strong>1.æ˜“ä¸Šæ‰‹</strong>:æƒ³æ¯”äºCore Data å’ŒSQLite, Realmçš„å­¦ä¹ æˆæœ¬ç›¸å¯¹æ¥è¯´ä¼šæ¯”è¾ƒä½, æ¯«ä¸å¤¸å¼ çš„è¯´, æŠŠå®˜æ–¹çš„æ–‡æ¡£å’ŒDemoçœ‹å®Œä¸€é, å°±å¯ä»¥å¿«é€Ÿçš„ä¸Šæ‰‹å¼€å‘åŠŸèƒ½ã€‚</p>
<p><strong>2.å¯è§†åŒ–</strong>: Realmæä¾›äº†ä¸€ä¸ªè½»é‡çº§çš„æ•°æ®åº“æŸ¥çœ‹å·¥å…·, åœ¨App Storeä¸­ä¸‹è½½<code>Realm Browser</code>, ç›¸æ¯”äºSQLite, ä½ å¯èƒ½éœ€è¦å»ä¸‹è½½ä»˜è´¹æˆ–è€…ç ´è§£ç‰ˆçš„Navicatã€SQL Managerç­‰è½¯ä»¶ä¼šæ–¹ä¾¿å¾ˆå¤š, å€ŸåŠ©äº<code>Realm Browser</code>è°ƒè¯•Realmæ•°æ®åº“å¾ˆä¾¿æ·ã€‚</p>
<ul>
<li>ä½¿ç”¨æ¨¡æ‹Ÿå™¨è¿›è¡Œè°ƒè¯•<ul>
<li>é€šè¿‡æ‰§è¡Œ<code>realm.configuration.fileURL</code>æ‰“å°å‡ºRealmæ•°æ®åº“çš„åœ°å€, Finderä¸­è·³è½¬è¿›å¯¹åº”çš„è·¯å¾„, ç”¨<code>Realm Browser</code>æ‰“å¼€å¯¹åº”çš„.realmæ–‡ä»¶å°±å¯ä»¥çœ‹åˆ°æ•°æ®å•¦ã€‚</li>
</ul>
</li>
<li>ä½¿ç”¨çœŸæœºè°ƒè¯•<ul>
<li>Xcode-&gt;Window-&gt;Devices,ç„¶åæ‰¾åˆ°å¯¹åº”çš„è®¾å¤‡ä¸é¡¹ç›®,å¯¼å‡ºxcappdataæ–‡ä»¶å,æ˜¾ç¤ºåŒ…å†…å®¹è¿›å…¥Documents,ä½¿ç”¨<code>Realm Browser</code>æ‰“å¼€.realmæ–‡ä»¶å³å¯.<a id="more"></a>
<h4 id="Xcodeæ’ä»¶"><a href="#Xcodeæ’ä»¶" class="headerlink" title="Xcodeæ’ä»¶"></a>Xcodeæ’ä»¶</h4>Realmçš„Xcodeæ’ä»¶ä»¤ Realm æ¨¡å‹çš„åˆ›å»ºæ›´åŠ æ–¹ä¾¿.gitHubä¸‹è½½ä¸€ä¸ªDemo<a href="https://github.com/realm/realm-cocoa">ä¼ é€é—¨</a>, æ‰¾åˆ°é‡Œé¢çš„Pluginç›®å½•ä¸‹çš„RealmPlugin.xcodeprojå¹¶è¿›è¡Œç¼–è¯‘ï¼Œé‡å¯ Xcodeä¹‹åæ’ä»¶å³å¯ç”Ÿæ•ˆã€‚<br><img src="https://ww2.sinaimg.cn/large/006tKfTcgy1fin1d9jycxj317d0qmwim.jpg" alt=""></li>
</ul>
</li>
</ul>
<h4 id="çº¯SWiftç‰ˆçš„å®‰è£…"><a href="#çº¯SWiftç‰ˆçš„å®‰è£…" class="headerlink" title="çº¯SWiftç‰ˆçš„å®‰è£…"></a>çº¯SWiftç‰ˆçš„å®‰è£…</h4><ul>
<li>ä½¿ç”¨ Realm æ„å»ºåº”ç”¨çš„åŸºæœ¬è¦æ±‚ï¼šiOS 8 åŠå…¶ä»¥ä¸Šç‰ˆæœ¬, macOS 10.9 åŠå…¶ä»¥ä¸Šç‰ˆæœ¬ï¼Œæ­¤å¤– Realm æ”¯æŒ tvOS å’Œ watchOS çš„æ‰€æœ‰ç‰ˆæœ¬ã€‚</li>
<li>éœ€è¦ä½¿ç”¨ Xcode 8.0 æˆ–è€…ä»¥åçš„ç‰ˆæœ¬ã€‚Realm Swift 2.3.0 æ˜¯æœ€åä¸€ä¸ªæ”¯æŒ Swift 2.x åŠ Xcode 7.3 çš„ç‰ˆæœ¬ã€‚</li>
<li>æ–¹æ³•1:Dynamic Framework<ul>
<li>ä¸‹è½½<a href="https://realm.io/cn/docs/swift/latest/#section-2" target="_blank" rel="external">Realmçš„æœ€æ–°ç‰ˆ</a>æœ¬å¹¶è§£å‹ã€‚</li>
<li>å‰å¾€æ‚¨ Xcode å·¥ç¨‹çš„â€Generalâ€è®¾ç½®é¡µã€‚å‰å¾€é€‚åˆæ‚¨é¡¹ç›®çš„ Swift ç‰ˆæœ¬ç›®å½•ï¼Œä»å…¶ä¸­çš„ iosæ–‡ä»¶å¤¹ä¸­ï¼Œæ‹–æ‹½<code>RealmSwift.framework</code> å’Œ<code>Realm.framework</code>åˆ°â€Embedded Binariesâ€é€‰é¡¹ä¸­ï¼Œç¡®è®¤Copy items if neededè¢«é€‰ä¸­ï¼ˆé™¤éæ‚¨çš„é¡¹ç›®ä¸­éœ€è¦åœ¨å¤šä¸ªå¹³å°ä¸­ä½¿ç”¨ Realmï¼‰ï¼Œå¹¶ç‚¹å‡»Finishã€‚</li>
<li>åœ¨æ‚¨çš„å•å…ƒæµ‹è¯•ç›®æ ‡çš„â€Build Settingsâ€ä¸­ï¼Œæ·»åŠ RealmSwift.frameworkçš„ä¸Šçº§ç›®å½•åˆ°æ‚¨çš„â€Framework Search Pathsâ€ä¸­ã€‚</li>
<li>å¦‚æœæ‚¨æ‰“ç®—åœ¨æ‚¨çš„ iOSã€tcOS æˆ–è€… watchOS å·¥ç¨‹ä¸­ä½¿ç”¨ Realmï¼Œè¯·åœ¨æ‚¨çš„ app ç›®æ ‡çš„â€œBuild Phasesâ€ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„â€Run Script Phaseâ€ï¼Œå¹¶åœ¨æ–‡æœ¬æ¡†ä¸­å†™å…¥<code>bash &quot;${BUILT_PRODUCTS_DIR}/${FRAMEWORKS_FOLDER_PATH}/Realm.framework/strip-frameworks.sh&quot;</code>å› ä¸ºè¦ç»•è¿‡è¿™ä¸ªAPPå•†åº—æäº¤çš„bugï¼Œè¿™ä¸€æ­¥åœ¨æ‰“åŒ…äºŒè¿›åˆ¶å‘å¸ƒç‰ˆæœ¬æ—¶æ˜¯å¿…é¡»ã€‚</li>
</ul>
</li>
<li>æ–¹æ³•2:Carthage<ul>
<li><a href="https://github.com/Carthage/Carthage#installing-carthage">å®‰è£… Carthage 0.17.0 æˆ–è€…æ›´é«˜ç‰ˆæœ¬</a></li>
<li>åœ¨Carthage ä¸­æ·»åŠ github <code>realm/realm-cocoa</code></li>
<li>è¿è¡Œ <code>carthage update</code></li>
<li>ä» Carthage/Build/ ç›®å½•ä¸‹å¯¹åº”å¹³å°æ–‡ä»¶å¤¹ä¸­ï¼Œå°† <code>RealmSwift.framework</code> å’Œ <code>Realm.framework</code> æ‹–æ›³åˆ°æ‚¨ Xcode å·¥ç¨‹Generalè®¾ç½®é¡¹çš„Linked Frameworks and Librariesé€‰é¡¹å¡ä¸­</li>
<li>iOS/tvOS/watchOS: åœ¨æ‚¨åº”ç”¨ç›®æ ‡çš„<strong>Build Phases</strong>è®¾ç½®é€‰é¡¹å¡ä¸­ï¼Œç‚¹å‡»â€œ+â€æŒ‰é’®å¹¶é€‰æ‹©â€œNew Run Script Phaseâ€ã€‚åœ¨æ–°å»ºçš„Run Scriptä¸­ï¼Œå¡«å†™:<code>/usr/local/bin/carthage copy-frameworks</code> åœ¨<strong>Input Files</strong>å†…æ·»åŠ æ‚¨æƒ³è¦ä½¿ç”¨çš„æ¡†æ¶è·¯å¾„ï¼Œä¾‹å¦‚:</li>
</ul>
</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$(<span class="type">SRCROOT</span>)/<span class="type">Carthage</span>/<span class="type">Build</span>/iOS/<span class="type">RealmSwift</span>.framework</div></pre></td></tr></table></figure>
<ul>
<li>æ–¹æ³•3:CocoaPods<ul>
<li>è¿è¡Œ <code>pod repo update</code>ï¼Œä»¥ç¡®ä¿ CocoaPods èƒ½å¤Ÿè·å–åˆ° Realm çš„æœ€æ–°ç‰ˆæœ¬</li>
<li>åœ¨Podfileä¸­ï¼Œæ·»åŠ use_frameworks!å’Œpod â€˜RealmSwiftâ€™ åˆ°æ‚¨çš„ä¸»è¦å’Œæµ‹è¯•ç›®æ ‡</li>
<li>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Xcode 8ï¼Œé‚£ä¹ˆå°†ä¸‹é¢ä»£ç å¤åˆ¶åˆ°æ‚¨çš„ Podfile åº•éƒ¨ï¼Œä»¥ä¾¿åœ¨å¿…è¦çš„æ—¶å€™æ›´æ–° Swift çš„ç‰ˆæœ¬ï¼š</li>
</ul>
</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">	installer.pods_project.targets.each <span class="keyword">do</span> |target|</div><div class="line">    target.build_configurations.each <span class="keyword">do</span> |config|</div><div class="line">      config.build_settings['<span class="type">SWIFT_VERSION'</span>] = '<span class="number">3.0</span>'</div><div class="line">    end</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<ul>
<li>åœ¨ç»ˆç«¯è¿è¡Œ pod install,é‡‡ç”¨ CocoaPods ç”Ÿæˆçš„ .xcworkspace æ¥è¿è¡Œå·¥ç¨‹ï¼</li>
<li>æ³¨æ„:æˆ‘è¿™è¾¹é€‰ç”¨CocoaPodsçš„æ–¹å¼å®‰è£…, å®‰è£…çš„æ—¶é—´è¿˜æ˜¯éœ€è¦æ¯”è¾ƒå¤šçš„, <strong>å¦‚æœå‘ç°pod search RealmSwiftç‰ˆæœ¬æ¯”è¾ƒä½, å…ˆå‡çº§ä¸€ä¸‹podç´¢å¼•åº“</strong></li>
</ul>
<h4 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h4><h5 id="æ”¯æŒçš„ç±»å‹"><a href="#æ”¯æŒçš„ç±»å‹" class="headerlink" title="æ”¯æŒçš„ç±»å‹"></a>æ”¯æŒçš„ç±»å‹</h5><ul>
<li>Realm æ”¯æŒä»¥ä¸‹çš„å±æ€§ç±»å‹ï¼šBoolã€Int8ã€Int16ã€Int32ã€Int64ã€Doubleã€Floatã€Stringã€Dateä»¥åŠDataã€‚</li>
<li>ä¹Ÿå¯ä»¥ä½¿ç”¨ List<object> å’Œ Object æ¥å»ºç«‹è¯¸å¦‚ä¸€å¯¹å¤šã€ä¸€å¯¹ä¸€ä¹‹ç±»çš„å…³ç³»æ¨¡å‹ï¼Œæ­¤å¤– Object çš„å­ç±»ä¹Ÿæ”¯æŒæ­¤åŠŸèƒ½ã€‚</object></li>
</ul>
<h5 id="æ•°æ®æ¨¡å‹-Object"><a href="#æ•°æ®æ¨¡å‹-Object" class="headerlink" title="æ•°æ®æ¨¡å‹(Object)"></a>æ•°æ®æ¨¡å‹(Object)</h5><ul>
<li>Realmæ•°æ®æ¨¡å‹æ˜¯åŸºäºæ ‡å‡†Swiftç±»æ¥è¿›è¡Œå®šä¹‰çš„, é€šè¿‡ç®€å•çš„é›†æˆ<strong>Object</strong>æˆ–è€…å…¶å­ç±», å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Realmæ•°æ®æ¨¡å‹å¯¹è±¡, å¯ä»¥ç»™Realmæ¨¡å‹æ·»åŠ æ–¹æ³•å’Œåè®®ç­‰, ç”¨æ³•å’Œswiftä¸­çš„å…¶ä»–å¯¹è±¡ç±»ä¼¼</li>
<li><p>Realm æ¨¡å‹çš„å±æ€§éœ€è¦è®¾ç½®ä¸ºdynamic varç‰¹æ€§ï¼Œä»¥ä¾¿å…¶èƒ½å¤Ÿè¢«æ•°æ®åº“åº•å±‚æ•°æ®æ‰€è®¿é—®ã€‚<strong>List</strong> å’Œ <strong>RealmOptional</strong> ä¸èƒ½è¢«è®¾ä¸ºåŠ¨æ€å±æ€§ï¼Œå› ä¸ºæ³›å‹å±æ€§ä¸èƒ½åœ¨ Objectiveâ€‘C è¿è¡Œæ—¶ä¸­è¢«è¯†åˆ«ï¼Œè€Œ dynamic å±æ€§ä¼šè¢«ç”¨äºè¿›è¡ŒåŠ¨æ€è°ƒåº¦ã€‚æ­¤å¤–è¿™ä¸¤ä¸ªç±»å‹åº”å½“å§‹ç»ˆå£°æ˜ä¸º let</p>
</li>
<li><p>ä¸ºå¯¹è±¡çš„ç±»å‹åˆ—è¡¨æ·»åŠ ç›®æ ‡ç±»å‹çš„å±æ€§ï¼Œæˆ–è€…Listï¼Œå°±å¯ä»¥åˆ›å»ºæ•°æ®å…³ç³»(relationship)å’ŒåµŒå¥—æ•°æ®ç»“æ„(nested data structure)ã€‚</p>
</li>
</ul>
<h5 id="å…³ç³»-Relationships"><a href="#å…³ç³»-Relationships" class="headerlink" title="å…³ç³»(Relationships)"></a>å…³ç³»(Relationships)</h5><ul>
<li><strong>Object</strong> èƒ½å¤Ÿå€ŸåŠ©Objectä»¥åŠListå±æ€§å’Œå¦ä¸€ä¸ªObjectå»ºç«‹è”ç³», Listçš„æ¥å£å’ŒArrayéå¸¸ç±»ä¼¼, èƒ½å¤Ÿé€šè¿‡ç´¢å¼•ä¸‹è¡¨è¿›è¡Œè®¿é—®, ä¸åŒä¹‹å¤„åœ¨äº, <strong>Listä¸­åªèƒ½å­˜æ”¾ç®€å•çš„Objectå­ç±»çš„ç±»å‹</strong></li>
</ul>
<h5 id="äº‹åŠ¡-Transactions"><a href="#äº‹åŠ¡-Transactions" class="headerlink" title="äº‹åŠ¡(Transactions)"></a>äº‹åŠ¡(Transactions)</h5><ul>
<li><p>Realm å†™å…¥æ“ä½œæ˜¯<em>åŒæ­¥ä»¥åŠé˜»å¡çš„</em>ï¼Œå¹¶ä¸ä¼šå¼‚æ­¥è¿è¡Œã€‚å¦‚æœçº¿ç¨‹ A å¼€å§‹äº†ä¸€ä¸ªå†™å…¥æ“ä½œï¼Œæ¥ç€åœ¨çº¿ç¨‹ A ç»“æŸä¹‹å‰ï¼Œçº¿ç¨‹ B åˆå¯¹åŒä¸€ä¸ª Realm æ•°æ®åº“å¼€å§‹äº†å†™å…¥æ“ä½œï¼Œé‚£ä¹ˆçº¿ç¨‹ A å¿…é¡»åœ¨çº¿ç¨‹ B çš„å†™å…¥æ“ä½œè¿›è¡Œä¹‹å‰ï¼Œå®Œæˆè‡ªå·±çš„å†™å…¥æ“ä½œï¼Œå¹¶å°†äº‹åŠ¡æäº¤ã€‚å†™å…¥æ“ä½œæ€»ä¼šåœ¨ beginWrite() æ“ä½œè¿›è¡Œçš„æ—¶å€™è‡ªåŠ¨åˆ·æ–°ï¼Œå› æ­¤é‡å¤å†™å…¥ (overlapping write) å¹¶ä¸ä¼šäº§ç”Ÿç«äº‰æ¡ä»¶ã€‚</p>
</li>
<li><p>ç”±äºå†™å…¥äº‹åŠ¡åƒå…¶ä½™ç¡¬ç›˜è¯»å†™æ“ä½œä¸€æ ·ï¼Œä¼šå‡ºç°å¤±è´¥çš„æƒ…å†µï¼Œå› æ­¤ Realm.write() ä»¥åŠ Realm.commitWrite() å¯ä»¥åŠ ä¸Š throwsæ ‡è®°ã€‚å› æ­¤ä½ å¯ä»¥å¤„ç†å’Œæ¢å¤è¯¸å¦‚ç¡¬ç›˜ç©ºé—´æº¢å‡ºä¹‹ç±»çš„é”™è¯¯ã€‚æ­¤å¤–ï¼Œå…¶ä»–çš„é”™è¯¯éƒ½æ— æ³•è¿›è¡Œæ¢å¤ã€‚</p>
<h5 id="ç»“æœé›†-Results"><a href="#ç»“æœé›†-Results" class="headerlink" title="ç»“æœé›†(Results)"></a>ç»“æœé›†(Results)</h5></li>
<li>é€šè¿‡æŸ¥è¯¢æ“ä½œï¼ŒRealm å°†ä¼šè¿”å›åŒ…å« Object é›†åˆçš„ Results å®ä¾‹ã€‚Results çš„è¡¨ç°å’Œ Array ååˆ†ç›¸ä¼¼ï¼Œå¹¶ä¸”åŒ…å«åœ¨ Results ä¸­çš„å¯¹è±¡èƒ½å¤Ÿé€šè¿‡ç´¢å¼•ä¸‹æ ‡è¿›è¡Œè®¿é—®ã€‚ </li>
<li>æ‰€æœ‰çš„æŸ¥è¯¢åœ¨ Realm ä¸­éƒ½æ˜¯å»¶è¿ŸåŠ è½½çš„ï¼Œåªæœ‰å½“å±æ€§è¢«è®¿é—®æ—¶ï¼Œæ‰èƒ½å¤Ÿè¯»å–ç›¸åº”çš„æ•°æ®ã€‚</li>
<li>æŸ¥è¯¢ç»“æœå¹¶ä¸æ˜¯æ•°æ®çš„æ‹·è´ï¼šä¿®æ”¹æŸ¥è¯¢ç»“æœä¼šç›´æ¥ä¿®æ”¹ç¡¬ç›˜ä¸Šçš„æ•°æ®ã€‚</li>
</ul>
<h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><h5 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h5><ul>
<li><p>é»˜è®¤é…ç½®çš„ Realm æ•°æ®åº“<br>é€šè¿‡è°ƒç”¨ Realm() æ¥åˆå§‹åŒ–ä»¥åŠè®¿é—®æˆ‘ä»¬çš„ realm å˜é‡ã€‚è¿™ä¸ªæ–¹æ³•å°†ä¼šè¿”å›ä¸€ä¸ª Realm å¯¹è±¡ï¼Œå¹¶æŒ‡å‘æ‚¨åº”ç”¨çš„ Documents (iOS) æˆ–è€… Application Support (OS X)æ–‡ä»¶å¤¹ä¸‹çš„ä¸€ä¸ªåä¸ºâ€œdefault.realmâ€çš„æ–‡ä»¶</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> realm = <span class="keyword">try</span>? <span class="type">Realm</span>()</div></pre></td></tr></table></figure>
</li>
<li><p>é…ç½®Realm<br>é€šè¿‡Realm.Configurationæ‚¨å¯ä»¥é…ç½®è¯¸å¦‚ Realm æ–‡ä»¶åœ¨ä½•å¤„å­˜å‚¨ä¹‹ç±»çš„ä¿¡æ¯ã€‚<br>é…ç½®åŒæ—¶ä¹Ÿå¯ä»¥åœ¨æ¯æ¬¡æ‚¨éœ€è¦ä½¿ç”¨ Realm å®ä¾‹çš„æ—¶å€™ä¼ é€’ç»™Realm(configuration: config)ï¼Œæˆ–è€…å¯ä»¥é€šè¿‡ Realm.Configuration.defaultConfiguration = config æ¥ä¸ºé»˜è®¤çš„ Realm æ•°æ®åº“è¿›è¡Œé…ç½®     </p>
</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">configRealmWithUser</span><span class="params">(<span class="number">_</span> username:String)</span></span> &#123;</div><div class="line">        </div><div class="line">	<span class="keyword">var</span> config = <span class="type">Realm</span>.<span class="type">Configuration</span>()</div><div class="line">        </div><div class="line">	config.fileURL = config.fileURL?.deletingLastPathComponent()</div><div class="line">            .appendingPathComponent(<span class="string">"<span class="subst">\(username)</span>.realm"</span>)</div><div class="line"></div><div class="line">	<span class="type">Realm</span>.<span class="type">Configuration</span>.defaultConfiguration = config</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨æ–¹å¼</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">configRealmWithUser(<span class="string">"simon"</span>)</div><div class="line"><span class="keyword">let</span> realm = <span class="keyword">try</span>! <span class="type">Realm</span>()</div></pre></td></tr></table></figure>
<ul>
<li>å†…å­˜æ•°æ®åº“<br>é€šå¸¸æƒ…å†µä¸‹ï¼ŒRealm æ•°æ®åº“æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­çš„ï¼Œä½†æ˜¯æ‚¨èƒ½å¤Ÿé€šè¿‡è®¾ç½® inMemoryIdentifier è€Œä¸æ˜¯è®¾ç½®Realm.Configuration ä¸­çš„ fileURL å±æ€§ï¼Œä»¥åˆ›å»ºä¸€ä¸ªå®Œå…¨åœ¨å†…å­˜ä¸­è¿è¡Œçš„æ•°æ®åº“ã€‚</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> realm = <span class="keyword">try</span>! <span class="type">Realm</span>(configuration: <span class="type">Realm</span>.<span class="type">Configuration</span>(inMemoryIdentifier: <span class="string">"MyInMemoryRealm"</span>))</div></pre></td></tr></table></figure>
<blockquote>
<p>å†…å­˜æ•°æ®åº“åœ¨æ¯æ¬¡ç¨‹åºè¿è¡ŒæœŸé—´éƒ½ä¸ä¼šä¿å­˜æ•°æ®ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ä¼šå¦¨ç¢åˆ° Realm çš„å…¶ä»–åŠŸèƒ½ï¼ŒåŒ…æ‹¬æŸ¥è¯¢ã€å…³ç³»ä»¥åŠçº¿ç¨‹å®‰å…¨ã€‚ å‡å¦‚æ‚¨éœ€è¦çµæ´»çš„æ•°æ®è¯»å†™ä½†åˆä¸æƒ³å‚¨å­˜æ•°æ®çš„è¯ï¼Œé‚£ä¹ˆå†…å­˜æ•°æ®åº“å¯¹æ‚¨æ¥è¯´ä¸€å®šæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p>
<p>å†…å­˜æ•°æ®åº“ä¼šåœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­åˆ›å»ºå¤šä¸ªæ–‡ä»¶ï¼Œç”¨æ¥åè°ƒå¤„ç†è¯¸å¦‚è·¨è¿›ç¨‹é€šçŸ¥ä¹‹ç±»çš„äº‹åŠ¡ã€‚ å®é™…ä¸Šæ²¡æœ‰ä»»ä½•çš„æ•°æ®ä¼šè¢«å†™å…¥åˆ°è¿™äº›æ–‡ä»¶å½“ä¸­ï¼Œé™¤éæ“ä½œç³»ç»Ÿç”±äºå†…å­˜è¿‡æ»¡éœ€è¦æ¸…é™¤ç£ç›˜ä¸Šçš„å¤šä½™ç©ºé—´ã€‚</p>
<p>æ³¨æ„ï¼š å½“æ‰€æœ‰å…·å¤‡ç‰¹å®šæ ‡è¯†ç¬¦çš„Realm å†…å­˜æ•°æ®åº“å®ä¾‹è¶…å‡ºå¯ç”¨èŒƒå›´ï¼Œä½†æ˜¯å´æ²¡æœ‰è¢«å¼•ç”¨çš„è¯ï¼Œé‚£ä¹ˆ<em> Realm å†…å­˜æ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šè¢«åˆ é™¤</em>ã€‚æˆ‘ä»¬å»ºè®®æ‚¨åœ¨åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œä¿æŒå¯¹ Realm å†…å­˜æ•°æ®åº“çš„å¼ºå¼•ç”¨ã€‚ï¼ˆå¯¹äºå­˜å‚¨åœ¨ç¡¬ç›˜å½“ä¸­çš„ Realm æ•°æ®åº“è€Œè¨€ï¼Œè¿™å¹¶ä¸æ˜¯å¿…é¡»çš„æ“ä½œã€‚ï¼‰</p>
</blockquote>
<h5 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h5><h5 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h5><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>: <span class="title">Object</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">dynamic</span> <span class="keyword">var</span> name = <span class="string">""</span></div><div class="line">    <span class="keyword">dynamic</span> <span class="keyword">var</span> age = <span class="number">0</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>: <span class="title">Object</span> </span>&#123;</div><div class="line">    <span class="keyword">dynamic</span> <span class="keyword">var</span> id = <span class="number">0</span></div><div class="line">    <span class="keyword">dynamic</span> <span class="keyword">var</span> name = <span class="string">""</span></div><div class="line">    <span class="keyword">dynamic</span> <span class="keyword">var</span> age = <span class="number">0</span></div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">primaryKey</span><span class="params">()</span></span> -&gt; <span class="type">String</span>? &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"id"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="æ–°å¢"><a href="#æ–°å¢" class="headerlink" title="æ–°å¢"></a>æ–°å¢</h5><ul>
<li>ä»¥å¯¹è±¡çš„å½¢å¼åˆ›å»º: æ­¤åˆ›å»ºæ–¹å¼, å¦‚æœæœ‰è®¾ç½®ä¸»é”®, åˆ™ä¸èƒ½åˆ›å»ºç›¸åŒçš„ä¸»é”®</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> mydog = <span class="type">Dog</span>()</div><div class="line">mydog.name = <span class="string">"aa"</span></div><div class="line">mydog.age = <span class="number">20</span></div><div class="line">mydog.id = <span class="number">5</span></div></pre></td></tr></table></figure>
<ul>
<li>ä»¥æ•°ç»„çš„å½¢å¼åˆ›å»º: å¦‚æœä¸»é”®ç›¸åŒ,åˆ™ä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®, æ²¡æœ‰è®¾ç½®ä¸»é”®, åˆ™updateåªèƒ½ä¸ºfalse</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">realm.create(<span class="type">Dog</span>.<span class="keyword">self</span>,</div><div class="line">			   value: [<span class="number">6</span>, <span class="string">"sssssss"</span>, <span class="number">747</span>],</div><div class="line">			   update: <span class="literal">true</span>)</div></pre></td></tr></table></figure>
<ul>
<li>ä»¥å­—å…¸çš„å½¢å¼åˆ›å»º: å¦‚æœä¸»é”®ç›¸åŒ,åˆ™ä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®, æ²¡æœ‰è®¾ç½®ä¸»é”®, åˆ™updateåªèƒ½ä¸ºfalse</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">realm.create(<span class="type">Dog</span>.<span class="keyword">self</span>,</div><div class="line">				value: [<span class="string">"id"</span>:<span class="number">6</span>, <span class="string">"name"</span>: <span class="string">"sada"</span>, <span class="string">"age"</span>:<span class="number">77</span>],</div><div class="line">				update: <span class="literal">true</span>)</div></pre></td></tr></table></figure>
<ul>
<li>å¤åˆæ¨¡å‹</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// åŸºç¡€æ¨¡å‹</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>: <span class="title">Object</span> </span>&#123;</div><div class="line">  <span class="keyword">dynamic</span> <span class="keyword">var</span> age = <span class="number">0</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// åŒ…å«æœ‰ Animal çš„æ¨¡å‹</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Duck</span>: <span class="title">Object</span> </span>&#123;</div><div class="line">  <span class="keyword">dynamic</span> <span class="keyword">var</span> animal: <span class="type">Animal</span>? = <span class="literal">nil</span></div><div class="line">  <span class="keyword">dynamic</span> <span class="keyword">var</span> name = <span class="string">""</span></div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Frog</span>: <span class="title">Object</span> </span>&#123;</div><div class="line">  <span class="keyword">dynamic</span> <span class="keyword">var</span> animal: <span class="type">Animal</span>? = <span class="literal">nil</span></div><div class="line">  <span class="keyword">dynamic</span> <span class="keyword">var</span> dateProp = <span class="type">NSDate</span>()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ç”¨æ³•</span></div><div class="line"><span class="keyword">let</span> duck = <span class="type">Duck</span>(value: [ <span class="string">"animal"</span>: [ <span class="string">"age"</span>: <span class="number">3</span> ], <span class="string">"name"</span>: <span class="string">"Gustav"</span> ])</div></pre></td></tr></table></figure>
<ul>
<li>Data ç±»å‹å­˜å‚¨(æœ¬åœ°å›¾ç‰‡ä¸ºä¾‹)</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DogPortrait</span>:<span class="title">Object</span> </span>&#123;</div><div class="line">    <span class="keyword">dynamic</span> <span class="keyword">var</span> data:<span class="type">Data</span>?</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> imageURL =  <span class="type">Bundle</span>.main.url(forResource: <span class="string">"sssss.png"</span>, withExtension: <span class="literal">nil</span>)!</div><div class="line"><span class="keyword">let</span> imageData = <span class="keyword">try</span>! <span class="type">Data</span>(contentsOf: imageURL)</div><div class="line"></div><div class="line"><span class="keyword">let</span> portrait = <span class="type">DogPortrait</span>()</div><div class="line">portrait.data = imageData</div><div class="line"></div><div class="line"><span class="keyword">try</span>! realm.write &#123;</div><div class="line">	realm.add(portrait)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// æŸ¥è¯¢</span></div><div class="line"><span class="keyword">let</span> portraits = realm.objects(<span class="type">DogPortrait</span>.<span class="keyword">self</span>)</div><div class="line"><span class="keyword">let</span> imgData = portraits[<span class="number">0</span>].data</div></pre></td></tr></table></figure>
<h5 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h5><ul>
<li>Realmæ— æ³•ç›´æ¥é™åˆ¶æŸ¥è¯¢æ•°é‡ã€‚</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> dogs = <span class="keyword">try</span>! <span class="type">Realm</span>().objects(<span class="type">Dog</span>.<span class="keyword">self</span>)</div></pre></td></tr></table></figure>
<ul>
<li>éœ€è¦æŸ¥è¯¢é™åˆ¶æ•°é‡, å¯ä»¥å€ŸåŠ©forå¾ªç¯</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;<span class="number">5</span> &#123;</div><div class="line">    <span class="keyword">let</span> dog = dogs[i]</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p><strong>Realmä¸ºä½•æ— æ³•é™åˆ¶æŸ¥è¯¢æ•°é‡ï¼Ÿ</strong></p>
<p>é€šå¸¸æŸ¥è¯¢æ•°æ®åº“æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨sqlè¯­å¥ä¸­æ·»åŠ ä¸€äº›é™åˆ¶è¯­å¥ï¼ˆæ¯”å¦‚rownumï¼Œlimitï¼Œtopç­‰ï¼‰æ¥é™åˆ¶è¿”å›çš„ç»“æœé›†çš„è¡Œæ•°ã€‚<br>ä½†æˆ‘ä»¬ä½¿ç”¨Realmä¼šå‘ç°ï¼Œå®ƒæ²¡æœ‰è¿™ç§åˆ†é¡µåŠŸèƒ½ï¼Œæ„Ÿè§‰ä¸ç®¡æŸ¥ä»€ä¹ˆéƒ½æ˜¯æŠŠæ‰€æœ‰çš„ç»“æœéƒ½æå‡ºæ¥ã€‚æ¯”å¦‚æˆ‘ä»¬åªè¦Userè¡¨çš„å‰10æ¡æ•°æ®ï¼Œé‚£ä¹ˆåšæ³•æ˜¯å…ˆæŸ¥è¯¢å‡ºæ‰€æœ‰çš„Useræ•°æ®ï¼Œå†ä»ç»“æœé›†ä¸­å–å‡ºå‰10æ¡æ•°æ®ã€‚<br>æœ‰äººå¯èƒ½ä¼šæ‹…å¿ƒï¼Œå¦‚æœæ•°æ®åº“ä¸­æ•°æ®éå¸¸å¤šï¼Œé‚£æ¯æ¬¡éƒ½è¿™ä¹ˆæŸ¥ä¸ä¼šå½±å“æ€§èƒ½å—ï¼Ÿ<br>å…¶å®å¤§å¯æ”¾å¿ƒï¼Œç”±äºRealméƒ½æ˜¯å»¶è¿ŸåŠ è½½çš„ï¼Œåªæœ‰å½“å±æ€§è¢«è®¿é—®æ—¶ï¼Œæ‰èƒ½å¤Ÿè¯»å–ç›¸åº”çš„æ•°æ®ã€‚ä¸åƒé€šå¸¸æ•°æ®åº“ï¼ŒæŸ¥è¯¢åï¼ŒæŸ¥è¯¢ç»“æœæ˜¯ä»æ•°æ®åº“æ‹·è´ä¸€ä»½å‡ºæ¥æ”¾åœ¨å†…å­˜ä¸­çš„ã€‚è€ŒRealmçš„æŸ¥è¯¢ç»“æœåº”è¯¥è¯´æ˜¯æ•°æ®åº“æ•°æ®çš„å¼•ç”¨ï¼Œå°±ç®—ä½ æŸ¥å‡ºæ¥ï¼Œå¦‚æœä¸ç”¨ä¹Ÿä¸ä¼šå ç”¨ä»€ä¹ˆå†…å­˜ã€‚</p>
</blockquote>
<ul>
<li>å¯ä»¥é€šè¿‡Predicateæ¡ä»¶æŸ¥è¯¢ç‰¹å®šæ•°æ®</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> results1 = realm.objects(<span class="type">Dog</span>.<span class="keyword">self</span>)</div><div class="line"></div><div class="line"><span class="keyword">let</span> results = realm.objects(<span class="type">Dog</span>.<span class="keyword">self</span>).<span class="built_in">filter</span>(<span class="type">NSPredicate</span>(format: <span class="string">"name contains 'A'"</span>))</div><div class="line">        </div><div class="line"><span class="keyword">let</span> result2 = results.<span class="built_in">filter</span>(<span class="string">"age &gt; 18"</span>)</div><div class="line"></div><div class="line"><span class="keyword">let</span> results3 = realm.objects(<span class="type">Dog</span>.<span class="keyword">self</span>).<span class="built_in">filter</span>(<span class="type">NSPredicate</span>(format: <span class="string">"name contains 'A'"</span>)).<span class="built_in">filter</span>(<span class="string">"age &gt; 16"</span>).sorted(byKeyPath: <span class="string">"age"</span>) <span class="comment">// å‡åº</span></div></pre></td></tr></table></figure>
<blockquote>
<p>1.NSPredicateï¼š</p>
<p>æ¯”è¾ƒæ“ä½œæ•°(comparison operand)å¯ä»¥æ˜¯å±æ€§åç§°æˆ–è€…æŸä¸ªå¸¸é‡ï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªæ“ä½œæ•°å¿…é¡»æ˜¯å±æ€§åç§°ï¼›<br>æ¯”è¾ƒæ“ä½œç¬¦ ==ã€&lt;=ã€&lt;ã€&gt;=ã€&gt;ã€!=, ä»¥åŠ BETWEEN æ”¯æŒ intã€longã€long longã€floatã€double ä»¥åŠ NSDate å±æ€§ç±»å‹çš„æ¯”è¾ƒï¼Œæ¯”å¦‚è¯´ age == 45ï¼›<br>ç›¸ç­‰æ¯”è¾ƒ ==ä»¥åŠ!=ï¼Œæ¯”å¦‚è¯´Results<employee>().filter(â€œcompany == %@â€, company)<br>æ¯”è¾ƒæ“ä½œç¬¦ == and != æ”¯æŒå¸ƒå°”å±æ€§ï¼›<br>å¯¹äº NSString å’Œ NSData å±æ€§æ¥è¯´ï¼Œæˆ‘ä»¬æ”¯æŒ ==ã€!=ã€BEGINSWITHã€CONTAINS ä»¥åŠ ENDSWITH æ“ä½œç¬¦ï¼Œæ¯”å¦‚è¯´ name CONTAINS â€˜Jaâ€™ï¼›<br>å­—ç¬¦ä¸²æ”¯æŒå¿½ç•¥å¤§å°å†™çš„æ¯”è¾ƒæ–¹å¼ï¼Œæ¯”å¦‚è¯´ name CONTAINS[c] â€˜Jaâ€™ ï¼Œæ³¨æ„åˆ°å…¶ä¸­å­—ç¬¦çš„å¤§å°å†™å°†è¢«å¿½ç•¥ï¼›<br>Realm æ”¯æŒä»¥ä¸‹å¤åˆæ“ä½œç¬¦ï¼šâ€œANDâ€ã€â€œORâ€ ä»¥åŠ â€œNOTâ€ã€‚æ¯”å¦‚è¯´ name BEGINSWITH â€˜Jâ€™ AND age &gt;= 32ï¼›<br>åŒ…å«æ“ä½œç¬¦ INï¼Œæ¯”å¦‚è¯´ name IN {â€˜Lisaâ€™, â€˜Spikeâ€™, â€˜Hachiâ€™}ï¼›<br>==ã€!=æ”¯æŒä¸ nil æ¯”è¾ƒï¼Œæ¯”å¦‚è¯´ Results<company>().filter(â€œceo == nilâ€)ã€‚æ³¨æ„åˆ°è¿™åªé€‚ç”¨äºæœ‰å…³ç³»çš„å¯¹è±¡ï¼Œè¿™é‡Œ ceo æ˜¯ Company æ¨¡å‹çš„ä¸€ä¸ªå±æ€§ã€‚<br>ANY æ¯”è¾ƒï¼Œæ¯”å¦‚è¯´ ANY student.age &lt; 21<br>æ³¨æ„ï¼Œè™½ç„¶æˆ‘ä»¬ä¸æ”¯æŒå¤åˆè¡¨è¾¾å¼ç±»å‹(aggregate expression type)ï¼Œä½†æ˜¯æˆ‘ä»¬æ”¯æŒå¯¹å¯¹è±¡çš„å€¼ä½¿ç”¨ BETWEEN æ“ä½œç¬¦ç±»å‹ã€‚æ¯”å¦‚è¯´ï¼ŒResults<person>.filter(â€œage BETWEEN %@â€, [42, 43]])ã€‚</person></company></employee></p>
<p>2.æ’åº:</p>
<p>sorted(byKeyPath:) ä»¥åŠ sorted(byProperty:) ä¸æ”¯æŒå°†å¤šä¸ªå±æ€§ç”¨ä½œæ’åºåŸºå‡†ï¼Œæ­¤å¤–ä¹Ÿä¸èƒ½é“¾å¼è°ƒç”¨ï¼ˆåªæœ‰æœ€åä¸€ä¸ª sorted ä¼šè¢«è°ƒç”¨ï¼‰ã€‚å¦‚æœè¦æŒ‰å¤šä¸ªå±æ€§è¿›è¡Œæ’åºçš„è¯ï¼Œè¯·ä½¿ç”¨ sorted(by:) æ–¹æ³•ï¼Œç„¶åå‘å…¶ä¸­ä¼ é€’å¤šä¸ª SortDescriptor å¯¹è±¡</p>
</blockquote>
<h5 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h5><ul>
<li>ç›´æ¥æ›´æ–°å†…å®¹, åœ¨å†™å…¥äº‹åŠ¡ä¸­é€šè¿‡è®¾ç½®æŸä¸ªå¯¹è±¡çš„å±æ€§ä»è€Œå®Œæˆå¯¹è±¡çš„æ›´æ–°æ“ä½œ</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mydog.name = <span class="string">"aa"</span></div><div class="line">mydog.age = <span class="number">20</span></div></pre></td></tr></table></figure>
<ul>
<li>é€šè¿‡ä¸»é”®æ›´æ–°, æ•°æ®æ¨¡å‹ä¸­è®¾ç½®äº†ä¸»é”®çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨Realm().add(_:update:)æ¥æ›´æ–°å¯¹è±¡ï¼Œæˆ–è€…å½“å¯¹è±¡ä¸å­˜åœ¨æ—¶æ’å…¥æ–°çš„å¯¹è±¡ã€‚</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> mydog = <span class="type">Dog</span>()</div><div class="line">mydog.name = <span class="string">"aa"</span></div><div class="line">mydog.age = <span class="number">20</span></div><div class="line">mydog.id = <span class="number">5</span></div><div class="line"></div><div class="line"><span class="keyword">try</span>! realm.write &#123;</div><div class="line">  realm.add(mydog, update: <span class="literal">true</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>é”®å€¼ç¼–ç <br><strong>Object</strong>ã€<strong>Result</strong> ä»¥åŠ Listéƒ½éµå®ˆé”®å€¼ç¼–ç (KVCï¼‰æœºåˆ¶, é€‚ç”¨äºå¤§é‡æ›´æ–°æ•°æ®</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span>? realm.write &#123;</div><div class="line">	results.first?.setValue(<span class="string">"33"</span>, forKeyPath: <span class="string">"age"</span>)</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<h5 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h5><ul>
<li>åˆ é™¤æ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> realm = <span class="keyword">try</span>! <span class="type">Realm</span>()</div><div class="line"><span class="keyword">try</span>? realm.write &#123;</div><div class="line">	realm.deleteAll()</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<ul>
<li>åˆ é™¤æŸæ¡æ•°æ®</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> realm = <span class="keyword">try</span>! <span class="type">Realm</span>()    </div><div class="line"><span class="keyword">let</span> results  = realm.objects(<span class="type">Dog</span>.<span class="keyword">self</span>).<span class="built_in">filter</span>(<span class="string">"age = 33"</span>)</div><div class="line"></div><div class="line">realm.beginWrite()</div><div class="line">realm.delete(dog)</div><div class="line"><span class="keyword">try</span>? realm.commitWrite()</div></pre></td></tr></table></figure>
<h5 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h5><p>Realm æ¨¡å‹çš„å±æ€§éœ€è¦è®¾ç½®ä¸ºdynamic varç‰¹æ€§ï¼Œä»¥ä¾¿å…¶èƒ½å¤Ÿè¢«æ•°æ®åº“åº•å±‚æ•°æ®æ‰€è®¿é—®ã€‚<br>List å’Œ RealmOptional ä¸èƒ½è¢«è®¾ä¸ºåŠ¨æ€å±æ€§ï¼Œå› ä¸ºæ³›å‹å±æ€§ä¸èƒ½åœ¨ Objectiveâ€‘C è¿è¡Œæ—¶ä¸­è¢«è¯†åˆ«, List å’Œ RealmOptionalåº”è¯¥ç”¨letä¿®é¥°</p>
<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>éå¯é€‰å€¼å½¢å¼</th>
<th>å¯é€‰å€¼å½¢å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bool</td>
<td>dynamic var value = false</td>
<td>let value = RealmOptional<bool>()</bool></td>
</tr>
<tr>
<td>Int</td>
<td>dynamic var value = 0</td>
<td>let value = RealmOptional<int>()</int></td>
</tr>
<tr>
<td>Float</td>
<td>dynamic var value: Float = 0.0</td>
<td>let value = RealmOptional<float>()</float></td>
</tr>
<tr>
<td>Double</td>
<td>dynamic var value: Double = 0.0</td>
<td>let value = RealmOptional<double>()</double></td>
</tr>
<tr>
<td>String</td>
<td>dynamic var value = â€œâ€</td>
<td>dynamic var value: String? = nil</td>
</tr>
<tr>
<td>Data</td>
<td>dynamic var value = NSData()</td>
<td>dynamic var value: NSData? = nil</td>
</tr>
<tr>
<td>Date</td>
<td>dynamic var value = NSDate()</td>
<td>dynamic var value: NSDate? = nil</td>
</tr>
<tr>
<td>Object</td>
<td>n/a: å¿…é¡»æ˜¯å¯é€‰å€¼</td>
<td>dynamic var value: Class?</td>
</tr>
<tr>
<td>List</td>
<td>let value = List<class>()</class></td>
<td>n/a: å¿…é¡»æ˜¯éå¯é€‰å€¼</td>
</tr>
<tr>
<td>LinkingObjects</td>
<td>let value = LinkingObjects(fromType: Class.self, property: â€œpropertyâ€)</td>
<td>n/a: å¿…é¡»æ˜¯éå¯é€‰å€¼</td>
</tr>
</tbody>
</table>
<ul>
<li>ç´¢å¼•å±æ€§<br>é‡å†™ Object.indexedProperties() æ–¹æ³•å¯ä»¥ä¸ºæ•°æ®æ¨¡å‹ä¸­éœ€è¦æ·»åŠ ç´¢å¼•çš„å±æ€§å»ºç«‹ç´¢å¼•;Realm æ”¯æŒå­—ç¬¦ä¸²ã€æ•´æ•°ã€å¸ƒå°”å€¼ä»¥åŠ NSDate å±æ€§ä½œä¸ºç´¢å¼•;<br>å¯¹å±æ€§è¿›è¡Œç´¢å¼•å¯ä»¥å‡å°‘æ’å…¥æ“ä½œçš„æ€§èƒ½è€—è´¹ï¼ŒåŠ å¿«æ¯”è¾ƒæ£€ç´¢çš„é€Ÿåº¦ã€‚</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">override</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">indexedProperties</span><span class="params">()</span></span> -&gt; [<span class="type">String</span>] &#123;</div><div class="line">	<span class="keyword">return</span> [<span class="string">"id"</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ä¸»é”®<br>é‡å†™ Object.primaryKey() å¯ä»¥è®¾ç½®æ¨¡å‹çš„ä¸»é”®ã€‚å£°æ˜ä¸»é”®ä¹‹åï¼Œå¯¹è±¡å°†å…è®¸è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä¸”æ›´æ–°é€Ÿåº¦æ›´åŠ é«˜æ•ˆï¼Œè€Œè¿™ä¹Ÿä¼šè¦æ±‚æ¯ä¸ªå¯¹è±¡ä¿æŒå”¯ä¸€æ€§ã€‚ ä¸€æ—¦å¸¦æœ‰ä¸»é”®çš„å¯¹è±¡è¢«æ·»åŠ åˆ° Realm ä¹‹åï¼Œè¯¥å¯¹è±¡çš„<strong>ä¸»é”®å°†ä¸å¯ä¿®æ”¹</strong>ã€‚</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">override</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">primaryKey</span><span class="params">()</span></span> -&gt; <span class="type">String</span>? &#123;</div><div class="line">	<span class="keyword">return</span> <span class="string">"id"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>å¿½ç•¥å±æ€§<br>é‡å†™ Object.ignoredProperties() å¯ä»¥é˜²æ­¢ Realm å­˜å‚¨æ•°æ®æ¨¡å‹çš„æŸä¸ªå±æ€§ã€‚Realm å°†ä¸ä¼šå¹²æ¶‰è¿™äº›å±æ€§çš„å¸¸è§„æ“ä½œï¼Œå®ƒä»¬å°†ç”±æˆå‘˜å˜é‡(ivar)æä¾›æ”¯æŒï¼Œå¹¶ä¸”æ‚¨èƒ½å¤Ÿè½»æ˜“é‡å†™å®ƒä»¬çš„ setter å’Œ getterã€‚</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">dynamic</span> <span class="keyword">var</span> tmpID = <span class="number">0</span></div><div class="line"><span class="keyword">var</span> name: <span class="type">String</span> &#123; <span class="comment">// åªè¯»å±æ€§å°†è¢«è‡ªåŠ¨å¿½ç•¥</span></div><div class="line">	<span class="keyword">return</span> <span class="string">"ignoredProperties"</span></div><div class="line">&#125;</div><div class="line">  </div><div class="line"><span class="keyword">override</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">ignoredProperties</span><span class="params">()</span></span> -&gt; [<span class="type">String</span>] &#123;</div><div class="line">	<span class="keyword">return</span> [<span class="string">"tmpID"</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>å¯ç©ºå±æ€§ <strong>String</strong>ã€<strong>NSDate</strong> ä»¥åŠ <strong>NSData</strong> å±æ€§é€šè¿‡æ ‡å‡†çš„ Swift è¯­æ³•å£°æ˜ä¸ºå¯ç©ºç±»å‹æˆ–è€…éç©ºç±»å‹; å£°æ˜å¯ç©ºçš„æ•°å€¼ç±»å‹å¯ä»¥ä½¿ç”¨<strong>RealmOptional</strong>ã€‚</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>: <span class="title">Object</span> </span>&#123;</div><div class="line">	<span class="comment">// å¯é€‰çš„å­—ç¬¦ä¸²å±æ€§ï¼Œé»˜è®¤ä¸º nil</span></div><div class="line">    <span class="keyword">dynamic</span> <span class="keyword">var</span> name: <span class="type">String</span>? = <span class="literal">nil</span></div><div class="line"></div><div class="line">    <span class="comment">// å¯é€‰çš„ int å±æ€§ï¼Œé»˜è®¤ä¸º nil</span></div><div class="line">    <span class="comment">// RealmOption å±æ€§åº”è¯¥å§‹ç»ˆå£°æ˜ä¸ºå¸¸é‡</span></div><div class="line">    <span class="comment">// å› ä¸ºç›®å‰ç›´æ¥ç»™è¿™ä¸ªå±æ€§è¿›è¡Œèµ‹å€¼å¹¶ä¸ä¼šèµ·ä»»ä½•ä½œç”¨</span></div><div class="line">    <span class="keyword">let</span> age = <span class="type">RealmOptional</span>&lt;<span class="type">Int</span>&gt;()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> realm = <span class="keyword">try</span>? <span class="type">Realm</span>()</div><div class="line"><span class="keyword">var</span> objc: optionObjc?</div><div class="line"><span class="keyword">try</span>? realm?.write &#123;</div><div class="line">objc =  realm?.create(optionObjc.<span class="keyword">self</span>, value: [<span class="string">"sx"</span>, <span class="number">12</span>], update: <span class="literal">false</span>)</div><div class="line">  <span class="comment">// è¯»å–æˆ–è€…ä¿®æ”¹ `RealmOptional` å¯ä»¥é€šè¿‡ `value` å±æ€§å®ç°</span></div><div class="line">	objc?.age.value = <span class="number">20</span> </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="å…³ç³»"><a href="#å…³ç³»" class="headerlink" title="å…³ç³»"></a>å…³ç³»</h5><ul>
<li>å¯¹ä¸€å…³ç³»:å¯¹äºå¤šå¯¹ä¸€æˆ–ä¸€å¯¹ä¸€çš„å…³ç³», åªéœ€è¦å£°æ˜ä¸€ä¸ªObjectå­ç±»ç±»å‹çš„å±æ€§å³å¯:</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>: <span class="title">Object</span> </span>&#123;</div><div class="line">    <span class="keyword">dynamic</span> <span class="keyword">var</span> id = <span class="number">0</span></div><div class="line">    <span class="keyword">dynamic</span> <span class="keyword">var</span> name = <span class="string">""</span></div><div class="line">    <span class="keyword">dynamic</span> <span class="keyword">var</span> age = <span class="number">0</span></div><div class="line">    <span class="keyword">dynamic</span> <span class="keyword">var</span> owner: <span class="type">Person</span>? <span class="comment">// å¯é€‰</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> dog = <span class="type">Dog</span>()</div><div class="line"><span class="keyword">let</span> person = <span class="type">Person</span>()</div><div class="line">dog.owner = person</div></pre></td></tr></table></figure>
<ul>
<li>å¯¹å¤šå…³ç³»:é€šè¿‡ List ç±»å‹çš„å±æ€§æ‚¨å¯ä»¥å®šä¹‰ä¸€ä¸ªå¯¹å¤šå…³ç³»ã€‚Listä¸­å¯ä»¥åŒ…å«ç®€å•ç±»å‹çš„Objectï¼Œå…¶æ¥å£ä¸å¯å˜çš„Arrayéå¸¸ç±»ä¼¼ã€‚<strong>æ³¨æ„ä½¿ç”¨let</strong></li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>: <span class="title">Object</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">dynamic</span> <span class="keyword">var</span> name = <span class="string">""</span></div><div class="line">    <span class="keyword">dynamic</span> <span class="keyword">var</span> age = <span class="number">0</span></div><div class="line">    <span class="keyword">let</span> dogs = <span class="type">List</span>&lt;<span class="type">Dog</span>&gt;()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> results = <span class="keyword">try</span>?<span class="type">Realm</span>().objects(<span class="type">Dog</span>.<span class="keyword">self</span>).<span class="built_in">filter</span>(<span class="string">"age &gt; 18"</span>)</div><div class="line">	<span class="keyword">let</span> person = <span class="type">Person</span>()</div><div class="line">	person.dogs.append((results?.first)!)</div><div class="line">	person.dogs.append((results?.last)!)</div><div class="line">        </div><div class="line"><span class="keyword">try</span>? <span class="type">Realm</span>().write &#123;</div><div class="line">	<span class="keyword">try</span>? <span class="type">Realm</span>().add(person)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>åå‘å…³ç³»<br>Realm æä¾›äº†<strong>é“¾æ¥å¯¹è±¡ (linking objects)</strong> å±æ€§æ¥è¡¨ç¤ºåå‘å…³ç³»</li>
</ul>
<blockquote>
<p>ä¾‹å¦‚ï¼Œä¸€ä¸ª Dog å¯¹è±¡å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªåä¸º owners çš„é“¾æ¥å¯¹è±¡å±æ€§ï¼Œè¿™ä¸ªå±æ€§ä¸­åŒ…å«äº†æŸäº› Person å¯¹è±¡ï¼Œè€Œè¿™äº› Person å¯¹è±¡åœ¨å…¶ dogs å±æ€§ä¸­åŒ…å«äº†è¿™ä¸€ä¸ªç¡®å®šçš„ Dog å¯¹è±¡ã€‚æ‚¨å¯ä»¥å°† owners å±æ€§è®¾ç½®ä¸º LinkingObjects ç±»å‹ï¼Œç„¶åæŒ‡å®šå…¶å…³ç³»ï¼Œè¯´æ˜å…¶å½“ä¸­åŒ…å«äº† Person å¯¹è±¡ã€‚</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>: <span class="title">Object</span> </span>&#123;</div><div class="line">    <span class="keyword">dynamic</span> <span class="keyword">var</span> name = <span class="string">""</span></div><div class="line">    <span class="keyword">dynamic</span> <span class="keyword">var</span> age = <span class="number">0</span></div><div class="line">     </div><div class="line">    <span class="comment">// Realm å¹¶ä¸ä¼šå­˜å‚¨è¿™ä¸ªå±æ€§ï¼Œå› ä¸ºè¿™ä¸ªå±æ€§åªå®šä¹‰äº† getter</span></div><div class="line">    <span class="comment">// å®šä¹‰â€œownersâ€ï¼Œå’Œ Person.dogs å»ºç«‹åå‘å…³ç³»</span></div><div class="line">    <span class="keyword">let</span> owners = <span class="type">LinkingObjects</span>(fromType: <span class="type">Person</span>.<span class="keyword">self</span>, property: <span class="string">"dogs"</span>)</div><div class="line">    </div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">RealmBackLink</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="keyword">let</span> realm = <span class="keyword">try</span>! <span class="type">Realm</span>()</div><div class="line">	<span class="keyword">let</span> dog1 = <span class="type">Dog</span>()</div><div class="line">	dog1.name = <span class="string">"ssssx"</span></div><div class="line">	dog1.age = <span class="number">22</span></div><div class="line">        </div><div class="line">	<span class="keyword">let</span> owner = <span class="type">Person</span>()</div><div class="line">	owner.dogs.append(dog1)</div><div class="line">        </div><div class="line">	<span class="keyword">try</span>! realm.write &#123; <span class="comment">// åªéœ€å­˜å‚¨personå³å¯</span></div><div class="line">		realm.add(owner)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">let</span> dogs = realm.objects(<span class="type">Dog</span>.<span class="keyword">self</span>)</div><div class="line">	<span class="keyword">let</span> ownerName = dogs.first?.owners.<span class="built_in">map</span>&#123;$<span class="number">0</span>.name&#125;</div><div class="line">        <span class="built_in">print</span>(ownerName)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h5><p>éœ€è¦æ³¨æ„çš„ä¸€ä»¶äº‹æƒ…å°±æ˜¯ä¸èƒ½è®©å¤šä¸ªçº¿ç¨‹éƒ½æŒæœ‰åŒä¸€ä¸ª Realm å¯¹è±¡çš„ å®ä¾‹ ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹éœ€è¦è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒä»¬åˆ†åˆ«ä¼šè·å–è‡ªå·±æ‰€éœ€è¦çš„å®ä¾‹ï¼ˆå¦åˆ™åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šå‘ç”Ÿçš„æ›´æ”¹å°±ä¼šé€ æˆå…¶ä»–çº¿ç¨‹å¾—åˆ°ä¸å®Œæ•´æˆ–è€…ä¸ä¸€è‡´çš„æ•°æ®ï¼‰</p>
<ul>
<li>è·¨çº¿ç¨‹ä¼ é€’å®ä¾‹<br>Object çš„æœªç®¡ç†å®ä¾‹ï¼ˆunmanaged) å¯ä»¥å®‰å…¨åœ°è·¨çº¿ç¨‹ä¼ é€’, ç®¡ç†å®ä¾‹çš†å—åˆ°çº¿ç¨‹çš„é™åˆ¶(Realmã€Objectã€Results æˆ–è€… List), è¿™æ„å‘³ç€å®ƒä»¬åªèƒ½å¤Ÿåœ¨è¢«åˆ›å»ºçš„çº¿ç¨‹ä¸Šä½¿ç”¨ã€‚Realm æä¾›äº†ä¸€ä¸ªæœºåˆ¶ï¼Œé€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤æ¥ä¿è¯å—åˆ°çº¿ç¨‹é™åˆ¶çš„å®ä¾‹èƒ½å¤Ÿå®‰å…¨ä¼ é€’:<ul>
<li>é€šè¿‡å—åˆ°çº¿ç¨‹é™åˆ¶çš„å¯¹è±¡æ¥æ„é€ ä¸€ä¸ª ThreadSafeReference</li>
<li>å°†æ­¤ ThreadSafeReference ä¼ é€’ç»™ç›®æ ‡çº¿ç¨‹æˆ–è€…é˜Ÿåˆ—</li>
<li>é€šè¿‡åœ¨ç›®æ ‡ Realm ä¸Šè°ƒç”¨ Realm.resolve(_:) æ¥è§£ææ­¤å¼•ç”¨</li>
</ul>
</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> person = <span class="type">Person</span>(name: <span class="string">"Jane"</span>)</div><div class="line"><span class="keyword">try</span>! realm.write &#123;</div><div class="line">  realm.add(person)</div><div class="line">&#125;</div><div class="line"><span class="keyword">let</span> personRef = <span class="type">ThreadSafeReference</span>(to: person)</div><div class="line"><span class="type">DispatchQueue</span>(label: <span class="string">"background"</span>).async &#123;</div><div class="line">  autoreleasepool &#123;</div><div class="line">    <span class="keyword">let</span> realm = <span class="keyword">try</span>! <span class="type">Realm</span>()</div><div class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> person = realm.resolve(personRef) <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">return</span> <span class="comment">// person å·²è¢«åˆ é™¤</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">try</span>! realm.write &#123;</div><div class="line">      person.name = <span class="string">"Jane Doe"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>ThreadSafeReferenceå¯¹è±¡æœ€å¤šåªèƒ½å¤Ÿè§£æä¸€æ¬¡;ThreadSafeReference è§£æå¤±è´¥çš„è¯ï¼Œå°†ä¼šå¯¼è‡´ Realm çš„åŸå§‹ç‰ˆæœ¬è¢«é”æ­»ï¼Œç›´åˆ°å¼•ç”¨è¢«é‡Šæ”¾ä¸ºæ­¢ã€‚å› æ­¤ï¼ŒThreadSafeReference çš„ç”Ÿå‘½å‘¨æœŸåº”è¯¥å¾ˆçŸ­(åŠ ä¸Šautoreleasepool)ã€‚</p>
</blockquote>
<ul>
<li>è¿™äº›ç±»å‹çš„æŸäº›å±æ€§å’Œæ–¹æ³•å¯ä»¥åœ¨ä»»æ„çº¿ç¨‹ä¸­è¿›è¡Œè®¿é—®</li>
</ul>
<blockquote>
<p>Realm: æ‰€æœ‰çš„å±æ€§ã€ç±»æ–¹æ³•å’Œæ„é€ å™¨ï¼›all properties, class methods, and initializers</p>
<p>Object: isInvalidatedã€objectSchemaã€realmï¼Œä»¥åŠæ‰€æœ‰çš„ç±»æ–¹æ³•å’Œæ„é€ å™¨ï¼›<br>Results: objectClassName å’Œ realm</p>
<p>List: isInvalidatedã€objectClassName å’Œ realmã€‚</p>
</blockquote>
<ul>
<li>è·¨çº¿ç¨‹ä½¿ç”¨æ•°æ®åº“<br>åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ä½¿ç”¨åŒä¸€ä¸ª Realm æ–‡ä»¶, éœ€è¦åœ¨æ¯ä¸€ä¸ªçº¿ç¨‹åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„Realm å®ä¾‹, åªè¦æŒ‡å®šçš„é…ç½®æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ Realm å®ä¾‹éƒ½å°†ä¼šæŒ‡å‘ç¡¬ç›˜ä¸Šçš„åŒä¸€ä¸ªæ–‡ä»¶ã€‚</li>
</ul>
<blockquote>
<p>æš‚æ—¶ä¸æ”¯æŒå…±äº«Realmå®ä¾‹</p>
<p>å½“å†™å…¥å¤§é‡æ•°æ®çš„æ—¶å€™ï¼Œåœ¨ä¸€ä¸ªå•ç‹¬äº‹åŠ¡ä¸­é€šè¿‡æ‰¹é‡æ‰§è¡Œå¤šæ¬¡æ•°æ®ä¿®æ”¹æ“ä½œæ˜¯éå¸¸é«˜æ•ˆçš„ã€‚äº‹åŠ¡ä¹Ÿå¯ä»¥ä½¿ç”¨ Grand Central Dispatch(GCD) åœ¨åå°è¿è¡Œï¼Œä»¥é˜²æ­¢é˜»å¡ä¸»çº¿ç¨‹ã€‚ Realm å¯¹è±¡å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”å®ƒä¹Ÿä¸èƒ½å¤Ÿè·¨çº¿ç¨‹å…±äº«ï¼Œ<strong>å› æ­¤è¦ä¸ºæ¯ä¸€ä¸ªè¦æ‰§è¡Œè¯»å–æˆ–è€…å†™å…¥æ“ä½œçš„çº¿ç¨‹æˆ–è€… dispatch é˜Ÿåˆ—åˆ›å»ºä¸€ä¸ª Realm å®ä¾‹</strong>ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªåœ¨åå°é˜Ÿåˆ—ä¸­æ’å…¥ç™¾ä¸‡æ•°æ®çš„ä¾‹å­ï¼š</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="type">DispatchQueue</span>(label: <span class="string">"background"</span>).async &#123;</div><div class="line">  autoreleasepool &#123;</div><div class="line">    <span class="comment">// åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­è·å– Realm å’Œè¡¨å®ä¾‹</span></div><div class="line">    <span class="keyword">let</span> realm = <span class="keyword">try</span>! <span class="type">Realm</span>()</div><div class="line"></div><div class="line">    <span class="comment">// é€šè¿‡å¼€å¯å†™å…¥æ“ä½œå°†å†™å…¥é—­åŒ…åˆ†æˆå¤šä¸ªå¾®å°éƒ¨åˆ†</span></div><div class="line">    <span class="keyword">for</span> idx1 <span class="keyword">in</span> <span class="number">0</span>..&lt;<span class="number">1000</span> &#123;</div><div class="line">      realm.beginWrite()</div><div class="line"></div><div class="line">      <span class="comment">// é€šè¿‡å­—å…¸æ’å…¥è¡Œï¼Œå¿½ç•¥å±æ€§æ¬¡åº</span></div><div class="line">      <span class="keyword">for</span> idx2 <span class="keyword">in</span> <span class="number">0</span>..&lt;<span class="number">1000</span> &#123;</div><div class="line">        realm.create(<span class="type">Person</span>.<span class="keyword">self</span>, value: [</div><div class="line">          <span class="string">"name"</span>: <span class="string">"<span class="subst">\(idx1)</span>"</span>,</div><div class="line">          <span class="string">"birthdate"</span>: <span class="type">Date</span>(timeIntervalSince1970: <span class="type">TimeInterval</span>(idx2))</div><div class="line">        ])</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">// æäº¤å†™å…¥äº‹åŠ¡ä»¥ç¡®ä¿æ•°æ®åœ¨å…¶ä»–çº¿ç¨‹å¯ç”¨</span></div><div class="line">      <span class="keyword">try</span>! realm.commitWrite()</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Json"><a href="#Json" class="headerlink" title="Json"></a>Json</h4><p>Realm æ²¡æœ‰æä¾›å¯¹ JSON çš„ç›´æ¥æ”¯æŒï¼Œä½†å¯ä»¥ä½¿ç”¨ NSJSONSerialization.JSONObjectWithData(_:options:) çš„è¾“å‡ºå®Œæˆä» JSON ä¸­æ·»åŠ  Object çš„æ“ä½œã€‚ ç”±æ­¤æ‰€äº§ç”Ÿçš„ KVC å…¼å®¹çš„å¯¹è±¡å¯ä»¥ä½¿ç”¨åˆ›å»ºå’Œæ›´æ–°å¯¹è±¡çš„ æ ‡å‡† API æ¥æ·»åŠ /æ›´æ–° Objectã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// è¡¨ç¤ºåŸå¸‚çš„ä¸€ä¸ª Realm å¯¹è±¡</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">City</span>: <span class="title">Object</span> </span>&#123;</div><div class="line">  <span class="keyword">dynamic</span> <span class="keyword">var</span> city = <span class="string">""</span></div><div class="line">  <span class="keyword">dynamic</span> <span class="keyword">var</span> id = <span class="number">0</span></div><div class="line">  <span class="comment">// å…¶å®ƒç©ºä½™çš„å±æ€§â€¦</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> data = <span class="string">"&#123;\"name\": \"San Francisco\", \"cityId\": 123&#125;"</span>.data(using: .utf8)!</div><div class="line"><span class="keyword">let</span> realm = <span class="keyword">try</span>! <span class="type">Realm</span>()</div><div class="line"></div><div class="line"><span class="comment">// ä»åŒ…å« JSON çš„ NSData ä¸­æ’å…¥æ•°æ®</span></div><div class="line"><span class="keyword">try</span>! realm.write &#123;</div><div class="line">  <span class="keyword">let</span> json = <span class="keyword">try</span>! <span class="type">JSONSerialization</span>.jsonObject(with: data, options: [])</div><div class="line">  realm.create(<span class="type">City</span>.<span class="keyword">self</span>, value: json, update: <span class="literal">true</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœåœ¨ JSON ä¸­åŒ…å«äº†åµŒå¥—çš„å¯¹è±¡æˆ–è€…æ•°ç»„çš„è¯ï¼Œè¿™äº›æ•°æ®éƒ½å°†è¢«è‡ªåŠ¨æ˜ å°„åˆ°å¯¹ä¸€ä»¥åŠå¯¹å¤šå…³ç³»â€”â€”å‚è§åµŒå¥—å¯¹è±¡ ä¸€èŠ‚è·å–è¯¦æƒ…ã€‚</p>
<p>å½“ä½¿ç”¨è¿™ç§æ–¹æ³•åœ¨ Realm ä¸­æ’å…¥æˆ–è€…æ›´æ–° JSON æ•°æ®çš„æ—¶å€™ï¼Œ<strong>è¦æ³¨æ„ Realm éœ€è¦ç¡®ä¿ JSON çš„å±æ€§åå’Œç±»å‹èƒ½å¤Ÿä¸ Object å±æ€§å®Œå…¨åŒ¹é…</strong>ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>float å±æ€§åº”å½“ä½¿ç”¨ float è¿›è¡Œåˆå§‹åŒ–â€”â€”æ‚¨ä¹Ÿå¯ä»¥é€‰æ‹© NSNumbersã€‚</li>
<li>NSDate å’Œ NSData å±æ€§æ— æ³•ä»å­—ç¬¦ä¸²è¿›è¡Œè‡ªåŠ¨æ¨æ–­ï¼Œè€Œåº”è¯¥åœ¨ä¼ é€’ç»™ Realm().create(_:value:update:) ä¹‹å‰è½¬æ¢ä¸ºé€‚å½“çš„ç±»å‹ã€‚</li>
<li>å¦‚æœ JSON ä¸­çš„å±æ€§æ˜¯ null (ä¾‹å¦‚ï¼šNSNull) æä¾›ç»™äº†ä¸€ä¸ªå¿…éœ€å±æ€§çš„è¯ï¼Œé‚£ä¹ˆä¼šæŠ›å‡ºå¼‚å¸¸ã€‚<br>å¦‚æœæŸä¸ªå¿…éœ€å±æ€§åœ¨æ’å…¥æ“ä½œä¸­æ²¡æœ‰æä¾›çš„è¯ï¼Œé‚£ä¹ˆä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li>
<li>Realm å°†ä¼šå¿½ç•¥ JSON ä¸­æ²¡æœ‰ä»¥ Object å®šä¹‰çš„ä»»ä½•å±æ€§ã€‚</li>
</ul>
<p>å¦‚æœ JSON æ¨¡å¼å’Œ Realm å¯¹è±¡æ— æ³•å®Œå…¨ä¸€è‡´çš„è¯ï¼Œæ¨èä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æ¨¡å‹æ˜ å°„æ¡†æ¶<br>ã€‚</p>
</blockquote>
<h5 id="é€šçŸ¥"><a href="#é€šçŸ¥" class="headerlink" title="é€šçŸ¥"></a>é€šçŸ¥</h5><ul>
<li>Realmé€šçŸ¥ é€šçŸ¥é—­åŒ…-å¯ä»¥åœ¨æ•´ä¸ª Realm æ•°æ®åº“ä¸Šè¿›è¡Œæ³¨å†Œã€‚å½“ç›¸å…³ Realm çš„å†™æ“ä½œäº‹åŠ¡è¢«æäº¤ä¹‹åï¼Œæ— è®ºè¿™ä¸ªäº‹åŠ¡å‘ç”Ÿåœ¨ä½•ç§çº¿ç¨‹æˆ–è€…ä½•ç§è¿›ç¨‹ä¹‹ä¸­ï¼Œè¿™ä¸ªé€šçŸ¥å¤„ç†é—­åŒ…éƒ½å°†ä¼šè¢«è§¦å‘ï¼š</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> realm  = <span class="keyword">try</span>? <span class="type">Realm</span>()</div><div class="line"><span class="built_in">print</span>(realm?.configuration.fileURL <span class="keyword">as</span> <span class="type">Any</span>)</div><div class="line"><span class="keyword">let</span> token = realm?.addNotificationBlock(&#123; (note, realm) <span class="keyword">in</span></div><div class="line">	<span class="built_in">print</span>(note, realm)</div><div class="line">&#125;)</div><div class="line">        </div><div class="line">        </div><div class="line"><span class="keyword">try</span>? realm?.write &#123;</div><div class="line">	realm?.create(<span class="type">Dog</span>.<span class="keyword">self</span>, value: [<span class="string">"id"</span>:<span class="number">1</span>, <span class="string">"name"</span>: <span class="string">"xssx"</span>], update: <span class="literal">true</span>) <span class="comment">// æ‰§è¡Œé€šçŸ¥é—­åŒ…</span></div><div class="line">&#125;</div><div class="line">        </div><div class="line">token?.stop() <span class="comment">// å…³é—­é€šçŸ¥</span></div><div class="line">        </div><div class="line"><span class="keyword">try</span>? realm?.write &#123;</div><div class="line">	realm?.create(<span class="type">Dog</span>.<span class="keyword">self</span>, value: [<span class="string">"name"</span>: <span class="string">"stopxssx"</span>], update: <span class="literal">true</span>)<span class="comment">// ä¸æ‰§è¡Œé€šçŸ¥é—­åŒ…</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>é›†åˆé€šçŸ¥<br>é›†åˆé€šçŸ¥æ˜¯å¼‚æ­¥è§¦å‘çš„ï¼Œé¦–å…ˆå®ƒä¼šåœ¨åˆå§‹åŒ–çš„æ—¶å€™è§¦å‘ï¼Œéšåå½“æŸä¸ªå†™å…¥äº‹åŠ¡æ”¹å˜äº†é›†åˆä¸­çš„æ‰€æœ‰æˆ–è€…æŸä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œé€šçŸ¥éƒ½ä¼šå†æ¬¡è§¦å‘ã€‚<br>æ‰€æœ‰çš„CRUDéƒ½ä¼šä¼ é€’åˆ°é€šçŸ¥é—­åŒ…å½“ä¸­çš„ RealmCollectionChange(æšä¸¾) å‚æ•°è®¿é—®åˆ°ã€‚è¿™ä¸ªå¯¹è±¡å½“ä¸­åŒ…å«äº†å— deletionsã€insertions å’Œ modifications çŠ¶æ€æ‰€å½±å“çš„ç´¢å¼•ä¿¡æ¯, å…¶å®šä¹‰å¦‚ä¸‹:</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">RealmCollectionChange</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">case</span> initial(<span class="type">T</span>) <span class="comment">// åˆå§‹åŒ–ä¼šæ‰§è¡Œ</span></div><div class="line">    <span class="keyword">case</span> update(<span class="type">T</span>, deletions: [<span class="type">Int</span>], insertions: [<span class="type">Int</span>], modifications: [<span class="type">Int</span>])</div><div class="line">    <span class="keyword">case</span> error(<span class="type">Error</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœå¤„ç†é›†åˆä¸­çš„å¯¹è±¡çš„å±æ€§å‘ç”Ÿæ›´æ”¹, éƒ½å¯ä»¥ç›‘å¬çš„åˆ°<strong>ä¿®æ”¹ (modifications)</strong> çš„é€šçŸ¥, å½“<strong>å¯¹ä¸€å…³ç³»å’Œå¯¹å¤šå…³ç³»</strong> å‘ç”Ÿå˜åŒ–æ—¶ä¹Ÿä¼šè§¦å‘è¿™ä¸ªçŠ¶æ€å˜åŒ–ï¼Œä½†æ˜¯å¯¹äº <strong>åå‘å…³ç³»</strong> æ¥è¯´åˆ™ä¸ä¼šè§¦å‘è¿™ä¸ªå˜åŒ–ã€‚</p>
<p>ä»¥tableViewä¸ºä¾‹å­,ç›‘å¬æ•°æ®æºçš„æ”¹å˜, åšå‡ºç›¸åº”æ›´æ”¹, å½“ç„¶å¯ä»¥é‡å†™æ•°æ®æºçš„setæ–¹æ³•, ä½†å¦‚æœæ•°æ®æºé‡Œçš„æŸä¸€ä¸ªæ•°æ®é‡Œçš„å±æ€§å‘ç”Ÿäº†æ›´æ”¹, æ˜¯æ— æ³•ç›‘å¬çš„åˆ°, å½“ç„¶å¯ä»¥ç»“åˆKVO,ä½†è¿™æ ·ä¸€æ¥å°±ç›¸å¯¹å¤æ‚äº†; soé›†åˆé€šçŸ¥è¿˜æ˜¯æŒºå®ç”¨çš„ã€‚</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>: <span class="title">Object</span> </span>&#123;</div><div class="line">  <span class="keyword">dynamic</span> <span class="keyword">var</span> name = <span class="string">""</span></div><div class="line">  <span class="keyword">dynamic</span> <span class="keyword">var</span> age = <span class="number">0</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>: <span class="title">Object</span> </span>&#123;</div><div class="line">  <span class="keyword">dynamic</span> <span class="keyword">var</span> name = <span class="string">""</span></div><div class="line">  <span class="keyword">let</span> dogs = <span class="type">List</span>&lt;<span class="type">Dog</span>&gt;()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UITableViewController</span> </span>&#123;</div><div class="line">  <span class="keyword">var</span> notificationToken: <span class="type">NotificationToken</span>? = <span class="literal">nil</span></div><div class="line"></div><div class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">super</span>.viewDidLoad()</div><div class="line">    <span class="keyword">let</span> realm = <span class="keyword">try</span>! <span class="type">Realm</span>()</div><div class="line">    </div><div class="line">    <span class="comment">// å¯¹resultsçš„ç›‘å¬</span></div><div class="line">    <span class="keyword">let</span> results = realm.objects(<span class="type">Person</span>).<span class="built_in">filter</span>(<span class="string">"age &gt; 5"</span>)</div><div class="line"></div><div class="line">    <span class="comment">// è§‚å¯Ÿ Results é€šçŸ¥</span></div><div class="line">    notificationToken = results.addNotificationBlock &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] (changes: <span class="type">RealmCollectionChange</span>) <span class="keyword">in</span></div><div class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> tableView = <span class="keyword">self</span>?.tableView <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</div><div class="line">      <span class="keyword">switch</span> changes &#123;</div><div class="line">      <span class="keyword">case</span> .initial:</div><div class="line">        <span class="comment">// Results ç°åœ¨å·²ç»å¡«å……å®Œæ¯•ï¼Œå¯ä»¥ä¸éœ€è¦é˜»å¡ UI å°±å¯ä»¥è¢«è®¿é—®</span></div><div class="line">        tableView.reloadData()</div><div class="line">        <span class="keyword">break</span></div><div class="line">      <span class="keyword">case</span> .update(<span class="number">_</span>, <span class="keyword">let</span> deletions, <span class="keyword">let</span> insertions, <span class="keyword">let</span> modifications):</div><div class="line">        <span class="comment">// Query results have changed, so apply them to the UITableView</span></div><div class="line">        tableView.beginUpdates()</div><div class="line">        tableView.insertRows(at: insertions.<span class="built_in">map</span>(&#123; <span class="type">IndexPath</span>(row: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;),</div><div class="line">                           with: .automatic)</div><div class="line">        tableView.deleteRows(at: deletions.<span class="built_in">map</span>(&#123; <span class="type">IndexPath</span>(row: $<span class="number">0</span>, section: <span class="number">0</span>)&#125;),</div><div class="line">                           with: .automatic)</div><div class="line">        tableView.reloadRows(at: modifications.<span class="built_in">map</span>(&#123; <span class="type">IndexPath</span>(row: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;), </div><div class="line">                           with: .automatic)</div><div class="line">        tableView.endUpdates()</div><div class="line">        <span class="keyword">break</span></div><div class="line">      <span class="keyword">case</span> .error(<span class="keyword">let</span> error):</div><div class="line">        <span class="comment">// å¦‚æœåœ¨åå°å·¥ä½œçº¿ç¨‹ä¸­æ‰“å¼€ Realm æ–‡ä»¶ï¼Œåˆ™ä¼šå‘ç”Ÿé”™è¯¯</span></div><div class="line">        <span class="built_in">fatalError</span>(<span class="string">"<span class="subst">\(error)</span>"</span>)</div><div class="line">        <span class="keyword">break</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">deinit</span> &#123;</div><div class="line">    notificationToken?.stop()</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>å¯¹è±¡é€šçŸ¥<ul>
<li>Realm æ”¯æŒå¯¹è±¡çº§åˆ«çš„é€šçŸ¥ã€‚åœ¨ç‰¹å®šçš„ Realm å¯¹è±¡ä¸Šè¿›è¡Œé€šçŸ¥çš„æ³¨å†Œï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ­¤å¯¹è±¡è¢«åˆ é™¤æ—¶ã€æˆ–è€…è¯¥å¯¹è±¡æ‰€ç®¡ç†çš„å±æ€§å€¼è¢«ä¿®æ”¹æ—¶è·å–ç›¸åº”çš„é€šçŸ¥ã€‚</li>
<li>åªæœ‰ç”± Realm æ•°æ®åº“æ‰€ç®¡ç†çš„å¯¹è±¡æ‰èƒ½å¤Ÿè¿›è¡Œé€šçŸ¥æ³¨å†Œã€‚</li>
<li>è¿™ä¸ªé€šçŸ¥å¤„ç†é—­åŒ…å°†åŒ…å«æœ‰ ObjectChange æšä¸¾å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æœ‰å¯¹è±¡è¢«åˆ é™¤ã€æ˜¯å¦æœ‰å¯¹è±¡çš„å±æ€§å€¼å‘ç”Ÿäº†æ”¹å˜ï¼Œä»¥åŠæ˜¯å¦æœ‰é”™è¯¯å‘ç”Ÿã€‚</li>
<li><strong>å¯¹è±¡è¢«åˆ é™¤çš„è¯</strong>ï¼Œé‚£ä¹ˆè¿™ä¸ªé€šçŸ¥é—­åŒ…å°†ä¼šå¸¦ç€ ObjectChange.deleted çš„å‚æ•°è¢«è°ƒç”¨ã€‚è¿™ä¸ªé—­åŒ…å°†ä¸ä¼šè¢«å†æ¬¡è°ƒç”¨ã€‚</li>
<li><strong>å¯¹è±¡çš„å±æ€§å‘ç”Ÿäº†å˜æ›´çš„è¯</strong>ï¼Œé‚£ä¹ˆè¿™ä¸ªé—­åŒ…å°†ä¼šå¸¦ç€ ObjectChange.change çš„å‚æ•°è¢«è°ƒç”¨ã€‚è¿™ä¸ªæšä¸¾å°†ä¼šåŒ…å«æœ‰ PropertyChange ç±»å‹çš„æ•°ç»„ã€‚æ¯ä¸ªæ•°ç»„å€¼éƒ½åŒ…å«æœ‰è¢«ä¿®æ”¹çš„å±æ€§å(ä»¥å­—ç¬¦ä¸²çš„å½¢å¼æä¾›)ã€ä¿®æ”¹å‰çš„å±æ€§å€¼ä»¥åŠå½“å‰çš„å±æ€§å€¼ã€‚</li>
<li><strong>æœ‰é”™è¯¯å‘ç”Ÿ</strong>ï¼Œé‚£ä¹ˆè¿™ä¸ªé—­åŒ…å°†ä¼šå¸¦æœ‰ ObjectChange.error çš„å‚æ•°è¢«è°ƒç”¨ã€‚è¿™ä¸ªé—­åŒ…å°†ä¸ä¼šè¢«å†æ¬¡è°ƒç”¨ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ObjectChange</span> </span>&#123;</div><div class="line">    <span class="keyword">case</span> error(<span class="number">_</span>: <span class="type">NSError</span>)</div><div class="line">    <span class="keyword">case</span> change(<span class="number">_</span>: [<span class="type">PropertyChange</span>])</div><div class="line">    <span class="keyword">case</span> deleted</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">StepCounter</span>: <span class="title">Object</span> </span>&#123;</div><div class="line">  <span class="keyword">dynamic</span> <span class="keyword">var</span> steps = <span class="number">0</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> stepCounter = <span class="type">StepCounter</span>()</div><div class="line"><span class="keyword">let</span> realm = <span class="keyword">try</span>! <span class="type">Realm</span>()</div><div class="line"><span class="keyword">try</span>! realm.write &#123;</div><div class="line">    realm.add(stepCounter)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> token : <span class="type">NotificationToken</span>?</div><div class="line">token = stepCounter.addNotificationBlock &#123; change <span class="keyword">in</span></div><div class="line">    <span class="keyword">switch</span> change &#123; <span class="comment">// ç›‘å¬å¯¹è±¡</span></div><div class="line">    <span class="keyword">case</span> .change(<span class="keyword">let</span> properties):</div><div class="line">        <span class="keyword">for</span> property <span class="keyword">in</span> properties &#123;</div><div class="line">            <span class="keyword">if</span> property.name == <span class="string">"steps"</span> &amp;&amp; property.newValue <span class="keyword">as</span>! <span class="type">Int</span> &gt; <span class="number">1000</span> &#123;</div><div class="line">                token = <span class="literal">nil</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    <span class="keyword">case</span> .error(<span class="keyword">let</span> error):</div><div class="line">    <span class="keyword">case</span> .deleted:</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ç•Œé¢é©±åŠ¨æ›´æ–°<br>Realm çš„é€šçŸ¥æ€»æ˜¯ä»¥å¼‚æ­¥çš„æ–¹å¼è¿›è¡Œä¼ é€’ï¼Œå› æ­¤è¿™äº›æ“ä½œæ°¸è¿œä¸ä¼šé˜»å¡ä¸» UI çº¿ç¨‹ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´åº”ç”¨å¡é¡¿ã€‚å¦‚æœéœ€è¦åœ¨ä¸»çº¿ç¨‹åŒæ­¥ä¼ é€’, å¹¶ç«‹å³æ›´æ–°åœ¨UIä¸Š, å°±å¯ä»¥ä½¿ç”¨<strong>ç•Œé¢é©±åŠ¨æ›´æ–° (Interface-Driven writes)ã€‚</strong></li>
</ul>
<blockquote>
<p>æ¡ˆä¾‹: å‡è®¾ç”¨æˆ·éœ€è¦å‘è¡¨è§†å›¾å½“ä¸­æ’å…¥ä¸€ä¸ªé¡¹ç›®ã€‚ç†æƒ³çŠ¶å†µä¸‹ï¼ŒUI å°†ä¼šå°†è¿™ä¸ªæ“ä½œç”¨åŠ¨ç”»è¡¨ç°å‡ºæ¥ï¼Œç„¶åå½“ç”¨æˆ·å®ŒæˆåŠ¨ä½œçš„æ—¶å€™ç«‹å³å¯åŠ¨ç›¸åº”çš„æ“ä½œã€‚</p>
<p>ç„¶è€Œï¼Œæ­¤æ’å…¥æ“ä½œçš„ Realm å˜æ›´é€šçŸ¥å°†ä¼šå»¶æ—¶ä¸€æ®µæ—¶é—´æ‰è¿›è¡Œä¼ é€’ï¼Œå®ƒä¼šå…ˆå°†ä¸€ä¸ªå¯¹è±¡æ·»åŠ åˆ°è¡¨è§†å›¾èƒŒåæ‰€å…³è”çš„é›†åˆå½“ä¸­ï¼Œéšåå†å°è¯•å»åœ¨ UI å½“ä¸­æ’å…¥ä¸€ä¸ªæ–°çš„é¡¹ç›®ã€‚è¿™ç§åŒé‡æ’å…¥å°†ä¼šå¯¼è‡´ UI ä¸åå°æ•°æ®ä¹‹é—´çš„æ•°æ®ä¸ä¸€è‡´ï¼Œè€Œè¿™å¾€å¾€ä¼šå¯¼è‡´åº”ç”¨å´©æºƒï¼ğŸ’¥NSInternalInconsistencyExceptionğŸ’¥</p>
<p>å€ŸåŠ© Realm.commitWrite(withoutNotifying:)ï¼Œè¿™æ ·åœ¨æ‰§è¡Œç•Œé¢é©±åŠ¨æ›´æ–°çš„æ—¶å€™ï¼Œé€šè¿‡ä¼ é€’é€šçŸ¥é—­åŒ…çš„é€šçŸ¥ä»¤ç‰Œçš„æ–¹å¼ï¼Œè¿™æ ·å°±ä¸ä¼šå¯¹å˜æ›´æ“ä½œæ‰§è¡ŒäºŒæ¬¡å“åº”ã€‚</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">token = collection.addNotificationBlock &#123; changes <span class="keyword">in</span></div><div class="line">  <span class="keyword">switch</span> changes &#123;</div><div class="line">  <span class="keyword">case</span> .initial:</div><div class="line">    tableView.reloadData()</div><div class="line">    <span class="keyword">break</span></div><div class="line">  <span class="keyword">case</span> .update(<span class="number">_</span>, <span class="keyword">let</span> deletions, <span class="keyword">let</span> insertions, <span class="keyword">let</span> modifications):</div><div class="line">    tableView.beginUpdates()</div><div class="line">    tableView.insertRows(at: insertions.<span class="built_in">map</span>(&#123; <span class="type">IndexPath</span>(row: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;),</div><div class="line">                         with: .automatic)</div><div class="line">    tableView.deleteRows(at: deletions.<span class="built_in">map</span>(&#123; <span class="type">IndexPath</span>(row: $<span class="number">0</span>, section: <span class="number">0</span>)&#125;),</div><div class="line">                         with: .automatic)</div><div class="line">    tableView.reloadRows(at: modifications.<span class="built_in">map</span>(&#123; <span class="type">IndexPath</span>(row: $<span class="number">0</span>, section: <span class="number">0</span>) &#125;),</div><div class="line">                         with: .automatic)</div><div class="line">    tableView.endUpdates()</div><div class="line">    <span class="keyword">break</span></div><div class="line">  <span class="keyword">case</span> .error(<span class="keyword">let</span> error):</div><div class="line">    <span class="keyword">break</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">insertItem</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</div><div class="line"> <span class="comment">// åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ</span></div><div class="line">  collection.realm!.beginWrite()</div><div class="line">  collection.insert(<span class="type">Item</span>(), at: <span class="number">0</span>)</div><div class="line">  tableView.insertRows(at: [<span class="type">IndexPath</span>(row: <span class="number">0</span>, section: <span class="number">0</span>)], with: .automatic)</div><div class="line">  </div><div class="line">  <span class="comment">// ç¡®ä¿ä¸ä¼šé‡å¤æ‰§è¡Œ</span></div><div class="line">  collection.realm!.commitWrite(withoutNotifying: [token])</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="æ•°æ®åº“è¿ç§»"><a href="#æ•°æ®åº“è¿ç§»" class="headerlink" title="æ•°æ®åº“è¿ç§»"></a>æ•°æ®åº“è¿ç§»</h5><p>å¦‚æœä¿®æ”¹äº†æ•°æ®æ¨¡å‹, ä¾‹å¦‚æ–°å¢å±æ€§, å°±éœ€è¦è¿›è¡Œæ•°æ®çš„è¿ç§»</p>
<ul>
<li>ç®€å•è¯´æ˜</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* Realm.Configuration(fileURL: &lt;#T##URL?#&gt;,</span></div><div class="line"> inMemoryIdentifier: &lt;#T##String?#&gt;,</div><div class="line">  syncConfiguration: &lt;#T##SyncConfiguration?#&gt;, </div><div class="line">  encryptionKey: &lt;#T##Data?#&gt;,</div><div class="line">  readOnly: &lt;#T##Bool#&gt;, </div><div class="line">  schemaVersion: &lt;#T##UInt64#&gt;,</div><div class="line">  migrationBlock: &lt;#T##MigrationBlock?##MigrationBlock?##(Migration, UInt64) -&gt; Void#&gt;,</div><div class="line">  deleteRealmIfMigrationNeeded: &lt;#T##Bool#&gt;,</div><div class="line">  shouldCompactOnLaunch: &lt;#T##((Int, Int) -&gt; Bool)?##((Int, Int) -&gt; Bool)?##(Int, Int) -&gt; Bool#&gt;,</div><div class="line">  objectTypes: &lt;#T##[Object.Type]?#&gt;)</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">configRealmWithUser</span><span class="params">(<span class="number">_</span> username:String)</span></span> &#123;   </div><div class="line">	<span class="keyword">var</span> config = <span class="type">Realm</span>.<span class="type">Configuration</span>()      </div><div class="line">	config.fileURL = 	config.fileURL?.deletingLastPathComponent()</div><div class="line">            .appendingPathComponent(<span class="string">"<span class="subst">\(username)</span>.realm"</span>)</div><div class="line"><span class="comment">//      config.syncConfiguration = </span></div><div class="line"><span class="comment">//      config.migrationBlock = </span></div><div class="line"><span class="comment">//      config.schemaVersion = </span></div><div class="line"><span class="comment">//  ... </span></div><div class="line">      </div><div class="line">	<span class="type">Realm</span>.<span class="type">Configuration</span>.defaultConfiguration = config</div><div class="line">&#125;</div><div class="line"></div><div class="line">æˆ–:å‚æ•°çš„ä¸ªæ•°ä»»æ„ç»„åˆçš„blockå½¢å¼</div><div class="line"><span class="keyword">let</span> config = <span class="type">Realm</span>.<span class="type">Configuration</span>(</div><div class="line">	schemaVersion: <span class="number">1</span>, migrationBlock: &#123; (migration, oldSchemaVersion) <span class="keyword">in</span></div><div class="line">	<span class="keyword">if</span> (oldSchemaVersion &lt; <span class="number">1</span>) &#123;</div><div class="line">	<span class="comment">// ä»€ä¹ˆéƒ½ä¸è¦åšï¼Realm ä¼šè‡ªè¡Œæ£€æµ‹æ–°å¢å’Œéœ€è¦ç§»é™¤çš„å±æ€§ï¼Œç„¶åè‡ªåŠ¨æ›´æ–°ç¡¬ç›˜ä¸Šçš„æ•°æ®åº“æ¶æ„</span></div><div class="line">	&#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="type">Realm</span>.<span class="type">Configuration</span>.defaultConfiguration = config</div></pre></td></tr></table></figure>
<ul>
<li>å€¼çš„æ›´æ–°</li>
</ul>
<blockquote>
<p>åœ¨è¿ç§»é—­åŒ…ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè°ƒç”¨Migration().enumerateObjects(ofType: <em>:</em>:) æ¥æšä¸¾ç‰¹å®šç±»å‹çš„æ¯ä¸ª Object å¯¹è±¡ï¼Œç„¶åæ‰§è¡Œå¿…è¦çš„è¿ç§»é€»è¾‘ã€‚æ³¨æ„ï¼Œå¯¹æšä¸¾ä¸­æ¯ä¸ªå·²å­˜åœ¨çš„ Object å®ä¾‹æ¥è¯´ï¼Œåº”è¯¥æ˜¯é€šè¿‡è®¿é—® oldObject å¯¹è±¡è¿›è¡Œè®¿é—®ï¼Œè€Œæ›´æ–°ä¹‹åçš„å®ä¾‹åº”è¯¥é€šè¿‡ newObject è¿›è¡Œè®¿é—®ï¼š</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// åœ¨ application(application:didFinishLaunchingWithOptions:) ä¸­è¿›è¡Œé…ç½®</span></div><div class="line"></div><div class="line"><span class="type">Realm</span>.<span class="type">Configuration</span>.defaultConfiguration = <span class="type">Realm</span>.<span class="type">Configuration</span>(</div><div class="line">  schemaVersion: <span class="number">1</span>,</div><div class="line">  migrationBlock: &#123; migration, oldSchemaVersion <span class="keyword">in</span></div><div class="line">    <span class="keyword">if</span> (oldSchemaVersion &lt; <span class="number">1</span>) &#123;</div><div class="line">      <span class="comment">// enumerateObjects(ofType:_:) æ–¹æ³•éå†äº†å­˜å‚¨åœ¨ Realm æ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ªâ€œPersonâ€å¯¹è±¡</span></div><div class="line">      migration.enumerateObjects(ofType: <span class="type">Person</span>.className()) &#123; oldObject, newObject <span class="keyword">in</span></div><div class="line">        <span class="comment">// å°†åå­—è¿›è¡Œåˆå¹¶ï¼Œå­˜æ”¾åœ¨ fullName åŸŸä¸­</span></div><div class="line">        <span class="keyword">let</span> firstName = oldObject![<span class="string">"firstName"</span>] <span class="keyword">as</span>! <span class="type">String</span></div><div class="line">        <span class="keyword">let</span> lastName = oldObject![<span class="string">"lastName"</span>] <span class="keyword">as</span>! <span class="type">String</span></div><div class="line">        newObject![<span class="string">"fullName"</span>] = <span class="string">"<span class="subst">\(firstName)</span> <span class="subst">\(lastName)</span>"</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;)</div></pre></td></tr></table></figure>
<ul>
<li>å±æ€§çš„é‡å‘½å</li>
</ul>
<blockquote>
<p>åœ¨è¿ç§»è¿‡ç¨‹ä¸­å¯¹ç±»ä¸­æŸä¸ªå±æ€§è¿›è¡Œé‡å‘½åæ“ä½œï¼Œæ¯”èµ·æ‹·è´å€¼å’Œä¿ç•™å…³ç³»æ¥è¯´è¦æ›´ä¸ºé«˜æ•ˆã€‚</p>
<p>è¦åœ¨è¿ç§»è¿‡ç¨‹ä¸­å¯¹æŸä¸ªå±æ€§å°±è¿›è¡Œé‡å‘½åçš„è¯ï¼Œè¯·ç¡®ä¿æ‚¨çš„æ–°æ¨¡å‹å½“ä¸­çš„è¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªå…¨æ–°çš„åå­—ï¼Œå®ƒçš„åå­—ä¸èƒ½å’ŒåŸæœ‰æ¨¡å‹å½“ä¸­çš„åå­—é‡åˆã€‚</p>
<p>å¦‚æœæ–°çš„å±æ€§æ‹¥æœ‰ä¸åŒçš„å¯ç©ºæ€§æˆ–è€…ç´¢å¼•è®¾ç½®çš„è¯ï¼Œè¿™äº›é…ç½®ä¼šåœ¨é‡å‘½åæ“ä½œæœŸé—´ç”Ÿæ•ˆã€‚</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// åœ¨ application(application:didFinishLaunchingWithOptions:) å½“ä¸­ä½¿ç”¨</span></div><div class="line"></div><div class="line"><span class="type">Realm</span>.<span class="type">Configuration</span>.defaultConfiguration = <span class="type">Realm</span>.<span class="type">Configuration</span>(</div><div class="line">  schemaVersion: <span class="number">1</span>,</div><div class="line">  migrationBlock: &#123; migration, oldSchemaVersion <span class="keyword">in</span></div><div class="line">    <span class="comment">// æˆ‘ä»¬ç›®å‰è¿˜æ²¡æœ‰è¿ç§»ä»»ä½•ä¸œè¥¿ï¼Œå› æ­¤ oldSchemaVersion == 0</span></div><div class="line">    <span class="keyword">if</span> (oldSchemaVersion &lt; <span class="number">1</span>) &#123;</div><div class="line">      <span class="comment">// é‡å‘½åæ“ä½œåº”è¯¥åœ¨è°ƒç”¨ `enumerateObjects(ofType: _:)` ä¹‹å¤–å®Œæˆ</span></div><div class="line">      migration.renameProperty(onType: <span class="type">Person</span>.className(), from: <span class="string">"yearsSinceBirth"</span>, to: <span class="string">"age"</span>)</div><div class="line">    &#125;</div><div class="line">  &#125;)</div></pre></td></tr></table></figure>
<ul>
<li>å¤šä¸ªç‰ˆæœ¬çš„æ§åˆ¶</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="type">Realm</span>.<span class="type">Configuration</span>.defaultConfiguration = <span class="type">Realm</span>.<span class="type">Configuration</span>(</div><div class="line">  schemaVersion: <span class="number">2</span>,</div><div class="line">  migrationBlock: &#123; migration, oldSchemaVersion <span class="keyword">in</span></div><div class="line">    <span class="comment">// enumerateObjects:block: éå†äº†å­˜å‚¨åœ¨ Realm æ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ªâ€œPersonâ€å¯¹è±¡</span></div><div class="line">    migration.enumerateObjects(ofType: <span class="type">Person</span>.className()) &#123; oldObject, newObject <span class="keyword">in</span></div><div class="line">      <span class="comment">// åªæœ‰å½“ Realm æ•°æ®åº“çš„æ¶æ„ç‰ˆæœ¬ä¸º 0 çš„æ—¶å€™ï¼Œæ‰æ·»åŠ  â€œfullNameâ€ å±æ€§</span></div><div class="line">      <span class="keyword">if</span> oldSchemaVersion &lt; <span class="number">1</span> &#123;</div><div class="line">        <span class="keyword">let</span> firstName = oldObject![<span class="string">"firstName"</span>] <span class="keyword">as</span>! <span class="type">String</span></div><div class="line">        <span class="keyword">let</span> lastName = oldObject![<span class="string">"lastName"</span>] <span class="keyword">as</span>! <span class="type">String</span></div><div class="line">        newObject![<span class="string">"fullName"</span>] = <span class="string">"<span class="subst">\(firstName)</span> <span class="subst">\(lastName)</span>"</span></div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">// åªæœ‰å½“ Realm æ•°æ®åº“çš„æ¶æ„ç‰ˆæœ¬ä¸º 0 æˆ–è€… 1 çš„æ—¶å€™ï¼Œæ‰æ·»åŠ â€œemailâ€å±æ€§</span></div><div class="line">      <span class="keyword">if</span> oldSchemaVersion &lt; <span class="number">2</span> &#123;</div><div class="line">          newObject![<span class="string">"email"</span>] = <span class="string">""</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line"></div><div class="line"><span class="comment">// Realm æ•°æ®åº“ä¼šè‡ªåŠ¨æ‰§è¡Œæ­¤æ•°æ®è¿ç§»ï¼Œç„¶åæˆåŠŸè¿›è¡Œè®¿é—®</span></div><div class="line"><span class="keyword">let</span> realm = <span class="keyword">try</span>! <span class="type">Realm</span>()</div></pre></td></tr></table></figure>
<h5 id="æ•°æ®åº“åŠ å¯†"><a href="#æ•°æ®åº“åŠ å¯†" class="headerlink" title="æ•°æ®åº“åŠ å¯†"></a>æ•°æ®åº“åŠ å¯†</h5><ul>
<li>Realm æ”¯æŒåœ¨åˆ›å»º Realm æ•°æ®åº“æ—¶é‡‡ç”¨64ä½çš„å¯†é’¥å¯¹æ•°æ®åº“æ–‡ä»¶è¿›è¡Œ AES-256+SHA2 åŠ å¯†ã€‚</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// äº§ç”Ÿéšæœºå¯†é’¥</span></div><div class="line"><span class="keyword">var</span> key = <span class="type">Data</span>(<span class="built_in">count</span>: <span class="number">64</span>)</div><div class="line"><span class="number">_</span> = key.withUnsafeMutableBytes &#123; bytes <span class="keyword">in</span></div><div class="line">  <span class="type">SecRandomCopyBytes</span>(kSecRandomDefault, <span class="number">64</span>, bytes)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// æ‰“å¼€åŠ å¯†æ–‡ä»¶</span></div><div class="line"><span class="keyword">let</span> config = <span class="type">Realm</span>.<span class="type">Configuration</span>(encryptionKey: key)</div><div class="line"><span class="keyword">do</span> &#123;</div><div class="line">  <span class="keyword">let</span> realm = <span class="keyword">try</span> <span class="type">Realm</span>(configuration: config)</div><div class="line">  <span class="comment">// å’Œå¾€å¸¸ä¸€æ ·ä½¿ç”¨ Realm å³å¯</span></div><div class="line">  <span class="keyword">let</span> dogs = realm.objects(<span class="type">Dog</span>).<span class="built_in">filter</span>(<span class="string">"name contains 'Fido'"</span>)</div><div class="line">&#125; <span class="keyword">catch</span> <span class="keyword">let</span> error <span class="keyword">as</span> <span class="type">NSError</span> &#123;</div><div class="line">  <span class="comment">// å¦‚æœå¯†é’¥é”™è¯¯ï¼Œ`error` ä¼šæç¤ºæ•°æ®åº“ä¸å¯è®¿é—®</span></div><div class="line">  <span class="built_in">fatalError</span>(<span class="string">"Error opening realm: <span class="subst">\(error)</span>"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™æ ·ç¡¬ç›˜ä¸Šçš„æ•°æ®éƒ½èƒ½éƒ½é‡‡ç”¨AES-256æ¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œå¹¶ç”¨ SHA-2 HMAC æ¥è¿›è¡ŒéªŒè¯ã€‚ æ¯æ¬¡æ‚¨è¦è·å–ä¸€ä¸ª Realm å®ä¾‹æ—¶ï¼Œæ‚¨éƒ½éœ€è¦æä¾›ä¸€æ¬¡ç›¸åŒçš„å¯†é’¥ã€‚</p>
</blockquote>
<ul>
<li>å¯†é’¥å¹¶å°†å…¶å®‰å…¨åœ°å­˜æ”¾åˆ°é’¥åŒ™ä¸²å½“ä¸­ï¼Œç„¶åç”¨å…¶åŠ å¯† Realmã€‚</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Security</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">getKey</span><span class="params">()</span></span> -&gt; <span class="type">NSData</span> &#123;</div><div class="line">	<span class="comment">// æ ‡è¯†ç¬¦</span></div><div class="line">	<span class="keyword">let</span> keychainIdentifier = <span class="string">"io.Realm.EncryptionExampleKey"</span></div><div class="line">	<span class="keyword">let</span> keychainIdentifierData = keychainIdentifier.data(using: <span class="type">String</span>.<span class="type">Encoding</span>.utf8, allowLossyConversion: <span class="literal">false</span>)!</div><div class="line"></div><div class="line">	<span class="comment">// æ£€æµ‹æ˜¯å¦å­˜åœ¨é’¥åŒ™ä¸²</span></div><div class="line">	<span class="keyword">var</span> query: [<span class="type">NSString</span>: <span class="type">AnyObject</span>] = [</div><div class="line">		kSecClass: kSecClassKey,</div><div class="line">		kSecAttrApplicationTag: keychainIdentifierData <span class="keyword">as</span> <span class="type">AnyObject</span>,</div><div class="line">		kSecAttrKeySizeInBits: <span class="number">512</span> <span class="keyword">as</span> <span class="type">AnyObject</span>,</div><div class="line">		kSecReturnData: <span class="literal">true</span> <span class="keyword">as</span> <span class="type">AnyObject</span></div><div class="line">	]</div><div class="line">	</div><div class="line">	<span class="keyword">var</span> dataTypeRef: <span class="type">AnyObject</span>?</div><div class="line">	<span class="keyword">var</span> status = <span class="built_in">withUnsafeMutablePointer</span>(to: &amp;dataTypeRef) &#123; <span class="type">SecItemCopyMatching</span>(query <span class="keyword">as</span> <span class="type">CFDictionary</span>, <span class="type">UnsafeMutablePointer</span>($<span class="number">0</span>)) &#125;</div><div class="line">	<span class="keyword">if</span> status == errSecSuccess &#123; <span class="comment">// æ‰¾åˆ°å°±è¿”å›</span></div><div class="line">		<span class="keyword">return</span> dataTypeRef <span class="keyword">as</span>! <span class="type">NSData</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// æ²¡æœ‰æ‰¾åˆ°å°±æ–°å»ºä¸€ä¸ª</span></div><div class="line">	<span class="keyword">let</span> keyData = <span class="type">NSMutableData</span>(length: <span class="number">64</span>)!</div><div class="line">	<span class="keyword">let</span> result = <span class="type">SecRandomCopyBytes</span>(kSecRandomDefault, <span class="number">64</span>, keyData.mutableBytes.bindMemory(to: <span class="type">UInt8</span>.<span class="keyword">self</span>, capacity: <span class="number">64</span>))</div><div class="line">	<span class="built_in">assert</span>(result == <span class="number">0</span>, <span class="string">"Failed to get random bytes"</span>)</div><div class="line"></div><div class="line">	<span class="comment">// å­˜å‚¨é’¥åŒ™ä¸²</span></div><div class="line">	query = [</div><div class="line">		kSecClass: kSecClassKey,</div><div class="line">		kSecAttrApplicationTag: keychainIdentifierData <span class="keyword">as</span> <span class="type">AnyObject</span>,</div><div class="line">		kSecAttrKeySizeInBits: <span class="number">512</span> <span class="keyword">as</span> <span class="type">AnyObject</span>,</div><div class="line">		kSecValueData: keyData</div><div class="line">	]</div><div class="line"></div><div class="line">	status = <span class="type">SecItemAdd</span>(query <span class="keyword">as</span> <span class="type">CFDictionary</span>, <span class="literal">nil</span>)</div><div class="line">	<span class="built_in">assert</span>(status == errSecSuccess, <span class="string">"Failed to insert the new key in the keychain"</span>)</div><div class="line">	<span class="keyword">return</span> keyData</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>ä½¿ç”¨</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// æ·»åŠ </span></div><div class="line">autoreleasepool &#123;</div><div class="line">	<span class="keyword">let</span> configuration = <span class="type">Realm</span>.<span class="type">Configuration</span>(encryptionKey: getKey() <span class="keyword">as</span> <span class="type">Data</span>)</div><div class="line">	<span class="keyword">let</span> realm = <span class="keyword">try</span>! <span class="type">Realm</span>(configuration: configuration)</div><div class="line"></div><div class="line">	<span class="comment">// Add an object</span></div><div class="line">	<span class="keyword">try</span>! realm.write &#123;</div><div class="line">		<span class="keyword">let</span> dog = <span class="type">Dog</span>()</div><div class="line">		dog.name = <span class="string">"xxxx"</span></div><div class="line">		realm.add(dog)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// æŸ¥è¯¢</span></div><div class="line">autoreleasepool &#123;</div><div class="line">	<span class="keyword">let</span> configuration = <span class="type">Realm</span>.<span class="type">Configuration</span>(encryptionKey: getKey() <span class="keyword">as</span> <span class="type">Data</span>)</div><div class="line">	<span class="keyword">let</span> realm = <span class="keyword">try</span>! <span class="type">Realm</span>(configuration: configuration)</div><div class="line">	<span class="keyword">if</span> <span class="keyword">let</span> dogName = realm.objects(<span class="type">Dog</span>.<span class="keyword">self</span>).first?.name &#123;</div><div class="line">	<span class="built_in">print</span>(dogName)</div><div class="line">	  &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>åŠ å¯†è¿‡çš„ Realm åªä¼šå¸¦æ¥å¾ˆå°‘çš„é¢å¤–èµ„æºå ç”¨ï¼ˆé€šå¸¸æœ€å¤šåªä¼šæ¯”å¹³å¸¸æ…¢10%ï¼‰ã€‚</p>
<p>Realm çš„åŠ å¯† API ç›®å‰æ”¯æŒ iOSã€OS X ä»¥åŠ WatchKit å¹³å°ï¼Œä½† ä¸æ”¯æŒ watchOS å¹³å°ï¼Œå› ä¸º Realm åŠ å¯†æœºåˆ¶ä½¿ç”¨çš„ <mach mach.h=""> ä»¥åŠ <mach exc.h=""> API è¢«æ ‡è®°ä¸º__WATCHOS_PROHIBITED` äº†ã€‚</mach></mach></p>
</blockquote>
<h5 id="ç‰ˆæœ¬é™åˆ¶"><a href="#ç‰ˆæœ¬é™åˆ¶" class="headerlink" title="ç‰ˆæœ¬é™åˆ¶"></a>ç‰ˆæœ¬é™åˆ¶</h5><blockquote>
<p>Realm è‡´åŠ›äºå¹³è¡¡æ•°æ®åº“è¯»å–çš„çµæ´»æ€§å’Œæ€§èƒ½ã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œåœ¨ Realm ä¸­æ‰€å­˜å‚¨çš„ä¿¡æ¯çš„å„ä¸ªæ–¹é¢éƒ½æœ‰åŸºæœ¬çš„é™åˆ¶ã€‚ä¾‹å¦‚ï¼š</p>
<p>ï¼ˆ1ï¼‰ç±»åç§°çš„é•¿åº¦æœ€å¤§åªèƒ½å­˜å‚¨ 57 ä¸ª UTF8 å­—ç¬¦ã€‚</p>
<p>ï¼ˆ2ï¼‰å±æ€§åç§°çš„é•¿åº¦æœ€å¤§åªèƒ½æ”¯æŒ 63 ä¸ª UTF8 å­—ç¬¦ã€‚</p>
<p>ï¼ˆ3ï¼‰NSData ä»¥åŠ String å±æ€§ä¸èƒ½ä¿å­˜è¶…è¿‡ 16 MB å¤§å°çš„æ•°æ®ã€‚å¦‚æœè¦å­˜å‚¨å¤§é‡çš„æ•°æ®ï¼Œå¯é€šè¿‡å°†å…¶åˆ†è§£ä¸º16MB å¤§å°çš„å—ï¼Œæˆ–è€…ç›´æ¥å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç„¶åå°†æ–‡ä»¶è·¯å¾„å­˜å‚¨åœ¨ Realm ä¸­ã€‚å¦‚æœæ‚¨çš„åº”ç”¨è¯•å›¾å­˜å‚¨ä¸€ä¸ªå¤§äº 16MB çš„å•ä¸€å±æ€§ï¼Œç³»ç»Ÿå°†åœ¨è¿è¡Œæ—¶æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>ï¼ˆ4ï¼‰å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ’åºä»¥åŠä¸åŒºåˆ†å¤§å°å†™æŸ¥è¯¢åªæ”¯æŒâ€œåŸºç¡€æ‹‰ä¸å­—ç¬¦é›†â€ã€â€œæ‹‰ä¸å­—ç¬¦è¡¥å……é›†â€ã€â€œæ‹‰ä¸æ–‡æ‰©å±•å­—ç¬¦é›† Aâ€ ä»¥åŠâ€æ‹‰ä¸æ–‡æ‰©å±•å­—ç¬¦é›† Bâ€œï¼ˆUTF-8 çš„èŒƒå›´åœ¨ 0~591 ä¹‹é—´ï¼‰ã€‚</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      
      
        
	<div id="comment">
		<!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
		</div>
		<!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ -->
	</div>



      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/æ•°æ®åº“/">æ•°æ®åº“</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/10/03/Xcode8æ–°ç‰¹æ€§/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Xcode8æ–°ç‰¹æ€§</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Realm-Swift3-0"><span class="nav-number">1.</span> <span class="nav-text">Realm-Swift3.0</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ç®€ä»‹"><span class="nav-number">1.0.1.</span> <span class="nav-text">ç®€ä»‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Xcodeæ’ä»¶"><span class="nav-number">1.0.2.</span> <span class="nav-text">Xcodeæ’ä»¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#çº¯SWiftç‰ˆçš„å®‰è£…"><span class="nav-number">1.0.3.</span> <span class="nav-text">çº¯SWiftç‰ˆçš„å®‰è£…</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æœ¯è¯­"><span class="nav-number">1.0.4.</span> <span class="nav-text">æœ¯è¯­</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#æ”¯æŒçš„ç±»å‹"><span class="nav-number">1.0.4.1.</span> <span class="nav-text">æ”¯æŒçš„ç±»å‹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#æ•°æ®æ¨¡å‹-Object"><span class="nav-number">1.0.4.2.</span> <span class="nav-text">æ•°æ®æ¨¡å‹(Object)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#å…³ç³»-Relationships"><span class="nav-number">1.0.4.3.</span> <span class="nav-text">å…³ç³»(Relationships)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#äº‹åŠ¡-Transactions"><span class="nav-number">1.0.4.4.</span> <span class="nav-text">äº‹åŠ¡(Transactions)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ç»“æœé›†-Results"><span class="nav-number">1.0.4.5.</span> <span class="nav-text">ç»“æœé›†(Results)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä½¿ç”¨"><span class="nav-number">1.0.5.</span> <span class="nav-text">ä½¿ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#åˆ›å»ºæ•°æ®åº“"><span class="nav-number">1.0.5.1.</span> <span class="nav-text">åˆ›å»ºæ•°æ®åº“</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CRUD"><span class="nav-number">1.0.5.2.</span> <span class="nav-text">CRUD</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#å¯¹è±¡"><span class="nav-number">1.0.5.3.</span> <span class="nav-text">å¯¹è±¡</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#æ–°å¢"><span class="nav-number">1.0.5.4.</span> <span class="nav-text">æ–°å¢</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#æŸ¥è¯¢"><span class="nav-number">1.0.5.5.</span> <span class="nav-text">æŸ¥è¯¢</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ä¿®æ”¹"><span class="nav-number">1.0.5.6.</span> <span class="nav-text">ä¿®æ”¹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#åˆ é™¤"><span class="nav-number">1.0.5.7.</span> <span class="nav-text">åˆ é™¤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#å±æ€§"><span class="nav-number">1.0.5.8.</span> <span class="nav-text">å±æ€§</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#å…³ç³»"><span class="nav-number">1.0.5.9.</span> <span class="nav-text">å…³ç³»</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#å¤šçº¿ç¨‹"><span class="nav-number">1.0.5.10.</span> <span class="nav-text">å¤šçº¿ç¨‹</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Json"><span class="nav-number">1.0.6.</span> <span class="nav-text">Json</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#é€šçŸ¥"><span class="nav-number">1.0.6.1.</span> <span class="nav-text">é€šçŸ¥</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#æ•°æ®åº“è¿ç§»"><span class="nav-number">1.0.6.2.</span> <span class="nav-text">æ•°æ®åº“è¿ç§»</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#æ•°æ®åº“åŠ å¯†"><span class="nav-number">1.0.6.3.</span> <span class="nav-text">æ•°æ®åº“åŠ å¯†</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ç‰ˆæœ¬é™åˆ¶"><span class="nav-number">1.0.6.4.</span> <span class="nav-text">ç‰ˆæœ¬é™åˆ¶</span></a></li></ol></li></ol></li></ol></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2014 - 2017 simonå°ğŸ“šåŠ All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				UV : <span id="busuanzi_value_site_uv"></span> |  
				PV : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>




  <script src="/js/dialog.js"></script>








	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">è®¾ç½®</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              æ­£æ–‡å­—å·å¤§å°
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            æ‚¨å·²è°ƒæ•´é¡µé¢å­—ä½“å¤§å°
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              å¤œé—´æŠ¤çœ¼æ¨¡å¼
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            å¤œé—´æ¨¡å¼å·²ç»å¼€å¯ï¼Œå†æ¬¡å•å‡»æŒ‰é’®å³å¯å…³é—­ 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å…³ äº&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            simonå°ğŸ“šåŠ
          </div>
          <div class="panel-body">
            Copyright Â© 2017 Mr.Simon All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
</body>
</html>