<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Simonã®å°ğŸ“šåŠ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta name="description" content="å—¨, æˆ‘æ˜¯simon">
<meta property="og:type" content="website">
<meta property="og:title" content="Simonã®å°ğŸ“šåŠ">
<meta property="og:url" content="https://github.com/icoderRo/index.html">
<meta property="og:site_name" content="Simonã®å°ğŸ“šåŠ">
<meta property="og:description" content="å—¨, æˆ‘æ˜¯simon">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Simonã®å°ğŸ“šåŠ">
<meta name="twitter:description" content="å—¨, æˆ‘æ˜¯simon">
  
    <link rel="alternate" href="/atom.xml" title="Simonã®å°ğŸ“šåŠ" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/home.css" >
  

  

  
  
  

</head>



  <body>


  
    <header id="header">

    
      <div id="intrologo" class="intro-logo" style="background-position:center; background-repeat:no-repeat; background-image: url(); background-size: auto 100%;">

      <!-- Support rolling -->  
        
        <section class="awSlider">
          <div class="carousel slide carousel-fade " data-ride="carousel">

            <!-- Wrapper for slides -->
            <div class="carousel-inner">
               
                  
                    <div class="item active">
                  
                    <img id="carousel-img0" src="/css/images/home-bg.jpg">
                  </div>

                  <!-- è‡ªé€‚åº”å¤§å›¾ -->
                  <script>
                      var img0 = new Image();
                      var imageTag0 = document.getElementById("carousel-img0");
                      img0.src = imageTag0.src;
                      img0.onload=function(){
                        if (img0.width / img0.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag0.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag0.style.height = document.body.clientHeight + "px";
                          imageTag0.style.marginLeft = -(document.body.clientHeight * img0.width / img0.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img1" src="/css/images/sample.jpg">
                  </div>

                  <!-- è‡ªé€‚åº”å¤§å›¾ -->
                  <script>
                      var img1 = new Image();
                      var imageTag1 = document.getElementById("carousel-img1");
                      img1.src = imageTag1.src;
                      img1.onload=function(){
                        if (img1.width / img1.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag1.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag1.style.height = document.body.clientHeight + "px";
                          imageTag1.style.marginLeft = -(document.body.clientHeight * img1.width / img1.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img2" src="https://source.unsplash.com/collection/954550/1024x768">
                  </div>

                  <!-- è‡ªé€‚åº”å¤§å›¾ -->
                  <script>
                      var img2 = new Image();
                      var imageTag2 = document.getElementById("carousel-img2");
                      img2.src = imageTag2.src;
                      img2.onload=function(){
                        if (img2.width / img2.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag2.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag2.style.height = document.body.clientHeight + "px";
                          imageTag2.style.marginLeft = -(document.body.clientHeight * img2.width / img2.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
            </div>

            <!-- Controls -->
            <a class="left carousel-control" href=".carousel" role="button" data-slide="prev">
              <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
              <span class="sr-only">Geri</span>
            </a>
            <a class="right carousel-control" href=".carousel" role="button" data-slide="next">
              <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
              <span class="sr-only">Ä°leri</span>
            </a>
          </div>
        </section>
        <script>
          $('section.awSlider .carousel').carousel({
              pause: '',
              interval: 5000
          });
          var startImage = $('section.awSlider .item.active > img').attr('src');
          $('section.awSlider .carousel').on('slid.bs.carousel', function () {
              var bscn = $(this).find('.item.active > img').attr('src');
              $('section.awSlider > img').attr('src', bscn);
          });
        </script>
      

    
 


    <canvas width="100%" height="100%"></canvas>
    <script>
      var c = document.getElementsByTagName('canvas')[0],
          x = c.getContext('2d'),
          w = window.innerWidth,
          h = window.innerHeight,
          pr = window.devicePixelRatio || 1,
          f = 90,
          q,
          m = Math,
          r = 0,
          u = m.PI*2,
          v = m.cos,
          z = m.random
      c.width = w*pr
      c.height = h*pr
      x.scale(pr, pr)
      x.globalAlpha = 0.6

      
    </script>
    

    
      <div id="homelogo" class="homelogo" style="background: rgba(255,255,255,1);"> 
    

        
          <div class="homelogoback"  style="border: 1px solid #404040;" >
            <h1><a href="#content" id="logo">Simonã®å°ğŸ“šåŠ</a></h1>
            <h3>å—¨, æˆ‘æ˜¯simon</h3>
            <h5>Mr.Simon</h5>
            <!-- <p><a href="https://github.com/iTimeTraveler" target="_blank">Github</a></p> -->
          </div>
        
    
    </div>
  </div>

  <!-- è‡ªé€‚åº”ä¸»é¡µèƒŒæ™¯å¤§å›¾ -->
  

 <!-- home_logo_imageå±…ä¸­ -->
 
    <script>
        var homelogodiv = document.getElementById("homelogo");
        if (document.all.homelogo.offsetWidth > document.body.clientWidth) {
          homelogodiv.style.width = document.body.clientWidth + "px";
          homelogodiv.style.marginLeft = document.body.clientWidth * -0.5 + "px";
        } else {
          homelogodiv.style.width = homelogodiv.clientWidth  + "px";
          homelogodiv.style.marginLeft = (homelogodiv.clientWidth)  * -0.5 + "px";
        }
    </script>
  

  <div class="intro-navigate">
      <p class="navigater-list">
        
          <a id="beautifont" class="main-nav-link" href="/">Startseite</a>
        
          <a id="beautifont" class="main-nav-link" href="/archives">Archive</a>
        
          <a id="beautifont" class="main-nav-link" href="/about">About</a>
        
      </p>
  </div>

</header>
  
  <div id="container">
    <div id="wrap">
      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;">
  
    <article id="[post]-RealmSwift"  class="article article-type-[post]" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/01/20/RealmSwift/">Realm-Swift3.0</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/01/20/RealmSwift/" class="article-date">
	  <time datetime="2017-01-19T16:00:00.000Z" itemprop="datePublished">2017-01-20</time>
	</a>

      
    <a class="article-category-link" href="/categories/iOS/">iOS</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<h2 id="Realm-Swift3-0"><a href="#Realm-Swift3-0" class="headerlink" title="Realm-Swift3.0"></a>Realm-Swift3.0</h2><p><img src="https://ww3.sinaimg.cn/large/006tKfTcgy1fimyuw95jdj30g7083ta2.jpg" alt=""></p>
<h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>Realm äº2014 å¹´7æœˆå‘å¸ƒï¼Œæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ç§»åŠ¨æ•°æ®åº“å¼•æ“ï¼Œä¸“é—¨ä¸ºç§»åŠ¨åº”ç”¨çš„æ•°æ®æŒä¹…åŒ–è€Œç”Ÿã€‚å…¶ç›®çš„æ˜¯è¦å–ä»£ Core Data å’Œ SQLite,æ”¯æŒJavaã€Objective-Cã€JavaScriptã€Swiftã€Xamarinå¹³å°</p>
<p>Realmçš„ä¼˜ç‚¹åœ¨å®˜æ–¹ä¸Šæœ‰å¾ˆå¤šçš„è¯´æ˜, ç•¥ä¸¾ä¸¤ç‚¹:</p>
<p><strong>1.æ˜“ä¸Šæ‰‹</strong>:æƒ³æ¯”äºCore Data å’ŒSQLite, Realmçš„å­¦ä¹ æˆæœ¬ç›¸å¯¹æ¥è¯´ä¼šæ¯”è¾ƒä½, æ¯«ä¸å¤¸å¼ çš„è¯´, æŠŠå®˜æ–¹çš„æ–‡æ¡£å’ŒDemoçœ‹å®Œä¸€é, å°±å¯ä»¥å¿«é€Ÿçš„ä¸Šæ‰‹å¼€å‘åŠŸèƒ½ã€‚</p>
<p><strong>2.å¯è§†åŒ–</strong>: Realmæä¾›äº†ä¸€ä¸ªè½»é‡çº§çš„æ•°æ®åº“æŸ¥çœ‹å·¥å…·, åœ¨App Storeä¸­ä¸‹è½½<code>Realm Browser</code>, ç›¸æ¯”äºSQLite, ä½ å¯èƒ½éœ€è¦å»ä¸‹è½½ä»˜è´¹æˆ–è€…ç ´è§£ç‰ˆçš„Navicatã€SQL Managerç­‰è½¯ä»¶ä¼šæ–¹ä¾¿å¾ˆå¤š, å€ŸåŠ©äº<code>Realm Browser</code>è°ƒè¯•Realmæ•°æ®åº“å¾ˆä¾¿æ·ã€‚</p>
<ul>
<li>ä½¿ç”¨æ¨¡æ‹Ÿå™¨è¿›è¡Œè°ƒè¯•<ul>
<li>é€šè¿‡æ‰§è¡Œ<code>realm.configuration.fileURL</code>æ‰“å°å‡ºRealmæ•°æ®åº“çš„åœ°å€, Finderä¸­è·³è½¬è¿›å¯¹åº”çš„è·¯å¾„, ç”¨<code>Realm Browser</code>æ‰“å¼€å¯¹åº”çš„.realmæ–‡ä»¶å°±å¯ä»¥çœ‹åˆ°æ•°æ®å•¦ã€‚</li>
</ul>
</li>
<li>ä½¿ç”¨çœŸæœºè°ƒè¯•<ul>
<li>Xcode-&gt;Window-&gt;Devices,ç„¶åæ‰¾åˆ°å¯¹åº”çš„è®¾å¤‡ä¸é¡¹ç›®,å¯¼å‡ºxcappdataæ–‡ä»¶å,æ˜¾ç¤ºåŒ…å†…å®¹è¿›å…¥Documents,ä½¿ç”¨<code>Realm Browser</code>æ‰“å¼€.realmæ–‡ä»¶å³å¯.</li>
</ul>
</li>
</ul>
<h4 id="Xcodeæ’ä»¶"><a href="#Xcodeæ’ä»¶" class="headerlink" title="Xcodeæ’ä»¶"></a>Xcodeæ’ä»¶</h4><p>Realmçš„Xcodeæ’ä»¶ä»¤ Realm æ¨¡å‹çš„åˆ›å»ºæ›´åŠ æ–¹ä¾¿.gitHubä¸‹è½½ä¸€ä¸ªDemo<a href="https://github.com/realm/realm-cocoa">ä¼ é€é—¨</a>, æ‰¾åˆ°é‡Œé¢çš„Pluginç›®å½•ä¸‹çš„RealmPlugin.xcodeprojå¹¶è¿›è¡Œç¼–è¯‘ï¼Œé‡å¯ Xcodeä¹‹åæ’ä»¶å³å¯ç”Ÿæ•ˆã€‚<br><img src="https://ww2.sinaimg.cn/large/006tKfTcgy1fin1d9jycxj317d0qmwim.jpg" alt=""></p>
<h4 id="çº¯SWiftç‰ˆçš„å®‰è£…"><a href="#çº¯SWiftç‰ˆçš„å®‰è£…" class="headerlink" title="çº¯SWiftç‰ˆçš„å®‰è£…"></a>çº¯SWiftç‰ˆçš„å®‰è£…</h4><ul>
<li>ä½¿ç”¨ Realm æ„å»ºåº”ç”¨çš„åŸºæœ¬è¦æ±‚ï¼šiOS 8 åŠå…¶ä»¥ä¸Šç‰ˆæœ¬, macOS 10.9 åŠå…¶ä»¥ä¸Šç‰ˆæœ¬ï¼Œæ­¤å¤– Realm æ”¯æŒ tvOS å’Œ watchOS çš„æ‰€æœ‰ç‰ˆæœ¬ã€‚</li>
<li>éœ€è¦ä½¿ç”¨ Xcode 8.0 æˆ–è€…ä»¥åçš„ç‰ˆæœ¬ã€‚Realm Swift 2.3.0 æ˜¯æœ€åä¸€ä¸ªæ”¯æŒ Swift 2.x åŠ Xcode 7.3 çš„ç‰ˆæœ¬ã€‚</li>
<li>æ–¹æ³•1:Dynamic Framework<ul>
<li>ä¸‹è½½<a href="https://realm.io/cn/docs/swift/latest/#section-2" target="_blank" rel="external">Realmçš„æœ€æ–°ç‰ˆ</a>æœ¬å¹¶è§£å‹ã€‚</li>
<li>å‰å¾€æ‚¨ Xcode å·¥ç¨‹çš„â€Generalâ€è®¾ç½®é¡µã€‚å‰å¾€é€‚åˆæ‚¨é¡¹ç›®çš„ Swift ç‰ˆæœ¬ç›®å½•ï¼Œä»å…¶ä¸­çš„ iosæ–‡ä»¶å¤¹ä¸­ï¼Œæ‹–æ‹½<code>RealmSwift.framework</code> å’Œ<code>Realm.framework</code>åˆ°â€Embedded Binariesâ€é€‰é¡¹ä¸­ï¼Œç¡®è®¤Copy items if neededè¢«é€‰ä¸­ï¼ˆé™¤éæ‚¨çš„é¡¹ç›®ä¸­éœ€è¦åœ¨å¤šä¸ªå¹³å°ä¸­ä½¿ç”¨ Realmï¼‰ï¼Œå¹¶ç‚¹å‡»Finishã€‚</li>
<li>åœ¨æ‚¨çš„å•å…ƒæµ‹è¯•ç›®æ ‡çš„â€Build Settingsâ€ä¸­ï¼Œæ·»åŠ RealmSwift.frameworkçš„ä¸Šçº§ç›®å½•åˆ°æ‚¨çš„â€Framework Search Pathsâ€ä¸­ã€‚</li>
<li>å¦‚æœæ‚¨æ‰“ç®—åœ¨æ‚¨çš„ iOSã€tcOS æˆ–è€… watchOS å·¥ç¨‹ä¸­ä½¿ç”¨ Realmï¼Œè¯·åœ¨æ‚¨çš„ app ç›®æ ‡çš„â€œBuild Phasesâ€ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„â€Run Script Phaseâ€ï¼Œå¹¶åœ¨æ–‡æœ¬æ¡†ä¸­å†™å…¥<code>bash &quot;${BUILT_PRODUCTS_DIR}/${FRAMEWORKS_FOLDER_PATH}/Realm.framework/strip-frameworks.sh&quot;</code>å› ä¸ºè¦ç»•è¿‡è¿™ä¸ªAPPå•†åº—æäº¤çš„bugï¼Œè¿™ä¸€æ­¥åœ¨æ‰“åŒ…äºŒè¿›åˆ¶å‘å¸ƒç‰ˆæœ¬æ—¶æ˜¯å¿…é¡»ã€‚</li>
</ul>
</li>
<li>æ–¹æ³•2:Carthage<ul>
<li><a href="https://github.com/Carthage/Carthage#installing-carthage">å®‰è£… Carthage 0.17.0 æˆ–è€…æ›´é«˜ç‰ˆæœ¬</a></li>
<li>åœ¨Carthage ä¸­æ·»åŠ github <code>realm/realm-cocoa</code></li>
<li>è¿è¡Œ <code>carthage update</code></li>
<li>ä» Carthage/Build/ ç›®å½•ä¸‹å¯¹åº”å¹³å°æ–‡ä»¶å¤¹ä¸­ï¼Œå°† <code>RealmSwift.framework</code> å’Œ <code>Realm.framework</code> æ‹–æ›³åˆ°æ‚¨ Xcode å·¥ç¨‹Generalè®¾ç½®é¡¹çš„Linked Frameworks and Librariesé€‰é¡¹å¡ä¸­</li>
<li>iOS/tvOS/watchOS: åœ¨æ‚¨åº”ç”¨ç›®æ ‡çš„<strong>Build Phases</strong>è®¾ç½®é€‰é¡¹å¡ä¸­ï¼Œç‚¹å‡»â€œ+â€æŒ‰é’®å¹¶é€‰æ‹©â€œNew Run Script Phaseâ€ã€‚åœ¨æ–°å»ºçš„Run Scriptä¸­ï¼Œå¡«å†™:<code>/usr/local/bin/carthage copy-frameworks</code> åœ¨<strong>Input Files</strong>å†…æ·»åŠ æ‚¨æƒ³è¦ä½¿ç”¨çš„æ¡†æ¶è·¯å¾„ï¼Œä¾‹å¦‚:</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$(SRCROOT)/Carthage/Build/iOS/RealmSwift.framework</div></pre></td></tr></table></figure>
<ul>
<li>æ–¹æ³•3:CocoaPods<ul>
<li>è¿è¡Œ <code>pod repo update</code>ï¼Œä»¥ç¡®ä¿ CocoaPods èƒ½å¤Ÿè·å–åˆ° Realm çš„æœ€æ–°ç‰ˆæœ¬</li>
<li>åœ¨Podfileä¸­ï¼Œæ·»åŠ use_frameworks!å’Œpod â€˜RealmSwiftâ€™ åˆ°æ‚¨çš„ä¸»è¦å’Œæµ‹è¯•ç›®æ ‡</li>
<li>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Xcode 8ï¼Œé‚£ä¹ˆå°†ä¸‹é¢ä»£ç å¤åˆ¶åˆ°æ‚¨çš„ Podfile åº•éƒ¨ï¼Œä»¥ä¾¿åœ¨å¿…è¦çš„æ—¶å€™æ›´æ–° Swift çš„ç‰ˆæœ¬ï¼š</li>
</ul>
</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">	installer.pods_project.targets.each <span class="keyword">do</span> |target|</div><div class="line">    target.build_configurations.each <span class="keyword">do</span> |config|</div><div class="line">      config.build_settings['<span class="type">SWIFT_VERSION'</span>] = '<span class="number">3.0</span>'</div><div class="line">    end</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<ul>
<li>åœ¨ç»ˆç«¯è¿è¡Œ pod install,é‡‡ç”¨ CocoaPods ç”Ÿæˆçš„ .xcworkspace æ¥è¿è¡Œå·¥ç¨‹ï¼</li>
<li>æ³¨æ„:æˆ‘è¿™è¾¹é€‰ç”¨CocoaPodsçš„æ–¹å¼å®‰è£…, å®‰è£…çš„æ—¶é—´è¿˜æ˜¯éœ€è¦æ¯”è¾ƒå¤šçš„, <strong>å¦‚æœå‘ç°pod search RealmSwiftç‰ˆæœ¬æ¯”è¾ƒä½, å…ˆå‡çº§ä¸€ä¸‹podç´¢å¼•åº“</strong></li>
</ul>
<h4 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h4><h5 id="æ”¯æŒçš„ç±»å‹"><a href="#æ”¯æŒçš„ç±»å‹" class="headerlink" title="æ”¯æŒçš„ç±»å‹"></a>æ”¯æŒçš„ç±»å‹</h5><ul>
<li>Realm æ”¯æŒä»¥ä¸‹çš„å±æ€§ç±»å‹ï¼šBoolã€Int8ã€Int16ã€Int32ã€Int64ã€Doubleã€Floatã€Stringã€Dateä»¥åŠDataã€‚</li>
<li>ä¹Ÿå¯ä»¥ä½¿ç”¨ List<object> å’Œ Object æ¥å»ºç«‹è¯¸å¦‚ä¸€å¯¹å¤šã€ä¸€å¯¹ä¸€ä¹‹ç±»çš„å…³ç³»æ¨¡å‹ï¼Œæ­¤å¤– Object çš„å­ç±»ä¹Ÿæ”¯æŒæ­¤åŠŸèƒ½ã€‚</object></li>
</ul>
<h5 id="æ•°æ®æ¨¡å‹-Object"><a href="#æ•°æ®æ¨¡å‹-Object" class="headerlink" title="æ•°æ®æ¨¡å‹(Object)"></a>æ•°æ®æ¨¡å‹(Object)</h5><ul>
<li>Realmæ•°æ®æ¨¡å‹æ˜¯åŸºäºæ ‡å‡†Swiftç±»æ¥è¿›è¡Œå®šä¹‰çš„, é€šè¿‡ç®€å•çš„é›†æˆ<strong>Object</strong>æˆ–è€…å…¶å­ç±», å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Realmæ•°æ®æ¨¡å‹å¯¹è±¡, å¯ä»¥ç»™Realmæ¨¡å‹æ·»åŠ æ–¹æ³•å’Œåè®®ç­‰, ç”¨æ³•å’Œswiftä¸­çš„å…¶ä»–å¯¹è±¡ç±»ä¼¼</li>
<li><p>Realm æ¨¡å‹çš„å±æ€§éœ€è¦è®¾ç½®ä¸ºdynamic varç‰¹æ€§ï¼Œä»¥ä¾¿å…¶èƒ½å¤Ÿè¢«æ•°æ®åº“åº•å±‚æ•°æ®æ‰€è®¿é—®ã€‚<strong>List</strong> å’Œ <strong>RealmOptional</strong> ä¸èƒ½è¢«è®¾ä¸ºåŠ¨æ€å±æ€§ï¼Œå› ä¸ºæ³›å‹å±æ€§ä¸èƒ½åœ¨ Objectiveâ€‘C è¿è¡Œæ—¶ä¸­è¢«è¯†åˆ«ï¼Œè€Œ dynamic å±æ€§ä¼šè¢«ç”¨äºè¿›è¡ŒåŠ¨æ€è°ƒåº¦ã€‚æ­¤å¤–è¿™ä¸¤ä¸ªç±»å‹åº”å½“å§‹ç»ˆå£°æ˜ä¸º let</p>
</li>
<li><p>ä¸ºå¯¹è±¡çš„ç±»å‹åˆ—è¡¨æ·»åŠ ç›®æ ‡ç±»å‹çš„å±æ€§ï¼Œæˆ–è€…Listï¼Œå°±å¯ä»¥åˆ›å»ºæ•°æ®å…³ç³»(relationship)å’ŒåµŒå¥—æ•°æ®ç»“æ„(nested data structure)ã€‚</p>
</li>
</ul>
<h5 id="å…³ç³»-Relationships"><a href="#å…³ç³»-Relationships" class="headerlink" title="å…³ç³»(Relationships)"></a>å…³ç³»(Relationships)</h5><ul>
<li><strong>Object</strong> èƒ½å¤Ÿå€ŸåŠ©Objectä»¥åŠListå±æ€§å’Œå¦ä¸€ä¸ªObjectå»ºç«‹è”ç³», Listçš„æ¥å£å’ŒArrayéå¸¸ç±»ä¼¼, èƒ½å¤Ÿé€šè¿‡ç´¢å¼•ä¸‹è¡¨è¿›è¡Œè®¿é—®, ä¸åŒä¹‹å¤„åœ¨äº, <strong>Listä¸­åªèƒ½å­˜æ”¾ç®€å•çš„Objectå­ç±»çš„ç±»å‹</strong></li>
</ul>
<h5 id="äº‹åŠ¡-Transactions"><a href="#äº‹åŠ¡-Transactions" class="headerlink" title="äº‹åŠ¡(Transactions)"></a>äº‹åŠ¡(Transactions)</h5><ul>
<li><p>Realm å†™å…¥æ“ä½œæ˜¯<em>åŒæ­¥ä»¥åŠé˜»å¡çš„</em>ï¼Œå¹¶ä¸ä¼šå¼‚æ­¥è¿è¡Œã€‚å¦‚æœçº¿ç¨‹ A å¼€å§‹äº†ä¸€ä¸ªå†™å…¥æ“ä½œï¼Œæ¥ç€åœ¨çº¿ç¨‹ A ç»“æŸä¹‹å‰ï¼Œçº¿ç¨‹ B åˆå¯¹åŒä¸€ä¸ª Realm æ•°æ®åº“å¼€å§‹äº†å†™å…¥æ“ä½œï¼Œé‚£ä¹ˆçº¿ç¨‹ A å¿…é¡»åœ¨çº¿ç¨‹ B çš„å†™å…¥æ“ä½œè¿›è¡Œä¹‹å‰ï¼Œå®Œæˆè‡ªå·±çš„å†™å…¥æ“ä½œï¼Œå¹¶å°†äº‹åŠ¡æäº¤ã€‚å†™å…¥æ“ä½œæ€»ä¼šåœ¨ beginWrite() æ“ä½œè¿›è¡Œçš„æ—¶å€™è‡ªåŠ¨åˆ·æ–°ï¼Œå› æ­¤é‡å¤å†™å…¥ (overlapping write) å¹¶ä¸ä¼šäº§ç”Ÿç«äº‰æ¡ä»¶ã€‚</p>
</li>
<li><p>ç”±äºå†™å…¥äº‹åŠ¡åƒå…¶ä½™ç¡¬ç›˜è¯»å†™æ“ä½œä¸€æ ·ï¼Œä¼šå‡ºç°å¤±è´¥çš„æƒ…å†µï¼Œå› æ­¤ Realm.write() ä»¥åŠ Realm.commitWrite() å¯ä»¥åŠ ä¸Š throwsæ ‡è®°ã€‚å› æ­¤ä½ å¯ä»¥å¤„ç†å’Œæ¢å¤è¯¸å¦‚ç¡¬ç›˜ç©ºé—´æº¢å‡ºä¹‹ç±»çš„é”™è¯¯ã€‚æ­¤å¤–ï¼Œå…¶ä»–çš„é”™è¯¯éƒ½æ— æ³•è¿›è¡Œæ¢å¤ã€‚</p>
<h5 id="ç»“æœé›†-Results"><a href="#ç»“æœé›†-Results" class="headerlink" title="ç»“æœé›†(Results)"></a>ç»“æœé›†(Results)</h5></li>
<li>é€šè¿‡æŸ¥è¯¢æ“ä½œï¼ŒRealm å°†ä¼šè¿”å›åŒ…å« Object é›†åˆçš„ Results å®ä¾‹ã€‚Results çš„è¡¨ç°å’Œ Array ååˆ†ç›¸ä¼¼ï¼Œå¹¶ä¸”åŒ…å«åœ¨ Results ä¸­çš„å¯¹è±¡èƒ½å¤Ÿé€šè¿‡ç´¢å¼•ä¸‹æ ‡è¿›è¡Œè®¿é—®ã€‚ </li>
<li>æ‰€æœ‰çš„æŸ¥è¯¢åœ¨ Realm ä¸­éƒ½æ˜¯å»¶è¿ŸåŠ è½½çš„ï¼Œåªæœ‰å½“å±æ€§è¢«è®¿é—®æ—¶ï¼Œæ‰èƒ½å¤Ÿè¯»å–ç›¸åº”çš„æ•°æ®ã€‚</li>
<li>æŸ¥è¯¢ç»“æœå¹¶ä¸æ˜¯æ•°æ®çš„æ‹·è´ï¼šä¿®æ”¹æŸ¥è¯¢ç»“æœä¼šç›´æ¥ä¿®æ”¹ç¡¬ç›˜ä¸Šçš„æ•°æ®ã€‚</li>
</ul>
<h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><h5 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h5><ul>
<li><p>é»˜è®¤é…ç½®çš„ Realm æ•°æ®åº“<br>é€šè¿‡è°ƒç”¨ Realm() æ¥åˆå§‹åŒ–ä»¥åŠè®¿é—®æˆ‘ä»¬çš„ realm å˜é‡ã€‚è¿™ä¸ªæ–¹æ³•å°†ä¼šè¿”å›ä¸€ä¸ª Realm å¯¹è±¡ï¼Œå¹¶æŒ‡å‘æ‚¨åº”ç”¨çš„ Documents (iOS) æˆ–è€… Application Support (OS X)æ–‡ä»¶å¤¹ä¸‹çš„ä¸€ä¸ªåä¸ºâ€œdefault.realmâ€çš„æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">let realm = try? Realm()</div></pre></td></tr></table></figure>
</li>
<li><p>é…ç½®Realm<br>é€šè¿‡Realm.Configurationæ‚¨å¯ä»¥é…ç½®è¯¸å¦‚ Realm æ–‡ä»¶åœ¨ä½•å¤„å­˜å‚¨ä¹‹ç±»çš„ä¿¡æ¯ã€‚<br>é…ç½®åŒæ—¶ä¹Ÿå¯ä»¥åœ¨æ¯æ¬¡æ‚¨éœ€è¦ä½¿ç”¨ Realm å®ä¾‹çš„æ—¶å€™ä¼ é€’ç»™Realm(configuration: config)ï¼Œæˆ–è€…å¯ä»¥é€šè¿‡ Realm.Configuration.defaultConfiguration = config æ¥ä¸ºé»˜è®¤çš„ Realm æ•°æ®åº“è¿›è¡Œé…ç½®     </p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">func configRealmWithUser(_ username:String) &#123;</div><div class="line">        </div><div class="line">	var config = Realm.Configuration()</div><div class="line">        </div><div class="line">	config.fileURL = config.fileURL?.deletingLastPathComponent()</div><div class="line">            .appendingPathComponent(&quot;\(username).realm&quot;)</div><div class="line"></div><div class="line">	Realm.Configuration.defaultConfiguration = config</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨æ–¹å¼</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">configRealmWithUser(&quot;simon&quot;)</div><div class="line">let realm = try! Realm()</div></pre></td></tr></table></figure>
<ul>
<li>å†…å­˜æ•°æ®åº“<br>é€šå¸¸æƒ…å†µä¸‹ï¼ŒRealm æ•°æ®åº“æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­çš„ï¼Œä½†æ˜¯æ‚¨èƒ½å¤Ÿé€šè¿‡è®¾ç½® inMemoryIdentifier è€Œä¸æ˜¯è®¾ç½®Realm.Configuration ä¸­çš„ fileURL å±æ€§ï¼Œä»¥åˆ›å»ºä¸€ä¸ªå®Œå…¨åœ¨å†…å­˜ä¸­è¿è¡Œçš„æ•°æ®åº“ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">let realm = try! Realm(configuration: Realm.Configuration(inMemoryIdentifier: &quot;MyInMemoryRealm&quot;))</div></pre></td></tr></table></figure>
<blockquote>
<p>å†…å­˜æ•°æ®åº“åœ¨æ¯æ¬¡ç¨‹åºè¿è¡ŒæœŸé—´éƒ½ä¸ä¼šä¿å­˜æ•°æ®ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ä¼šå¦¨ç¢åˆ° Realm çš„å…¶ä»–åŠŸèƒ½ï¼ŒåŒ…æ‹¬æŸ¥è¯¢ã€å…³ç³»ä»¥åŠçº¿ç¨‹å®‰å…¨ã€‚ å‡å¦‚æ‚¨éœ€è¦çµæ´»çš„æ•°æ®è¯»å†™ä½†åˆä¸æƒ³å‚¨å­˜æ•°æ®çš„è¯ï¼Œé‚£ä¹ˆå†…å­˜æ•°æ®åº“å¯¹æ‚¨æ¥è¯´ä¸€å®šæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p>
<p>å†…å­˜æ•°æ®åº“ä¼šåœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­åˆ›å»ºå¤šä¸ªæ–‡ä»¶ï¼Œç”¨æ¥åè°ƒå¤„ç†è¯¸å¦‚è·¨è¿›ç¨‹é€šçŸ¥ä¹‹ç±»çš„äº‹åŠ¡ã€‚ å®é™…ä¸Šæ²¡æœ‰ä»»ä½•çš„æ•°æ®ä¼šè¢«å†™å…¥åˆ°è¿™äº›æ–‡ä»¶å½“ä¸­ï¼Œé™¤éæ“ä½œç³»ç»Ÿç”±äºå†…å­˜è¿‡æ»¡éœ€è¦æ¸…é™¤ç£ç›˜ä¸Šçš„å¤šä½™ç©ºé—´ã€‚</p>
<p>æ³¨æ„ï¼š å½“æ‰€æœ‰å…·å¤‡ç‰¹å®šæ ‡è¯†ç¬¦çš„Realm å†…å­˜æ•°æ®åº“å®ä¾‹è¶…å‡ºå¯ç”¨èŒƒå›´ï¼Œä½†æ˜¯å´æ²¡æœ‰è¢«å¼•ç”¨çš„è¯ï¼Œé‚£ä¹ˆ<em> Realm å†…å­˜æ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šè¢«åˆ é™¤</em>ã€‚æˆ‘ä»¬å»ºè®®æ‚¨åœ¨åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œä¿æŒå¯¹ Realm å†…å­˜æ•°æ®åº“çš„å¼ºå¼•ç”¨ã€‚ï¼ˆå¯¹äºå­˜å‚¨åœ¨ç¡¬ç›˜å½“ä¸­çš„ Realm æ•°æ®åº“è€Œè¨€ï¼Œè¿™å¹¶ä¸æ˜¯å¿…é¡»çš„æ“ä½œã€‚ï¼‰</p>
</blockquote>
<h5 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h5><h5 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">class Person: Object &#123;</div><div class="line">    </div><div class="line">    dynamic var name = &quot;&quot;</div><div class="line">    dynamic var age = 0</div><div class="line">&#125;</div><div class="line"></div><div class="line">class Dog: Object &#123;</div><div class="line">    dynamic var id = 0</div><div class="line">    dynamic var name = &quot;&quot;</div><div class="line">    dynamic var age = 0</div><div class="line">    </div><div class="line">    override static func primaryKey() -&gt; String? &#123;</div><div class="line">        return &quot;id&quot;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="æ–°å¢"><a href="#æ–°å¢" class="headerlink" title="æ–°å¢"></a>æ–°å¢</h5><ul>
<li>ä»¥å¯¹è±¡çš„å½¢å¼åˆ›å»º: æ­¤åˆ›å»ºæ–¹å¼, å¦‚æœæœ‰è®¾ç½®ä¸»é”®, åˆ™ä¸èƒ½åˆ›å»ºç›¸åŒçš„ä¸»é”®</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">let mydog = Dog()</div><div class="line">mydog.name = &quot;aa&quot;</div><div class="line">mydog.age = 20</div><div class="line">mydog.id = 5</div></pre></td></tr></table></figure>
<ul>
<li>ä»¥æ•°ç»„çš„å½¢å¼åˆ›å»º: å¦‚æœä¸»é”®ç›¸åŒ,åˆ™ä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®, æ²¡æœ‰è®¾ç½®ä¸»é”®, åˆ™updateåªèƒ½ä¸ºfalse</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">realm.create(Dog.self,</div><div class="line">			   value: [6, &quot;sssssss&quot;, 747],</div><div class="line">			   update: true)</div></pre></td></tr></table></figure>
<ul>
<li>ä»¥å­—å…¸çš„å½¢å¼åˆ›å»º: å¦‚æœä¸»é”®ç›¸åŒ,åˆ™ä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®, æ²¡æœ‰è®¾ç½®ä¸»é”®, åˆ™updateåªèƒ½ä¸ºfalse</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">realm.create(Dog.self,</div><div class="line">				value: [&quot;id&quot;:6, &quot;name&quot;: &quot;sada&quot;, &quot;age&quot;:77],</div><div class="line">				update: true)</div></pre></td></tr></table></figure>
<ul>
<li>å¤åˆæ¨¡å‹</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">// åŸºç¡€æ¨¡å‹</div><div class="line">class Animal: Object &#123;</div><div class="line">  dynamic var age = 0</div><div class="line">&#125;</div><div class="line"></div><div class="line">// åŒ…å«æœ‰ Animal çš„æ¨¡å‹</div><div class="line">class Duck: Object &#123;</div><div class="line">  dynamic var animal: Animal? = nil</div><div class="line">  dynamic var name = &quot;&quot;</div><div class="line">&#125;</div><div class="line">class Frog: Object &#123;</div><div class="line">  dynamic var animal: Animal? = nil</div><div class="line">  dynamic var dateProp = NSDate()</div><div class="line">&#125;</div><div class="line"></div><div class="line">// ç”¨æ³•</div><div class="line">let duck = Duck(value: [ &quot;animal&quot;: [ &quot;age&quot;: 3 ], &quot;name&quot;: &quot;Gustav&quot; ])</div></pre></td></tr></table></figure>
<ul>
<li>Data ç±»å‹å­˜å‚¨(æœ¬åœ°å›¾ç‰‡ä¸ºä¾‹)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">class DogPortrait:Object &#123;</div><div class="line">    dynamic var data:Data?</div><div class="line">&#125;</div><div class="line"></div><div class="line">let imageURL =  Bundle.main.url(forResource: &quot;sssss.png&quot;, withExtension: nil)!</div><div class="line">let imageData = try! Data(contentsOf: imageURL)</div><div class="line"></div><div class="line">let portrait = DogPortrait()</div><div class="line">portrait.data = imageData</div><div class="line"></div><div class="line">try! realm.write &#123;</div><div class="line">	realm.add(portrait)</div><div class="line">&#125;</div><div class="line"></div><div class="line">// æŸ¥è¯¢</div><div class="line">let portraits = realm.objects(DogPortrait.self)</div><div class="line">let imgData = portraits[0].data</div></pre></td></tr></table></figure>
<h5 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h5><ul>
<li>Realmæ— æ³•ç›´æ¥é™åˆ¶æŸ¥è¯¢æ•°é‡ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">let dogs = try! Realm().objects(Dog.self)</div></pre></td></tr></table></figure>
<ul>
<li>éœ€è¦æŸ¥è¯¢é™åˆ¶æ•°é‡, å¯ä»¥å€ŸåŠ©forå¾ªç¯</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">for i in 0..&lt;5 &#123;</div><div class="line">    let dog = dogs[i]</div><div class="line">    // ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p><strong>Realmä¸ºä½•æ— æ³•é™åˆ¶æŸ¥è¯¢æ•°é‡ï¼Ÿ</strong></p>
<p>é€šå¸¸æŸ¥è¯¢æ•°æ®åº“æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨sqlè¯­å¥ä¸­æ·»åŠ ä¸€äº›é™åˆ¶è¯­å¥ï¼ˆæ¯”å¦‚rownumï¼Œlimitï¼Œtopç­‰ï¼‰æ¥é™åˆ¶è¿”å›çš„ç»“æœé›†çš„è¡Œæ•°ã€‚<br>ä½†æˆ‘ä»¬ä½¿ç”¨Realmä¼šå‘ç°ï¼Œå®ƒæ²¡æœ‰è¿™ç§åˆ†é¡µåŠŸèƒ½ï¼Œæ„Ÿè§‰ä¸ç®¡æŸ¥ä»€ä¹ˆéƒ½æ˜¯æŠŠæ‰€æœ‰çš„ç»“æœéƒ½æå‡ºæ¥ã€‚æ¯”å¦‚æˆ‘ä»¬åªè¦Userè¡¨çš„å‰10æ¡æ•°æ®ï¼Œé‚£ä¹ˆåšæ³•æ˜¯å…ˆæŸ¥è¯¢å‡ºæ‰€æœ‰çš„Useræ•°æ®ï¼Œå†ä»ç»“æœé›†ä¸­å–å‡ºå‰10æ¡æ•°æ®ã€‚<br>æœ‰äººå¯èƒ½ä¼šæ‹…å¿ƒï¼Œå¦‚æœæ•°æ®åº“ä¸­æ•°æ®éå¸¸å¤šï¼Œé‚£æ¯æ¬¡éƒ½è¿™ä¹ˆæŸ¥ä¸ä¼šå½±å“æ€§èƒ½å—ï¼Ÿ<br>å…¶å®å¤§å¯æ”¾å¿ƒï¼Œç”±äºRealméƒ½æ˜¯å»¶è¿ŸåŠ è½½çš„ï¼Œåªæœ‰å½“å±æ€§è¢«è®¿é—®æ—¶ï¼Œæ‰èƒ½å¤Ÿè¯»å–ç›¸åº”çš„æ•°æ®ã€‚ä¸åƒé€šå¸¸æ•°æ®åº“ï¼ŒæŸ¥è¯¢åï¼ŒæŸ¥è¯¢ç»“æœæ˜¯ä»æ•°æ®åº“æ‹·è´ä¸€ä»½å‡ºæ¥æ”¾åœ¨å†…å­˜ä¸­çš„ã€‚è€ŒRealmçš„æŸ¥è¯¢ç»“æœåº”è¯¥è¯´æ˜¯æ•°æ®åº“æ•°æ®çš„å¼•ç”¨ï¼Œå°±ç®—ä½ æŸ¥å‡ºæ¥ï¼Œå¦‚æœä¸ç”¨ä¹Ÿä¸ä¼šå ç”¨ä»€ä¹ˆå†…å­˜ã€‚</p>
</blockquote>
<ul>
<li>å¯ä»¥é€šè¿‡Predicateæ¡ä»¶æŸ¥è¯¢ç‰¹å®šæ•°æ®</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">let results1 = realm.objects(Dog.self)</div><div class="line"></div><div class="line">let results = realm.objects(Dog.self).filter(NSPredicate(format: &quot;name contains &apos;A&apos;&quot;))</div><div class="line">        </div><div class="line">let result2 = results.filter(&quot;age &gt; 18&quot;)</div><div class="line"></div><div class="line">let results3 = realm.objects(Dog.self).filter(NSPredicate(format: &quot;name contains &apos;A&apos;&quot;)).filter(&quot;age &gt; 16&quot;).sorted(byKeyPath: &quot;age&quot;) // å‡åº</div></pre></td></tr></table></figure>
<blockquote>
<p>1.NSPredicateï¼š</p>
<p>æ¯”è¾ƒæ“ä½œæ•°(comparison operand)å¯ä»¥æ˜¯å±æ€§åç§°æˆ–è€…æŸä¸ªå¸¸é‡ï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªæ“ä½œæ•°å¿…é¡»æ˜¯å±æ€§åç§°ï¼›<br>æ¯”è¾ƒæ“ä½œç¬¦ ==ã€&lt;=ã€&lt;ã€&gt;=ã€&gt;ã€!=, ä»¥åŠ BETWEEN æ”¯æŒ intã€longã€long longã€floatã€double ä»¥åŠ NSDate å±æ€§ç±»å‹çš„æ¯”è¾ƒï¼Œæ¯”å¦‚è¯´ age == 45ï¼›<br>ç›¸ç­‰æ¯”è¾ƒ ==ä»¥åŠ!=ï¼Œæ¯”å¦‚è¯´Results<employee>().filter(â€œcompany == %@â€, company)<br>æ¯”è¾ƒæ“ä½œç¬¦ == and != æ”¯æŒå¸ƒå°”å±æ€§ï¼›<br>å¯¹äº NSString å’Œ NSData å±æ€§æ¥è¯´ï¼Œæˆ‘ä»¬æ”¯æŒ ==ã€!=ã€BEGINSWITHã€CONTAINS ä»¥åŠ ENDSWITH æ“ä½œç¬¦ï¼Œæ¯”å¦‚è¯´ name CONTAINS â€˜Jaâ€™ï¼›<br>å­—ç¬¦ä¸²æ”¯æŒå¿½ç•¥å¤§å°å†™çš„æ¯”è¾ƒæ–¹å¼ï¼Œæ¯”å¦‚è¯´ name CONTAINS[c] â€˜Jaâ€™ ï¼Œæ³¨æ„åˆ°å…¶ä¸­å­—ç¬¦çš„å¤§å°å†™å°†è¢«å¿½ç•¥ï¼›<br>Realm æ”¯æŒä»¥ä¸‹å¤åˆæ“ä½œç¬¦ï¼šâ€œANDâ€ã€â€œORâ€ ä»¥åŠ â€œNOTâ€ã€‚æ¯”å¦‚è¯´ name BEGINSWITH â€˜Jâ€™ AND age &gt;= 32ï¼›<br>åŒ…å«æ“ä½œç¬¦ INï¼Œæ¯”å¦‚è¯´ name IN {â€˜Lisaâ€™, â€˜Spikeâ€™, â€˜Hachiâ€™}ï¼›<br>==ã€!=æ”¯æŒä¸ nil æ¯”è¾ƒï¼Œæ¯”å¦‚è¯´ Results<company>().filter(â€œceo == nilâ€)ã€‚æ³¨æ„åˆ°è¿™åªé€‚ç”¨äºæœ‰å…³ç³»çš„å¯¹è±¡ï¼Œè¿™é‡Œ ceo æ˜¯ Company æ¨¡å‹çš„ä¸€ä¸ªå±æ€§ã€‚<br>ANY æ¯”è¾ƒï¼Œæ¯”å¦‚è¯´ ANY student.age &lt; 21<br>æ³¨æ„ï¼Œè™½ç„¶æˆ‘ä»¬ä¸æ”¯æŒå¤åˆè¡¨è¾¾å¼ç±»å‹(aggregate expression type)ï¼Œä½†æ˜¯æˆ‘ä»¬æ”¯æŒå¯¹å¯¹è±¡çš„å€¼ä½¿ç”¨ BETWEEN æ“ä½œç¬¦ç±»å‹ã€‚æ¯”å¦‚è¯´ï¼ŒResults<person>.filter(â€œage BETWEEN %@â€, [42, 43]])ã€‚</person></company></employee></p>
<p>2.æ’åº:</p>
<p>sorted(byKeyPath:) ä»¥åŠ sorted(byProperty:) ä¸æ”¯æŒå°†å¤šä¸ªå±æ€§ç”¨ä½œæ’åºåŸºå‡†ï¼Œæ­¤å¤–ä¹Ÿä¸èƒ½é“¾å¼è°ƒç”¨ï¼ˆåªæœ‰æœ€åä¸€ä¸ª sorted ä¼šè¢«è°ƒç”¨ï¼‰ã€‚å¦‚æœè¦æŒ‰å¤šä¸ªå±æ€§è¿›è¡Œæ’åºçš„è¯ï¼Œè¯·ä½¿ç”¨ sorted(by:) æ–¹æ³•ï¼Œç„¶åå‘å…¶ä¸­ä¼ é€’å¤šä¸ª SortDescriptor å¯¹è±¡</p>
</blockquote>
<h5 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h5><ul>
<li>ç›´æ¥æ›´æ–°å†…å®¹, åœ¨å†™å…¥äº‹åŠ¡ä¸­é€šè¿‡è®¾ç½®æŸä¸ªå¯¹è±¡çš„å±æ€§ä»è€Œå®Œæˆå¯¹è±¡çš„æ›´æ–°æ“ä½œ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mydog.name = &quot;aa&quot;</div><div class="line">mydog.age = 20</div></pre></td></tr></table></figure>
<ul>
<li>é€šè¿‡ä¸»é”®æ›´æ–°, æ•°æ®æ¨¡å‹ä¸­è®¾ç½®äº†ä¸»é”®çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨Realm().add(_:update:)æ¥æ›´æ–°å¯¹è±¡ï¼Œæˆ–è€…å½“å¯¹è±¡ä¸å­˜åœ¨æ—¶æ’å…¥æ–°çš„å¯¹è±¡ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">let mydog = Dog()</div><div class="line">mydog.name = &quot;aa&quot;</div><div class="line">mydog.age = 20</div><div class="line">mydog.id = 5</div><div class="line"></div><div class="line">try! realm.write &#123;</div><div class="line">  realm.add(mydog, update: true)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>é”®å€¼ç¼–ç <br><strong>Object</strong>ã€<strong>Result</strong> ä»¥åŠ Listéƒ½éµå®ˆé”®å€¼ç¼–ç (KVCï¼‰æœºåˆ¶, é€‚ç”¨äºå¤§é‡æ›´æ–°æ•°æ®</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">try? realm.write &#123;</div><div class="line">	results.first?.setValue(&quot;33&quot;, forKeyPath: &quot;age&quot;)</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<h5 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h5><ul>
<li>åˆ é™¤æ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">let realm = try! Realm()</div><div class="line">try? realm.write &#123;</div><div class="line">	realm.deleteAll()</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<ul>
<li>åˆ é™¤æŸæ¡æ•°æ®</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">let realm = try! Realm()    </div><div class="line">let results  = realm.objects(Dog.self).filter(&quot;age = 33&quot;)</div><div class="line"></div><div class="line">realm.beginWrite()</div><div class="line">realm.delete(dog)</div><div class="line">try? realm.commitWrite()</div></pre></td></tr></table></figure>
<h5 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h5><p>Realm æ¨¡å‹çš„å±æ€§éœ€è¦è®¾ç½®ä¸ºdynamic varç‰¹æ€§ï¼Œä»¥ä¾¿å…¶èƒ½å¤Ÿè¢«æ•°æ®åº“åº•å±‚æ•°æ®æ‰€è®¿é—®ã€‚<br>List å’Œ RealmOptional ä¸èƒ½è¢«è®¾ä¸ºåŠ¨æ€å±æ€§ï¼Œå› ä¸ºæ³›å‹å±æ€§ä¸èƒ½åœ¨ Objectiveâ€‘C è¿è¡Œæ—¶ä¸­è¢«è¯†åˆ«, List å’Œ RealmOptionalåº”è¯¥ç”¨letä¿®é¥°</p>
<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>éå¯é€‰å€¼å½¢å¼</th>
<th>å¯é€‰å€¼å½¢å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bool</td>
<td>dynamic var value = false</td>
<td>let value = RealmOptional<bool>()</bool></td>
</tr>
<tr>
<td>Int</td>
<td>dynamic var value = 0</td>
<td>let value = RealmOptional<int>()</int></td>
</tr>
<tr>
<td>Float</td>
<td>dynamic var value: Float = 0.0</td>
<td>let value = RealmOptional<float>()</float></td>
</tr>
<tr>
<td>Double</td>
<td>dynamic var value: Double = 0.0</td>
<td>let value = RealmOptional<double>()</double></td>
</tr>
<tr>
<td>String</td>
<td>dynamic var value = â€œâ€</td>
<td>dynamic var value: String? = nil</td>
</tr>
<tr>
<td>Data</td>
<td>dynamic var value = NSData()</td>
<td>dynamic var value: NSData? = nil</td>
</tr>
<tr>
<td>Date</td>
<td>dynamic var value = NSDate()</td>
<td>dynamic var value: NSDate? = nil</td>
</tr>
<tr>
<td>Object</td>
<td>n/a: å¿…é¡»æ˜¯å¯é€‰å€¼</td>
<td>dynamic var value: Class?</td>
</tr>
<tr>
<td>List</td>
<td>let value = List<class>()</class></td>
<td>n/a: å¿…é¡»æ˜¯éå¯é€‰å€¼</td>
</tr>
<tr>
<td>LinkingObjects</td>
<td>let value = LinkingObjects(fromType: Class.self, property: â€œpropertyâ€)</td>
<td>n/a: å¿…é¡»æ˜¯éå¯é€‰å€¼</td>
</tr>
</tbody>
</table>
<ul>
<li>ç´¢å¼•å±æ€§<br>é‡å†™ Object.indexedProperties() æ–¹æ³•å¯ä»¥ä¸ºæ•°æ®æ¨¡å‹ä¸­éœ€è¦æ·»åŠ ç´¢å¼•çš„å±æ€§å»ºç«‹ç´¢å¼•;Realm æ”¯æŒå­—ç¬¦ä¸²ã€æ•´æ•°ã€å¸ƒå°”å€¼ä»¥åŠ NSDate å±æ€§ä½œä¸ºç´¢å¼•;<br>å¯¹å±æ€§è¿›è¡Œç´¢å¼•å¯ä»¥å‡å°‘æ’å…¥æ“ä½œçš„æ€§èƒ½è€—è´¹ï¼ŒåŠ å¿«æ¯”è¾ƒæ£€ç´¢çš„é€Ÿåº¦ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">override static func indexedProperties() -&gt; [String] &#123;</div><div class="line">	return [&quot;id&quot;]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ä¸»é”®<br>é‡å†™ Object.primaryKey() å¯ä»¥è®¾ç½®æ¨¡å‹çš„ä¸»é”®ã€‚å£°æ˜ä¸»é”®ä¹‹åï¼Œå¯¹è±¡å°†å…è®¸è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä¸”æ›´æ–°é€Ÿåº¦æ›´åŠ é«˜æ•ˆï¼Œè€Œè¿™ä¹Ÿä¼šè¦æ±‚æ¯ä¸ªå¯¹è±¡ä¿æŒå”¯ä¸€æ€§ã€‚ ä¸€æ—¦å¸¦æœ‰ä¸»é”®çš„å¯¹è±¡è¢«æ·»åŠ åˆ° Realm ä¹‹åï¼Œè¯¥å¯¹è±¡çš„<strong>ä¸»é”®å°†ä¸å¯ä¿®æ”¹</strong>ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">override static func primaryKey() -&gt; String? &#123;</div><div class="line">	return &quot;id&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>å¿½ç•¥å±æ€§<br>é‡å†™ Object.ignoredProperties() å¯ä»¥é˜²æ­¢ Realm å­˜å‚¨æ•°æ®æ¨¡å‹çš„æŸä¸ªå±æ€§ã€‚Realm å°†ä¸ä¼šå¹²æ¶‰è¿™äº›å±æ€§çš„å¸¸è§„æ“ä½œï¼Œå®ƒä»¬å°†ç”±æˆå‘˜å˜é‡(ivar)æä¾›æ”¯æŒï¼Œå¹¶ä¸”æ‚¨èƒ½å¤Ÿè½»æ˜“é‡å†™å®ƒä»¬çš„ setter å’Œ getterã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">dynamic var tmpID = 0</div><div class="line">var name: String &#123; // åªè¯»å±æ€§å°†è¢«è‡ªåŠ¨å¿½ç•¥</div><div class="line">	return &quot;ignoredProperties&quot;</div><div class="line">&#125;</div><div class="line">  </div><div class="line">override static func ignoredProperties() -&gt; [String] &#123;</div><div class="line">	return [&quot;tmpID&quot;]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>å¯ç©ºå±æ€§ <strong>String</strong>ã€<strong>NSDate</strong> ä»¥åŠ <strong>NSData</strong> å±æ€§é€šè¿‡æ ‡å‡†çš„ Swift è¯­æ³•å£°æ˜ä¸ºå¯ç©ºç±»å‹æˆ–è€…éç©ºç±»å‹; å£°æ˜å¯ç©ºçš„æ•°å€¼ç±»å‹å¯ä»¥ä½¿ç”¨<strong>RealmOptional</strong>ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">class Person: Object &#123;</div><div class="line">	// å¯é€‰çš„å­—ç¬¦ä¸²å±æ€§ï¼Œé»˜è®¤ä¸º nil</div><div class="line">    dynamic var name: String? = nil</div><div class="line"></div><div class="line">    // å¯é€‰çš„ int å±æ€§ï¼Œé»˜è®¤ä¸º nil</div><div class="line">    // RealmOption å±æ€§åº”è¯¥å§‹ç»ˆå£°æ˜ä¸ºå¸¸é‡</div><div class="line">    // å› ä¸ºç›®å‰ç›´æ¥ç»™è¿™ä¸ªå±æ€§è¿›è¡Œèµ‹å€¼å¹¶ä¸ä¼šèµ·ä»»ä½•ä½œç”¨</div><div class="line">    let age = RealmOptional&lt;Int&gt;()</div><div class="line">&#125;</div><div class="line"></div><div class="line">let realm = try? Realm()</div><div class="line">var objc: optionObjc?</div><div class="line">try? realm?.write &#123;</div><div class="line">objc =  realm?.create(optionObjc.self, value: [&quot;sx&quot;, 12], update: false)</div><div class="line">  // è¯»å–æˆ–è€…ä¿®æ”¹ `RealmOptional` å¯ä»¥é€šè¿‡ `value` å±æ€§å®ç°</div><div class="line">	objc?.age.value = 20 </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="å…³ç³»"><a href="#å…³ç³»" class="headerlink" title="å…³ç³»"></a>å…³ç³»</h5><ul>
<li>å¯¹ä¸€å…³ç³»:å¯¹äºå¤šå¯¹ä¸€æˆ–ä¸€å¯¹ä¸€çš„å…³ç³», åªéœ€è¦å£°æ˜ä¸€ä¸ªObjectå­ç±»ç±»å‹çš„å±æ€§å³å¯:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">class Dog: Object &#123;</div><div class="line">    dynamic var id = 0</div><div class="line">    dynamic var name = &quot;&quot;</div><div class="line">    dynamic var age = 0</div><div class="line">    dynamic var owner: Person? // å¯é€‰</div><div class="line">&#125;</div><div class="line"></div><div class="line">let dog = Dog()</div><div class="line">let person = Person()</div><div class="line">dog.owner = person</div></pre></td></tr></table></figure>
<ul>
<li>å¯¹å¤šå…³ç³»:é€šè¿‡ List ç±»å‹çš„å±æ€§æ‚¨å¯ä»¥å®šä¹‰ä¸€ä¸ªå¯¹å¤šå…³ç³»ã€‚Listä¸­å¯ä»¥åŒ…å«ç®€å•ç±»å‹çš„Objectï¼Œå…¶æ¥å£ä¸å¯å˜çš„Arrayéå¸¸ç±»ä¼¼ã€‚<strong>æ³¨æ„ä½¿ç”¨let</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">class Person: Object &#123;</div><div class="line">    </div><div class="line">    dynamic var name = &quot;&quot;</div><div class="line">    dynamic var age = 0</div><div class="line">    let dogs = List&lt;Dog&gt;()</div><div class="line">&#125;</div><div class="line"></div><div class="line">let results = try?Realm().objects(Dog.self).filter(&quot;age &gt; 18&quot;)</div><div class="line">	let person = Person()</div><div class="line">	person.dogs.append((results?.first)!)</div><div class="line">	person.dogs.append((results?.last)!)</div><div class="line">        </div><div class="line">try? Realm().write &#123;</div><div class="line">	try? Realm().add(person)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>åå‘å…³ç³»<br>Realm æä¾›äº†<strong>é“¾æ¥å¯¹è±¡ (linking objects)</strong> å±æ€§æ¥è¡¨ç¤ºåå‘å…³ç³»</li>
</ul>
<blockquote>
<p>ä¾‹å¦‚ï¼Œä¸€ä¸ª Dog å¯¹è±¡å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªåä¸º owners çš„é“¾æ¥å¯¹è±¡å±æ€§ï¼Œè¿™ä¸ªå±æ€§ä¸­åŒ…å«äº†æŸäº› Person å¯¹è±¡ï¼Œè€Œè¿™äº› Person å¯¹è±¡åœ¨å…¶ dogs å±æ€§ä¸­åŒ…å«äº†è¿™ä¸€ä¸ªç¡®å®šçš„ Dog å¯¹è±¡ã€‚æ‚¨å¯ä»¥å°† owners å±æ€§è®¾ç½®ä¸º LinkingObjects ç±»å‹ï¼Œç„¶åæŒ‡å®šå…¶å…³ç³»ï¼Œè¯´æ˜å…¶å½“ä¸­åŒ…å«äº† Person å¯¹è±¡ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">class Dog: Object &#123;</div><div class="line">    dynamic var name = &quot;&quot;</div><div class="line">    dynamic var age = 0</div><div class="line">     </div><div class="line">    // Realm å¹¶ä¸ä¼šå­˜å‚¨è¿™ä¸ªå±æ€§ï¼Œå› ä¸ºè¿™ä¸ªå±æ€§åªå®šä¹‰äº† getter</div><div class="line">    // å®šä¹‰â€œownersâ€ï¼Œå’Œ Person.dogs å»ºç«‹åå‘å…³ç³»</div><div class="line">    let owners = LinkingObjects(fromType: Person.self, property: &quot;dogs&quot;)</div><div class="line">    </div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">func RealmBackLink() &#123;</div><div class="line">	let realm = try! Realm()</div><div class="line">	let dog1 = Dog()</div><div class="line">	dog1.name = &quot;ssssx&quot;</div><div class="line">	dog1.age = 22</div><div class="line">        </div><div class="line">	let owner = Person()</div><div class="line">	owner.dogs.append(dog1)</div><div class="line">        </div><div class="line">	try! realm.write &#123; // åªéœ€å­˜å‚¨personå³å¯</div><div class="line">		realm.add(owner)</div><div class="line">	&#125;</div><div class="line">	let dogs = realm.objects(Dog.self)</div><div class="line">	let ownerName = dogs.first?.owners.map&#123;$0.name&#125;</div><div class="line">        print(ownerName)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h5><p>éœ€è¦æ³¨æ„çš„ä¸€ä»¶äº‹æƒ…å°±æ˜¯ä¸èƒ½è®©å¤šä¸ªçº¿ç¨‹éƒ½æŒæœ‰åŒä¸€ä¸ª Realm å¯¹è±¡çš„ å®ä¾‹ ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹éœ€è¦è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒä»¬åˆ†åˆ«ä¼šè·å–è‡ªå·±æ‰€éœ€è¦çš„å®ä¾‹ï¼ˆå¦åˆ™åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šå‘ç”Ÿçš„æ›´æ”¹å°±ä¼šé€ æˆå…¶ä»–çº¿ç¨‹å¾—åˆ°ä¸å®Œæ•´æˆ–è€…ä¸ä¸€è‡´çš„æ•°æ®ï¼‰</p>
<ul>
<li>è·¨çº¿ç¨‹ä¼ é€’å®ä¾‹<br>Object çš„æœªç®¡ç†å®ä¾‹ï¼ˆunmanaged) å¯ä»¥å®‰å…¨åœ°è·¨çº¿ç¨‹ä¼ é€’, ç®¡ç†å®ä¾‹çš†å—åˆ°çº¿ç¨‹çš„é™åˆ¶(Realmã€Objectã€Results æˆ–è€… List), è¿™æ„å‘³ç€å®ƒä»¬åªèƒ½å¤Ÿåœ¨è¢«åˆ›å»ºçš„çº¿ç¨‹ä¸Šä½¿ç”¨ã€‚Realm æä¾›äº†ä¸€ä¸ªæœºåˆ¶ï¼Œé€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤æ¥ä¿è¯å—åˆ°çº¿ç¨‹é™åˆ¶çš„å®ä¾‹èƒ½å¤Ÿå®‰å…¨ä¼ é€’:<ul>
<li>é€šè¿‡å—åˆ°çº¿ç¨‹é™åˆ¶çš„å¯¹è±¡æ¥æ„é€ ä¸€ä¸ª ThreadSafeReference</li>
<li>å°†æ­¤ ThreadSafeReference ä¼ é€’ç»™ç›®æ ‡çº¿ç¨‹æˆ–è€…é˜Ÿåˆ—</li>
<li>é€šè¿‡åœ¨ç›®æ ‡ Realm ä¸Šè°ƒç”¨ Realm.resolve(_:) æ¥è§£ææ­¤å¼•ç”¨</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">let person = Person(name: &quot;Jane&quot;)</div><div class="line">try! realm.write &#123;</div><div class="line">  realm.add(person)</div><div class="line">&#125;</div><div class="line">let personRef = ThreadSafeReference(to: person)</div><div class="line">DispatchQueue(label: &quot;background&quot;).async &#123;</div><div class="line">  autoreleasepool &#123;</div><div class="line">    let realm = try! Realm()</div><div class="line">    guard let person = realm.resolve(personRef) else &#123;</div><div class="line">      return // person å·²è¢«åˆ é™¤</div><div class="line">    &#125;</div><div class="line">    try! realm.write &#123;</div><div class="line">      person.name = &quot;Jane Doe&quot;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>ThreadSafeReferenceå¯¹è±¡æœ€å¤šåªèƒ½å¤Ÿè§£æä¸€æ¬¡;ThreadSafeReference è§£æå¤±è´¥çš„è¯ï¼Œå°†ä¼šå¯¼è‡´ Realm çš„åŸå§‹ç‰ˆæœ¬è¢«é”æ­»ï¼Œç›´åˆ°å¼•ç”¨è¢«é‡Šæ”¾ä¸ºæ­¢ã€‚å› æ­¤ï¼ŒThreadSafeReference çš„ç”Ÿå‘½å‘¨æœŸåº”è¯¥å¾ˆçŸ­(åŠ ä¸Šautoreleasepool)ã€‚</p>
</blockquote>
<ul>
<li>è¿™äº›ç±»å‹çš„æŸäº›å±æ€§å’Œæ–¹æ³•å¯ä»¥åœ¨ä»»æ„çº¿ç¨‹ä¸­è¿›è¡Œè®¿é—®</li>
</ul>
<blockquote>
<p>Realm: æ‰€æœ‰çš„å±æ€§ã€ç±»æ–¹æ³•å’Œæ„é€ å™¨ï¼›all properties, class methods, and initializers</p>
<p>Object: isInvalidatedã€objectSchemaã€realmï¼Œä»¥åŠæ‰€æœ‰çš„ç±»æ–¹æ³•å’Œæ„é€ å™¨ï¼›<br>Results: objectClassName å’Œ realm</p>
<p>List: isInvalidatedã€objectClassName å’Œ realmã€‚</p>
</blockquote>
<ul>
<li>è·¨çº¿ç¨‹ä½¿ç”¨æ•°æ®åº“<br>åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ä½¿ç”¨åŒä¸€ä¸ª Realm æ–‡ä»¶, éœ€è¦åœ¨æ¯ä¸€ä¸ªçº¿ç¨‹åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„Realm å®ä¾‹, åªè¦æŒ‡å®šçš„é…ç½®æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ Realm å®ä¾‹éƒ½å°†ä¼šæŒ‡å‘ç¡¬ç›˜ä¸Šçš„åŒä¸€ä¸ªæ–‡ä»¶ã€‚</li>
</ul>
<blockquote>
<p>æš‚æ—¶ä¸æ”¯æŒå…±äº«Realmå®ä¾‹</p>
<p>å½“å†™å…¥å¤§é‡æ•°æ®çš„æ—¶å€™ï¼Œåœ¨ä¸€ä¸ªå•ç‹¬äº‹åŠ¡ä¸­é€šè¿‡æ‰¹é‡æ‰§è¡Œå¤šæ¬¡æ•°æ®ä¿®æ”¹æ“ä½œæ˜¯éå¸¸é«˜æ•ˆçš„ã€‚äº‹åŠ¡ä¹Ÿå¯ä»¥ä½¿ç”¨ Grand Central Dispatch(GCD) åœ¨åå°è¿è¡Œï¼Œä»¥é˜²æ­¢é˜»å¡ä¸»çº¿ç¨‹ã€‚ Realm å¯¹è±¡å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”å®ƒä¹Ÿä¸èƒ½å¤Ÿè·¨çº¿ç¨‹å…±äº«ï¼Œ<strong>å› æ­¤è¦ä¸ºæ¯ä¸€ä¸ªè¦æ‰§è¡Œè¯»å–æˆ–è€…å†™å…¥æ“ä½œçš„çº¿ç¨‹æˆ–è€… dispatch é˜Ÿåˆ—åˆ›å»ºä¸€ä¸ª Realm å®ä¾‹</strong>ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªåœ¨åå°é˜Ÿåˆ—ä¸­æ’å…¥ç™¾ä¸‡æ•°æ®çš„ä¾‹å­ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">DispatchQueue(label: &quot;background&quot;).async &#123;</div><div class="line">  autoreleasepool &#123;</div><div class="line">    // åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­è·å– Realm å’Œè¡¨å®ä¾‹</div><div class="line">    let realm = try! Realm()</div><div class="line"></div><div class="line">    // é€šè¿‡å¼€å¯å†™å…¥æ“ä½œå°†å†™å…¥é—­åŒ…åˆ†æˆå¤šä¸ªå¾®å°éƒ¨åˆ†</div><div class="line">    for idx1 in 0..&lt;1000 &#123;</div><div class="line">      realm.beginWrite()</div><div class="line"></div><div class="line">      // é€šè¿‡å­—å…¸æ’å…¥è¡Œï¼Œå¿½ç•¥å±æ€§æ¬¡åº</div><div class="line">      for idx2 in 0..&lt;1000 &#123;</div><div class="line">        realm.create(Person.self, value: [</div><div class="line">          &quot;name&quot;: &quot;\(idx1)&quot;,</div><div class="line">          &quot;birthdate&quot;: Date(timeIntervalSince1970: TimeInterval(idx2))</div><div class="line">        ])</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      // æäº¤å†™å…¥äº‹åŠ¡ä»¥ç¡®ä¿æ•°æ®åœ¨å…¶ä»–çº¿ç¨‹å¯ç”¨</div><div class="line">      try! realm.commitWrite()</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Json"><a href="#Json" class="headerlink" title="Json"></a>Json</h4><p>Realm æ²¡æœ‰æä¾›å¯¹ JSON çš„ç›´æ¥æ”¯æŒï¼Œä½†å¯ä»¥ä½¿ç”¨ NSJSONSerialization.JSONObjectWithData(_:options:) çš„è¾“å‡ºå®Œæˆä» JSON ä¸­æ·»åŠ  Object çš„æ“ä½œã€‚ ç”±æ­¤æ‰€äº§ç”Ÿçš„ KVC å…¼å®¹çš„å¯¹è±¡å¯ä»¥ä½¿ç”¨åˆ›å»ºå’Œæ›´æ–°å¯¹è±¡çš„ æ ‡å‡† API æ¥æ·»åŠ /æ›´æ–° Objectã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">// è¡¨ç¤ºåŸå¸‚çš„ä¸€ä¸ª Realm å¯¹è±¡</div><div class="line">class City: Object &#123;</div><div class="line">  dynamic var city = &quot;&quot;</div><div class="line">  dynamic var id = 0</div><div class="line">  // å…¶å®ƒç©ºä½™çš„å±æ€§â€¦</div><div class="line">&#125;</div><div class="line"></div><div class="line">let data = &quot;&#123;\&quot;name\&quot;: \&quot;San Francisco\&quot;, \&quot;cityId\&quot;: 123&#125;&quot;.data(using: .utf8)!</div><div class="line">let realm = try! Realm()</div><div class="line"></div><div class="line">// ä»åŒ…å« JSON çš„ NSData ä¸­æ’å…¥æ•°æ®</div><div class="line">try! realm.write &#123;</div><div class="line">  let json = try! JSONSerialization.jsonObject(with: data, options: [])</div><div class="line">  realm.create(City.self, value: json, update: true)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœåœ¨ JSON ä¸­åŒ…å«äº†åµŒå¥—çš„å¯¹è±¡æˆ–è€…æ•°ç»„çš„è¯ï¼Œè¿™äº›æ•°æ®éƒ½å°†è¢«è‡ªåŠ¨æ˜ å°„åˆ°å¯¹ä¸€ä»¥åŠå¯¹å¤šå…³ç³»â€”â€”å‚è§åµŒå¥—å¯¹è±¡ ä¸€èŠ‚è·å–è¯¦æƒ…ã€‚</p>
<p>å½“ä½¿ç”¨è¿™ç§æ–¹æ³•åœ¨ Realm ä¸­æ’å…¥æˆ–è€…æ›´æ–° JSON æ•°æ®çš„æ—¶å€™ï¼Œ<strong>è¦æ³¨æ„ Realm éœ€è¦ç¡®ä¿ JSON çš„å±æ€§åå’Œç±»å‹èƒ½å¤Ÿä¸ Object å±æ€§å®Œå…¨åŒ¹é…</strong>ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>float å±æ€§åº”å½“ä½¿ç”¨ float è¿›è¡Œåˆå§‹åŒ–â€”â€”æ‚¨ä¹Ÿå¯ä»¥é€‰æ‹© NSNumbersã€‚</li>
<li>NSDate å’Œ NSData å±æ€§æ— æ³•ä»å­—ç¬¦ä¸²è¿›è¡Œè‡ªåŠ¨æ¨æ–­ï¼Œè€Œåº”è¯¥åœ¨ä¼ é€’ç»™ Realm().create(_:value:update:) ä¹‹å‰è½¬æ¢ä¸ºé€‚å½“çš„ç±»å‹ã€‚</li>
<li>å¦‚æœ JSON ä¸­çš„å±æ€§æ˜¯ null (ä¾‹å¦‚ï¼šNSNull) æä¾›ç»™äº†ä¸€ä¸ªå¿…éœ€å±æ€§çš„è¯ï¼Œé‚£ä¹ˆä¼šæŠ›å‡ºå¼‚å¸¸ã€‚<br>å¦‚æœæŸä¸ªå¿…éœ€å±æ€§åœ¨æ’å…¥æ“ä½œä¸­æ²¡æœ‰æä¾›çš„è¯ï¼Œé‚£ä¹ˆä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li>
<li>Realm å°†ä¼šå¿½ç•¥ JSON ä¸­æ²¡æœ‰ä»¥ Object å®šä¹‰çš„ä»»ä½•å±æ€§ã€‚</li>
</ul>
<p>å¦‚æœ JSON æ¨¡å¼å’Œ Realm å¯¹è±¡æ— æ³•å®Œå…¨ä¸€è‡´çš„è¯ï¼Œæ¨èä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æ¨¡å‹æ˜ å°„æ¡†æ¶<br>ã€‚</p>
</blockquote>
<h5 id="é€šçŸ¥"><a href="#é€šçŸ¥" class="headerlink" title="é€šçŸ¥"></a>é€šçŸ¥</h5><ul>
<li>Realmé€šçŸ¥ é€šçŸ¥é—­åŒ…-å¯ä»¥åœ¨æ•´ä¸ª Realm æ•°æ®åº“ä¸Šè¿›è¡Œæ³¨å†Œã€‚å½“ç›¸å…³ Realm çš„å†™æ“ä½œäº‹åŠ¡è¢«æäº¤ä¹‹åï¼Œæ— è®ºè¿™ä¸ªäº‹åŠ¡å‘ç”Ÿåœ¨ä½•ç§çº¿ç¨‹æˆ–è€…ä½•ç§è¿›ç¨‹ä¹‹ä¸­ï¼Œè¿™ä¸ªé€šçŸ¥å¤„ç†é—­åŒ…éƒ½å°†ä¼šè¢«è§¦å‘ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">let realm  = try? Realm()</div><div class="line">print(realm?.configuration.fileURL as Any)</div><div class="line">let token = realm?.addNotificationBlock(&#123; (note, realm) in</div><div class="line">	print(note, realm)</div><div class="line">&#125;)</div><div class="line">        </div><div class="line">        </div><div class="line">try? realm?.write &#123;</div><div class="line">	realm?.create(Dog.self, value: [&quot;id&quot;:1, &quot;name&quot;: &quot;xssx&quot;], update: true) // æ‰§è¡Œé€šçŸ¥é—­åŒ…</div><div class="line">&#125;</div><div class="line">        </div><div class="line">token?.stop() // å…³é—­é€šçŸ¥</div><div class="line">        </div><div class="line">try? realm?.write &#123;</div><div class="line">	realm?.create(Dog.self, value: [&quot;name&quot;: &quot;stopxssx&quot;], update: true)// ä¸æ‰§è¡Œé€šçŸ¥é—­åŒ…</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>é›†åˆé€šçŸ¥<br>é›†åˆé€šçŸ¥æ˜¯å¼‚æ­¥è§¦å‘çš„ï¼Œé¦–å…ˆå®ƒä¼šåœ¨åˆå§‹åŒ–çš„æ—¶å€™è§¦å‘ï¼Œéšåå½“æŸä¸ªå†™å…¥äº‹åŠ¡æ”¹å˜äº†é›†åˆä¸­çš„æ‰€æœ‰æˆ–è€…æŸä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œé€šçŸ¥éƒ½ä¼šå†æ¬¡è§¦å‘ã€‚<br>æ‰€æœ‰çš„CRUDéƒ½ä¼šä¼ é€’åˆ°é€šçŸ¥é—­åŒ…å½“ä¸­çš„ RealmCollectionChange(æšä¸¾) å‚æ•°è®¿é—®åˆ°ã€‚è¿™ä¸ªå¯¹è±¡å½“ä¸­åŒ…å«äº†å— deletionsã€insertions å’Œ modifications çŠ¶æ€æ‰€å½±å“çš„ç´¢å¼•ä¿¡æ¯, å…¶å®šä¹‰å¦‚ä¸‹:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public enum RealmCollectionChange&lt;T&gt; &#123;</div><div class="line">    case initial(T) // åˆå§‹åŒ–ä¼šæ‰§è¡Œ</div><div class="line">    case update(T, deletions: [Int], insertions: [Int], modifications: [Int])</div><div class="line">    case error(Error)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœå¤„ç†é›†åˆä¸­çš„å¯¹è±¡çš„å±æ€§å‘ç”Ÿæ›´æ”¹, éƒ½å¯ä»¥ç›‘å¬çš„åˆ°<strong>ä¿®æ”¹ (modifications)</strong> çš„é€šçŸ¥, å½“<strong>å¯¹ä¸€å…³ç³»å’Œå¯¹å¤šå…³ç³»</strong> å‘ç”Ÿå˜åŒ–æ—¶ä¹Ÿä¼šè§¦å‘è¿™ä¸ªçŠ¶æ€å˜åŒ–ï¼Œä½†æ˜¯å¯¹äº <strong>åå‘å…³ç³»</strong> æ¥è¯´åˆ™ä¸ä¼šè§¦å‘è¿™ä¸ªå˜åŒ–ã€‚</p>
<p>ä»¥tableViewä¸ºä¾‹å­,ç›‘å¬æ•°æ®æºçš„æ”¹å˜, åšå‡ºç›¸åº”æ›´æ”¹, å½“ç„¶å¯ä»¥é‡å†™æ•°æ®æºçš„setæ–¹æ³•, ä½†å¦‚æœæ•°æ®æºé‡Œçš„æŸä¸€ä¸ªæ•°æ®é‡Œçš„å±æ€§å‘ç”Ÿäº†æ›´æ”¹, æ˜¯æ— æ³•ç›‘å¬çš„åˆ°, å½“ç„¶å¯ä»¥ç»“åˆKVO,ä½†è¿™æ ·ä¸€æ¥å°±ç›¸å¯¹å¤æ‚äº†; soé›†åˆé€šçŸ¥è¿˜æ˜¯æŒºå®ç”¨çš„ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">class Dog: Object &#123;</div><div class="line">  dynamic var name = &quot;&quot;</div><div class="line">  dynamic var age = 0</div><div class="line">&#125;</div><div class="line"></div><div class="line">class Person: Object &#123;</div><div class="line">  dynamic var name = &quot;&quot;</div><div class="line">  let dogs = List&lt;Dog&gt;()</div><div class="line">&#125;</div><div class="line"></div><div class="line">class ViewController: UITableViewController &#123;</div><div class="line">  var notificationToken: NotificationToken? = nil</div><div class="line"></div><div class="line">  override func viewDidLoad() &#123;</div><div class="line">    super.viewDidLoad()</div><div class="line">    let realm = try! Realm()</div><div class="line">    </div><div class="line">    // å¯¹resultsçš„ç›‘å¬</div><div class="line">    let results = realm.objects(Person).filter(&quot;age &gt; 5&quot;)</div><div class="line"></div><div class="line">    // è§‚å¯Ÿ Results é€šçŸ¥</div><div class="line">    notificationToken = results.addNotificationBlock &#123; [weak self] (changes: RealmCollectionChange) in</div><div class="line">      guard let tableView = self?.tableView else &#123; return &#125;</div><div class="line">      switch changes &#123;</div><div class="line">      case .initial:</div><div class="line">        // Results ç°åœ¨å·²ç»å¡«å……å®Œæ¯•ï¼Œå¯ä»¥ä¸éœ€è¦é˜»å¡ UI å°±å¯ä»¥è¢«è®¿é—®</div><div class="line">        tableView.reloadData()</div><div class="line">        break</div><div class="line">      case .update(_, let deletions, let insertions, let modifications):</div><div class="line">        // Query results have changed, so apply them to the UITableView</div><div class="line">        tableView.beginUpdates()</div><div class="line">        tableView.insertRows(at: insertions.map(&#123; IndexPath(row: $0, section: 0) &#125;),</div><div class="line">                           with: .automatic)</div><div class="line">        tableView.deleteRows(at: deletions.map(&#123; IndexPath(row: $0, section: 0)&#125;),</div><div class="line">                           with: .automatic)</div><div class="line">        tableView.reloadRows(at: modifications.map(&#123; IndexPath(row: $0, section: 0) &#125;), </div><div class="line">                           with: .automatic)</div><div class="line">        tableView.endUpdates()</div><div class="line">        break</div><div class="line">      case .error(let error):</div><div class="line">        // å¦‚æœåœ¨åå°å·¥ä½œçº¿ç¨‹ä¸­æ‰“å¼€ Realm æ–‡ä»¶ï¼Œåˆ™ä¼šå‘ç”Ÿé”™è¯¯</div><div class="line">        fatalError(&quot;\(error)&quot;)</div><div class="line">        break</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  deinit &#123;</div><div class="line">    notificationToken?.stop()</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>å¯¹è±¡é€šçŸ¥<ul>
<li>Realm æ”¯æŒå¯¹è±¡çº§åˆ«çš„é€šçŸ¥ã€‚åœ¨ç‰¹å®šçš„ Realm å¯¹è±¡ä¸Šè¿›è¡Œé€šçŸ¥çš„æ³¨å†Œï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ­¤å¯¹è±¡è¢«åˆ é™¤æ—¶ã€æˆ–è€…è¯¥å¯¹è±¡æ‰€ç®¡ç†çš„å±æ€§å€¼è¢«ä¿®æ”¹æ—¶è·å–ç›¸åº”çš„é€šçŸ¥ã€‚</li>
<li>åªæœ‰ç”± Realm æ•°æ®åº“æ‰€ç®¡ç†çš„å¯¹è±¡æ‰èƒ½å¤Ÿè¿›è¡Œé€šçŸ¥æ³¨å†Œã€‚</li>
<li>è¿™ä¸ªé€šçŸ¥å¤„ç†é—­åŒ…å°†åŒ…å«æœ‰ ObjectChange æšä¸¾å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æœ‰å¯¹è±¡è¢«åˆ é™¤ã€æ˜¯å¦æœ‰å¯¹è±¡çš„å±æ€§å€¼å‘ç”Ÿäº†æ”¹å˜ï¼Œä»¥åŠæ˜¯å¦æœ‰é”™è¯¯å‘ç”Ÿã€‚</li>
<li><strong>å¯¹è±¡è¢«åˆ é™¤çš„è¯</strong>ï¼Œé‚£ä¹ˆè¿™ä¸ªé€šçŸ¥é—­åŒ…å°†ä¼šå¸¦ç€ ObjectChange.deleted çš„å‚æ•°è¢«è°ƒç”¨ã€‚è¿™ä¸ªé—­åŒ…å°†ä¸ä¼šè¢«å†æ¬¡è°ƒç”¨ã€‚</li>
<li><strong>å¯¹è±¡çš„å±æ€§å‘ç”Ÿäº†å˜æ›´çš„è¯</strong>ï¼Œé‚£ä¹ˆè¿™ä¸ªé—­åŒ…å°†ä¼šå¸¦ç€ ObjectChange.change çš„å‚æ•°è¢«è°ƒç”¨ã€‚è¿™ä¸ªæšä¸¾å°†ä¼šåŒ…å«æœ‰ PropertyChange ç±»å‹çš„æ•°ç»„ã€‚æ¯ä¸ªæ•°ç»„å€¼éƒ½åŒ…å«æœ‰è¢«ä¿®æ”¹çš„å±æ€§å(ä»¥å­—ç¬¦ä¸²çš„å½¢å¼æä¾›)ã€ä¿®æ”¹å‰çš„å±æ€§å€¼ä»¥åŠå½“å‰çš„å±æ€§å€¼ã€‚</li>
<li><strong>æœ‰é”™è¯¯å‘ç”Ÿ</strong>ï¼Œé‚£ä¹ˆè¿™ä¸ªé—­åŒ…å°†ä¼šå¸¦æœ‰ ObjectChange.error çš„å‚æ•°è¢«è°ƒç”¨ã€‚è¿™ä¸ªé—­åŒ…å°†ä¸ä¼šè¢«å†æ¬¡è°ƒç”¨ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public enum ObjectChange &#123;</div><div class="line">    case error(_: NSError)</div><div class="line">    case change(_: [PropertyChange])</div><div class="line">    case deleted</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">class StepCounter: Object &#123;</div><div class="line">  dynamic var steps = 0</div><div class="line">&#125;</div><div class="line"></div><div class="line">let stepCounter = StepCounter()</div><div class="line">let realm = try! Realm()</div><div class="line">try! realm.write &#123;</div><div class="line">    realm.add(stepCounter)</div><div class="line">&#125;</div><div class="line"></div><div class="line">var token : NotificationToken?</div><div class="line">token = stepCounter.addNotificationBlock &#123; change in</div><div class="line">    switch change &#123; // ç›‘å¬å¯¹è±¡</div><div class="line">    case .change(let properties):</div><div class="line">        for property in properties &#123;</div><div class="line">            if property.name == &quot;steps&quot; &amp;&amp; property.newValue as! Int &gt; 1000 &#123;</div><div class="line">                token = nil</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    case .error(let error):</div><div class="line">    case .deleted:</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ç•Œé¢é©±åŠ¨æ›´æ–°<br>Realm çš„é€šçŸ¥æ€»æ˜¯ä»¥å¼‚æ­¥çš„æ–¹å¼è¿›è¡Œä¼ é€’ï¼Œå› æ­¤è¿™äº›æ“ä½œæ°¸è¿œä¸ä¼šé˜»å¡ä¸» UI çº¿ç¨‹ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´åº”ç”¨å¡é¡¿ã€‚å¦‚æœéœ€è¦åœ¨ä¸»çº¿ç¨‹åŒæ­¥ä¼ é€’, å¹¶ç«‹å³æ›´æ–°åœ¨UIä¸Š, å°±å¯ä»¥ä½¿ç”¨<strong>ç•Œé¢é©±åŠ¨æ›´æ–° (Interface-Driven writes)ã€‚</strong></li>
</ul>
<blockquote>
<p>æ¡ˆä¾‹: å‡è®¾ç”¨æˆ·éœ€è¦å‘è¡¨è§†å›¾å½“ä¸­æ’å…¥ä¸€ä¸ªé¡¹ç›®ã€‚ç†æƒ³çŠ¶å†µä¸‹ï¼ŒUI å°†ä¼šå°†è¿™ä¸ªæ“ä½œç”¨åŠ¨ç”»è¡¨ç°å‡ºæ¥ï¼Œç„¶åå½“ç”¨æˆ·å®ŒæˆåŠ¨ä½œçš„æ—¶å€™ç«‹å³å¯åŠ¨ç›¸åº”çš„æ“ä½œã€‚</p>
<p>ç„¶è€Œï¼Œæ­¤æ’å…¥æ“ä½œçš„ Realm å˜æ›´é€šçŸ¥å°†ä¼šå»¶æ—¶ä¸€æ®µæ—¶é—´æ‰è¿›è¡Œä¼ é€’ï¼Œå®ƒä¼šå…ˆå°†ä¸€ä¸ªå¯¹è±¡æ·»åŠ åˆ°è¡¨è§†å›¾èƒŒåæ‰€å…³è”çš„é›†åˆå½“ä¸­ï¼Œéšåå†å°è¯•å»åœ¨ UI å½“ä¸­æ’å…¥ä¸€ä¸ªæ–°çš„é¡¹ç›®ã€‚è¿™ç§åŒé‡æ’å…¥å°†ä¼šå¯¼è‡´ UI ä¸åå°æ•°æ®ä¹‹é—´çš„æ•°æ®ä¸ä¸€è‡´ï¼Œè€Œè¿™å¾€å¾€ä¼šå¯¼è‡´åº”ç”¨å´©æºƒï¼ğŸ’¥NSInternalInconsistencyExceptionğŸ’¥</p>
<p>å€ŸåŠ© Realm.commitWrite(withoutNotifying:)ï¼Œè¿™æ ·åœ¨æ‰§è¡Œç•Œé¢é©±åŠ¨æ›´æ–°çš„æ—¶å€™ï¼Œé€šè¿‡ä¼ é€’é€šçŸ¥é—­åŒ…çš„é€šçŸ¥ä»¤ç‰Œçš„æ–¹å¼ï¼Œè¿™æ ·å°±ä¸ä¼šå¯¹å˜æ›´æ“ä½œæ‰§è¡ŒäºŒæ¬¡å“åº”ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">token = collection.addNotificationBlock &#123; changes in</div><div class="line">  switch changes &#123;</div><div class="line">  case .initial:</div><div class="line">    tableView.reloadData()</div><div class="line">    break</div><div class="line">  case .update(_, let deletions, let insertions, let modifications):</div><div class="line">    tableView.beginUpdates()</div><div class="line">    tableView.insertRows(at: insertions.map(&#123; IndexPath(row: $0, section: 0) &#125;),</div><div class="line">                         with: .automatic)</div><div class="line">    tableView.deleteRows(at: deletions.map(&#123; IndexPath(row: $0, section: 0)&#125;),</div><div class="line">                         with: .automatic)</div><div class="line">    tableView.reloadRows(at: modifications.map(&#123; IndexPath(row: $0, section: 0) &#125;),</div><div class="line">                         with: .automatic)</div><div class="line">    tableView.endUpdates()</div><div class="line">    break</div><div class="line">  case .error(let error):</div><div class="line">    break</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">func insertItem() throws &#123;</div><div class="line"> // åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ</div><div class="line">  collection.realm!.beginWrite()</div><div class="line">  collection.insert(Item(), at: 0)</div><div class="line">  tableView.insertRows(at: [IndexPath(row: 0, section: 0)], with: .automatic)</div><div class="line">  </div><div class="line">  // ç¡®ä¿ä¸ä¼šé‡å¤æ‰§è¡Œ</div><div class="line">  collection.realm!.commitWrite(withoutNotifying: [token])</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="æ•°æ®åº“è¿ç§»"><a href="#æ•°æ®åº“è¿ç§»" class="headerlink" title="æ•°æ®åº“è¿ç§»"></a>æ•°æ®åº“è¿ç§»</h5><p>å¦‚æœä¿®æ”¹äº†æ•°æ®æ¨¡å‹, ä¾‹å¦‚æ–°å¢å±æ€§, å°±éœ€è¦è¿›è¡Œæ•°æ®çš„è¿ç§»</p>
<ul>
<li>ç®€å•è¯´æ˜</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">/* Realm.Configuration(fileURL: &lt;#T##URL?#&gt;,</div><div class="line"> inMemoryIdentifier: &lt;#T##String?#&gt;,</div><div class="line">  syncConfiguration: &lt;#T##SyncConfiguration?#&gt;, </div><div class="line">  encryptionKey: &lt;#T##Data?#&gt;,</div><div class="line">  readOnly: &lt;#T##Bool#&gt;, </div><div class="line">  schemaVersion: &lt;#T##UInt64#&gt;,</div><div class="line">  migrationBlock: &lt;#T##MigrationBlock?##MigrationBlock?##(Migration, UInt64) -&gt; Void#&gt;,</div><div class="line">  deleteRealmIfMigrationNeeded: &lt;#T##Bool#&gt;,</div><div class="line">  shouldCompactOnLaunch: &lt;#T##((Int, Int) -&gt; Bool)?##((Int, Int) -&gt; Bool)?##(Int, Int) -&gt; Bool#&gt;,</div><div class="line">  objectTypes: &lt;#T##[Object.Type]?#&gt;)</div><div class="line">*/</div><div class="line"></div><div class="line">func configRealmWithUser(_ username:String) &#123;   </div><div class="line">	var config = Realm.Configuration()      </div><div class="line">	config.fileURL = 	config.fileURL?.deletingLastPathComponent()</div><div class="line">            .appendingPathComponent(&quot;\(username).realm&quot;)</div><div class="line">//      config.syncConfiguration = </div><div class="line">//      config.migrationBlock = </div><div class="line">//      config.schemaVersion = </div><div class="line">//  ... </div><div class="line">      </div><div class="line">	Realm.Configuration.defaultConfiguration = config</div><div class="line">&#125;</div><div class="line"></div><div class="line">æˆ–:å‚æ•°çš„ä¸ªæ•°ä»»æ„ç»„åˆçš„blockå½¢å¼</div><div class="line">let config = Realm.Configuration(</div><div class="line">	schemaVersion: 1, migrationBlock: &#123; (migration, oldSchemaVersion) in</div><div class="line">	if (oldSchemaVersion &lt; 1) &#123;</div><div class="line">	// ä»€ä¹ˆéƒ½ä¸è¦åšï¼Realm ä¼šè‡ªè¡Œæ£€æµ‹æ–°å¢å’Œéœ€è¦ç§»é™¤çš„å±æ€§ï¼Œç„¶åè‡ªåŠ¨æ›´æ–°ç¡¬ç›˜ä¸Šçš„æ•°æ®åº“æ¶æ„</div><div class="line">	&#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line">Realm.Configuration.defaultConfiguration = config</div></pre></td></tr></table></figure>
<ul>
<li>å€¼çš„æ›´æ–°</li>
</ul>
<blockquote>
<p>åœ¨è¿ç§»é—­åŒ…ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè°ƒç”¨Migration().enumerateObjects(ofType: <em>:</em>:) æ¥æšä¸¾ç‰¹å®šç±»å‹çš„æ¯ä¸ª Object å¯¹è±¡ï¼Œç„¶åæ‰§è¡Œå¿…è¦çš„è¿ç§»é€»è¾‘ã€‚æ³¨æ„ï¼Œå¯¹æšä¸¾ä¸­æ¯ä¸ªå·²å­˜åœ¨çš„ Object å®ä¾‹æ¥è¯´ï¼Œåº”è¯¥æ˜¯é€šè¿‡è®¿é—® oldObject å¯¹è±¡è¿›è¡Œè®¿é—®ï¼Œè€Œæ›´æ–°ä¹‹åçš„å®ä¾‹åº”è¯¥é€šè¿‡ newObject è¿›è¡Œè®¿é—®ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">// åœ¨ application(application:didFinishLaunchingWithOptions:) ä¸­è¿›è¡Œé…ç½®</div><div class="line"></div><div class="line">Realm.Configuration.defaultConfiguration = Realm.Configuration(</div><div class="line">  schemaVersion: 1,</div><div class="line">  migrationBlock: &#123; migration, oldSchemaVersion in</div><div class="line">    if (oldSchemaVersion &lt; 1) &#123;</div><div class="line">      // enumerateObjects(ofType:_:) æ–¹æ³•éå†äº†å­˜å‚¨åœ¨ Realm æ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ªâ€œPersonâ€å¯¹è±¡</div><div class="line">      migration.enumerateObjects(ofType: Person.className()) &#123; oldObject, newObject in</div><div class="line">        // å°†åå­—è¿›è¡Œåˆå¹¶ï¼Œå­˜æ”¾åœ¨ fullName åŸŸä¸­</div><div class="line">        let firstName = oldObject![&quot;firstName&quot;] as! String</div><div class="line">        let lastName = oldObject![&quot;lastName&quot;] as! String</div><div class="line">        newObject![&quot;fullName&quot;] = &quot;\(firstName) \(lastName)&quot;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;)</div></pre></td></tr></table></figure>
<ul>
<li>å±æ€§çš„é‡å‘½å</li>
</ul>
<blockquote>
<p>åœ¨è¿ç§»è¿‡ç¨‹ä¸­å¯¹ç±»ä¸­æŸä¸ªå±æ€§è¿›è¡Œé‡å‘½åæ“ä½œï¼Œæ¯”èµ·æ‹·è´å€¼å’Œä¿ç•™å…³ç³»æ¥è¯´è¦æ›´ä¸ºé«˜æ•ˆã€‚</p>
<p>è¦åœ¨è¿ç§»è¿‡ç¨‹ä¸­å¯¹æŸä¸ªå±æ€§å°±è¿›è¡Œé‡å‘½åçš„è¯ï¼Œè¯·ç¡®ä¿æ‚¨çš„æ–°æ¨¡å‹å½“ä¸­çš„è¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªå…¨æ–°çš„åå­—ï¼Œå®ƒçš„åå­—ä¸èƒ½å’ŒåŸæœ‰æ¨¡å‹å½“ä¸­çš„åå­—é‡åˆã€‚</p>
<p>å¦‚æœæ–°çš„å±æ€§æ‹¥æœ‰ä¸åŒçš„å¯ç©ºæ€§æˆ–è€…ç´¢å¼•è®¾ç½®çš„è¯ï¼Œè¿™äº›é…ç½®ä¼šåœ¨é‡å‘½åæ“ä½œæœŸé—´ç”Ÿæ•ˆã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// åœ¨ application(application:didFinishLaunchingWithOptions:) å½“ä¸­ä½¿ç”¨</div><div class="line"></div><div class="line">Realm.Configuration.defaultConfiguration = Realm.Configuration(</div><div class="line">  schemaVersion: 1,</div><div class="line">  migrationBlock: &#123; migration, oldSchemaVersion in</div><div class="line">    // æˆ‘ä»¬ç›®å‰è¿˜æ²¡æœ‰è¿ç§»ä»»ä½•ä¸œè¥¿ï¼Œå› æ­¤ oldSchemaVersion == 0</div><div class="line">    if (oldSchemaVersion &lt; 1) &#123;</div><div class="line">      // é‡å‘½åæ“ä½œåº”è¯¥åœ¨è°ƒç”¨ `enumerateObjects(ofType: _:)` ä¹‹å¤–å®Œæˆ</div><div class="line">      migration.renameProperty(onType: Person.className(), from: &quot;yearsSinceBirth&quot;, to: &quot;age&quot;)</div><div class="line">    &#125;</div><div class="line">  &#125;)</div></pre></td></tr></table></figure>
<ul>
<li>å¤šä¸ªç‰ˆæœ¬çš„æ§åˆ¶</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">Realm.Configuration.defaultConfiguration = Realm.Configuration(</div><div class="line">  schemaVersion: 2,</div><div class="line">  migrationBlock: &#123; migration, oldSchemaVersion in</div><div class="line">    // enumerateObjects:block: éå†äº†å­˜å‚¨åœ¨ Realm æ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ªâ€œPersonâ€å¯¹è±¡</div><div class="line">    migration.enumerateObjects(ofType: Person.className()) &#123; oldObject, newObject in</div><div class="line">      // åªæœ‰å½“ Realm æ•°æ®åº“çš„æ¶æ„ç‰ˆæœ¬ä¸º 0 çš„æ—¶å€™ï¼Œæ‰æ·»åŠ  â€œfullNameâ€ å±æ€§</div><div class="line">      if oldSchemaVersion &lt; 1 &#123;</div><div class="line">        let firstName = oldObject![&quot;firstName&quot;] as! String</div><div class="line">        let lastName = oldObject![&quot;lastName&quot;] as! String</div><div class="line">        newObject![&quot;fullName&quot;] = &quot;\(firstName) \(lastName)&quot;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      // åªæœ‰å½“ Realm æ•°æ®åº“çš„æ¶æ„ç‰ˆæœ¬ä¸º 0 æˆ–è€… 1 çš„æ—¶å€™ï¼Œæ‰æ·»åŠ â€œemailâ€å±æ€§</div><div class="line">      if oldSchemaVersion &lt; 2 &#123;</div><div class="line">          newObject![&quot;email&quot;] = &quot;&quot;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">// Realm æ•°æ®åº“ä¼šè‡ªåŠ¨æ‰§è¡Œæ­¤æ•°æ®è¿ç§»ï¼Œç„¶åæˆåŠŸè¿›è¡Œè®¿é—®</div><div class="line">let realm = try! Realm()</div></pre></td></tr></table></figure>
<h5 id="æ•°æ®åº“åŠ å¯†"><a href="#æ•°æ®åº“åŠ å¯†" class="headerlink" title="æ•°æ®åº“åŠ å¯†"></a>æ•°æ®åº“åŠ å¯†</h5><ul>
<li>Realm æ”¯æŒåœ¨åˆ›å»º Realm æ•°æ®åº“æ—¶é‡‡ç”¨64ä½çš„å¯†é’¥å¯¹æ•°æ®åº“æ–‡ä»¶è¿›è¡Œ AES-256+SHA2 åŠ å¯†ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// äº§ç”Ÿéšæœºå¯†é’¥</div><div class="line">var key = Data(count: 64)</div><div class="line">_ = key.withUnsafeMutableBytes &#123; bytes in</div><div class="line">  SecRandomCopyBytes(kSecRandomDefault, 64, bytes)</div><div class="line">&#125;</div><div class="line"></div><div class="line">// æ‰“å¼€åŠ å¯†æ–‡ä»¶</div><div class="line">let config = Realm.Configuration(encryptionKey: key)</div><div class="line">do &#123;</div><div class="line">  let realm = try Realm(configuration: config)</div><div class="line">  // å’Œå¾€å¸¸ä¸€æ ·ä½¿ç”¨ Realm å³å¯</div><div class="line">  let dogs = realm.objects(Dog).filter(&quot;name contains &apos;Fido&apos;&quot;)</div><div class="line">&#125; catch let error as NSError &#123;</div><div class="line">  // å¦‚æœå¯†é’¥é”™è¯¯ï¼Œ`error` ä¼šæç¤ºæ•°æ®åº“ä¸å¯è®¿é—®</div><div class="line">  fatalError(&quot;Error opening realm: \(error)&quot;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™æ ·ç¡¬ç›˜ä¸Šçš„æ•°æ®éƒ½èƒ½éƒ½é‡‡ç”¨AES-256æ¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œå¹¶ç”¨ SHA-2 HMAC æ¥è¿›è¡ŒéªŒè¯ã€‚ æ¯æ¬¡æ‚¨è¦è·å–ä¸€ä¸ª Realm å®ä¾‹æ—¶ï¼Œæ‚¨éƒ½éœ€è¦æä¾›ä¸€æ¬¡ç›¸åŒçš„å¯†é’¥ã€‚</p>
</blockquote>
<ul>
<li>å¯†é’¥å¹¶å°†å…¶å®‰å…¨åœ°å­˜æ”¾åˆ°é’¥åŒ™ä¸²å½“ä¸­ï¼Œç„¶åç”¨å…¶åŠ å¯† Realmã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">import Security</div><div class="line"></div><div class="line">func getKey() -&gt; NSData &#123;</div><div class="line">	// æ ‡è¯†ç¬¦</div><div class="line">	let keychainIdentifier = &quot;io.Realm.EncryptionExampleKey&quot;</div><div class="line">	let keychainIdentifierData = keychainIdentifier.data(using: String.Encoding.utf8, allowLossyConversion: false)!</div><div class="line"></div><div class="line">	// æ£€æµ‹æ˜¯å¦å­˜åœ¨é’¥åŒ™ä¸²</div><div class="line">	var query: [NSString: AnyObject] = [</div><div class="line">		kSecClass: kSecClassKey,</div><div class="line">		kSecAttrApplicationTag: keychainIdentifierData as AnyObject,</div><div class="line">		kSecAttrKeySizeInBits: 512 as AnyObject,</div><div class="line">		kSecReturnData: true as AnyObject</div><div class="line">	]</div><div class="line">	</div><div class="line">	var dataTypeRef: AnyObject?</div><div class="line">	var status = withUnsafeMutablePointer(to: &amp;dataTypeRef) &#123; SecItemCopyMatching(query as CFDictionary, UnsafeMutablePointer($0)) &#125;</div><div class="line">	if status == errSecSuccess &#123; // æ‰¾åˆ°å°±è¿”å›</div><div class="line">		return dataTypeRef as! NSData</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	// æ²¡æœ‰æ‰¾åˆ°å°±æ–°å»ºä¸€ä¸ª</div><div class="line">	let keyData = NSMutableData(length: 64)!</div><div class="line">	let result = SecRandomCopyBytes(kSecRandomDefault, 64, keyData.mutableBytes.bindMemory(to: UInt8.self, capacity: 64))</div><div class="line">	assert(result == 0, &quot;Failed to get random bytes&quot;)</div><div class="line"></div><div class="line">	// å­˜å‚¨é’¥åŒ™ä¸²</div><div class="line">	query = [</div><div class="line">		kSecClass: kSecClassKey,</div><div class="line">		kSecAttrApplicationTag: keychainIdentifierData as AnyObject,</div><div class="line">		kSecAttrKeySizeInBits: 512 as AnyObject,</div><div class="line">		kSecValueData: keyData</div><div class="line">	]</div><div class="line"></div><div class="line">	status = SecItemAdd(query as CFDictionary, nil)</div><div class="line">	assert(status == errSecSuccess, &quot;Failed to insert the new key in the keychain&quot;)</div><div class="line">	return keyData</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>ä½¿ç”¨</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">// æ·»åŠ </div><div class="line">autoreleasepool &#123;</div><div class="line">	let configuration = Realm.Configuration(encryptionKey: getKey() as Data)</div><div class="line">	let realm = try! Realm(configuration: configuration)</div><div class="line"></div><div class="line">	// Add an object</div><div class="line">	try! realm.write &#123;</div><div class="line">		let dog = Dog()</div><div class="line">		dog.name = &quot;xxxx&quot;</div><div class="line">		realm.add(dog)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">// æŸ¥è¯¢</div><div class="line">autoreleasepool &#123;</div><div class="line">	let configuration = Realm.Configuration(encryptionKey: getKey() as Data)</div><div class="line">	let realm = try! Realm(configuration: configuration)</div><div class="line">	if let dogName = realm.objects(Dog.self).first?.name &#123;</div><div class="line">	print(dogName)</div><div class="line">	  &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>åŠ å¯†è¿‡çš„ Realm åªä¼šå¸¦æ¥å¾ˆå°‘çš„é¢å¤–èµ„æºå ç”¨ï¼ˆé€šå¸¸æœ€å¤šåªä¼šæ¯”å¹³å¸¸æ…¢10%ï¼‰ã€‚</p>
<p>Realm çš„åŠ å¯† API ç›®å‰æ”¯æŒ iOSã€OS X ä»¥åŠ WatchKit å¹³å°ï¼Œä½† ä¸æ”¯æŒ watchOS å¹³å°ï¼Œå› ä¸º Realm åŠ å¯†æœºåˆ¶ä½¿ç”¨çš„ <mach mach.h=""> ä»¥åŠ <mach exc.h=""> API è¢«æ ‡è®°ä¸º__WATCHOS_PROHIBITED` äº†ã€‚</mach></mach></p>
</blockquote>
<h5 id="ç‰ˆæœ¬é™åˆ¶"><a href="#ç‰ˆæœ¬é™åˆ¶" class="headerlink" title="ç‰ˆæœ¬é™åˆ¶"></a>ç‰ˆæœ¬é™åˆ¶</h5><blockquote>
<p>Realm è‡´åŠ›äºå¹³è¡¡æ•°æ®åº“è¯»å–çš„çµæ´»æ€§å’Œæ€§èƒ½ã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œåœ¨ Realm ä¸­æ‰€å­˜å‚¨çš„ä¿¡æ¯çš„å„ä¸ªæ–¹é¢éƒ½æœ‰åŸºæœ¬çš„é™åˆ¶ã€‚ä¾‹å¦‚ï¼š</p>
<p>ï¼ˆ1ï¼‰ç±»åç§°çš„é•¿åº¦æœ€å¤§åªèƒ½å­˜å‚¨ 57 ä¸ª UTF8 å­—ç¬¦ã€‚</p>
<p>ï¼ˆ2ï¼‰å±æ€§åç§°çš„é•¿åº¦æœ€å¤§åªèƒ½æ”¯æŒ 63 ä¸ª UTF8 å­—ç¬¦ã€‚</p>
<p>ï¼ˆ3ï¼‰NSData ä»¥åŠ String å±æ€§ä¸èƒ½ä¿å­˜è¶…è¿‡ 16 MB å¤§å°çš„æ•°æ®ã€‚å¦‚æœè¦å­˜å‚¨å¤§é‡çš„æ•°æ®ï¼Œå¯é€šè¿‡å°†å…¶åˆ†è§£ä¸º16MB å¤§å°çš„å—ï¼Œæˆ–è€…ç›´æ¥å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç„¶åå°†æ–‡ä»¶è·¯å¾„å­˜å‚¨åœ¨ Realm ä¸­ã€‚å¦‚æœæ‚¨çš„åº”ç”¨è¯•å›¾å­˜å‚¨ä¸€ä¸ªå¤§äº 16MB çš„å•ä¸€å±æ€§ï¼Œç³»ç»Ÿå°†åœ¨è¿è¡Œæ—¶æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>ï¼ˆ4ï¼‰å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ’åºä»¥åŠä¸åŒºåˆ†å¤§å°å†™æŸ¥è¯¢åªæ”¯æŒâ€œåŸºç¡€æ‹‰ä¸å­—ç¬¦é›†â€ã€â€œæ‹‰ä¸å­—ç¬¦è¡¥å……é›†â€ã€â€œæ‹‰ä¸æ–‡æ‰©å±•å­—ç¬¦é›† Aâ€ ä»¥åŠâ€æ‹‰ä¸æ–‡æ‰©å±•å­—ç¬¦é›† Bâ€œï¼ˆUTF-8 çš„èŒƒå›´åœ¨ 0~591 ä¹‹é—´ï¼‰ã€‚</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/æ•°æ®åº“/">æ•°æ®åº“</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="[post]-Xcode8æ–°ç‰¹æ€§"  class="article article-type-[post]" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2016/10/03/Xcode8æ–°ç‰¹æ€§/">Xcode8æ–°ç‰¹æ€§</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2016/10/03/Xcode8æ–°ç‰¹æ€§/" class="article-date">
	  <time datetime="2016-10-03T03:26:31.000Z" itemprop="datePublished">2016-10-03</time>
	</a>

      
    <a class="article-category-link" href="/categories/iOS/">iOS</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>9æœˆ14æ—¥å¼€å‘è€…ä»¬å·²ç»å¯ä»¥ä¸‹è½½å¹¶ä½¿ç”¨æ­£å¼ç‰ˆXcode8, å€Ÿç€å›½åº†ä¼‘æ¯æœŸé—´,æœ¬äººä¹Ÿä¸‹è½½å¹¶ä½¿ç”¨äº†Xcode8, å‘ç°é‡Œé¢çš„å‘ç‚¹ä¸å°‘.ä¸‹é¢å°±æ€»ç»“åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡è§çš„ä¸€äº›é—®é¢˜.</p>
<h3 id="æ–°ç‰¹æ€§"><a href="#æ–°ç‰¹æ€§" class="headerlink" title="æ–°ç‰¹æ€§"></a>æ–°ç‰¹æ€§</h3><h4 id="General"><a href="#General" class="headerlink" title="General"></a>General</h4><p>Xcode8ä¸­é€šè¿‡<code>Automatically manage signing</code>, è®©è‹¹æœä¸ºæˆ‘ä»¬ç®¡ç†æ•´æ•°å’Œé…ç½®æ–‡ä»¶.<br>æƒ³è¦è®¾ç½®å®‰è£…åæ˜¾ç¤ºåœ¨æ‰‹æœºä¸Šçš„APPçš„åå­—, å¯ä»¥ç›´æ¥ä¿®æ”¹<strong>Display Name</strong>, è¿™ä¸ªä¿®æ”¹å’Œ<strong>Info.plist</strong>ä¿®æ”¹æ˜¯åŒæ­¥çš„.<br><img src="http://ww4.sinaimg.cn/large/65e4f1e6gw1f92dmnilo1j20g20arq45.jpg" alt=""></p>
<p>æ‰‹åŠ¨ç®¡ç†è¯ä¹¦å’Œæè¿°æ–‡ä»¶, å»æ‰<code>Automatically manage signing</code>çš„å‹¾å³å¯.<br><img src="http://ww1.sinaimg.cn/large/65e4f1e6gw1f92dn5338yj20gg0dmq4b.jpg" alt=""></p>
<h4 id="ATSé—®é¢˜"><a href="#ATSé—®é¢˜" class="headerlink" title="ATSé—®é¢˜"></a>ATSé—®é¢˜</h4><p>åœ¨iOS9ä¸­,æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®<code>NSAllowsArbitraryLoads</code>ä¸º<code>YES</code>, æ¥ä½¿ç”¨HTTPç½‘ç»œ; iOS10ä»2017å¹´1æœˆ1æ—¥å¼€å§‹, è‹¹æœä¸å…è®¸æˆ‘ä»¬é€šè¿‡è¿™ä¸ªæ–¹æ³•è·³è¿‡ATS, å¼ºåˆ¶ä½¿ç”¨HTTPS.æˆ‘ä»¬å¯ä»¥ç”¨è¿‡<code>NSExceptionDomains</code>å¯¹ç‰¹å®šçš„åŸŸåå¼€æ”¾HTTP.<br><img src="http://ww1.sinaimg.cn/large/65e4f1e6gw1f92dni65g2j20x007rta9.jpg" alt=""></p>
<h4 id="éšç§æƒé™çš„è®¾ç½®"><a href="#éšç§æƒé™çš„è®¾ç½®" class="headerlink" title="éšç§æƒé™çš„è®¾ç½®"></a>éšç§æƒé™çš„è®¾ç½®</h4><p>iOS10 å¯¹éšç§æƒé™æ›´åŠ ä¸¥æ ¼, å¦‚æœä¸è®¾ç½®, ä¼šç›´æ¥å´©æºƒ.<br><img src="http://ww1.sinaimg.cn/large/65e4f1e6gw1f92dnv67gxj20zb03tjul.jpg" alt=""><br>æ ¹æ®é”™è¯¯æç¤º: æˆ‘ä»¬å¯ä»¥åœ¨<code>info.plist</code>æ–‡ä»¶ä¸­ æ·»åŠ å¯¹åº”çš„é”®å€¼å°±å¯ä»¥äº†.<br><img src="http://ww2.sinaimg.cn/large/65e4f1e6gw1f92do7ykoaj20w70dw0vr.jpg" alt=""></p>
<ul>
<li>éº¦å…‹é£æƒé™ï¼šPrivacy - Microphone Usage Description æ˜¯å¦å…è®¸æ­¤Appä½¿ç”¨ä½ çš„éº¦å…‹é£ï¼Ÿ</li>
<li>ç›¸æœºæƒé™ï¼š Privacy - Camera Usage Description æ˜¯å¦å…è®¸æ­¤Appä½¿ç”¨ä½ çš„ç›¸æœºï¼Ÿ<ul>
<li>ç›¸å†Œæƒé™ï¼š Privacy - Photo Library Usage Description æ˜¯å¦å…è®¸æ­¤Appè®¿é—®ä½ çš„åª’ä½“èµ„æ–™åº“ï¼Ÿ</li>
<li>é€šè®¯å½•æƒé™ï¼š Privacy - Contacts Usage Description æ˜¯å¦å…è®¸æ­¤Appè®¿é—®ä½ çš„é€šè®¯å½•ï¼Ÿ</li>
<li>è“ç‰™æƒé™ï¼šPrivacy - Bluetooth Peripheral Usage Description æ˜¯å¦è®¸å…æ­¤Appä½¿ç”¨è“ç‰™ï¼Ÿ</li>
<li>è¯­éŸ³è½¬æ–‡å­—æƒé™ï¼šPrivacy - Speech Recognition Usage Description æ˜¯å¦å…è®¸æ­¤Appä½¿ç”¨è¯­éŸ³è¯†åˆ«ï¼Ÿ</li>
<li>æ—¥å†æƒé™ï¼šPrivacy - Calendars Usage Description æ˜¯å¦å…è®¸æ­¤Appä½¿ç”¨æ—¥å†ï¼Ÿ</li>
<li>å®šä½æƒé™ï¼šPrivacy - Location When In Use Usage Description æˆ‘ä»¬éœ€è¦é€šè¿‡æ‚¨çš„åœ°ç†ä½ç½®ä¿¡æ¯è·å–æ‚¨å‘¨è¾¹çš„ç›¸å…³æ•°æ®</li>
<li>å®šä½æƒé™: Privacy - Location Always Usage Description æˆ‘ä»¬éœ€è¦é€šè¿‡æ‚¨çš„åœ°ç†ä½ç½®ä¿¡æ¯è·å–æ‚¨å‘¨è¾¹çš„ç›¸å…³æ•°æ®</li>
</ul>
</li>
</ul>
<h4 id="Interface-Builder"><a href="#Interface-Builder" class="headerlink" title="Interface Builder"></a>Interface Builder</h4><p>Xcode8ä¹‹å‰çš„ <code>Size Class</code><br><img src="http://ww2.sinaimg.cn/large/65e4f1e6gw1f92dosolakj20am08gwel.jpg" alt=""><br>Xcode8ä¹‹åçš„å°±ä¸å«<code>Size Class</code>, å°±æ˜¯ä¸€ä¸ªé¢„è§ˆå½“å‰å½“å‰<code>XIB</code>æˆ–<code>SB</code>åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹çš„å›¾å½¢ç•Œé¢.<br><img src="http://ww2.sinaimg.cn/large/65e4f1e6gw1f92dp951zdj20fm05bjrx.jpg" alt=""><br><img src="http://ww3.sinaimg.cn/large/65e4f1e6gw1f92dphol8mj20k002ddg8.jpg" alt=""></p>
<p>Xcode8æ‰“å¼€ä¹‹å‰çš„æ—§é¡¹ç›®çš„<code>XIB</code>æˆ–<code>SB</code>æ–‡ä»¶æ—¶, ä¼šå¼¹å‡ºä¸€ä¸ªé€‰æ‹©åˆå§‹åŒ–è®¾ç½®è§†å›¾çš„çª—å£, ä¸€èˆ¬é€‰æ‹©<code>Choose Device</code>.<br><img src="http://ww2.sinaimg.cn/large/65e4f1e6gw1f92dpz5c7qj20c505odgo.jpg" alt=""></p>
<p>å¦‚æœXcode8æ‰“å¼€è¿‡å½“å‰çš„<code>XIB</code>æ–‡ä»¶, å¹¶é€‰æ‹©<code>Choose Device</code>å, ä½äºXcode8ç‰ˆæœ¬çš„ç¼–è¯‘å™¨å°†æ— æ³•æ‰“å¼€è¿™ä¸ª<code>XIB</code>æ–‡ä»¶, å¹¶ä¼šæŠ¥ä¸€ä¸‹é”™è¯¯:</p>
<blockquote>
<p>The document â€œViewController.xibâ€ requires Xcode 8.0 or later. This version does not support documents saved in the Xcode 8 format. Open this document with Xcode 8.0 or later.</p>
</blockquote>
<p>æœ‰ä¸¤ç§æ–¹æ³•è§£å†³:<br>1.åˆ é™¤<code>XIB</code>æˆ–<code>SB</code>æ–‡ä»¶ä¸­çš„ <strong>xml</strong>ä¸­çš„ä»£ç .</p>
<blockquote>
<p>æ‰“å¼€æ–¹å¼å³é”® -&gt; Open as -&gt; Source Code <code>&lt;capability name=&quot;documents saved in the Xcode 8 format&quot; minToolsVersion=&quot;8.0&quot;/&gt;</code></p>
</blockquote>
<p>2.å¤§å®¶ä¸€èµ·å‡çº§åˆ°Xcode8.</p>
<h4 id="ç¦ç”¨ç³»ç»Ÿlog"><a href="#ç¦ç”¨ç³»ç»Ÿlog" class="headerlink" title="ç¦ç”¨ç³»ç»Ÿlog"></a>ç¦ç”¨ç³»ç»Ÿlog</h4><p>Xcode 8åœ¨è°ƒè¯•å’Œè¿è¡Œè¿‡ç¨‹ä¸­, ä¼šæ‰“å°å¾ˆå¤šä¸è®¤è¯†çš„log.è¿™äº›æ˜¯ç³»ç»Ÿæ‰“å°çš„.<br><img src="http://ww2.sinaimg.cn/large/65e4f1e6gw1f92dqhhcvbj20xm05kadd.jpg" alt=""><br>è§£å†³åŠæ³•æ˜¯:åœ¨<code>Target -&gt; Edit Scheme -&gt; Run -&gt; Arguments</code>ä¸­ï¼Œæ·»åŠ <code>OS_ACTIVITY_MODE</code>å­—æ®µï¼Œå¹¶è®¾ç½®ä¸º<code>Disable</code>å³å¯ã€‚<br><img src="http://ww4.sinaimg.cn/large/65e4f1e6gw1f92dqvs2f7j21ax0l7mzr.jpg" alt=""></p>
<h4 id="æ’ä»¶é—®é¢˜"><a href="#æ’ä»¶é—®é¢˜" class="headerlink" title="æ’ä»¶é—®é¢˜"></a>æ’ä»¶é—®é¢˜</h4><p>è‹¹æœä¸ºäº†é¿å…ç±»ä¼¼ <a href="https://en.wikipedia.org/wiki/XcodeGhost" target="_blank" rel="external">Xcode Ghost:</a> äº‹ä»¶çš„å†æ¬¡å‘ç”Ÿ,Xcode8 ç¦ç”¨äº†æ’ä»¶æœºåˆ¶,è€Œå¼€æ”¾äº†å¦ä¸€ç§å½¢å¼ï¼š <a href="https://developer.apple.com/videos/play/wwdc2016/414/" target="_blank" rel="external">Source Editor extensions</a> ä½†æ˜¯è¿™ç§å½¢å¼å±€é™æ€§å¤ªå¤§.<br>è¿™é‡Œæœ‰ä¸€è¾¹æ–‡ç« ä»‹ç», è®©ä½ çš„Xcode8ç»§ç»­ä½¿ç”¨æ’ä»¶:<a href="http://vongloo.me/2016/09/10/Make-Your-Xcode8-Great-Again/?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="external">Xcode8ç»§ç»­ä½¿ç”¨æ’ä»¶</a></p>
<p>å¦‚æœå‡ºç°<code>commandï¼‹ï¼</code>æ³¨é‡Šä»£ç å¤±æ•ˆ, å¯ä»¥æ‰§è¡Œ<br><code>sudo /usr/libexec/xpccachectl</code>åé‡å¯ç”µè„‘.</p>
<p><strong>VVDocumenter-Xcode</strong>å·²ç»åœ¨Xcode8ä¸­é›†æˆäº†æ³¨é‡Šæ’ä»¶, ä½¿ç”¨æ–¹æ³•ä¸æ˜¯ä»¥å‰çš„<code>///</code>, è€Œæ˜¯<code>optionï¼‹commandï¼‹ï¼</code>.</p>
<h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><h5 id="UIColoræ–°å¢æ–¹æ³•"><a href="#UIColoræ–°å¢æ–¹æ³•" class="headerlink" title="UIColoræ–°å¢æ–¹æ³•"></a>UIColoræ–°å¢æ–¹æ³•</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">+ (UIColor *)colorWithDisplayP3Red:(CGFloat)displayP3Red green:(CGFloat)green blue:(CGFloat)blue alpha:(CGFloat)alpha NS_AVAILABLE_IOS(10_0);</div><div class="line"></div><div class="line">- (UIColor *)initWithDisplayP3Red:(CGFloat)displayP3Red green:(CGFloat)green blue:(CGFloat)blue alpha:(CGFloat)alpha NS_AVAILABLE_IOS(10_0);</div></pre></td></tr></table></figure>
<p>æ®è‹¹æœå®˜æ–¹å»ºè®®ä½¿ç”¨<code>sRGB</code>, ç†ç”±æ˜¯æ€§èƒ½å¥½, è‰²å½©æ›´ä¸°å¯Œ.</p>
<h5 id="å­—ä½“"><a href="#å­—ä½“" class="headerlink" title="å­—ä½“"></a>å­—ä½“</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">NS_CLASS_AVAILABLE_IOS(10_0) @protocol UIContentSizeCategoryAdjusting &lt;NSObject&gt;</div><div class="line"></div><div class="line">/*</div><div class="line"> Indicates whether the corresponding element should automatically update its font when the deviceâ€™s UIContentSizeCategory is changed.</div><div class="line"> For this property to take effect, the elementâ€™s font must be a font vended using +preferredFontForTextStyle: or +preferredFontForTextStyle:compatibleWithTraitCollection: with a valid UIFontTextStyle.</div><div class="line"> */</div><div class="line">@property (nonatomic) BOOL adjustsFontForContentSizeCategory;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p><strong>adjustsFontForContentSizeCategory</strong> å­—ä½“æ˜¯å¦éšç€æ‰‹æœºç³»ç»Ÿå­—ä½“çš„å˜åŒ–è€Œå˜åŒ–.</p>
<h5 id="refreshControl"><a href="#refreshControl" class="headerlink" title="refreshControl"></a>refreshControl</h5><p>iOS10ä»¥å‰:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NS_CLASS_AVAILABLE_IOS(6_0) __TVOS_PROHIBITED @interface UIRefreshControl : UIControl</div></pre></td></tr></table></figure></p>
<p> iOS10ä»¥å:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@property (nonatomic, strong, nullable) UIRefreshControl *refreshControl NS_AVAILABLE_IOS(10_0) __TVOS_PROHIBITED;</div></pre></td></tr></table></figure>
<p>iOS10 ä»¥ååªè¦æ˜¯é›†æˆä¸<code>UIScrollView</code>, å³å¯è·å¾—æ­¤å±æ€§.</p>
<h5 id="systemVersion"><a href="#systemVersion" class="headerlink" title="systemVersion"></a>systemVersion</h5><p>åˆ¤æ–­ç³»ç»Ÿç‰ˆæœ¬å·å»ºè®®ç”¨æ³•:<br><code>[[UIDevice currentDevice] systemVersion]</code></p>
<h5 id="UICollectionView"><a href="#UICollectionView" class="headerlink" title="UICollectionView"></a>UICollectionView</h5><p>iOS10 å¯¹UICollectionViewè¿›ä¸€æ­¥çš„ä¼˜åŒ–, è¯¦æƒ…å¯å‚è€ƒ<a href="http://www.jianshu.com/p/e97780a24224" target="_blank" rel="external">UICollectionViewæ–°ç‰¹æ€§
</a></p>
<h5 id="Notification"><a href="#Notification" class="headerlink" title="Notification"></a>Notification</h5><p>iOS10æ‰€æœ‰çš„é€šçŸ¥éƒ½å±äº<code>UserNotifications.framework</code><br>å¢åŠ äº†æ’¤å›å•æ¡é€šçŸ¥,æ›´æ–°å·²å±•ç¤ºé€šçŸ¥,ä¸­é€”ä¿®æ”¹é€šçŸ¥å†…å®¹,åœ¨é€šçŸ¥ä¸­å±•ç¤ºå›¾ç‰‡è§†é¢‘,è‡ªå®šä¹‰é€šçŸ¥ UI ç­‰ä¸€ç³»åˆ—æ–°åŠŸèƒ½,éå¸¸å¼ºå¤§.<br>è¯¦æƒ…å¯ä»¥å‚è€ƒ:<br><a href="https://onevcat.com/2016/08/notification/" target="_blank" rel="external">æ´»ä¹…è§çš„é‡æ„ - iOS 10 UserNotifications æ¡†æ¶è§£æ</a><br><a href="https://developer.apple.com/reference/usernotifications" target="_blank" rel="external">UserNotifications </a></p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/æ–°ç‰¹æ€§/">æ–°ç‰¹æ€§</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="[post]-ç¼–è¯‘ijkplayerDemo"  class="article article-type-[post]" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2016/08/27/ç¼–è¯‘ijkplayerDemo/">ç¼–è¯‘ijkplayerDemo</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2016/08/27/ç¼–è¯‘ijkplayerDemo/" class="article-date">
	  <time datetime="2016-08-26T16:00:00.000Z" itemprop="datePublished">2016-08-27</time>
	</a>

      
    <a class="article-category-link" href="/categories/iOS/">iOS</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<h3 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a><a href="https://github.com/Bilibili/ijkplayer">ä¸‹è½½</a></h3><p><img src="http://ww4.sinaimg.cn/large/65e4f1e6gw1f92f6xoeksj20ka0br76g.jpg" alt=""></p>
<h3 id="ç¼–è¯‘-ijkplayer"><a href="#ç¼–è¯‘-ijkplayer" class="headerlink" title="ç¼–è¯‘ ijkplayer"></a>ç¼–è¯‘ ijkplayer</h3><h4 id="ä¸‹è½½å›æ¥åä¼šå‘ç°-ffmpeg-lib-é‡Œé¢çš„-aæ–‡ä»¶ç¼ºå¤±-æ˜¾ç¤ºä¸ºçº¢è‰²"><a href="#ä¸‹è½½å›æ¥åä¼šå‘ç°-ffmpeg-lib-é‡Œé¢çš„-aæ–‡ä»¶ç¼ºå¤±-æ˜¾ç¤ºä¸ºçº¢è‰²" class="headerlink" title="ä¸‹è½½å›æ¥åä¼šå‘ç° ffmpeg - lib é‡Œé¢çš„.aæ–‡ä»¶ç¼ºå¤± æ˜¾ç¤ºä¸ºçº¢è‰²"></a>ä¸‹è½½å›æ¥åä¼šå‘ç° ffmpeg - lib é‡Œé¢çš„.aæ–‡ä»¶ç¼ºå¤± æ˜¾ç¤ºä¸ºçº¢è‰²</h4><p><img src="http://ww1.sinaimg.cn/large/65e4f1e6gw1f92fdqgeofj20cd097wf7.jpg" alt=""></p>
<h4 id="æ¥ç€ç¼–è¯‘-ffmpeg"><a href="#æ¥ç€ç¼–è¯‘-ffmpeg" class="headerlink" title="æ¥ç€ç¼–è¯‘ ffmpeg"></a>æ¥ç€ç¼–è¯‘ ffmpeg</h4><h5 id="æ‰“å¼€ç»ˆç«¯-cd-åˆ°ijkplayeræ–‡ä»¶å¤¹ä¸­-cd-ijkplayer-å¦‚ä¸‹å›¾"><a href="#æ‰“å¼€ç»ˆç«¯-cd-åˆ°ijkplayeræ–‡ä»¶å¤¹ä¸­-cd-ijkplayer-å¦‚ä¸‹å›¾" class="headerlink" title="æ‰“å¼€ç»ˆç«¯, cd åˆ°ijkplayeræ–‡ä»¶å¤¹ä¸­ cd ijkplayer å¦‚ä¸‹å›¾:"></a>æ‰“å¼€ç»ˆç«¯, cd åˆ°ijkplayeræ–‡ä»¶å¤¹ä¸­ cd ijkplayer å¦‚ä¸‹å›¾:</h5><p><img src="http://ww4.sinaimg.cn/large/65e4f1e6gw1f92fee7jkfj20h70g2goz.jpg" alt=""></p>
<h5 id="ä¸‹è½½ffmpeg"><a href="#ä¸‹è½½ffmpeg" class="headerlink" title="ä¸‹è½½ffmpeg"></a>ä¸‹è½½ffmpeg</h5><p> ./init-ios.sh</p>
<p><img src="http://ww3.sinaimg.cn/large/65e4f1e6gw1f92ferz68vj20jy0abjuz.jpg" alt=""></p>
<h5 id="cdåˆ°iOSç›®å½•"><a href="#cdåˆ°iOSç›®å½•" class="headerlink" title="cdåˆ°iOSç›®å½•"></a>cdåˆ°iOSç›®å½•</h5><p><img src="http://ww4.sinaimg.cn/large/65e4f1e6gw1f92fffs942j20j10chtbf.jpg" alt=""></p>
<h5 id="ç¼–è¯‘-ffmpeg"><a href="#ç¼–è¯‘-ffmpeg" class="headerlink" title="ç¼–è¯‘ ffmpeg"></a>ç¼–è¯‘ ffmpeg</h5><p>./compile-ffmpeg.sh clean<br>./compile-ffmpeg.sh all<br>ç­‰å¾…ç¼–è¯‘å®Œæˆå³å¯</p>
<h5 id="è¿è¡ŒIJKMediaDemo"><a href="#è¿è¡ŒIJKMediaDemo" class="headerlink" title="è¿è¡ŒIJKMediaDemo"></a>è¿è¡ŒIJKMediaDemo</h5><p><img src="http://ww4.sinaimg.cn/large/65e4f1e6gw1f92ffqzrm3j20jk0bbq43.jpg" alt=""></p>
<p><img src="http://ww1.sinaimg.cn/large/65e4f1e6gw1f92fg1ngm3j20jz0aut9f.jpg" alt=""></p>
<h3 id="åˆ¶ä½œframework"><a href="#åˆ¶ä½œframework" class="headerlink" title="åˆ¶ä½œframework"></a>åˆ¶ä½œframework</h3><h4 id="æ‰“å¼€IJKMediaPlayerç›®å½•-è¿è¡ŒIJKMediaPlayer-xcodeproj"><a href="#æ‰“å¼€IJKMediaPlayerç›®å½•-è¿è¡ŒIJKMediaPlayer-xcodeproj" class="headerlink" title="æ‰“å¼€IJKMediaPlayerç›®å½• è¿è¡ŒIJKMediaPlayer.xcodeproj"></a>æ‰“å¼€IJKMediaPlayerç›®å½• è¿è¡ŒIJKMediaPlayer.xcodeproj</h4><p><img src="http://ww4.sinaimg.cn/large/65e4f1e6gw1f92fgbldpsj20iw096q4d.jpg" alt=""></p>
<h4 id="é€‰æ‹©releaseæ¨¡å¼-ç¼–è¯‘çœŸæœºå’Œæ¨¡æ‹Ÿå™¨çš„IJKMediaPlayer-xcodeproj-æ‰“å¼€ç›¸åº”ç›®å½•"><a href="#é€‰æ‹©releaseæ¨¡å¼-ç¼–è¯‘çœŸæœºå’Œæ¨¡æ‹Ÿå™¨çš„IJKMediaPlayer-xcodeproj-æ‰“å¼€ç›¸åº”ç›®å½•" class="headerlink" title="é€‰æ‹©releaseæ¨¡å¼,ç¼–è¯‘çœŸæœºå’Œæ¨¡æ‹Ÿå™¨çš„IJKMediaPlayer.xcodeproj, æ‰“å¼€ç›¸åº”ç›®å½•"></a>é€‰æ‹©releaseæ¨¡å¼,ç¼–è¯‘çœŸæœºå’Œæ¨¡æ‹Ÿå™¨çš„IJKMediaPlayer.xcodeproj, æ‰“å¼€ç›¸åº”ç›®å½•</h4><p><img src="http://ww4.sinaimg.cn/large/65e4f1e6gw1f92fgl0q3kj20hv05r74z.jpg" alt=""></p>
<p>ä¼šå¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶å¤¹ ä¸€ä¸ªæ˜¯çœŸæœºçš„ Release-iphoneos ä¸€ä¸ªæ˜¯æ¨¡æ‹Ÿå™¨çš„Release-iphonesimulator<br><img src="http://ww4.sinaimg.cn/large/65e4f1e6gw1f92fgsw65tj20it04xq3a.jpg" alt=""></p>
<h4 id="å°†çœŸæœºframeworkå’Œæ¨¡æ‹Ÿå™¨çš„frameworkåˆå¹¶æˆä¸€ä¸ª"><a href="#å°†çœŸæœºframeworkå’Œæ¨¡æ‹Ÿå™¨çš„frameworkåˆå¹¶æˆä¸€ä¸ª" class="headerlink" title="å°†çœŸæœºframeworkå’Œæ¨¡æ‹Ÿå™¨çš„frameworkåˆå¹¶æˆä¸€ä¸ª"></a>å°†çœŸæœºframeworkå’Œæ¨¡æ‹Ÿå™¨çš„frameworkåˆå¹¶æˆä¸€ä¸ª</h4><p>æ‰“å¼€ç»ˆç«¯è¾“å…¥  lipo -create â€œçœŸæœºIJKMediaFrameworkè·¯å¾„â€ â€œæ¨¡æ‹Ÿå™¨IJKMediaFrameworkè·¯å¾„â€<br> -output â€œåˆå¹¶åçš„æ–‡ä»¶è·¯å¾„å’Œåç§°(LastPathComponentä¼šé»˜è®¤ä¸ºæ–‡ä»¶åå­—)â€   æ‰“å¼€ç›¸åº”è·¯åŠ² å¾—åˆ°åˆå¹¶åçš„framework<br><img src="http://ww2.sinaimg.cn/large/65e4f1e6gw1f92fh8bcmcj20ju09m0td.jpg" alt=""></p>
<p>å°†ç”Ÿæˆçš„åˆå¹¶åçš„framework æ›¿æ¢æ‰ Release-iphoneos å’ŒRelease-iphonesimulator é‡Œé¢çš„framework</p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/framework/">framework</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="[post]-è®°IMèŠå¤©ç•Œé¢å¡é¡¿åˆ†æ"  class="article article-type-[post]" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2016/08/06/è®°IMèŠå¤©ç•Œé¢å¡é¡¿åˆ†æ/">è®°IMèŠå¤©ç•Œé¢å¡é¡¿åˆ†æ</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2016/08/06/è®°IMèŠå¤©ç•Œé¢å¡é¡¿åˆ†æ/" class="article-date">
	  <time datetime="2016-08-06T12:26:31.000Z" itemprop="datePublished">2016-08-06</time>
	</a>

      
    <a class="article-category-link" href="/categories/iOS/">iOS</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<h3 id="å¼€å§‹æµ‹è¯•"><a href="#å¼€å§‹æµ‹è¯•" class="headerlink" title="å¼€å§‹æµ‹è¯•"></a>å¼€å§‹æµ‹è¯•</h3><p>å¿«é€Ÿæ»šåŠ¨è§†å›¾</p>
<p><img src="http://ww4.sinaimg.cn/large/006y8lVagw1f909vpp8x6j305z0argn9.jpg" alt=""></p>
<h3 id="å¼€å¯GPU-Driveræ£€æµ‹"><a href="#å¼€å¯GPU-Driveræ£€æµ‹" class="headerlink" title="å¼€å¯GPU Driveræ£€æµ‹"></a>å¼€å¯GPU Driveræ£€æµ‹</h3><p><img src="http://ww3.sinaimg.cn/large/006y8lVagw1f908hv7ia4j30kk0bkq4v.jpg" alt=""></p>
<p><img src="http://ww2.sinaimg.cn/large/006y8lVagw1f908if5qvwj30jn0hlq69.jpg" alt=""> </p>
<p>å›¾ä¸­å¯ä»¥çœ‹å‡ºå½“å‰çš„å¸§ç‡éå¸¸çš„ä½, ä¿æŒåœ¨ 40~50 FPS, æ˜æ˜¾å¯ä»¥æ„Ÿè§‰åˆ°å¡é¡¿.</p>
<h3 id="å¡é¡¿äº§ç”Ÿçš„åŸå› "><a href="#å¡é¡¿äº§ç”Ÿçš„åŸå› " class="headerlink" title="å¡é¡¿äº§ç”Ÿçš„åŸå› "></a>å¡é¡¿äº§ç”Ÿçš„åŸå› </h3><p><img src="http://ww2.sinaimg.cn/large/006y8lVagw1f908kgyq1ej30fp06o0tc.jpg" alt=""></p>
<p><strong>å›¾åƒæ˜¾ç¤ºåŸç†</strong>:<br>ç®€å•æ¥è¯´, CPUè®¡ç®—å¥½æ˜¾ç¤ºçš„å†…å®¹æäº¤åˆ°GPU, GPUæ¸²æŸ“å®Œæˆåå°†æ¸²æŸ“çš„ç»“æœæ”¾å…¥å¸§ç¼“å†²åŒº, è§†é¢‘æ§åˆ¶å™¨ä¼šé€è¡Œè¯»å–å¸§ç¼“å†²åŒºçš„æ•°æ®, è¿›è¿‡ä¸€äº›è½¬æ¢(æ•°æ¨¡è½¬æ¢)ä¼ é€’ç»™æ˜¾ç¤ºå™¨æ˜¾ç¤º.</p>
<blockquote>
<p>iOSè®¾å¤‡ç›®å‰ä½¿ç”¨çš„æ˜¯åŒç¼“å­˜+å‚ç›´åŒæ­¥, å®‰å“ç³»ç»Ÿæ˜¯ä¸‰ç¼“å­˜+å‚ç›´åŒæ­¥, æ„Ÿå…´è¶£çš„çœ‹å®˜, å¯è‡ªè¡Œæœç´¢.</p>
</blockquote>
<p><strong>ç»“è®º</strong>:<br><img src="http://ww1.sinaimg.cn/large/006y8lVagw1f908jsi16aj30is052t91.jpg" alt=""><br>ä»æµç¨‹å›¾å¯ä»¥çœ‹å‡º, CPUå’ŒGPUä¸è®ºå“ªä¸ªé˜»ç¢äº†å›¾åƒæ˜¾ç¤ºæµç¨‹, å‡ä¼šé€ æˆæ‰å¸§, äº§ç”Ÿå±å¹•å¡é¡¿çš„ç°è±¡.</p>
<blockquote>
<p>CPU: ä¸€èˆ¬å¤„ç†è§†å›¾çš„åˆ›å»ºã€å¸ƒå±€è®¡ç®—ã€å›¾ç‰‡è§£ç ã€æ–‡æœ¬çš„ç»˜åˆ¶ã€å›¾åƒç»˜åˆ¶ç­‰ç­‰.</p>
<p>GPU: å¯¹CPUæäº¤çš„å†…å®¹(çº¹ç†ã€é¡¶ç‚¹)è¿›è¡Œåº”ç”¨å˜æ¢ã€æ··åˆã€æ¸²æŸ“. ä¾‹å¦‚:çº¹ç†çš„æ¸²æŸ“ã€è§†å›¾çš„æ··åˆã€å›¾å½¢çš„ç”Ÿæˆ.</p>
</blockquote>
<p>ä¸‹é¢å¯¹GPUå’ŒCPUåˆ†åˆ«è¿›è¡Œæ£€æµ‹.</p>
<h3 id="æ£€æµ‹GPU"><a href="#æ£€æµ‹GPU" class="headerlink" title="æ£€æµ‹GPU"></a>æ£€æµ‹GPU</h3><ul>
<li><p>Renderer Utilization</p>
<blockquote>
<p>å¦‚æœRenderer Utilizationçš„ç™¾åˆ†æ¯”è¶…è¿‡äº†50%, æœ‰å¯èƒ½æ˜¯å› ä¸ºç¦»å±æ¸²æŸ“æˆ–è€…æ˜¯é‡ç»˜å¯¼è‡´</p>
</blockquote>
</li>
<li><p>Tiler Utilization    </p>
<blockquote>
<p>å¦‚æœTiler Utilizationçš„ç™¾åˆ†æ¯”è¶…è¿‡äº†50%, å¾ˆæœ‰å¯èƒ½æ˜¯å±å¹•ä¸Šæœ‰å¤ªå¤šçš„å›¾å±‚è¦†ç›–<br><img src="http://ww2.sinaimg.cn/large/006y8lVagw1f908if5qvwj30jn0hlq69.jpg" alt=""> </p>
</blockquote>
</li>
</ul>
<p>å¯ä»¥åˆ¤æ–­, GPUå¹¶ä¸æ˜¯å½±å“æ€§èƒ½çš„ç½ªé­æ¶é¦–</p>
<h3 id="æ£€æµ‹CPU"><a href="#æ£€æµ‹CPU" class="headerlink" title="æ£€æµ‹CPU"></a>æ£€æµ‹CPU</h3><p><img src="http://ww4.sinaimg.cn/large/006y8lVagw1f908of007vj30wl0f0wla.jpg" alt=""> </p>
<p>å‹¾ä¸ŠSeparate by Thread å’Œ Hide System Libraties : åˆ†ç¦»çº¿ç¨‹, æ–¹ä¾¿æŸ¥çœ‹å„æ¡çº¿ç¨‹å’Œéšè—ç³»ç»Ÿåº“.</p>
<p>æ˜æ˜¾çœ‹è§CPUå ç”¨ç‡ç‰¹åˆ«é«˜,é¦–å½“å…¶å†²çš„æ˜¯åˆ†åˆ«æ˜¯å <strong>- cellForRowAtIndexPath</strong>å’Œ<strong>- heightForRowAtIndexPath</strong>çš„ä¸¤å¥ä»£ç .  </p>
<p><strong>1.æ£€æµ‹cellForRowAtIndexPathä»£ç </strong><br><img src="http://ww2.sinaimg.cn/large/006y8lVagw1f908t1aj10j30gb08mwhp.jpg" alt=""></p>
<p>ç‚¹å¼€å°ç®­å¤´, å‘ç°é‡Œé¢<code>emotionStringWithWH:</code>æ¶ˆè€—äº†å¤§é‡CPUçš„æ€§èƒ½.<br><img src="http://ww2.sinaimg.cn/large/006y8lVagw1f908y25l56j30gz0b9425.jpg" alt=""><br>åŒå‡»è¿›å»æŸ¥çœ‹ä»£ç , å¯ä»¥çœ‹åˆ°æ¶ˆè€—æ€§èƒ½çš„ä»£ç æ˜¯åœ¨cellæ¨¡å‹èµ‹å€¼çš„æ–¹æ³•.<br><code>_msgLabel.attributedText =[session.fullText emotionStringWithWH:23];</code></p>
<p><strong>çŒœæƒ³:</strong>tableViewæ¯æ¬¡æ»šåŠ¨, cellçš„setæ–¹æ³•éƒ½ä¼šè°ƒç”¨<code>emotionStringWithWH:</code>,ä¸ºäº†é¿å…æ¯æ¬¡ç»™å¯Œæ–‡æœ¬èµ‹å€¼éƒ½è°ƒç”¨æ­¤æ–¹æ³•, æ–°å¢ä¸€ä¸ªå±æ€§<code>NSAttributedString *text</code>.</p>
<p>å½“å‰ä»£ç ä¿®æ”¹æˆ:<br><code>_msgLabel.attributedText = session.text;</code></p>
<p>å› æ­¤, æˆ‘ä»¬éœ€è¦ç»™textåœ¨åˆé€‚çš„åœ°æ–¹èµ‹å€¼, æœ¬demoåœ¨ç‚¹å‡»å‘é€æ–‡æœ¬çš„æ–¹æ³•ä¸­æ·»åŠ <br><code>session.text = [session.fullText emotionStringWithWH:23];</code></p>
<p><img src="http://ww3.sinaimg.cn/large/006y8lVagw1f908zuayblj30kh0hq7a3.jpg" alt=""></p>
<p>é‡æ–°è¿è¡Œé¡¹ç›®, å†æ¬¡æ£€æµ‹</p>
<p><img src="http://ww2.sinaimg.cn/large/006y8lVagw1f90914j1h3j30kb0c0403.jpg" alt=""><br><img src="http://ww2.sinaimg.cn/large/006y8lVagw1f909909vnsj30l70bn75j.jpg" alt=""><br>å¯ä»¥çœ‹å‡ºå¸§ç‡æå‡äº†ä¸€å°éƒ¨åˆ† ä¿æŒåœ¨45~55 FPS, å¿«é€Ÿæ»‘åŠ¨CPUçš„ä½¿ç”¨ç‡åœ¨40%å·¦å³.</p>
<p><strong>2.æ£€æµ‹heightForRowAtIndexPathä»£ç </strong><br><img src="http://ww2.sinaimg.cn/large/006y8lVagw1f9092evlcpj30nq0bptel.jpg" alt=""><br>ä»å›¾ä¸­çº¢è‰²ç®­å¤´æ‰€ç¤º, å¯ä»¥çœ‹å‡º, è®¡ç®—é«˜åº¦çš„æ–¹æ³•:<code>cellHeight</code>å ç”¨äº†æ¯”è¾ƒå¤šçš„å¼€é”€.<br>æŸ¥çœ‹å½“å‰çš„ä»£ç å‘ç°,æ¯æ¬¡æ»‘åŠ¨éƒ½ä¼šé‡å¤è®¡ç®—é«˜åº¦:<br><code>self.baseChatCellTool.session = self.dataSource[indexPath.row];</code><br><code>return
self.baseChatCellTool.cellHeight;</code></p>
<p>å› æ­¤, ç¬¬ä¸€æ„Ÿè§‰å°±æ˜¯åº”è¯¥å°†è®¡ç®—è¿‡çš„é«˜åº¦ç»™ç¼“å­˜èµ·æ¥,äºæ˜¯ä¹å°†ä»£ç ä¿®æ”¹ä¸º:</p>
<pre><code>LCSession *session = self.dataSource[indexPath.row];
if (!session.cellHeight) {
    self.baseChatCellTool.session = session;
    session.cellHeight = self.baseChatCellTool.cellHeight;

    dispatch_async(dispatch_get_global_queue(0, 0), ^{
        [LCCachesTool addSession:session];
    });
}
return session.cellHeight;
</code></pre><p>é‡æ–°è¿è¡Œé¡¹ç›®, å†æ¬¡æ£€æµ‹<br><img src="http://ww4.sinaimg.cn/large/006y8lVagw1f909dk785oj30lm0avgqs.jpg" alt=""><br>æˆ‘ä»¬å‘ç°<code>cellForRowAtIndexPath</code>ä¾æ—§å ç”¨äº†æ¯”è¾ƒå¤šçš„å¼€é”€,ç‚¹å‡»æŸ¥çœ‹, å¦‚ç»¿è‰²æ¡†æ‰€ç¤º, å‘ç°, é‡Œé¢å…¨éƒ¨éƒ½ä¸º%0çš„å¼€é”€<br><img src="http://ww2.sinaimg.cn/large/006y8lVagw1f909ejipnrj30ya0djn4c.jpg" alt=""><br> æˆ‘ä»¬å°†<code>Hide System Libraties</code>é€‰é¡¹å–æ¶ˆå‹¾é€‰, æ‰¾åˆ°ä¸ä¸Šå›¾ä¸­åŒæ ·çš„æ–¹æ³•<code>setSession</code>, å‘ç°æ˜¯UILabelè®¾ç½®å¯Œæ–‡æœ¬çš„æ—¶å€™, å ç”¨äº†å¤§é‡çš„å¼€é”€, è¿™ä¸ªè¯é¢˜, æˆ‘ä»¬æš‚ä¸”æ‰“ä½.<br>ç»§ç»­çœ‹å›ä¸Šå›¾, æˆ‘ä¹ˆå‘ç°è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•å ç”¨äº†æ¯”è¾ƒå¤§çš„å¼€é”€:<code>layoutSubviews</code>, å½“æˆ‘ä»¬æ»šåŠ¨è§†å›¾çš„æ—¶å€™, å°±ä¼šè°ƒç”¨<code>layoutSubviews</code>, æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹, åœ¨æ­¤æ–¹æ³•ä¸­, åšäº†ä»€ä¹ˆäº‹æƒ…:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[self.headerImageView mas_makeConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">	    make.right.equalTo(self.contentView).offset(-7);</div><div class="line">	    make.top.equalTo(self.contentView).offset(7);</div><div class="line">	    make.width.height.equalTo(@(46));</div><div class="line">	&#125;];</div><div class="line">	</div><div class="line">	[self.nicknameLabel mas_makeConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">	    make.top.equalTo(self.headerImageView).offset(-2);</div><div class="line">	    make.right.equalTo(self.headerImageView.mas_left).offset(-15);</div><div class="line">	&#125;];</div><div class="line">	</div><div class="line">	[self.msgLabel mas_remakeConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">	    if (self.session.messageType == messageTypeImage || self.session.messageType == messageTypeMap) &#123;</div><div class="line">	        make.right.equalTo(self.headerImageView.mas_left).offset(-4);</div><div class="line">	    &#125; else &#123;</div><div class="line">	        make.right.equalTo(self.headerImageView.mas_left).offset(-20);</div><div class="line">	    &#125;</div><div class="line">	</div><div class="line">	    make.top.equalTo(self.nicknameLabel.mas_bottom).offset(13);</div><div class="line">	&#125;];</div><div class="line">	</div><div class="line">	[self.backgroundMsgView mas_makeConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">	</div><div class="line">	    make.edges.equalTo(self.msgLabel).insets(UIEdgeInsetsMake(-8, -10, -10, -15));</div><div class="line">	</div><div class="line">	&#125;];</div><div class="line">	.....</div></pre></td></tr></table></figure>
<p>é‡Œé¢éƒ½æ˜¯äº›å¸ƒå±€çš„ä»£ç . æˆ‘ä»¬çŸ¥é“, è‡ªåŠ¨å¸ƒå±€çš„æ¶ˆè€—æ˜¯æ˜‚è´µçš„, ç‰¹åˆ«æ˜¯æ¯æ¬¡æ»šåŠ¨éƒ½éœ€è¦å¸ƒå±€. ç”±æ­¤äº§ç”Ÿç¬¬ä¸€ä¸ªä¼˜åŒ–æ–¹æ¡ˆ: ç°æœ‰çš„è‡ªåŠ¨å¸ƒå±€æ›¿æ¢ä¸ºåæ ‡ç³»(frame), æˆ‘ä»¬ä¹Ÿéƒ½çŸ¥é“, åˆ©ç”¨frameè®¡ç®—æ˜¯ä¸€ä»¶éå¸¸ç—›è‹¦çš„äº‹æƒ….</p>
<blockquote>
<p>å½“ç„¶, æœ€ç»ˆçš„æ–¹æ¡ˆ,åˆ©ç”¨coreTextæ’ç‰ˆ, è‚¯å®šæ˜¯åˆ©ç”¨frame, ä½†æ˜¯æ˜¯å·²ç»æå‰è®¡ç®—å¥½çš„frame.</p>
</blockquote>
<p>å½“å‰åŸºäºç³»ç»Ÿçš„UILabel, å’Œä¸ºäº†æ–¹ä¾¿ä¹¦å†™å¸ƒå±€ä»£ç , æˆ‘ä»¬ä»è¿™ä¸ªæ–¹å‘æ¥ä¼˜åŒ–, é¦–å…ˆè‡ªåŠ¨å¸ƒå±€æ˜¯éœ€è¦çš„, å…¶æ¬¡é¿å…è°ƒç”¨layoutSubViews(å› ä¸ºæ¯æ¬¡æ»šåŠ¨è§†å›¾éƒ½ä¼šè°ƒç”¨), åœ¨initæ–¹æ³•ä¸­, å¸ƒå±€ä¸€æ¬¡:   <code>[self layout];</code></p>
<p>é‡æ–°è¿è¡Œé¡¹ç›®, å†æ¬¡æ£€æµ‹:<br><img src="http://ww3.sinaimg.cn/large/006y8lVagw1f909gz55z0j30ko0cgdh2.jpg" alt=""><br><img src="http://ww3.sinaimg.cn/large/006y8lVagw1f909otf69fj30ql0iutdp.jpg" alt=""><br>CPUæœ€é«˜ä½¿ç”¨ç‡ä¸º34%,å¹³å‡åœ¨23%å·¦å³ å¸§ç‡æä¿æŒåœ¨50~55 FPS<br><img src="http://ww3.sinaimg.cn/large/006y8lVagw1f909hseqorj30s20d8q8b.jpg" alt=""><br>æˆ‘ä»¬å‘ç°<code>cellForRowAtIndexPath</code>ä¾æ—§å ç”¨äº†æ¯”è¾ƒå¤šçš„å¼€é”€,ç‚¹å‡»æŸ¥çœ‹, å‘ç°, é‡Œé¢å…¨éƒ¨éƒ½ä¸º%0çš„å¼€é”€, ç”±æ­¤å¯è§,è¿™äº›å¼€é”€åŸºæœ¬éƒ½å±äºç³»ç»Ÿçº§çš„å¼€é”€äº†. </p>
<blockquote>
<p>å¸¸è§çš„æ–‡æœ¬æ§ä»¶ ï¼ˆUILabelã€UITextView ç­‰ï¼‰ï¼Œå…¶æ’ç‰ˆå’Œç»˜åˆ¶éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹è¿›è¡Œçš„ï¼Œå½“æ˜¾ç¤ºå¤§é‡æ–‡æœ¬æ—¶ï¼ŒCPU çš„å‹åŠ›ä¼šéå¸¸å¤§ã€‚å¯¹æ­¤è§£å†³æ–¹æ¡ˆåªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯è‡ªå®šä¹‰æ–‡æœ¬æ§ä»¶</p>
</blockquote>
<p>é‚£ä¹ˆå‘ç°åŸºæœ¬ä¹Ÿå°±åªæœ‰ä¸€æ¡è·¯å¯ä»¥èµ°äº†, é‚£å°±æ˜¯åŸºäºcoreTextå¯¹æ–‡æœ¬è¿›è¡Œå¼‚æ­¥çš„ç»˜åˆ¶.åŸºäºcoreTextå¯¹æ–‡æœ¬è¿›è¡Œå¼‚æ­¥çš„ç»˜åˆ¶æˆ‘ä»¬åç»­å†è¯´.</p>
<blockquote>
<p>coreTextä¼˜ç‚¹: å ç”¨å†…å­˜å°‘,å¯ä»¥é¢„å…ˆæ’ç‰ˆå¯¹è±¡, ä¿ç•™å¯¹è±¡ä¾›ç»˜åˆ¶ä½¿ç”¨, å¯¹è±¡åˆ›å»ºå¥½åï¼Œèƒ½ç›´æ¥è·å–æ–‡æœ¬çš„å®½é«˜ç­‰ä¿¡æ¯ï¼Œé¿å…äº†å¤šæ¬¡è®¡ç®—.</p>
</blockquote>
<h3 id="ç»§ç»­æœç½—"><a href="#ç»§ç»­æœç½—" class="headerlink" title="ç»§ç»­æœç½—"></a>ç»§ç»­æœç½—</h3><p><strong>imageNamed:</strong><br><img src="http://ww3.sinaimg.cn/large/006y8lVagw1f909j34h07j30hv096q6f.jpg" alt=""><br><img src="http://ww3.sinaimg.cn/large/006y8lVagw1f909je5sutj30gj048wf5.jpg" alt=""><br>æˆ‘ä»¬å°†ä»£ç è¿˜åŸ,å‘ç°å¤šæ¬¡è°ƒç”¨[UIImage imageNamed:]å¯¹äºå†…å­˜çš„å¼€é”€ç›¸å¯¹è¾ƒå¤§, åœ¨åˆ›å»ºImageæˆ–è€…CGImageSourceå¯¹è±¡æ—¶,å›¾ç‰‡æ•°æ®å¹¶ä¸ä¼šç«‹å³è§£ç ,è€Œæ˜¯ç­‰åˆ°è®¾ç½®åˆ°ImageViewæˆ–è€…layer.contentsï¼Œlayerè¢«æäº¤åˆ°GPUä¹‹å‰,æ‰è§£ç ,å¹¶ä¸”è¿™äº›æ“ä½œéƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹è¿›è¡Œ,æ˜¯ç›¸å½“è€—æ€§èƒ½çš„.å› æ­¤åº”è¯¥å¼€å¯å­çº¿ç¨‹æŠŠå›¾ç‰‡ç»˜åˆ¶åˆ°CGBitmapContext,ç„¶åä»Bitmapç›´æ¥åˆ›å»ºå›¾ç‰‡, å¸¸è§çš„ç½‘ç»œå›¾ç‰‡åº“éƒ½è‡ªå¸¦è¿™äº›åŠŸèƒ½.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// ç®€ç•¥æ€è·¯</div><div class="line">dispatch\_async(backgroundQueue, ^&#123;</div><div class="line">	CGContextRef ctx = CGBitmapContextCreate(...);</div><div class="line">	CGImageRef img = CGBitmapContextCreateImage(ctx);</div><div class="line">	CFRelease(ctx);</div><div class="line">	dispatch_async(mainQueue, ^&#123;</div><div class="line">	    layer.contents = img;</div><div class="line">	&#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">ä¾‹å¦‚AFNä¸­å¯¹äºå›¾ç‰‡çš„å¤„ç†:</div><div class="line">	// éƒ¨åˆ†ä»£ç </div><div class="line">	CGContextRef context = CGBitmapContextCreate(NULL, width, height, bitsPerComponent, bytesPerRow, colorSpace, bitmapInfo);</div><div class="line">	</div><div class="line">	CGColorSpaceRelease(colorSpace);</div><div class="line">	</div><div class="line">	if (!context) &#123;</div><div class="line">	    CGImageRelease(imageRef);</div><div class="line">	</div><div class="line">	    return image;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	CGContextDrawImage(context, CGRectMake(0.0f, 0.0f, width, height), imageRef);</div><div class="line">	CGImageRef inflatedImageRef = CGBitmapContextCreateImage(context);</div><div class="line">	</div><div class="line">	CGContextRelease(context);</div><div class="line">	</div><div class="line">	UIImage *inflatedImage = [[UIImage alloc] initWithCGImage:inflatedImageRef scale:scale orientation:image.imageOrientation];</div><div class="line">	</div><div class="line">	CGImageRelease(inflatedImageRef);</div><div class="line">	CGImageRelease(imageRef);</div><div class="line">	</div><div class="line">	return inflatedImage;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">ä¾‹å¦‚SDä¸­å¯¹äºå›¾ç‰‡çš„å¤„ç†:</div><div class="line">	        // Workaround for iOS anamorphic image</div><div class="line">	        if (partialImageRef) &#123;</div><div class="line">	            const size_t partialHeight = CGImageGetHeight(partialImageRef);</div><div class="line">	            CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceRGB();</div><div class="line">	            CGContextRef bmContext = CGBitmapContextCreate(NULL, width, height, 8, width * 4, colorSpace, kCGBitmapByteOrderDefault | kCGImageAlphaPremultipliedFirst);</div><div class="line">	            CGColorSpaceRelease(colorSpace);</div><div class="line">	            if (bmContext) &#123;</div><div class="line">	                CGContextDrawImage(bmContext, (CGRect)&#123;.origin.x = 0.0f, .origin.y = 0.0f, .size.width = width, .size.height = partialHeight&#125;, partialImageRef);</div><div class="line">	                CGImageRelease(partialImageRef);</div><div class="line">	                partialImageRef = CGBitmapContextCreateImage(bmContext);</div><div class="line">	                CGContextRelease(bmContext);</div><div class="line">	            &#125;</div><div class="line">	            else &#123;</div><div class="line">	                CGImageRelease(partialImageRef);</div><div class="line">	                partialImageRef = nil;</div><div class="line">	            &#125;</div><div class="line">	        &#125;</div><div class="line">	</div><div class="line">	        if (partialImageRef) &#123;</div><div class="line">	            UIImage *image = [UIImage imageWithCGImage:partialImageRef scale:1 orientation:orientation];</div><div class="line">	            // å­˜å‚¨key</div><div class="line">	            NSString *key = [[SDWebImageManager sharedManager] cacheKeyForURL:self.request.URL];</div><div class="line">	            UIImage *scaledImage = [self scaledImageForKey:key image:image];</div><div class="line">	            if (self.shouldDecompressImages) &#123;</div><div class="line">	                image = [UIImage decodedImageWithImage:scaledImage];</div><div class="line">	            &#125;</div><div class="line">	            else &#123;</div><div class="line">	                image = scaledImage;</div><div class="line">	            &#125;</div><div class="line">	            CGImageRelease(partialImageRef);</div><div class="line">	            dispatch_main_sync_safe(^&#123; // å›åˆ°ä¸»çº¿ç¨‹</div><div class="line">	                if (self.completedBlock) &#123;</div><div class="line">	                    self.completedBlock(image, nil, nil, NO);</div><div class="line">	                &#125;</div><div class="line">	            &#125;);</div><div class="line">	        &#125;</div></pre></td></tr></table></figure>
<p><strong>æ¸²æŸ“æ—¶æœº</strong><br>Core Animation åœ¨ RunLoop ä¸­æ³¨å†Œäº†ä¸€ä¸ª Observer,ç›‘å¬äº† BeforeWaiting å’Œ Exit äº‹ä»¶.å½“ä¸€ä¸ªè§¦æ‘¸äº‹ä»¶åˆ°æ¥æ—¶,RunLoop è¢«å”¤é†’,App ä¸­çš„ä»£ç ä¼šæ‰§è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºå’Œè°ƒæ•´è§†å›¾å±‚çº§ã€è®¾ç½® UIView çš„ frameã€ä¿®æ”¹ CALayer çš„é€æ˜åº¦ã€ä¸ºè§†å›¾æ·»åŠ ä¸€ä¸ªåŠ¨ç”»;è¿™äº›æ“ä½œæœ€ç»ˆéƒ½ä¼šè¢« CALayer æ ‡è®°,å¹¶é€šè¿‡ CATransaction æäº¤åˆ°ä¸€ä¸ªä¸­é—´çŠ¶æ€å».å½“ä¸Šé¢æ‰€æœ‰æ“ä½œç»“æŸå,RunLoop å³å°†è¿›å…¥ä¼‘çœ ï¼ˆæˆ–è€…é€€å‡ºï¼‰æ—¶,å…³æ³¨è¯¥äº‹ä»¶çš„ Observer éƒ½ä¼šå¾—åˆ°é€šçŸ¥.  </p>
<p>è¿™ä¸ªå›è°ƒå‡½æ•°çš„è°ƒç”¨æ ˆå¤§æ¦‚æ˜¯è¿™æ ·:</p>
<p><img src="http://ww3.sinaimg.cn/large/006y8lVagw1f909jumtrmj30mi04oq5j.jpg" alt=""></p>
<p><strong>æ–‡æœ¬è®¡ç®—</strong><br><img src="http://ww1.sinaimg.cn/large/006y8lVagw1f909kghwezj30lz01xmxr.jpg" alt=""><br>UILabel å†…éƒ¨çš„å®ç°æ–¹å¼ï¼šç”¨ [NSAttributedString boundingRectWithSize:options:context:] æ¥è®¡ç®—æ–‡æœ¬å®½é«˜,ç”¨ -[NSAttributedString drawWithRect:options:context:] æ¥ç»˜åˆ¶æ–‡æœ¬.ä¼˜åŒ–ç‚¹:æ”¾åˆ°å­çº¿ç¨‹è¿›è¡Œä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹.</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä»ä¸Šé¢å¯çŸ¥,å‡ ä¸ªCPUèµ„æºæ¶ˆè€—çš„åŸå› :</p>
<ul>
<li>å¸ƒå±€è®¡ç®—<ul>
<li>è§†å›¾çš„å¸ƒå±€è®¡ç®—æ˜¯å¸¸è§æ¶ˆè€—CPUçš„èµ„æº. ä¸€èˆ¬åœ¨å­çº¿ç¨‹ä¸­æå‰è®¡ç®—å¥½è§†å›¾çš„å¸ƒå±€ã€å¯¹å¸ƒå±€è¿›è¡Œç¼“å­˜, åŸºæœ¬ä¸Šå°±æ²¡æœ‰å•¥é—®é¢˜äº†.</li>
</ul>
</li>
<li>Autolayout<ul>
<li>ç”±äºæ‰‹åŠ¨è®¡ç®—frameç­‰å±æ€§,æ¯”è¾ƒå¤æ‚ã€å¼€å‘æ•ˆç‡ç›¸å¯¹è¾ƒä½<br>,è‡ªåŠ¨å¸ƒå±€å¾ˆæå¤§çš„æå‡å¼€å‘æ•ˆç‡, å¤æ‚çš„è§†å›¾ä½¿ç”¨è‡ªåŠ¨å¸ƒå±€ä¼šäº§ç”Ÿä¸¥é‡çš„æ€§èƒ½é—®é¢˜,éšç€è§†å›¾çš„æ•°é‡å¢é•¿, CPUçš„æ¶ˆè€—ä¼šå‘ˆæŒ‡æ•°çº§çš„æå‡.å…¶æœ€ç»ˆéƒ½ä¼šè½åˆ°å¯¹è§†å›¾çš„frame/bounds/center ç­‰å±æ€§çš„è°ƒæ•´.</li>
</ul>
</li>
<li>æ–‡æœ¬æ¸²æŸ“<ul>
<li>å¸¸è§çš„ç³»ç»Ÿæ–‡æœ¬æ§ä»¶(UILabel, UITextViewâ€¦), å…¶æ’ç‰ˆå’Œç»˜åˆ¶éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ, å½“æœ‰å¤§é‡çš„æ–‡æœ¬/å¯Œæ–‡æœ¬/å›¾æ–‡æ··æ’ç­‰, å¯¹äºCPUçš„æ¶ˆè€—æ˜¯éå¸¸æ˜‚è´µçš„, åŒæ—¶ä¼´æœ‰ä¸¥é‡çš„ç•Œé¢å¡é¡¿ç°è±¡.å½“ä¸‹çš„è§£å†³æ–¹æ¡ˆæ˜¯åŸºäºCoreTextå¯¹æ–‡æœ¬è¿›è¡Œå¼‚æ­¥çš„ç»˜åˆ¶.</li>
</ul>
</li>
<li>å›¾åƒè§£ç <ul>
<li>å›¾ç‰‡è®¾ç½®åˆ°UIImageView/layer.contentsï¼Œlayerè¢«æäº¤åˆ°GPUä¹‹å‰,æ‰è§£ç ,å¹¶ä¸”è¿™äº›æ“ä½œéƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹è¿›è¡Œ,æ˜¯ç›¸å½“è€—æ€§èƒ½çš„.å› æ­¤åº”è¯¥å¼€å¯å­çº¿ç¨‹æŠŠå›¾ç‰‡ç»˜åˆ¶åˆ°CGBitmapContext,ç„¶åä»Bitmapç›´æ¥åˆ›å»ºå›¾ç‰‡.</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/æ€§èƒ½ä¼˜åŒ–/">æ€§èƒ½ä¼˜åŒ–</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="[post]-netty-socketç¼–è§£ç "  class="article article-type-[post]" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2016/06/12/netty-socketç¼–è§£ç /">åŸºäºnetty LengthFieldBasedFrameDecoderç¼–è§£ç </a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2016/06/12/netty-socketç¼–è§£ç /" class="article-date">
	  <time datetime="2016-06-11T16:00:00.000Z" itemprop="datePublished">2016-06-12</time>
	</a>

      
    <a class="article-category-link" href="/categories/iOS/">iOS</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">æœåŠ¡å™¨ä¼ è¾“åè®®åè®®:  </div><div class="line">åŸºäºnetty LengthFieldBasedFrameDecoder(100000000,0,4,0,4) </div><div class="line">æ€»é•¿åº¦ = 4byte + åŒ…ä½“å†…å®¹</div><div class="line">æ¥æ”¶äºŒè¿›åˆ¶çš„jsonå­—ç¬¦ä¸²</div></pre></td></tr></table></figure>
<h3 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h3><h5 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯:"></a>æ€è·¯:</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1.åœ¨å‘é€æ•°æ®åŒ…å‰, æ‹¼æ¥4ä¸ªå­—èŠ‚å¸¦æœ‰åŒ…ä½“å†…å®¹é•¿åº¦çš„æ•°æ®.</div><div class="line">2.åœ¨æ¥å—æ•°æ—¶, éœ€è¦è€ƒè™‘ ç²˜åŒ…å’ŒåŠåŒ…çš„æƒ…å†µ.æ ¹æ®åŒ…å¤´é•¿åº¦,åˆ¤æ–­åŒ…</div><div class="line">  çš„å®Œæ•´æ€§.å°†å®Œæ•´çš„åŒ…è§£æå‡ºå»,ä¸å®Œæ•´çš„ç­‰å¾…ä¸‹ä¸€æ¬¡çš„æ•°æ®æ‹¼æ¥.</div></pre></td></tr></table></figure>
<h4 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1.é‡‡ç”¨é¢å‘åè®®çš„æ–¹å¼ç¼–ç ä¸è§£ç </div><div class="line">2.è‡ªå®šä¹‰ç¼–ç å™¨å’Œè§£ç å™¨, éµå®ˆåè®®, å®ç°åè®®ä¸­çš„æ–¹æ³•</div><div class="line">3.åŸºäºGCDAsyncSocket, å°è£…éœ€è¦ç”¨åˆ°çš„æ–¹æ³•</div></pre></td></tr></table></figure>
<h5 id="æ–‡ä»¶ç»“æ„"><a href="#æ–‡ä»¶ç»“æ„" class="headerlink" title="æ–‡ä»¶ç»“æ„"></a>æ–‡ä»¶ç»“æ„</h5><p><img src="http://ww2.sinaimg.cn/large/65e4f1e6gw1f92ii7orifj20a207kt9g.jpg" alt=""></p>
<h3 id="åˆ†å—è®²è§£"><a href="#åˆ†å—è®²è§£" class="headerlink" title="åˆ†å—è®²è§£"></a>åˆ†å—è®²è§£</h3><h5 id="åè®®-LCSocketCoderProtocol"><a href="#åè®®-LCSocketCoderProtocol" class="headerlink" title="åè®® - LCSocketCoderProtocol"></a>åè®® - LCSocketCoderProtocol</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">1.ç¼–ç åè®®:LCSocketEncoderProtocol</div><div class="line">2.è§£ç åè®®:LCSocketDecoderProtocol</div><div class="line">3.ç¼–ç å®Œæˆåçš„è¾“å‡ºåè®®:LCSocketEncoderOutputProtocol</div><div class="line">4.è§£ç å®Œæˆåçš„è¾“å‡ºåè®®:LCSocketDecoderOutputProtocol</div></pre></td></tr></table></figure>
<h5 id="ç¼–ç å™¨-LCSocketEncoder"><a href="#ç¼–ç å™¨-LCSocketEncoder" class="headerlink" title="ç¼–ç å™¨ - LCSocketEncoder"></a>ç¼–ç å™¨ - LCSocketEncoder</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">1. éµå®ˆç¼–ç åè®®</div><div class="line">2.å®ç°åè®®ä¸­çš„æ–¹æ³•:</div><div class="line">- (void)encode:(id)object output (id&lt;LCSocketEncoderOutputProtocol&gt;)output</div><div class="line">å…¶ä¸­, è¾“å‡ºoutputéµå®ˆ ç¼–ç è¾“å‡ºåè®®</div></pre></td></tr></table></figure>
<h5 id="ç¼–ç å™¨-LCSocketDecoder"><a href="#ç¼–ç å™¨-LCSocketDecoder" class="headerlink" title="ç¼–ç å™¨ - LCSocketDecoder"></a>ç¼–ç å™¨ - LCSocketDecoder</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">1. éµå®ˆè§£ç åè®®</div><div class="line">2.å®ç°åè®®ä¸­çš„æ–¹æ³•:</div><div class="line">- (void)decode:(id)object output:(id&lt;LCSocketDecoderOutputProtocol&gt;)output</div><div class="line">å…¶ä¸­, è¾“å‡ºoutputéµå®ˆ è§£ç è¾“å‡ºåè®®</div></pre></td></tr></table></figure>
<h5 id="å¥—æ¥å­—-LCBaseSocket"><a href="#å¥—æ¥å­—-LCBaseSocket" class="headerlink" title="å¥—æ¥å­— - LCBaseSocket"></a>å¥—æ¥å­— - LCBaseSocket</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1. åŸºäºGCDAsyncSocket</div><div class="line">2.å•ä¾‹åŒ–, æä¾›éœ€è¦ç»™å¤–ç•Œè®¿é—®çš„æ¥å£,å¦‚:&quot;é‡è¿&quot;, &quot;æ–­å¼€è¿æ¥&quot;. &quot;æ˜¯å¦æ­£åœ¨è¿æ¥&quot;ç­‰</div><div class="line">3.è®¾ç½®ä»£ç†å±æ€§</div></pre></td></tr></table></figure>
<h3 id="ç¼–ç å™¨ä»£ç è¯¦è§£-LCSocketEncoder"><a href="#ç¼–ç å™¨ä»£ç è¯¦è§£-LCSocketEncoder" class="headerlink" title="ç¼–ç å™¨ä»£ç è¯¦è§£ - LCSocketEncoder"></a>ç¼–ç å™¨ä»£ç è¯¦è§£ - LCSocketEncoder</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">1.åˆ¤æ–­æ•°æ®æ ¼å¼æ˜¯å¦å¯è§£æä¸ºjson</div><div class="line"> if (![NSJSONSerialization isValidJSONObject:object]) &#123;</div><div class="line">        [output didEndEncode:nil error:[NSError errorWithDomain:@&quot;æ•°æ®ä¸èƒ½è§£æä¸ºjson&quot; code:-1 userInfo:nil]];</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">2.å°†jsonæ•°æ®ç¼–ç ä¸ºNSData</div><div class="line"> NSError *error = nil;</div><div class="line"> NSData *contentData = [NSJSONSerialization dataWithJSONObject:object options:NSJSONWritingPrettyPrinted error:&amp;error];</div><div class="line"> NSString *contentStr = [[NSString alloc] initWithData:contentData encoding:NSUTF8StringEncoding];</div><div class="line"> contentData = [contentStr dataUsingEncoding:NSUTF8StringEncoding];</div><div class="line"></div><div class="line">3.åˆ¤æ–­ç¼–ç åçš„æ•°æ®é•¿åº¦</div><div class="line"> if (contentData.length &gt; 1000000 - countOfLengthByte) &#123;</div><div class="line">        [output didEndEncode:nil error:[NSError errorWithDomain:@&quot;encoderçš„æ•°æ®å¤ªé•¿&quot; code:-1 userInfo:nil]];</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">4.å°†æ•°æ®é•¿åº¦, æ‹¼æ¥åˆ°åŒ…å¤´</div><div class="line"> NSUInteger contentDataLength = contentData.length;</div><div class="line"> NSData *headData = [self dataForLength:contentDataLength byteCount:countOfLengthByte reverse:NO];</div><div class="line">    </div><div class="line"> NSMutableData *data = [NSMutableData data];</div><div class="line"> [data appendData:headData];</div><div class="line"> [data appendData:contentData];</div><div class="line"></div><div class="line">5.åˆ†å‘æ•°æ®</div><div class="line"> [output didEndEncode:data error:nil];</div></pre></td></tr></table></figure>
<h3 id="è§£ç å™¨ä»£ç è¯¦è§£-LCSocketDecoder"><a href="#è§£ç å™¨ä»£ç è¯¦è§£-LCSocketDecoder" class="headerlink" title="è§£ç å™¨ä»£ç è¯¦è§£ - LCSocketDecoder"></a>è§£ç å™¨ä»£ç è¯¦è§£ - LCSocketDecoder</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">1.åˆ¤æ–­æ•°æ®æ˜¯å¦ä¸ºNSDataç±»å‹</div><div class="line">if (![object isKindOfClass:[NSData class]]) &#123;</div><div class="line">        [output didEndDecode:nil error:[NSError errorWithDomain:@&quot;å½“å‰æ•°æ®ç±»å‹éNSData&quot; code:-1 userInfo:nil]];</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">2.åˆå§‹åŒ–, å¹¶æˆªå–åŒ…å¤´æ•°æ®</div><div class="line"> self.needAppend = NO;</div><div class="line"> NSData *packetData = object;</div><div class="line"> [self.tempData appendData:packetData];</div><div class="line"> packetData = [self.tempData copy];</div><div class="line">    </div><div class="line"> NSData *headerData = [packetData subdataWithRange:NSMakeRange(0, countOfLengthByte)];</div><div class="line"> NSUInteger contentLength = [self lengthForData:headerData reverse:YES];</div><div class="line"></div><div class="line">3.åˆ¤æ–­æ˜¯å¦ç²˜åŒ…</div><div class="line">while (packetData.length &gt;= contentLength) &#123; &#125;</div><div class="line">  3.1 åˆ¤æ–­åŒ…çš„é•¿åº¦</div><div class="line">  if (contentLength &gt; 1000000 - countOfLengthByte) &#123; // æœåŠ¡å™¨å®šçš„...</div><div class="line">            [output didEndDecode:nil error:[NSError errorWithDomain:@&quot;æ•°æ®å¤ªé•¿&quot; code:-1 userInfo:nil]];</div><div class="line">            return;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">  </div><div class="line">  3.2æˆªå–åŒ…ä½“å†…å®¹</div><div class="line">  NSData *contentData = [packetData subdataWithRange:NSMakeRange(countOfLengthByte, contentLength)];</div><div class="line"></div><div class="line">  3.3 è¾“å‡ºä¸€ä¸ªå®Œæ•´çš„åŒ…, æˆªå–å‰©ä½™çš„åŒ…</div><div class="line">   [output didEndDecode:contentData error:nil];</div><div class="line">  packetData = [packetData subdataWithRange:NSMakeRange(contentLength + countOfLengthByte , packetData.length - contentLength - countOfLengthByte)];</div><div class="line"></div><div class="line">  3.4 åˆ¤æ–­åŒ…å¤´é•¿åº¦, å¦‚æœå°äºè§„å®šçš„, åˆ™è·³å‡ºå¾ªç¯, ç­‰å¾…æ‹¼æ¥</div><div class="line">    if (packetData.length &lt; countOfLengthByte) &#123;</div><div class="line">            if (self.tempData.length != 0) &#123;</div><div class="line">                [self.tempData resetBytesInRange:NSMakeRange(0, self.tempData.length)];</div><div class="line">                [self.tempData setLength:0];</div><div class="line">                self.needAppend = YES;</div><div class="line">            &#125;</div><div class="line">            break;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">  3.5 æˆªå–åŒ…å¤´çš„æ•°æ®,è®¡ç®—é•¿åº¦</div><div class="line">   headerData = [packetData subdataWithRange:NSMakeRange(0, countOfLengthByte)];</div><div class="line">  contentLength = [self lengthForData:headerData reverse:YES];</div><div class="line"></div><div class="line">  3.6.åªè¦æ‰§è¡Œäº†while, å°†tempDataçš„æ•°æ®æ¸…ç©º, æ‹¼æ¥æ–°çš„æ•°æ®</div><div class="line">  if (self.tempData.length != 0) &#123;</div><div class="line">            [self.tempData resetBytesInRange:NSMakeRange(0, self.tempData.length)];</div><div class="line">            [self.tempData setLength:0];</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        self.needAppend = YES;</div></pre></td></tr></table></figure>
<h2 id="ä¸€äº›å°ç»†èŠ‚"><a href="#ä¸€äº›å°ç»†èŠ‚" class="headerlink" title="ä¸€äº›å°ç»†èŠ‚"></a>ä¸€äº›å°ç»†èŠ‚</h2><h3 id="è®¡ç®—æ ¹æ®NSDataåŒ…å¤´çš„é•¿åº¦-lengthForData"><a href="#è®¡ç®—æ ¹æ®NSDataåŒ…å¤´çš„é•¿åº¦-lengthForData" class="headerlink" title="è®¡ç®—æ ¹æ®NSDataåŒ…å¤´çš„é•¿åº¦- lengthForData"></a>è®¡ç®—æ ¹æ®NSDataåŒ…å¤´çš„é•¿åº¦- lengthForData</h3><h5 id="æ‰«ç›²"><a href="#æ‰«ç›²" class="headerlink" title="æ‰«ç›²"></a>æ‰«ç›²</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">NSData ä¸­çš„lengthä¸ºNSUIntegerç±»å‹</div><div class="line">æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ NSUIntegerä¸ºä½•ç‰©</div><div class="line"></div><div class="line">#if __LP64__ || (TARGET_OS_EMBEDDED &amp;&amp; !TARGET_OS_IPHONE) || TARGET_OS_WIN32 || NS_BUILD_32_LIKE_64</div><div class="line">typedef long NSInteger;</div><div class="line">typedef unsigned long NSUInteger;</div><div class="line">#else</div><div class="line">typedef int NSInteger;</div><div class="line">typedef unsigned int NSUInteger;</div><div class="line">#endif</div><div class="line"></div><div class="line">ç›®å‰ä¸€èˆ¬éƒ½ä¸º64ä½æ“ä½œç³»ç»Ÿ, æ‰€ä»¥ NSUInteger å°±æ˜¯ unsigned long å äº†8bits</div><div class="line">1å­—èŠ‚(byte) = 8bits,ä¸¤è€…æ¢ç®—æ˜¯1ï¼š8çš„å…³ç³»ã€‚</div><div class="line">ç•¥å¸¦:ä¸€ä¸ªæ±‰å­—å äº†ä¸¤ä¸ªå­—èŠ‚</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">- (NSUInteger)lengthForData:(NSData *)data</div><div class="line">&#123;</div><div class="line">    NSUInteger dataLen = data.length;</div><div class="line">    NSUInteger length = 0;</div><div class="line">    </div><div class="line">    int offset = 0;</div><div class="line">    while (offset &lt; dataLen) &#123;</div><div class="line">        NSUInteger tempVal = 0;</div><div class="line">        [data getBytes:&amp;tempVal range:NSMakeRange(offset, 1)];</div><div class="line">        length += (tempVal &lt;&lt; (8 * offset));</div><div class="line">        offset++;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    return length;</div><div class="line">&#125;</div><div class="line"></div><div class="line">1.å°†æ•°æ®çš„é«˜ä½ä½, æ›´æ”¹ä¸ºä½ä½åœ¨å‰,é«˜ä½åœ¨å,å¦‚:</div><div class="line">&lt;00000045&gt; --&gt; &lt;45000000&gt;æ•°æ®ä»¥16è¿›åˆ¶çš„å½¢å¼å±•ç¤º,</div><div class="line">éªŒè¯:åˆ©ç”¨è®¡ç®—å™¨è½¬æ¢ä¸ºåè¿›åˆ¶ ç­‰äº 69.åé™„å›¾.</div><div class="line"></div><div class="line">2.åˆ©ç”¨NSData ä¸­çš„:</div><div class="line">  - (void)getBytes:(void *)buffer range:(NSRange)range</div><div class="line">æ–¹æ³•è·å–æ¯ä¸€ä¸ªå­—èŠ‚</div><div class="line"></div><div class="line">3.(æ³¨æ„å½“å‰ä¸º:ä½ä½åœ¨å‰,é«˜ä½åœ¨å)</div><div class="line">å°†æ¯ä¸€ä¸ªå­—èŠ‚, æ ¹æ®å­—èŠ‚æ‰€å±çš„èŒƒå›´,ç»Ÿä¸€å¾€å·¦ä½ç§»ç›¸åº”çš„ 8 (1å­—èŠ‚(byte) = 8bits)çš„å€æ•°, </div><div class="line">ä¹Ÿå°±æ˜¯è¯´,å°†åé¢é«˜ä½çš„å­—èŠ‚,ç»Ÿä¸€å¤„ç†ä¸ºä½ä½çš„å­—èŠ‚, å°†ç»Ÿä¸€æ ¼å¼çš„å­—èŠ‚, ç›¸åŠ .</div><div class="line">åˆ©ç”¨%zd è¾“å‡ºæ¯ä¸€ä¸ªå­—èŠ‚çš„ åè¿›åˆ¶çš„å¤§å°.è¿›è¡Œæ£€éªŒ.</div></pre></td></tr></table></figure>
<p><img src="http://ww4.sinaimg.cn/large/65e4f1e6gw1f92iig5bwaj209s0bk0tr.jpg" alt=""></p>
<p><img src="http://ww3.sinaimg.cn/large/65e4f1e6gw1f92iiun4e9j209u0bmmy3.jpg" alt=""></p>
<p><img src="http://ww4.sinaimg.cn/large/65e4f1e6gw1f92ij2cezsj20ft0ckac9.jpg" alt=""></p>
<h3 id="é«˜ä½ä½äº’æ¢-dataWithReverse"><a href="#é«˜ä½ä½äº’æ¢-dataWithReverse" class="headerlink" title="é«˜ä½ä½äº’æ¢-dataWithReverse"></a>é«˜ä½ä½äº’æ¢-dataWithReverse</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">- (NSData *)dataWithReverse:(NSData *)data</div><div class="line">&#123;</div><div class="line">    NSMutableData *dstData = [[NSMutableData alloc] initWithData:data];</div><div class="line">    NSUInteger count = data.length / 2;</div><div class="line">    </div><div class="line">    for (NSUInteger i = 0; i &lt; count; i++) &#123;</div><div class="line">        </div><div class="line">        NSRange head = NSMakeRange(i, 1);</div><div class="line">        NSRange end = NSMakeRange(data.length - i - 1, 1);</div><div class="line">        </div><div class="line">        NSData *headData = [data subdataWithRange:head];</div><div class="line">        NSData *endData = [data subdataWithRange:end];</div><div class="line">        </div><div class="line">        [dstData replaceBytesInRange:head withBytes:endData.bytes];</div><div class="line">        [dstData replaceBytesInRange:end withBytes:headData.bytes];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    return dstData;</div><div class="line">&#125;</div><div class="line"></div><div class="line">1.ä¾‹ç”¨NSMutableData å­—èŠ‚äº’æ¢ çš„æ–¹æ³•</div><div class="line">- (void)replaceBytesInRange:(NSRange)range withBytes:(const void *)bytes;</div><div class="line"></div><div class="line">2.éå†æ•°æ®</div><div class="line">ä»æ”¶å°¾å¼€å§‹,ä¾æ¬¡å°†å­—èŠ‚äº’æ¢, ä¸€èˆ¬åŒ…å¤´æ‰€å å­—èŠ‚éƒ½ä¸ä¼šå¤ªå¤š, æ‰€ä»¥åªéœ€éå†å‡ æ¬¡å°±å¯ä»¥å®Œæˆ,éå†çš„æ¬¡æ•°ä¸ºå­—èŠ‚æ€»æ•°å‡åŠ</div></pre></td></tr></table></figure>
<h3 id="å°†é•¿åº¦è½¬ä¸ºå å›ºå®šå­—èŠ‚æ•°çš„NSData-dataForLength"><a href="#å°†é•¿åº¦è½¬ä¸ºå å›ºå®šå­—èŠ‚æ•°çš„NSData-dataForLength" class="headerlink" title="å°†é•¿åº¦è½¬ä¸ºå å›ºå®šå­—èŠ‚æ•°çš„NSData - dataForLength"></a>å°†é•¿åº¦è½¬ä¸ºå å›ºå®šå­—èŠ‚æ•°çš„NSData - dataForLength</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">  NSMutableData *valData = [NSMutableData data];</div><div class="line">    NSUInteger templen = length;</div><div class="line">    </div><div class="line">    int offset = 0;</div><div class="line">    while (offset &lt; byteCount) &#123;</div><div class="line">        unsigned char valChar = 0xff &amp; templen;</div><div class="line">        [valData appendBytes:&amp;valChar length:1];</div><div class="line"></div><div class="line">        templen = templen &gt;&gt; 8;</div><div class="line">        offset++;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return valData;</div><div class="line"></div><div class="line">1.åˆ©ç”¨:NSMutableData çš„æ–¹æ³•</div><div class="line">- (void)appendBytes:(const void *)bytes length:(NSUInteger)length;</div><div class="line"></div><div class="line">2.å°†æ•°æ®   &amp; 0xff </div><div class="line">0xffæ˜¯åå…­è¿›åˆ¶FFçš„è¡¨ç¤ºæ–¹æ³•ï¼Œå› ä¸ºä¸€ä¸ªåå…­è¿›åˆ¶æ•°å­—è½¬æ¢æˆäºŒè¿›åˆ¶æ˜¯å››ä½ï¼Œå³F=1111ï¼Œæ‰€ä»¥0xffå ç”¨ä¸€ä¸ªå­—èŠ‚, 8bits</div><div class="line">&amp;ç¬¦è¡¨ç¤ºçš„æ˜¯æŒ‰ä½æ•°è¿›è¡Œä¸ï¼ˆåŒä¸º1çš„æ—¶å€™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ï¼‰</div><div class="line">ä¿ç•™å7ä½ï¼Œé«˜ä½æ¸…é›¶,é¿å…ç¬¦å·ä½æ‰©å±•ï¼š</div><div class="line"></div><div class="line">3.whileå¾ªç¯çš„è¯´æ˜:</div><div class="line">é¦–å…ˆ, 0xff &amp; templen, åªä¿ç•™æœ€ä½çš„å­—èŠ‚, è·å–åˆ°æœ€ä½ä½çš„å­—èŠ‚, åˆ©ç”¨appendBytes, å°†æ­¤å­—èŠ‚æ·»åŠ è¿›å», </div><div class="line">è¿›è€Œå°†templenå¾€å³ç§»8ä½, ä¹Ÿå°±æ˜¯å‰”é™¤åˆšæ‰è®¡ç®—è¿‡çš„å­—èŠ‚, è·å–ç¬¬äºŒä¸ªå­—èŠ‚</div><div class="line">,å°†ç¬¬äºŒä¸ªå­—èŠ‚æ·»åŠ è¿›å».ä¾æ¬¡å¾€åç›´åˆ°å°†æ‰€æœ‰çš„åŒ…å¤´å­—èŠ‚æ·»åŠ å®Œæ¯•</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/socket/">socket</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="[post]-å°è£…å½•éŸ³ä¸æ’­æ”¾"  class="article article-type-[post]" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2016/03/31/å°è£…å½•éŸ³ä¸æ’­æ”¾/">å½•éŸ³ä¸æœ¬åœ°æ’­æ”¾</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2016/03/31/å°è£…å½•éŸ³ä¸æ’­æ”¾/" class="article-date">
	  <time datetime="2016-03-30T16:00:00.000Z" itemprop="datePublished">2016-03-31</time>
	</a>

      
    <a class="article-category-link" href="/categories/iOS/">iOS</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<h3 id="ç®€è¨€"><a href="#ç®€è¨€" class="headerlink" title="ç®€è¨€"></a>ç®€è¨€</h3><p>è¿‘æœŸç”±äºè¦å®ç°ä¸€ä¸ªæœ¬åœ°å½•éŸ³ä¸æ’­æ”¾çš„å°åŠŸèƒ½, æƒ³ç€æŠŠå½•éŸ³ä¸æ’­æ”¾é›†æˆåœ¨ä¸€ä¸ªç±»ä¸­, æä¾›ç»Ÿä¸€çš„æ¥å£, æ–¹ä¾¿å…¶ä»–åŒäº‹è°ƒç”¨.</p>
<p>AVAudioRecorder ä¸ AVAudioPlayeréƒ½å±äºéŸ³é¢‘ä¸“ç”¨ç±»(Audio-only classes),è¿™äº›ç±»æ˜¯è¯¥æ¡†æ¶ä¸­æœ€å¤è€, ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„å‡ ä¸ªç±».<br><img src="http://ww1.sinaimg.cn/large/65e4f1e6gw1f937o0amtdj20gp09ct8y.jpg" alt=""></p>
<h3 id="AVAudioSession"><a href="#AVAudioSession" class="headerlink" title="AVAudioSession"></a>AVAudioSession</h3><p>AVAudioSessionæ˜¯åº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿä¹‹é—´æ‰®æ¼”ä¸­é—´äººçš„è§’è‰².è§„å®šäº†åº”ç”¨ç¨‹åº(app)ä¸ç³»ç»ŸéŸ³é¢‘è¡Œä¸ºäº¤äº’çš„è§„èŒƒ, ä¸€ä¸ªåº”ç”¨ç¨‹åºåªæœ‰ä¸€ä¸ªAVAudioSessionçš„å®ä¾‹.åº”ç”¨ç¨‹åºé€šè¿‡è®¾ç½®AVAudioSessionçš„å±æ€§å‘Šè¯‰ç³»ç»Ÿæƒ³åˆ°è¾¾çš„æ•ˆæœ, ç³»ç»Ÿä¼šç»¼åˆå…¶ä»–åº”ç”¨ç¨‹åºçš„AVAudioSessionå±æ€§æ¥å†³å®šç¡¬ä»¶è¾“å…¥/è¾“å‡º. </p>
<h4 id="AVAudioSessionçš„åˆ†ç±»"><a href="#AVAudioSessionçš„åˆ†ç±»" class="headerlink" title="AVAudioSessionçš„åˆ†ç±»"></a>AVAudioSessionçš„åˆ†ç±»</h4><table>
<thead>
<tr>
<th>åˆ†ç±»</th>
<th>ä½œç”¨</th>
<th>æ˜¯å¦å…è®¸æ··éŸ³</th>
<th>éŸ³é¢‘è¾“å…¥</th>
<th>éŸ³é¢‘è¾“å‡º</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ambient</td>
<td>æ¸¸æˆã€æ•ˆç‡åº”ç”¨ç¨‹åº</td>
<td>â˜‘ï¸</td>
<td>æ— </td>
<td>â˜‘ï¸</td>
</tr>
<tr>
<td>SoloAmbient(é»˜è®¤)</td>
<td>æ¸¸æˆã€æ•ˆç‡åº”ç”¨ç¨‹åº</td>
<td>æ— </td>
<td>æ— </td>
<td>â˜‘ï¸</td>
</tr>
<tr>
<td>Playback</td>
<td>éŸ³é¢‘å’Œè§†é¢‘æ’­æ”¾å™¨</td>
<td>å¯é€‰</td>
<td>æ— </td>
<td>â˜‘ï¸</td>
</tr>
<tr>
<td>Record</td>
<td>å½•éŸ³æœºã€éŸ³é¢‘æ•æ‰</td>
<td>æ— </td>
<td>â˜‘ï¸</td>
<td>æ— </td>
</tr>
<tr>
<td>PlayAndRecord</td>
<td>VoIPã€è¯­éŸ³èŠå¤©</td>
<td>å¯é€‰</td>
<td>â˜‘ï¸</td>
<td>â˜‘ï¸</td>
</tr>
<tr>
<td>AudioProcessing</td>
<td>ç¦»çº¿ä¼šè¯å’Œå¤„ç†</td>
<td>æ— </td>
<td>æ— </td>
<td>æ— </td>
</tr>
<tr>
<td>MultiRoute</td>
<td>ä½¿ç”¨å¤–éƒ¨ç¡¬ä»¶çš„é«˜çº§A/Våº”ç”¨ç¨‹åº</td>
<td>æ— </td>
<td>â˜‘ï¸</td>
<td>â˜‘ï¸</td>
</tr>
</tbody>
</table>
<p>ä¸Šè¿°åˆ†ç±»æ‰€æä¾›çš„å‡ ç§å¸¸è§çš„è¡Œä¸ºå¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†çš„åœºæ™¯éœ€æ±‚, å¦‚æœè¿˜éœ€è¦æ›´å¤æ‚çš„åŠŸèƒ½, å…¶ä¸­çš„ä¸€äº›åˆ†ç±»å¯ä»¥é€šè¿‡optionså’Œmodesæ–¹æ³•è¿›ä¸€æ­¥è‡ªå®šä¹‰.</p>
<p>é¡¹ç›®ä¸­ç”¨åˆ°äº†ä¸‰ç§çŠ¶æ€:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">switch (session) &#123;</div><div class="line">       case audioSessionAudioRecord:</div><div class="line">           category = AVAudioSessionCategoryRecord;</div><div class="line">           break;</div><div class="line">       case audioSessionPlay:</div><div class="line">           category = AVAudioSessionCategoryPlayback;</div><div class="line">           break;</div><div class="line">       default:</div><div class="line">           category = AVAudioSessionCategoryAmbient;</div><div class="line">           break;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>åˆå§‹åŒ–çŠ¶æ€ä¸º:AVAudioSessionCategoryAmbient<br>å½•éŸ³çŠ¶æ€ä¸º:AVAudioSessionCategoryRecord<br>æ’­æ”¾çŠ¶æ€ä¸º:AVAudioSessionCategoryPlayback</p>
</blockquote>
<h3 id="AVAudioRecorder"><a href="#AVAudioRecorder" class="headerlink" title="AVAudioRecorder"></a>AVAudioRecorder</h3><p>AVAudioRecorderæ„å»ºä¸Audio Queue Servicesä¹‹ä¸Š, æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”ä»£ç ç®€å•æ˜“ç”¨çš„OCæ¥å£.æˆ‘ä»¬å¯ä»¥åœ¨iOSè®¾å¤‡ä¸Šä½¿ç”¨è¿™ä¸ªç±»æ¥ä»å†…ç½®çš„éº¦å…‹é£å½•åˆ¶éŸ³é¢‘, ä¹Ÿå¯ä»¥ä»å¤–éƒ¨éŸ³é¢‘è®¾å¤‡è¿›è¡Œå½•åˆ¶, æ¯”å¦‚è€³æœº, USBéº¦å…‹é£ç­‰.</p>
<h4 id="åˆ›å»ºAVAudioRecorder"><a href="#åˆ›å»ºAVAudioRecorder" class="headerlink" title="åˆ›å»ºAVAudioRecorder"></a>åˆ›å»ºAVAudioRecorder</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (nullable instancetype)initWithURL:(NSURL *)url </div><div class="line">settings:(NSDictionary&lt;NSString *, id&gt; *)settings </div><div class="line">error:(NSError **)outError;</div></pre></td></tr></table></figure>
<p>å¯è§åˆ›å»ºAVAudioRecorderå®ä¾‹, éœ€è¦ä¸‰ä¸ªå‚æ•°</p>
<ul>
<li>ç”¨äºè¡¨ç¤ºéŸ³é¢‘æµå†™å…¥æ–‡ä»¶çš„æœ¬åœ°æ–‡ä»¶URL</li>
<li>åŒ…å«ç”¨äºé…ç½®å½•éŸ³ä¼šè¯é”®å€¼ä¿¡æ¯çš„NSDictionary</li>
<li>ç”¨äºæ•æ‰é”™è¯¯çš„NSErroræŒ‡é’ˆ</li>
</ul>
<h5 id="æœ¬åœ°æ–‡ä»¶URL"><a href="#æœ¬åœ°æ–‡ä»¶URL" class="headerlink" title="æœ¬åœ°æ–‡ä»¶URL"></a>æœ¬åœ°æ–‡ä»¶URL</h5><p>ä¼ å…¥ä¸€ä¸ªpath, å»é™¤PathExtension(è§„é¿), æ–°å¢PathExtension</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[NSURL fileURLWithPath:[[recordPath </div><div class="line">stringByDeletingPathExtension] </div><div class="line">stringByAppendingPathExtension:@&quot;wav&quot;]];</div></pre></td></tr></table></figure>
<h5 id="å½•éŸ³ä¼šè¯é”®å€¼ä¿¡æ¯NSDictionary"><a href="#å½•éŸ³ä¼šè¯é”®å€¼ä¿¡æ¯NSDictionary" class="headerlink" title="å½•éŸ³ä¼šè¯é”®å€¼ä¿¡æ¯NSDictionary"></a>å½•éŸ³ä¼šè¯é”®å€¼ä¿¡æ¯NSDictionary</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[[NSDictionary alloc] initWithObjectsAndKeys:</div><div class="line"></div><div class="line">[NSNumber numberWithFloat: 11025.0],AVSampleRateKey, //é‡‡æ ·ç‡ </div><div class="line">[NSNumber numberWithInt: kAudioFormatLinearPCM],AVFormatIDKey,</div><div class="line">[NSNumber numberWithInt:16],AVLinearPCMBitDepthKey,//é‡‡æ ·ä½æ•° </div><div class="line">[NSNumber numberWithInt: 2], AVNumberOfChannelsKey,//é€šé“çš„æ•°ç›®</div><div class="line">[NSNumber numberWithInt:AVAudioQualityMax], AVEncoderAudioQualityKey, // å½•éŸ³è´¨é‡</div><div class="line"></div><div class="line">nil];</div></pre></td></tr></table></figure>
<ul>
<li><p>éŸ³é¢‘æ ¼å¼</p>
<ul>
<li><p>AVFormatIDKeyé”®å®šä¹‰äº†å†™å…¥å†…å®¹çš„éŸ³é¢‘æ ¼å¼,å¸¸ç”¨çš„éŸ³é¢‘æ ¼å¼æ‰€æ”¯æŒçš„å€¼: </p>
<ul>
<li>kAudioFormatLinearPCM</li>
<li>kAudioFormatMPEG4AAC</li>
<li>kAudioFormatAppleIMA4</li>
<li>kAudioFormatMPEGLayer3</li>
<li>kAudioFormatAMR</li>
<li>â€¦.</li>
</ul>
<blockquote>
<p>æŒ‡å®škAudioFormatLinearPCM ä¼šå°†æœªå‹ç¼©çš„éŸ³é¢‘æµå†™å…¥åˆ°æ–‡ä»¶ä¸­, è¿™ç§æ ¼å¼çš„ä¿çœŸåº¦æœ€é«˜,ç›¸åº”çš„æ–‡ä»¶ä¹Ÿæ˜¯æœ€å¤§.é€‰æ‹©AAC(kAudioFormatMPEG4AAC)æˆ–è€…kAudioFormatAppleIMA4çš„å‹ç¼©æ ¼å¼ä¼šç¼©å°æ–‡ä»¶, åŒæ—¶è¿˜èƒ½ä¿è¯é«˜è´¨é‡çš„éŸ³é¢‘å†…å®¹. å½•åˆ¶çš„éŸ³é¢‘æ ¼å¼å¿…é¡»å’Œå‚æ•°å®šä¹‰çš„æ–‡ä»¶ç±»å‹å…¼å®¹.ä¾‹å¦‚:å½•åˆ¶ä¸€ä¸ªaaa.wavçš„æ–‡ä»¶, é‚£ä¹ˆå½•åˆ¶çš„éŸ³é¢‘å¿…é¡»æ»¡è¶³WAVEçš„æ ¼å¼è¦æ±‚,å³LinerPCM.</p>
</blockquote>
</li>
</ul>
</li>
<li><p>é‡‡æ ·ç‡</p>
<ul>
<li><p>AVSampleRateKeyç”¨äºå®šä¹‰å½•éŸ³å™¨çš„é‡‡æ ·ç‡.è¾“å…¥çš„æ¨¡æ‹ŸéŸ³é¢‘ä¿¡å·æ¯ä¸€ç§’çš„é‡‡æ ·æ•°,æ˜¯å½±å“éŸ³é¢‘è´¨é‡å’ŒéŸ³é¢‘æ–‡ä»¶å¤§å°,éå¸¸é‡è¦çš„ä¸€ä¸ªå› ç´ ,é‡‡æ ·ç‡è¶Šå°,æ–‡ä»¶è¶Šå°,è´¨é‡è¶Šä½.æ ‡å‡†çš„é‡‡æ ·ç‡æœ‰:8000ã€16000ã€22050ã€44100</p>
<blockquote>
<p>äººç±»å¯æ¥æ”¶çš„éŸ³é¢‘èŒƒå›´ä¸º20Hz-20KHz. éŸ³é¢‘æœ€ä½³çš„é‡‡æ ·ç‡ä¸ºæ‰€éœ€é‡‡æ ·å¯¹è±¡çš„æœ€é«˜é¢‘ç‡çš„ä¸¤å€;AMå¹¿æ’­ç±»å‹çš„é‡‡æ ·ç‡ä¸º8KHz;CDè´¨é‡çš„é‡‡æ ·ç‡ä¸º44.1KHz.</p>
</blockquote>
</li>
</ul>
</li>
<li><p>é€šé“æ•°</p>
<ul>
<li>AVNumberOfChannelsKeyè®°å½•éŸ³é¢‘å†…å®¹çš„é€šé“æ•°.é»˜è®¤å€¼ä¸º1,å³ç”¨å•å£°é“å½•åˆ¶, è®¾ç½®ä¸º2ä½¿ç”¨ç«‹ä½“å£°å½•åˆ¶.ä¸€èˆ¬æƒ…å†µç”¨å•å£°é“å½•éŸ³</li>
</ul>
</li>
<li><p>æŒ‡å®šæ ¼å¼çš„key</p>
<ul>
<li>AVEncoderAudioQualityKey - å½•éŸ³è´¨é‡</li>
<li>AVEncoderBitRateKey - éŸ³é¢‘æ¯”ç‰¹ç‡</li>
<li>AVEncoderBitRatePerChannelKey - æ¯æ¡é€šé“çš„éŸ³é¢‘æ¯”ç‰¹ç‡</li>
<li>â€¦</li>
</ul>
</li>
</ul>
<h5 id="ç›‘å¬éº¦å…‹é£æ˜¯å¦å…è®¸ä½¿ç”¨"><a href="#ç›‘å¬éº¦å…‹é£æ˜¯å¦å…è®¸ä½¿ç”¨" class="headerlink" title="ç›‘å¬éº¦å…‹é£æ˜¯å¦å…è®¸ä½¿ç”¨"></a>ç›‘å¬éº¦å…‹é£æ˜¯å¦å…è®¸ä½¿ç”¨</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- (BOOL)checkMicrophoneAvailability</div><div class="line">&#123;</div><div class="line">    __block BOOL open = NO;</div><div class="line">    AVAudioSession *session = [AVAudioSession sharedInstance];</div><div class="line">    if ([session respondsToSelector:@selector(requestRecordPermission:)]) &#123;</div><div class="line">        [session performSelector:@selector(requestRecordPermission:) withObject:^(BOOL status) &#123;</div><div class="line">            open = status;</div><div class="line">        &#125;];</div><div class="line">    &#125; else &#123;</div><div class="line">        open = YES;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    return open;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="AVAudioPlayer"><a href="#AVAudioPlayer" class="headerlink" title="AVAudioPlayer"></a>AVAudioPlayer</h3><p>AVAudioPlayeræ„å»ºäºCoreAudioä¸­çš„C-based Audio Queue Servicesçš„é¡¶å±‚, æä¾›äº†åœ¨Audio Queue Servicesæ‰€èƒ½æ‰¾åˆ°çš„æ ¸å¿ƒåŠŸèƒ½, ä¾‹å¦‚:æ’­æ”¾ã€å¾ªç¯ã€éŸ³é¢‘è®¡é‡, ä½¿ç”¨çš„æ˜¯éå¸¸å‹å¥½å¹¶ç®€å•çš„OCæ¥å£.AVAudioPlayeråªèƒ½æ’­æ”¾æœ¬åœ°éŸ³é¢‘, ä»ç½‘ç»œæµä¸­æ’­æ”¾éŸ³é¢‘ä½¿ç”¨AVPlayer.è¿™é‡Œæš‚ä¸”ä¸è®¨è®ºAVPlayer.</p>
<h4 id="åˆ›å»ºAVAudioPlayer"><a href="#åˆ›å»ºAVAudioPlayer" class="headerlink" title="åˆ›å»ºAVAudioPlayer"></a>åˆ›å»ºAVAudioPlayer</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (nullable instancetype)initWithContentsOfURL:</div><div class="line">(NSURL *)url error:(NSError **)outError;</div><div class="line"></div><div class="line">- (nullable instancetype)initWithData:</div><div class="line">(NSData *)data error:(NSError **)outError;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬é‡‡ç”¨URLçš„æ–¹å¼åˆ›å»º, åªéœ€è¦ä¼ å…¥ä¸€ä¸ªæœ¬åœ°URL</p>
<blockquote>
<p>URLå¿…é¡»åœ¨åº”ç”¨ç¨‹åºæ²™ç›’å†…</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">self.player = [[AVAudioPlayer alloc] </div><div class="line">initWithContentsOfURL:audioUrl error:&amp;error];</div><div class="line"></div><div class="line">[self.player prepareToPlay];</div><div class="line">[self.player play];</div></pre></td></tr></table></figure>
<p>è°ƒç”¨<strong>prepareToPlay</strong>è¿™ä¸ªæ–¹æ³•æ˜¯å¯é€‰çš„, å½“è°ƒç”¨playæ–¹æ³•æ—¶ä¼šéšå½¢æ¿€æ´», ä¸è¿‡åœ¨åˆ›å»ºæ—¶è°ƒç”¨, å¯ä»¥é™ä½è°ƒç”¨playæ–¹æ³•å’Œå¬åˆ°å£°éŸ³è¾“å‡ºä¹‹é—´çš„å»¶æ—¶.</p>
<h4 id="å¤„ç†ä¸­æ–­äº‹ä»¶"><a href="#å¤„ç†ä¸­æ–­äº‹ä»¶" class="headerlink" title="å¤„ç†ä¸­æ–­äº‹ä»¶"></a>å¤„ç†ä¸­æ–­äº‹ä»¶</h4><p>å½“æœ‰ç”µè¯æ‹¨æ‰“è¿›æ¥æˆ–è€…VoIPç”µè¯, æˆ‘ä»¬åº”è¯¥åšå‡ºåŠæ—¶çš„ååº”,ç›‘å¬<strong>AVAudioSessionInterruptionNotification</strong>çŠ¶æ€</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[[NSNotificationCenter defaultCenter] </div><div class="line">addObserver:self selector:@selector(handleInterruption:) </div><div class="line">name:AVAudioSessionInterruptionNotification </div><div class="line">object:[AVAudioSession sharedInstance]];</div></pre></td></tr></table></figure>
<p>å¦‚æœ<strong>AVAudioSessionInterruptionType</strong>ä¸º<strong>AVAudioSessionInterruptionTypeBegan</strong>åˆ™åœæ­¢å½“å‰æ’­æ”¾.å¦‚æœtypeä¸º<strong>AVAudioSessionInterruptionTypeEnded</strong>ä¸”optionsä¸º<strong>AVAudioSessionInterruptionOptionShouldResume</strong>åˆ™é‡æ–°æ’­æ”¾.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- (void)handleInterruption:(NSNotification *)note</div><div class="line">&#123;</div><div class="line">    NSDictionary *info = note.userInfo;</div><div class="line">    AVAudioSessionInterruptionType type = [info[AVAudioSessionInterruptionTypeKey] unsignedIntegerValue];</div><div class="line">    if (type == AVAudioSessionInterruptionTypeBegan) &#123;</div><div class="line">        [self stopPlaying];</div><div class="line">//    &#125; else &#123;</div><div class="line">//        AVAudioSessionInterruptionOptions options = [info[AVAudioSessionInterruptionOptionKey] unsignedIntegerValue];</div><div class="line">//        </div><div class="line">//        if (options == AVAudioSessionInterruptionOptionShouldResume) &#123;</div><div class="line">//            // é‡æ–°æ’­æ”¾</div><div class="line">//        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="å¯¹çº¿è·¯æ”¹å˜çš„å“åº”"><a href="#å¯¹çº¿è·¯æ”¹å˜çš„å“åº”" class="headerlink" title="å¯¹çº¿è·¯æ”¹å˜çš„å“åº”"></a>å¯¹çº¿è·¯æ”¹å˜çš„å“åº”</h4><p>åœ¨iOSè®¾å¤‡ä¸Šæ·»åŠ ,ç§»é™¤éŸ³é¢‘è¾“å…¥ã€è¾“å‡ºçº¿è·¯æ—¶, ä¼šå‘ç”Ÿçº¿è·¯çš„æ”¹å˜, å¦‚:ç”¨æˆ·æ’å…¥è€³æœºæˆ–æ–­å¼€USBéº¦å…‹é£ç­‰.è¿™äº›äº‹ä»¶çš„å‘ç”Ÿ, éŸ³é¢‘å°±ä¼šæ ¹æ®æƒ…å†µæ”¹å˜è¾“å…¥/è¾“å‡ºçº¿è·¯.ç›‘å¬<strong>AVAudioSessionRouteChangeNotification</strong>çŠ¶æ€</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[[NSNotificationCenter defaultCenter] </div><div class="line">addObserver:self selector:@selector(handleRouteChange:) </div><div class="line">name:AVAudioSessionRouteChangeNotification </div><div class="line">object:[AVAudioSession sharedInstance]];</div></pre></td></tr></table></figure>
<p>æ¥æ”¶é€šçŸ¥åå…ˆåˆ¤æ–­çº¿è·¯å˜æ›´å‘ç”Ÿçš„åŸå› , é€šè¿‡<strong>userInfo</strong>ä¸­çš„<strong>AVAudioSessionRouteChangeReasonKey</strong>æ¨æ–­ä¸åŒçš„äº‹ä»¶, ä¾‹å¦‚è€³æœºæ–­å¼€è¿™ä¸ªäº‹ä»¶çš„åŸå› ä¸º:<strong>AVAudioSessionRouteChangeReasonOldDeviceUnavailable</strong>, æ¥ç€è·å–æè¿°å‰ä¸€ä¸ªçº¿è·¯çš„ä¿¡æ¯<strong>AVAudioSessionRouteDescription</strong>, ä»çº¿è·¯çš„ç¬¬ä¸€ä¸ªè¾“å…¥æ¥å£åˆ¤æ–­å…¶æ˜¯å¦ä¸ºè€³æœºæ¥å£.å¦‚æœæ˜¯, åˆ™ä»£ç è€³æœºæ‹”å‡º, åœæ­¢æ’­æ”¾.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">- (void)handleRouteChange:(NSNotification *)note</div><div class="line">&#123;</div><div class="line">    NSDictionary *info = note.userInfo;</div><div class="line">    AVAudioSessionRouteChangeReason reason = [info[AVAudioSessionRouteChangeReasonKey] unsignedIntegerValue];</div><div class="line">    </div><div class="line">    // è€³æœºæ–­å¼€çš„äº‹ä»¶ä¸ºä¾‹</div><div class="line">    if (reason == AVAudioSessionRouteChangeReasonOldDeviceUnavailable) &#123;</div><div class="line">        </div><div class="line">        AVAudioSessionRouteDescription *previousRoute = info[AVAudioSessionRouteChangePreviousRouteKey];</div><div class="line">        </div><div class="line">        AVAudioSessionPortDescription *previousOutput = previousRoute.outputs.firstObject;</div><div class="line">        NSString *portType = previousOutput.portType;</div><div class="line">        if ([portType isEqualToString:AVAudioSessionPortHeadphones]) &#123;</div><div class="line">            [self stopPlaying];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="åˆ‡æ¢å¬ç­’å’Œæ‰¬å£°å™¨"><a href="#åˆ‡æ¢å¬ç­’å’Œæ‰¬å£°å™¨" class="headerlink" title="åˆ‡æ¢å¬ç­’å’Œæ‰¬å£°å™¨"></a>åˆ‡æ¢å¬ç­’å’Œæ‰¬å£°å™¨</h4><p>å½“æˆ‘ä»¬å°†æ‰‹æœºè´´è¿‘è€³æœµæ—¶å€™, å½“å‰è¯­éŸ³æ’­æ”¾åº”è¯¥æ˜¯å¬ç­’æ¨¡å¼, å½“æˆ‘ä»¬æ‹¿ç€æ‰‹æœºè§‚çœ‹æ—¶å€™, å½“å‰çš„è¯­éŸ³æ’­æ”¾åº”è¯¥æ˜¯æ‰¬å£°å™¨çš„æ¨¡å¼.<br>æˆ‘ä»¬åº”è¯¥è·å–è®¾å¤‡çš„çº¢å¤–æ„Ÿåº”<strong>setProximityMonitoringEnabled</strong>çš„çŠ¶æ€ä¸º<strong>YES</strong>, å¹¶ç›‘å¬çŠ¶æ€çš„æ›´æ”¹<strong>UIDeviceProximityStateDidChangeNotification</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (void)changeProximityMonitorEnableState:(BOOL)enable &#123;</div><div class="line">    [[UIDevice currentDevice] setProximityMonitoringEnabled:YES];</div><div class="line">    if ([UIDevice currentDevice].proximityMonitoringEnabled == YES) &#123;</div><div class="line">		//ç›‘å¬è·ç¦»äº‹ä»¶ï¼Œå…ˆè®¾ç½®ä¸ºYESï¼Œå¦‚æœè®¾ç½®å®Œåè¿˜æ˜¯NOï¼Œè¯´æ˜å½“å‰è®¾å¤‡è¿‘è·ç¦»ä¼ æ„Ÿå™¨ä¸å¯ç”¨</div><div class="line">        if (enable) &#123;</div><div class="line">            [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(sensorStateChange) name:UIDeviceProximityStateDidChangeNotification object:n</div><div class="line">        &#125; else &#123;</div><div class="line">            [[NSNotificationCenter defaultCenter] removeObserver:self name:UIDeviceProximityStateDidChangeNotification object:nil];</div><div class="line">            [[UIDevice currentDevice] setProximityMonitoringEnabled:NO];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç›‘å¬çŠ¶æ€çš„æ”¹å˜ <strong>sensorStateChange</strong> å¦‚æœæ­¤æ—¶æ‰‹æœºé è¿‘é¢éƒ¨æ”¾åœ¨è€³æœµæ—ï¼Œé‚£ä¹ˆå£°éŸ³å°†é€šè¿‡å¬ç­’è¾“å‡ºï¼Œå¹¶å°†å±å¹•å˜æš—.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- (void)sensorStateChange &#123;</div><div class="line">    if ([[UIDevice currentDevice] proximityState] == YES) &#123;</div><div class="line">        //é»‘å±</div><div class="line">        [[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryPlayAndRecord error:nil];</div><div class="line">        </div><div class="line">    &#125; else &#123;</div><div class="line">        //æ²¡é»‘å±å¹•</div><div class="line">        [[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryPlayback error:nil];</div><div class="line">        if (![self isPlaying]) &#123;</div><div class="line">            //æ²¡æœ‰æ’­æ”¾äº†ï¼Œä¹Ÿæ²¡æœ‰åœ¨é»‘å±çŠ¶æ€ä¸‹ï¼Œå°±å¯ä»¥æŠŠè·ç¦»ä¼ æ„Ÿå™¨å…³äº†</div><div class="line">            [[UIDevice currentDevice] setProximityMonitoringEnabled:NO];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Audio-Metering"><a href="#Audio-Metering" class="headerlink" title="Audio Metering"></a>Audio Metering</h3><p>Audio Meteringå¯ä»¥è®©æˆ‘ä»¬è·å–åˆ°éŸ³é¢‘çš„å¹³å‡å€¼åˆ†è´å’Œå³°å€¼çš„åˆ†è´æ•°æ®.<strong>averagePowerForChannel</strong>å’Œ<strong>peakPowerForChannel</strong>è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ªç”¨äºè¡¨ç¤ºå£°éŸ³åˆ†è´ç­‰çº§çš„æµ®ç‚¹å€¼. è¿™ä¸ªå€¼çš„èŒƒå›´æœ€å¤§åˆ†è´0dB - æœ€å°åˆ†è´æˆ–é™éŸ³ -160dB.æ¯æ¬¡éœ€è¦è¯»å–æœ€æ–°çš„å€¼, å¼€å¯ä¸€ä¸ªå®šæ—¶å™¨,æ‰§è¡Œå®šæ—¶å™¨çš„æ–¹æ³•,è°ƒç”¨updateMeters.æ ¹æ®averagePowerForChannelæ”¾å›çš„å€¼è¿›è¡Œè®¾ç½®.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">- (void)timerAction</div><div class="line">&#123;</div><div class="line">    if (self.status == subTitleStatuesDefault) &#123;</div><div class="line">        </div><div class="line">        if ([LCAudioRecord recorder]) [[LCAudioRecord recorder] updateMeters];</div><div class="line"></div><div class="line">        float peakPower = [[LCAudioRecord recorder] averagePowerForChannel:0];</div><div class="line">        double ALPHA = 0.05;</div><div class="line">        double value = pow(10, (ALPHA * peakPower));</div><div class="line">        if (value &lt; 0.1 ) &#123;</div><div class="line">            self.bordImageView.image = [UIImage imageNamed:@&quot;è¯­éŸ³ä¸­-1&quot;];</div><div class="line">        &#125; else if (value &lt; 0.15) &#123;</div><div class="line">            self.bordImageView.image = [UIImage imageNamed:@&quot;è¯­éŸ³ä¸­-2&quot;];</div><div class="line">        &#125; else if (value &lt; 0.25) &#123;</div><div class="line">            self.bordImageView.image = [UIImage imageNamed:@&quot;è¯­éŸ³ä¸­-3&quot;];</div><div class="line">        &#125; else if (value &lt; 0.35) &#123;</div><div class="line">            self.bordImageView.image = [UIImage imageNamed:@&quot;è¯­éŸ³ä¸­-4&quot;];</div><div class="line">        &#125; else if (value &lt; 0.9 ) &#123;</div><div class="line">            self.bordImageView.image = [UIImage imageNamed:@&quot;è¯­éŸ³ä¸­-5&quot;];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    self.seconds ++;</div><div class="line">    if (self.seconds &gt;= 599.9) &#123;</div><div class="line">        [self.class dismiss];</div><div class="line">        [[NSNotificationCenter defaultCenter] postNotificationName:@&quot;recordDUrationToolong&quot; object:nil];</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="å°è£…"><a href="#å°è£…" class="headerlink" title="å°è£…"></a>å°è£…</h3><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯:"></a>æ€è·¯:</h4><ul>
<li>åˆ›å»ºä¸€ä¸ªAudioManagerç»Ÿä¸€ç®¡ç†audioRecordå’ŒaudioPlay</li>
<li>å…ˆåˆ†åˆ«å®ç°audioRecordå’ŒaudioPlayç›¸å…³çš„æ–¹æ³•</li>
<li>åŸºäºaudioRecordå’ŒaudioPlayæä¾›çš„æ–¹æ³• åœ¨AudioManager ç»Ÿä¸€è¿›è¡Œå°è£…æ¥å£.</li>
<li>åˆ©ç”¨blockçš„å½¢å¼å›è°ƒ</li>
</ul>
<p>æœ€ç»ˆæ¥å£å½¢å¼:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">+ (instancetype)manager;</div><div class="line"></div><div class="line">#pragma mark - LCAudioRecord</div><div class="line">// åˆ¤æ–­éº¦å…‹é£æ˜¯å¦å¯ç”¨</div><div class="line">- (BOOL)checkMicrophoneAvailability;</div><div class="line"> </div><div class="line">/**</div><div class="line"> *  å¼€å§‹å½•éŸ³</div><div class="line"> *</div><div class="line"> */</div><div class="line">- (void)startRecordingWithFileName:(NSString *)fileName</div><div class="line">                             completion:(void(^)(NSError *error))completion;</div><div class="line"></div><div class="line">/**</div><div class="line"> *  åœæ­¢å½•éŸ³</div><div class="line"> *</div><div class="line"> */</div><div class="line">- (void)stopRecordingWithCompletion:(void(^)(NSString *recordPath,</div><div class="line">                                                 NSInteger aDuration,</div><div class="line">                                                 NSError *error))completion;</div><div class="line">/**</div><div class="line"> *  å–æ¶ˆå½•éŸ³</div><div class="line"> */</div><div class="line">- (void)cancelRecording;</div><div class="line"></div><div class="line">/**</div><div class="line"> *  å½“å‰æ˜¯å¦æ­£åœ¨å½•éŸ³</div><div class="line"> *</div><div class="line"> */</div><div class="line">- (BOOL)isRecording;</div><div class="line"></div><div class="line"></div><div class="line">#pragma mark - LCAudioPlay</div><div class="line">/**</div><div class="line"> *  æ’­æ”¾éŸ³é¢‘</div><div class="line"> *</div><div class="line"> */</div><div class="line">- (void)playingWithRecordPath:(NSString *)recordPath</div><div class="line">                  completion:(void(^)(NSError *error))completion;</div><div class="line"></div><div class="line">/**</div><div class="line"> *  åœæ­¢æ’­æ”¾</div><div class="line"> *</div><div class="line"> */</div><div class="line">- (void)stopPlaying;</div><div class="line"></div><div class="line">/**</div><div class="line"> *  å½“å‰æ˜¯å¦æ­£åœ¨æ’­æ”¾</div><div class="line"> *</div><div class="line"> */</div><div class="line">-(BOOL)isPlaying;</div></pre></td></tr></table></figure>
<p>å½•éŸ³æŒ‡ç¤ºå™¨çš„æ¥å£:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">typedef NS_ENUM(NSInteger, subTitleStatues) &#123;</div><div class="line">    subTitleStatuesDefault,</div><div class="line">    subTitleStatuesCancel,</div><div class="line">&#125;;</div><div class="line">@interface LCMetersRecordingView : UIView</div><div class="line">// æ ¹æ® çŠ¶æ€æ›´æ”¹ æ˜¾ç¤ºçš„å†…å®¹</div><div class="line">+ (void)subTitleLabelStatues:(subTitleStatues)statues;</div><div class="line">+ (void)show;</div><div class="line">+ (void)dismiss;</div><div class="line">@end</div></pre></td></tr></table></figure>
<h4 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨:"></a>å¦‚ä½•ä½¿ç”¨:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">1.å¼€å§‹å½•éŸ³</div><div class="line">// æ£€æµ‹éº¦å…‹é£æ˜¯å¦å¯ç”¨</div><div class="line">[LCAudioManager manager] checkMicrophoneAvailability]</div><div class="line">[[LCAudioManager manager] startRecordingWithFileName:[NSString recordFileName] completion:nil];</div><div class="line"></div><div class="line">2.ç»“æŸå½•éŸ³</div><div class="line">[[LCAudioManager manager] stopRecordingWithCompletion:^(NSString *recordPath, NSInteger aDuration, NSError *error) &#123;</div><div class="line">        if (aDuration &lt; 1) &#123; </div><div class="line">            [MBProgressHUD showError:@&quot;å½•éŸ³æ—¶é—´è¿‡çŸ­&quot;];</div><div class="line">            return ;</div><div class="line">        &#125;</div><div class="line">        if (!error) &#123; // å½•éŸ³æˆåŠŸ</div><div class="line">          // æ‰§è¡Œä¸‹ä¸€æ­¥è®¡åˆ’</div><div class="line">        &#125;</div><div class="line">    &#125;];</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AVFoundation/">AVFoundation</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="[post]-ç½‘ç»œå®‰å…¨"  class="article article-type-[post]" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2016/01/12/ç½‘ç»œå®‰å…¨/">TCP/IPç½‘ç»œå®‰å…¨(å…­)</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2016/01/12/ç½‘ç»œå®‰å…¨/" class="article-date">
	  <time datetime="2016-01-11T16:00:00.000Z" itemprop="datePublished">2016-01-12</time>
	</a>

      
    <a class="article-category-link" href="/categories/iOS/">iOS</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p>###TCP/IPç½‘ç»œå®‰å…¨<br>TCP/IPç›¸å…³çš„å®‰å…¨è¦ç´ å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fidg13uz9ij30qm0ks77x.jpg" alt=""></p>
<h4 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h4><p>ç»„ç»‡æœºæ„å†…éƒ¨çš„ç½‘ç»œä¸äº’è”ç½‘ç›¸è¿æ—¶, ä¸ºäº†é¿å…å†…éƒ¨ç½‘ç»œå—åˆ°éæ³•è®¿é—®çš„å¨èƒ, ä¼šè®¾ç½®é˜²ç«å¢™ã€‚</p>
<blockquote>
<p>ä½¿ç”¨NATçš„æƒ…å†µä¸‹, ç”±äºé™å®šäº†å¯ä»¥ä»å¤–éƒ¨è®¿é—®çš„åœ°å€, å› æ­¤ä¹Ÿèƒ½èµ·åˆ°é˜²ç«å¢™çš„ä½œç”¨ã€‚</p>
</blockquote>
<p>é˜²ç«å¢™æœ‰å¤šç§ç§ç±»å’Œå½¢æ€, ä¸“é—¨è¿‡æ»¤ç‰¹å®šæ•°æ®åŒ…çš„<strong>åŒ…è¿‡æ»¤é˜²ç«å¢™</strong>, æ•°æ®åˆ°è¾¾åº”ç”¨ä»¥åç”±åº”ç”¨å¤„ç†å¹¶æ‹’ç»éæ³•è®¿é—®çš„åº”ç”¨ç½‘å…³ã€‚é˜²ç«å¢™å¯ä»¥é™åˆ¶ä»äº’è”ç½‘è®¿é—®çš„ä¸»æœºä¸ªæ•°; å°†å®‰å…¨çš„ä¸»æœºå’Œå¯ä»¥æš´éœ²çš„ä¸»æœºåŠ ä»¥åŒºåˆ†, é’ˆå¯¹åè€…é›†ä¸­å®æ–½å®‰å…¨é˜²æŠ¤ã€‚</p>
<p>ä¸‹å›¾ä¸­, å¯¹è·¯ç”±å™¨è®¾ç½®äº†åªå‘å…¶å‘é€ç‰¹å®šåœ°å€å’Œç«¯å£å·çš„åŒ…, ä¹Ÿå°±æ˜¯è®¾ç½®äº†ä¸€ä¸ªåŒ…è¿‡æ»¤é˜²ç«å¢™ã€‚<br>å½“ä»å¤–éƒ¨è¿‡æ¥TCPé€šä¿¡è¯·æ±‚æ—¶, åªå…è®¸å¯¹WebæœåŠ¡å™¨çš„TCP 80ç«¯å£å’Œé‚®ä»¶æœåŠ¡å™¨çš„TCP 25ç«¯å£è®¿é—®ã€‚å…¶ä»–æ‰€æœ‰ç±»å‹çš„åŒ…éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚<br>æ­¤å¤–, å»ºç«‹TCPè¿æ¥çš„è¯·æ±‚åªå…è®¸ä»å†…ç½‘å‘èµ·, ä¸èƒ½ä»å¤–ç½‘ç›´æ¥è¿æ¥å†…ç½‘ã€‚<br><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fidghahbcdj30qq0c6n0x.jpg" alt=""></p>
<h4 id="IDS-å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ"><a href="#IDS-å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ" class="headerlink" title="IDS(å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ)"></a>IDS(å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ)</h4><p>IDSæ£€æµ‹å·²ç»ä¾µå…¥å†…éƒ¨ç½‘ç»œè¿›è¡Œéæ³•è®¿é—®çš„æƒ…å†µ, å¹¶åŠæ—¶é€šçŸ¥ç»™ç½‘ç»œç®¡ç†å‘˜çš„ç³»ç»Ÿã€‚<br>IDSæ ¹æ®ä¸åŒçš„ç”¨é€”å¯ä»¥æä¾›å„ç§ä¸åŒçš„åŠŸèƒ½ã€‚ä»è®¾ç½®å½¢å¼ä¸Šçœ‹, ä¸€èˆ¬åœ¨é˜²ç«å¢™æˆ–DMSç­‰è¾¹ç•Œè®¾å¤‡ä¸Šè¿›è¡Œè®¾ç½®ã€‚æœ‰äº†è¿™æ ·çš„ç›‘æ§ã€æ£€æµ‹è¾¹ç•Œçš„åŠŸèƒ½, å°±å¯ä»¥è®¾ç½®åœ¨ç½‘ç»œå†…éƒ¨ã€å…¨ç½‘æˆ–ä¸ªåˆ«ç‰¹æ®Šçš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç›‘æ§ã€‚<br>ä»åŠŸèƒ½ä¸Šçœ‹, IDSæœ‰å®šæœŸé‡‡é›†æ—¥å¿—ã€é•¿æœŸç›‘æ§ã€é€šçŸ¥å¼‚å¸¸ç­‰åŠŸèƒ½ã€‚å¯ä»¥ç›‘æ§ç½‘ç»œä¸ŠæµåŠ¨çš„æ‰€æœ‰æ•°æ®åŒ…, ä¸é˜²ç«å¢™ç›¸è¾…ç›¸æˆã€‚</p>
<blockquote>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fidgosnrmfj30qk09mjty.jpg" alt=""></p>
</blockquote>
<h4 id="åŠ å¯†æŠ€æœ¯"><a href="#åŠ å¯†æŠ€æœ¯" class="headerlink" title="åŠ å¯†æŠ€æœ¯"></a>åŠ å¯†æŠ€æœ¯</h4><p>åŠ å¯†æŒ‡çš„æ˜¯åˆ©ç”¨å¯†é’¥å¯¹æ˜æ–‡çš„æ•°æ®é€šè¿‡ä¸€å®šçš„ç®—æ³•å˜æ¢æˆå¯†æ–‡çš„è¿‡ç¨‹, é€†åè¿‡ç¨‹å«è§£å¯†ã€‚<br><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fidgut9bw0j30mo09mab5.jpg" alt=""></p>
<p>åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥å«åšå¯¹ç§°åŠ å¯†æ–¹å¼, åŠ å¯†å’Œè§£å¯†çš„è¿‡ç¨‹ä¸­ä½¿ç”¨ä¸åŒçš„å¯†é’¥å«åšéå¯¹ç§°åŠ å¯†ã€‚</p>
<h5 id="å¯¹ç§°åŠ å¯†"><a href="#å¯¹ç§°åŠ å¯†" class="headerlink" title="å¯¹ç§°åŠ å¯†"></a>å¯¹ç§°åŠ å¯†</h5><p>å¯¹ç§°åŠ å¯†æ–¹å¼åŒ…æ‹¬AESã€DESç­‰åŠ å¯†æ ‡å‡†, å¯¹ç§°åŠ å¯†çš„ä¼˜ç‚¹åœ¨äºåŠ è§£å¯†çš„æ•ˆç‡æ¯”è¾ƒé«˜, ç¼ºç‚¹åœ¨äºå¦‚ä½•ä¿è¯å¯†é’¥æ˜¯å®‰å…¨çš„ã€‚<br><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fidi40bqysj30lk06cwf8.jpg" alt=""></p>
<h5 id="éå¯¹ç§°åŠ å¯†"><a href="#éå¯¹ç§°åŠ å¯†" class="headerlink" title="éå¯¹ç§°åŠ å¯†"></a>éå¯¹ç§°åŠ å¯†</h5><p>éå¯¹ç§°åŠ å¯†ä¸­, åˆ©ç”¨å…¬é’¥(å…¬å¼€çš„å¯†é’¥)åŠ å¯†çš„æ•°æ®åªèƒ½é€šè¿‡ç§é’¥è§£å¯†, ä½¿ç”¨ç§é’¥åŠ å¯†çš„æ•°æ®å°±éœ€è¦å…¬é’¥è¿›è¡Œè§£å¯†ã€‚å…¬é’¥åŠ å¯†æ–¹æ³•ä¸­å¸¸è§çš„åŠ å¯†ç®—æ³•æ˜¯RSAç®—æ³•ã€‚<br><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fidi8rdatnj30r20840ud.jpg" alt=""></p>
<h4 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h4><p>HTTPSå…¶å®å°±æ˜¯å®‰å…¨çš„HTTP, ä¹Ÿå°±æ˜¯HTTPçš„å®‰å…¨å‡çº§ç‰ˆæœ¬, HTTPå±äºåº”ç”¨å±‚çš„åè®®, HTTPåè®®ä¹‹ä¸‹æ˜¯ä¼ è¾“åè®®TCP, HTTPSå°±æ˜¯åœ¨HTTPä¸TCPä¸­é—´åŠ å¤šäº†ä¸€å±‚åŠ å¯†å±‚TLS/SSLã€‚</p>
<h5 id="TLS-SSL"><a href="#TLS-SSL" class="headerlink" title="TLS/SSL"></a>TLS/SSL</h5><p>SSL/TLSåè®®çš„åŸºæœ¬æ€è·¯æ˜¯å®¢æˆ·ç«¯å…ˆå‘æœåŠ¡å™¨ç«¯ç´¢è¦å…¬é’¥ï¼Œç„¶åç”¨å…¬é’¥åŠ å¯†ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å¯†æ–‡åï¼Œç”¨è‡ªå·±çš„ç§é’¥è§£å¯†ã€‚é€šä¿—çš„è®², SSLæ˜¯ç”¨æ¥åŠ å¯†çš„, TLSæ˜¯SSLçš„å‡çº§ç‰ˆæœ¬ã€‚<a href="http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html" target="_blank" rel="external">TLS/SSLåè®®è¿è¡Œæœºåˆ¶</a></p>
<p>HTTPä¸­åº”ç”¨å±‚ç›´æ¥å°†æ•°æ®ä¼ è¾“ç»™TCP, åœ¨HTTPSä¸­åº”ç”¨å±‚å°†æ•°æ®ä¼ è¾“ç»™TLS/SSLåŠ å¯†å, åœ¨ä¼ è¾“ç»™TCPè¿›è¡Œä¼ è¾“ã€‚</p>
<h5 id="HTTPSåŠ å¯†é€šä¿¡ç®€ç•¥æµç¨‹"><a href="#HTTPSåŠ å¯†é€šä¿¡ç®€ç•¥æµç¨‹" class="headerlink" title="HTTPSåŠ å¯†é€šä¿¡ç®€ç•¥æµç¨‹"></a>HTTPSåŠ å¯†é€šä¿¡ç®€ç•¥æµç¨‹</h5><p>HTTPSä¸­é‡‡ç”¨å¯¹ç§°åŠ å¯†æ–¹å¼, åœ¨å‘é€å…¶å…¬å…±å¯†é’¥æ—¶é‡‡ç”¨çš„æ˜¯å…¬é’¥åŠ å¯†æ–¹å¼ã€‚<br><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fidk73ex94j30q40iu784.jpg" alt=""></p>
<ul>
<li>1.æµè§ˆå™¨è®¿é—®ç½‘ç«™, ç½‘ç«™å°†è‡ªå·±çš„è¯ä¹¦ç»™åˆ°æµè§ˆå™¨</li>
<li>2.æµè§ˆå™¨ä»è¯ä¹¦ä¸­è·å–ç½‘ç«™çš„å…¬é’¥A</li>
<li>3.æµè§ˆå™¨ç”Ÿæˆä¸€ä¸ªå¯¹ç§°å¯†é’¥B, å¹¶ç”¨å…¬é’¥AåŠ å¯†å, ä¼ é€ç»™ç½‘ç«™</li>
<li>4.ç½‘ç«™é€šè¿‡ç§é’¥è§£å¯†, æ‹¿åˆ°å¯¹ç§°å¯†é’¥B</li>
<li>5.ä¹‹åé€šä¿¡çš„æ•°æ®, éƒ½ä½¿ç”¨å¯†é’¥Bè¿›è¡ŒåŠ å¯†</li>
</ul>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fidjjx7lfjj30p20smmz8.jpg" alt=""></p>
<h5 id="è¾¨åˆ«ä¼ªé€ çš„è¯ä¹¦"><a href="#è¾¨åˆ«ä¼ªé€ çš„è¯ä¹¦" class="headerlink" title="è¾¨åˆ«ä¼ªé€ çš„è¯ä¹¦"></a>è¾¨åˆ«ä¼ªé€ çš„è¯ä¹¦</h5><ul>
<li><p>å®Œå…¨ä¼ªé€ çš„è¯ä¹¦ â€“ å¯¹è¯ä¹¦è¿›è¡Œæ£€æŸ¥<br>1.è¯ä¹¦é¢å‘çš„æœºæ„æ˜¯ä¼ªé€ çš„, æµè§ˆå™¨ä¸è®¤è¯†, ç›´æ¥è®¤ä¸ºæ˜¯å±é™©è¯ä¹¦<br>2.è¯ä¹¦é¢å‘æœºæ„ç¡®å®å­˜åœ¨, æ ¹æ®CAå, æ‰¾åˆ°å†…ç½®çš„CAæ ¹è¯ä¹¦ã€CAçš„å…¬é’¥, åˆ©ç”¨å…¬é’¥å¯¹ä¼ªé€ çš„è¯ä¹¦æ‘˜è¦è¿›è¡Œè§£å¯†, å¦‚æœè§£å¯†å¤±è´¥, åˆ™è®¤ä¸ºæ˜¯å±é™©è¯ä¹¦ã€‚</p>
</li>
<li><p>ç¯¡æ”¹è¿‡çš„è¯ä¹¦ â€“ å‡è®¾ä»£ç†é€šè¿‡æŸç§é€”å¾„, æ‹¿åˆ°XXçš„è¯ä¹¦, ç„¶åå°†è¯ä¹¦çš„å…¬é’¥å·å·ä¿®æ”¹æˆè‡ªå·±çš„ã€‚<br>1.æ£€æŸ¥è¯ä¹¦, æ ¹æ®CAå, æ‰¾åˆ°å¯¹åº”çš„CAæ ¹è¯ä¹¦, ä»¥åŠCAçš„å…¬é’¥<br>2.ç”¨CAçš„å…¬é’¥, å¯¹è¯ä¹¦çš„æ•°å­—ç­¾åè¿›è¡Œè§£å¯†, å¾—åˆ°å¯¹åº”çš„è¯ä¹¦æ‘˜è¦AA<br>3.æ ¹æ®è¯ä¹¦ç­¾åä½¿ç”¨çš„hashç®—æ³•, è®¡ç®—å‡ºå½“å‰è¯ä¹¦çš„æ‘˜è¦BB<br>4.å¯¹æ¯”ä¸¤ä¸ªæ‘˜è¦, å‘ç°ä¸ä¸€è‡´, åˆ™ä¸ºå±é™©çš„è¯ä¹¦            </p>
<p><a href="http://www.cnblogs.com/hyddd/archive/2009/01/07/1371292.html" target="_blank" rel="external">æµ…ææ•°å­—è¯ä¹¦</a></p>
</li>
</ul>
<p>å‚è€ƒ:</p>
<ul>
<li><a href="">å›¾è§£TCP/IP</a></li>
<li><a href="http://www.jianshu.com/nb/3276500" target="_blank" rel="external">http://www.jianshu.com/nb/3276500</a></li>
<li><a href="https://segmentfault.com/a/1190000004523659#articleHeader3" target="_blank" rel="external">HTTPç§‘æ™®æ‰«ç›²è´´</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ç½‘ç»œ/">ç½‘ç»œ</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="[post]-TCP:UDP"  class="article article-type-[post]" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2016/01/01/TCP:UDP/">TCP/UDP(äº”)</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2016/01/01/TCP:UDP/" class="article-date">
	  <time datetime="2015-12-31T16:00:00.000Z" itemprop="datePublished">2016-01-01</time>
	</a>

      
    <a class="article-category-link" href="/categories/iOS/">iOS</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<h3 id="TCP-UDP"><a href="#TCP-UDP" class="headerlink" title="TCP/UDP"></a>TCP/UDP</h3><p>TCPä¸UDPæ˜¯ä¼ è¾“å±‚çš„ä¸¤ä¸ªä¸»è¦åè®®ã€‚TCPæä¾›å¯é çš„é€šä¿¡çš„ä¼ è¾“, è€ŒUDPé¢å‘æ— è¿æ¥çš„ä¸å¯é çš„é€šä¿¡ä¼ è¾“ã€‚</p>
<p>ç½‘ç»œå±‚ä¸­çš„IPé¦–éƒ¨ä¸­æœ‰ä¸€ä¸ªåè®®çš„å­—æ®µ, ç”¨æ¥æ ‡è¯†ç½‘ç»œå±‚çš„ä¸Šä¸€å±‚é‡‡ç”¨çš„æ˜¯å“ªä¸€ç§ä¼ è¾“å±‚çš„åè®®ã€‚æ ¹æ®è¿™ä¸ªå­—æ®µçš„åè®®å·, å°±å¯ä»¥è¯†åˆ«IPä¼ è¾“çš„<strong>æ•°æ®éƒ¨åˆ†</strong>æ˜¯TCPçš„å†…å®¹, è¿˜æ˜¯UDPçš„å†…å®¹ã€‚åŒç†,ä¼ è¾“å±‚ä½¿ç”¨ç«¯å£å·è¯†åˆ«åœ¨ä¼ è¾“å±‚çš„ä¸Šä¸€å±‚(åº”ç”¨å±‚)ä¸­è¦è¿›è¡Œå¤„ç†çš„ç¨‹åºã€‚</p>
<h4 id="ç«¯å£å·"><a href="#ç«¯å£å·" class="headerlink" title="ç«¯å£å·"></a>ç«¯å£å·</h4><p>æ•°æ®é“¾è·¯å’ŒIPåœ°å€, åˆ†åˆ«å¯¹åº”MACåœ°å€å’ŒIPåœ°å€ã€‚å‰è€…ç”¨æ¥è¯†åˆ«åŒä¸€é“¾è·¯ä¸­ä¸åŒçš„è®¡ç®—æœº, åè€…ç”¨æ¥è¯†åˆ«TCP/IPç½‘ç»œä¸­äº’è¿çš„ä¸»æœºå’Œè·¯ç”±å™¨ã€‚åœ¨ä¼ è¾“å±‚ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„åœ°å€æ¦‚å¿µ, é‚£å°±æ˜¯ç«¯å£å·ã€‚ç«¯å£å·ç”¨æ¥è¯†åˆ«åŒä¸€å°è®¡ç®—æœºä¸­è¿›è¡Œé€šä¿¡çš„ä¸åŒåº”ç”¨ç¨‹åº, ä¹Ÿå«åšç¨‹åºåœ°å€ã€‚</p>
<h5 id="é€šä¿¡è¯†åˆ«"><a href="#é€šä¿¡è¯†åˆ«" class="headerlink" title="é€šä¿¡è¯†åˆ«"></a>é€šä¿¡è¯†åˆ«</h5><p>ä»…ä»…å‡­ç›®æ ‡ç«¯å£è¯†åˆ«æŸä¸€ä¸ªé€šä¿¡æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚å¦‚ä¸‹å›¾: 1å’Œ2çš„é€šä¿¡æ˜¯åœ¨ä¸¤å°è®¡ç®—æœºä¸Šè¿›è¡Œçš„ã€‚ä»–ä»¬çš„ç›®æ ‡ç«¯å£å·éƒ½æ˜¯80, éœ€è¦æ ¹æ®æºç«¯å£å·è¿›è¡ŒåŒºåˆ†ã€‚3å’Œ1çš„ç›®æ ‡ç«¯å£å·å’Œæºç«¯å£å·å®Œå…¨ç›¸åŒ, ä½†æ˜¯ä»–ä»¬å„è‡ªçš„æºIPåœ°å€ä¸åŒã€‚å¦å¤–åè®®å·ä¸åŒ, ä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯ä¸¤ä¸ªä¸åŒçš„é€šä¿¡ã€‚</p>
<p>ç»¼ä¸Š, TCP/IPæˆ–UDP/IPé€šä¿¡ä¸­é€šå¸¸é‡‡ç”¨5ä¸ªä¿¡æ¯æ¥è¯†åˆ«ä¸€ä¸ªé€šä¿¡ã€‚åˆ†åˆ«æ˜¯: <strong>æºIPåœ°å€</strong>ã€<strong>ç›®æ ‡IPåœ°å€</strong>ã€<strong>åè®®å·</strong>ã€<strong>æºç«¯å£å·</strong>ã€<strong>ç›®æ ‡ç«¯å£å·</strong>ã€‚åªæœ‰5ä¸ªä¿¡æ¯ä¸€è‡´, æ‰è®¤ä¸ºæ˜¯åŒä¸€ä¸ªé€šä¿¡ã€‚<br><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fic9us8bqbj30pq0l4tf1.jpg" alt=""></p>
<h5 id="ç«¯å£å·çš„ç¡®å®š"><a href="#ç«¯å£å·çš„ç¡®å®š" class="headerlink" title="ç«¯å£å·çš„ç¡®å®š"></a>ç«¯å£å·çš„ç¡®å®š</h5><ul>
<li>æ ‡å‡†æ—¢å®šçš„ç«¯å£å·<br>è¿™ç§æ–¹æ³•ä¹Ÿå«<strong>é™æ€æ–¹æ³•</strong>, æŒ‡æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰å…¶æŒ‡å®šçš„ç«¯å£å·ã€‚çŸ¥åç«¯å£å·ä¸€èˆ¬ç”±0~1023çš„æ•°å­—åˆ†é…è€Œæˆ, åº”ç”¨ç¨‹åºéœ€è¦é¿å…ä½¿ç”¨çŸ¥åç«¯å£å·, å¯ä»¥ä½¿ç”¨1024~49151ä¹‹é—´çš„æ•°å­—ä½œä¸ºè‡ªå®šä¹‰ç«¯å£å·ã€‚</li>
<li>æ—¶åºåˆ†é…æ³•<br>è¿™ç§æ–¹æ³•ä¹Ÿå«<strong>åŠ¨æ€æ–¹æ³•</strong>, æ­¤æ—¶æœåŠ¡ç«¯æœ‰å¿…è¦ç¡®å®šç›‘å¬ç«¯å£å·, ä½†æ˜¯æ¥å—æœåŠ¡çš„å®¢æˆ·ç«¯æ²¡å¿…è¦ç¡®å®šç«¯å£å·ã€‚<br>å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå®Œå…¨ä¸ç”¨è‡ªå·±è®¾ç½®ç«¯å£å·, <strong>å…¨æƒäº¤ç»™æ“ä½œç³»ç»Ÿè¿›è¡Œåˆ†é…</strong>ã€‚æ“ä½œç³»ç»Ÿå¯ä»¥ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºåˆ†é…äº’ä¸å†²çªçš„ç«¯å£å·ã€‚ä¾‹å¦‚, æ¯éœ€è¦ä¸€ä¸ªæ–°çš„ç«¯å£å·, å°±åœ¨ä¹‹å‰åˆ†é…å·ç çš„åŸºç¡€ä¸ŠåŠ 1ã€‚åŠ¨æ€åˆ†é…çš„ç«¯å£å·çš„å–å€¼èŒƒå›´åœ¨49152~65535ä¹‹é—´ã€‚</li>
</ul>
<h4 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h4><p>UDPä¸æä¾›å¤æ‚çš„æ§åˆ¶æœºåˆ¶, åˆ©ç”¨IPæä¾›é¢å‘æ— è¿æ¥çš„é€šä¿¡æœåŠ¡ã€‚å› æ­¤UDPä¸æ£€æŸ¥å¯¹ç«¯æ˜¯å¦å¯ä»¥é€šä¿¡, ç›´æ¥å°†UDPåŒ…å‘é€å‡ºå»ã€‚<br>å³ä½¿æ˜¯å‡ºç°ç½‘ç»œæ‹¥å µçš„æƒ…å†µä¸‹, UDPä¹Ÿæ— æ³•è¿›è¡Œæµé‡æ§åˆ¶ç­‰é¿å…ç½‘ç»œæ‹¥å¡çš„è¡Œä¸ºã€‚æ­¤å¤–, ä¼ è¾“é€”ä¸­å‡ºç°ä¸¢åŒ…, UDPä¹Ÿä¸è´Ÿè´£é‡å‘ç­‰ã€‚UDPå¸¸ç”¨äºä¸€ä¸‹å‡ ä¸ªæ–¹é¢:</p>
<ul>
<li>åŒ…æ€»é‡è¾ƒå°‘çš„é€šä¿¡(DNSã€SNMPç­‰)</li>
<li>è§†é¢‘ã€éŸ³é¢‘ç­‰å¤šåª’ä½“é€šä¿¡</li>
<li>é™å®šäºLANç­‰ç‰¹å®šç½‘ç»œä¸­çš„åº”ç”¨é€šä¿¡</li>
<li>å¹¿æ’­/å¤šæ’­é€šä¿¡</li>
</ul>
<h5 id="UDPé¦–éƒ¨"><a href="#UDPé¦–éƒ¨" class="headerlink" title="UDPé¦–éƒ¨"></a>UDPé¦–éƒ¨</h5><p>UDPé¦–éƒ¨ç”±æºç«¯å£å·, ç›®æ ‡ç«¯å£å·, åŒ…é•¿å’Œæ ¡éªŒå’Œç»„æˆã€‚<br><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ficeugx7idj30oi0a6jue.jpg" alt=""></p>
<ul>
<li>æºç«¯å£å·: è¡¨ç¤ºå‘é€ç«¯å£å·</li>
<li>ç›®æ ‡ç«¯å£å·: æ¥æ”¶ç«¯ç«¯å£å·</li>
<li>åŒ…é•¿åº¦: ä¿å­˜UDPsé¦–éƒ¨å’Œæ•°æ®é•¿åº¦ä¹‹å’Œ</li>
<li>æ ¡éªŒå’Œ: æ ¡éªŒå’Œç”¨æ¥åˆ¤æ–­æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦æŸå </li>
</ul>
<blockquote>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1ficezxbfsxj30r40j479a.jpg" alt=""></p>
</blockquote>
<h4 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h4><p>TCPå¯¹æ•°æ®çš„ä¼ è¾“ã€å‘é€ã€é€šä¿¡éƒ½è¿›è¡Œäº†æ§åˆ¶çš„åè®®ã€‚å¯ä»¥è¿›è¡Œä¸¢åŒ…æ—¶çš„é‡å‘æ§åˆ¶, å¯ä»¥å¯¹æ¬¡åºä¹±æ‰çš„åˆ†åŒ…è¿›è¡Œé¡ºåºæ§åˆ¶, åªæœ‰åœ¨ç¡®è®¤é€šä¿¡å¯¹ç«¯å­˜åœ¨æ—¶æ‰ä¼šå‘é€æ•°æ®, ä»è€Œå¯ä»¥æ§åˆ¶é€šä¿¡æµé‡çš„æµªè´¹ã€‚<strong>TCPé€šè¿‡æ£€éªŒå’Œã€åºåˆ—å·ã€ç¡®è®¤åº”ç­”ã€é‡å‘æ§åˆ¶ã€è¿æ¥ç®¡ç†ä»¥åŠçª—å£æ§åˆ¶ç­‰æœºåˆ¶å®ç°å¯é æ€§ä¼ è¾“</strong>ã€‚</p>
<h5 id="TCPé¦–éƒ¨"><a href="#TCPé¦–éƒ¨" class="headerlink" title="TCPé¦–éƒ¨"></a>TCPé¦–éƒ¨</h5><p>TCPæ²¡æœ‰åŒ…é•¿åº¦å’Œæ•°æ®é•¿åº¦, å¯ç”±IPå±‚è·çŸ¥TCPçš„åŒ…é•¿åº¦, ç”±åŒ…é•¿å¯çŸ¥æ•°æ®çš„é•¿åº¦ã€‚<br><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1ficf0umzwjj30o60hkwia.jpg" alt=""></p>
<ul>
<li>ç«¯å£å·: å‘é€ç«¯ç«¯å£å·</li>
<li>ç›®æ ‡ç«¯å£å·: æ¥æ”¶ç«¯ç«¯å£å·</li>
<li>åºåˆ—å·: å‘é€æ•°æ®çš„ä½ç½®</li>
<li>ç¡®è®¤åº”ç­”å·: ä¸‹ä¸€æ¬¡åº”è¯¥æ”¶åˆ°çš„æ•°æ®çš„åºåˆ—å·</li>
<li>æ•°æ®åç§»: è¡¨ç¤ºTCPä¼ è¾“çš„æ•°æ®éƒ¨åˆ†ä»åŒ…çš„å“ªä¸ªä½ç½®å¼€å§‹è®¡ç®—</li>
<li>ä¿ç•™: ä¸ºä»¥åæ‰©å±•ä½¿ç”¨</li>
<li>æ§åˆ¶ä½: æ§åˆ¶å„ç§çŠ¶æ€</li>
<li>çª—å£å¤§å°: èƒ½å¤Ÿæ¥æ”¶çš„æ•°æ®å¤§å°</li>
<li>æ ¡éªŒå’Œ: ä¸UDPç›¸ä¼¼ </li>
</ul>
<blockquote>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1ficf8k5zw1j30r80fuaej.jpg" alt=""></p>
</blockquote>
<ul>
<li>ç´§æ€¥æŒ‡é’ˆ: ä¸ç´§æ€¥æ•°æ®ç›¸å…³</li>
<li>é€‰é¡¹: ç”¨äºæé«˜TCPä¼ è¾“æ€§èƒ½, å°†æ•°æ®è°ƒæ•´ä¸º32ä½çš„æ•´æ•°å€</li>
</ul>
<h5 id="åºåˆ—å·ä¸ç¡®è®¤åº”ç­”"><a href="#åºåˆ—å·ä¸ç¡®è®¤åº”ç­”" class="headerlink" title="åºåˆ—å·ä¸ç¡®è®¤åº”ç­”"></a>åºåˆ—å·ä¸ç¡®è®¤åº”ç­”</h5><p>åœ¨TCPä¸­, å½“å‘é€ç«¯çš„æ•°æ®åˆ°è¾¾æ¥æ”¶ç«¯æ—¶, æ¥æ”¶ç«¯ä¸»æœºä¼šè¿”å›ä¸€ä¸ªå·²æ”¶åˆ°æ¶ˆæ¯çš„é€šçŸ¥, è¿™ä¸ªæ¶ˆæ¯å«åšç¡®è®¤åº”ç­”(ACK), å¦å®šç¡®è®¤åº”ç­”(NACK)ã€‚<br><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1ficbd4xq2fj30ey0hgabh.jpg" alt=""><br>TCPé€šè¿‡è‚¯å®šçš„ç¡®è®¤åº”ç­”(ACK)å®ç°å¯é çš„æ•°æ®ä¼ è¾“ã€‚å½“å‘é€ç«¯å°†æ•°æ®å‘å‡ºä¹‹åä¼šç­‰å¾…å¯¹ç«¯çš„ç¡®è®¤åº”ç­”ã€‚å¦‚æœæœ‰ç¡®è®¤åº”ç­”, è¯´æ˜æ•°æ®å·²ç»æˆåŠŸåˆ°è¾¾å¯¹ç«¯ã€‚åä¹‹, åˆ™æ•°æ®ä¸¢å¤±çš„å¯èƒ½æ€§å¾ˆå¤§ã€‚<br>åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰ç­‰åˆ°ç¡®è®¤åº”ç­”, å‘é€ç«¯å°±å¯ä»¥è®¤ä¸ºæ•°æ®å·²ç»ä¸¢å¤±, å¹¶è¿›è¡Œé‡å‘ã€‚ç”±æ­¤, å³ä½¿äº§ç”Ÿäº†ä¸¢åŒ…, ä»ç„¶èƒ½å¤Ÿä¿è¯æ•°æ®èƒ½å¤Ÿåˆ°è¾¾å¯¹ç«¯, å®ç°å¯é ä¼ è¾“ã€‚<br><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ficbifcnspj30he0ii769.jpg" alt=""></p>
<p>æœªæ”¶åˆ°ç¡®è®¤åº”ç­”å¹¶ä¸æ„å‘³ç€æ•°æ®ä¸€å®šä¸¢å¤±ã€‚ä¹Ÿå¯èƒ½æ˜¯æ•°æ®å¯¹æ–¹å·²ç»æ”¶åˆ°, åªæ˜¯ç¡®è®¤è¿”å›çš„ç¡®è®¤åº”ç­”åœ¨é€”ä¸­ä¸¢å¤±ã€‚è¿™ç§æƒ…å†µä¹Ÿä¼šå¯¼è‡´å‘é€ç«¯å› ä¸ºæ²¡æœ‰æ”¶åˆ°ç¡®è®¤åº”ç­”, ä»è€Œè¿›è¡Œé‡å‘æ•°æ®ã€‚<br><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ficbkhlhunj30h00kqtbh.jpg" alt=""></p>
<p>æ­¤å¤–, ä¹Ÿæœ‰å¯èƒ½å› ä¸ºä¸€äº›å…¶ä»–åŸå› å¯¼è‡´ç¡®è®¤åº”ç­”å»¶è¿Ÿåˆ°è¾¾, åœ¨æºä¸»æœºé‡å‘æ•°æ®ä»¥åæ‰åˆ°è¾¾çš„æƒ…å†µä¹Ÿç»å¸¸è§ã€‚æ­¤æ—¶, æºå‘é€ä¸»æœºåªè¦æŒ‰ç…§æ—¢å®šæœºåˆ¶é‡å‘æ•°æ®å³å¯ã€‚ä½†æ˜¯å¯¹äºç›®æ ‡ä¸»æœºæ¥è¯´, å®ƒä¼šåå¤æ”¶åˆ°ç›¸åŒçš„æ•°æ®ã€‚è€Œä¸ºäº†å¯¹ä¸Šå±‚åº”ç”¨æä¾›å¯é çš„ä¼ è¾“, å¿…é¡»å¾—æ”¾å¼ƒé‡å¤çš„æ•°æ®åŒ…ã€‚å› æ­¤éœ€è¦å¼•å…¥ä¸€ç§æœºåˆ¶, èƒ½å¤Ÿè¯†åˆ«æ˜¯å¦å·²ç»æ¥æ”¶æ•°æ®, åˆ¤æ–­æ˜¯å¦éœ€è¦æ¥æ”¶æ•°æ®ç­‰ã€‚<br>åºåˆ—å·å¯ä»¥å®ç°ç¡®è®¤åº”ç­”å¤„ç†ã€é‡å‘æ§åˆ¶ä»¥åŠé‡å¤æ§åˆ¶ç­‰åŠŸèƒ½; åºåˆ—å·æ˜¯æŒ‰é¡ºåºç»™å‘é€æ•°æ®çš„æ¯ä¸€ä¸ªå­—èŠ‚éƒ½æ ‡ä¸Šå·ç çš„ç¼–å·ã€‚ <strong>æ¥æ”¶ç«¯æŸ¥è¯¢æ¥æ”¶æ•°æ®TCPé¦–éƒ¨ä¸­çš„åºåˆ—å·å’Œæ•°æ®é•¿åº¦, å°†è‡ªå·±ä¸‹ä¸€æ­¥åº”è¯¥æ¥æ”¶çš„åºå·ä½œä¸ºç¡®è®¤åº”ç­”è¿”é€å›å»</strong>ã€‚é€šè¿‡åºåˆ—å·å’Œç¡®è®¤åº”ç­”å·, TCPå¯ä»¥å®ç°å¯é çš„ä¼ è¾“ã€‚<br><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1ficbtksijvj30r80sk43h.jpg" alt=""></p>
<h5 id="è¿æ¥ç®¡ç†"><a href="#è¿æ¥ç®¡ç†" class="headerlink" title="è¿æ¥ç®¡ç†"></a>è¿æ¥ç®¡ç†</h5><p>TCPæä¾›é¢å‘æœ‰è¿æ¥çš„é€šä¿¡ä¼ è¾“ã€‚é¢å‘æœ‰è¿æ¥æ˜¯æŒ‡åœ¨æ•°æ®é€šä¿¡å¼€å§‹ä¹‹å‰å…ˆåšå¥½é€šä¿¡ä¸¤ç«¯ä¹‹é—´çš„å‡†å¤‡å·¥ä½œã€‚TCPä¼šåœ¨æ•°æ®é€šä¿¡ä¹‹å‰, é€šè¿‡TCPé¦–éƒ¨å‘é€ä¸€ä¸ª<strong>SYNåŒ…</strong>ä½œä¸ºå»ºç«‹è¿æ¥çš„è¯·æ±‚ç­‰å¾…ç¡®è®¤åº”ç­”ã€‚å¦‚æœå¯¹ç«¯å‘æ¥ç¡®è®¤åº”ç­”, åˆ™è®¤ä¸ºå¯ä»¥è¿›è¡Œæ•°æ®é€šä¿¡ã€‚å¦‚æœå¯¹ç«¯çš„ç¡®è®¤åº”ç­”æœªèƒ½åˆ°è¾¾, å°±ä¸ä¼šè¿›è¡Œé€šä¿¡ã€‚åœ¨é€šä¿¡ç»“æŸçš„æ—¶å€™å›è¿›è¡Œæ–­å¼€è¿æ¥çš„å¤„ç†(FINåŒ…), ä¹Ÿå°±æ˜¯å‘é€ä¸€ä¸ªFINåŒ…, ç¡®è®¤æ–­å¼€è¿æ¥ã€‚<br>å»ºç«‹ä¸€ä¸ªTCPè¿æ¥éœ€è¦å‘é€3ä¸ªåŒ…, ä¹Ÿå«åšâ€ä¸‰æ¬¡æ¡æ‰‹â€, æ–­å¼€TCPè¿æ¥éœ€è¦å‘é€4ä¸ªåŒ…, ä¹Ÿå«â€å››æ¬¡æŒ¥æ‰‹â€ã€‚æ‰€ä»¥ä¸€ä¸ªè¿æ¥çš„å»ºç«‹ä¸æ–­å¼€,è‡³å°‘éœ€è¦æ¥å›å‘é€7ä¸ªåŒ…æ‰èƒ½å®Œæˆã€‚<br><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ficcefq92qj30eq0lydhu.jpg" alt=""></p>
<h5 id="TCPä»¥æ®µä½å•ä½å‘é€æ•°æ®"><a href="#TCPä»¥æ®µä½å•ä½å‘é€æ•°æ®" class="headerlink" title="TCPä»¥æ®µä½å•ä½å‘é€æ•°æ®"></a>TCPä»¥æ®µä½å•ä½å‘é€æ•°æ®</h5><p>åœ¨å»ºç«‹TCPè¿æ¥çš„åŒæ—¶, ä¹Ÿå¯ä»¥ç¡®å®šå‘é€æ•°æ®åŒ…çš„å•ä½(æœ€å¤§æ¶ˆæ¯é•¿åº¦:æ®µ :MSS,)ã€‚MSSæ˜¯åœ¨ä¸‰æ¬¡æ¡æ‰‹çš„æ—¶å€™, åœ¨ä¸¤ç«¯ä¸»æœºä¹‹é—´è¢«è®¡ç®—å¾—å‡ºã€‚ä¸¤ç«¯çš„ä¸»æœºåœ¨å‘å‡ºå»ºç«‹è¿æ¥è¯·æ±‚æ—¶, ä¼šåœ¨TCPé¦–éƒ¨ä¸­å†™å…¥MSSé€‰é¡¹, å‘Šè¯‰å¯¹æ–¹è‡ªå·±çš„æ¥å£èƒ½å¤Ÿé€‚åº”çš„MSSçš„å¤§å°ã€‚ä¹‹å, åœ¨æ­¤ä¹‹é—´é€‰æ‹©ä¸€ä¸ªæœ€å°çš„MSSçš„å€¼ã€‚<br><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ficck17ilzj30p40pmgq5.jpg" alt=""></p>
<p>#####çª—å£æ§åˆ¶<br>TCPä»¥1ä¸ªæ®µä¸ºå•ä½, æ¯å‘ä¸€ä¸ªæ®µè¿›è¡Œä¸€æ¬¡ç¡®è®¤åº”ç­”çš„å¤„ç†, è¿™ç§ä¼ è¾“æ–¹å¼æœ‰ä¸€ä¸ªç¼ºç‚¹, åŒ…çš„å¾€è¿”æ—¶é—´è¶Šé•¿é€šä¿¡æ€§èƒ½è¶Šä½ã€‚<br><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ficcpl3nlgj30j40iitar.jpg" alt=""></p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ TCPå¼•å…¥äº†çª—å£çš„æ¦‚å¿µ, ä½¿åœ¨å¾€è¿”æ—¶é—´è¾ƒé•¿çš„æƒ…å†µä¸‹, ä¹Ÿèƒ½æ§åˆ¶ç½‘ç»œæ€§èƒ½çš„ä¸‹é™ã€‚ç¡®è®¤åº”ç­”ä¸å†æ˜¯ä»¥æ¯ä¸ªåˆ†æ®µ, è€Œæ˜¯ä»¥æ›´å¤§çš„å•ä½è¿›è¡Œç¡®è®¤, è½¬å‘æ—¶é—´å°†ä¼šè¢«å¤§å¹…åº¦çš„ç¼©çŸ­ã€‚<br><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ficcsbstu2j30hw0fwjud.jpg" alt=""><br>çª—å£å¤§å°:æŒ‡æ— éœ€ç­‰å¾…ç¡®è®¤åº”ç­”è€Œå¯ä»¥ç»§ç»­å‘é€æ•°æ®æ®µçš„æœ€å¤§å€¼ã€‚è¿™ä¸ªæœºåˆ¶çš„å®ç°ä½¿ç”¨äº†å¤§é‡çš„ç¼“å†²åŒºã€‚</p>
<p>å‘é€ç«¯ä¸»æœºåœ¨ç­‰åˆ°ç¡®è®¤åº”ç­”è¿”å›ä¹‹å‰, å¿…é¡»åœ¨ç¼“å†²åŒºä¸­ä¿ç•™è¿™éƒ¨åˆ†æ•°æ®ã€‚å½“æ•°æ®å‘å‡ºåè‹¥å¦‚æœŸæ”¶åˆ°ç¡®è®¤åº”ç­”å°±å¯ä»¥ä¸ç”¨å†è¿›è¡Œé‡å‘, æ­¤æ—¶æ•°æ®å°±å¯ä»¥ä»ç¼“å­˜åŒºæ¸…é™¤ã€‚æ”¶åˆ°ç¡®è®¤åº”ç­”çš„æƒ…å†µä¸‹, å°†çª—å£æ»‘åŠ¨åˆ°ç¡®è®¤åº”ç­”ä¸­çš„åºåˆ—å·çš„ä½ç½®ã€‚è¿™æ ·å¯ä»¥é¡ºåºåœ°å°†å¤šä¸ªæ®µåŒæ—¶å‘é€æé«˜é€šä¿¡æ€§èƒ½ã€‚è¿™ç§æœºåˆ¶ä¹Ÿè¢«ç§°ä¸ºæ»‘åŠ¨çª—å£æ§åˆ¶ã€‚<br><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ficcy2nup5j30pu0jq43p.jpg" alt=""></p>
<h5 id="çª—å£æ§åˆ¶ä¸é‡å‘"><a href="#çª—å£æ§åˆ¶ä¸é‡å‘" class="headerlink" title="çª—å£æ§åˆ¶ä¸é‡å‘"></a>çª—å£æ§åˆ¶ä¸é‡å‘</h5><p>åœ¨ä½¿ç”¨çª—å£æ§åˆ¶ä¸­, å¤„ç†æ®µä¸¢å¤±çš„æƒ…å†µã€‚</p>
<ul>
<li><p>ç¡®è®¤åº”ç­”æœªèƒ½è¿”å›çš„æƒ…å†µ<br>åœ¨è¿™ç§æƒ…å†µä¸‹, æ•°æ®å·²ç»åˆ°è¾¾å¯¹ç«¯, æ˜¯ä¸éœ€è¦è¿›è¡Œé‡å‘çš„ã€‚<br><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ficdgl41sej30py0i6adg.jpg" alt=""></p>
</li>
<li><p>æŸä¸ªæ®µä¸¢å¤±çš„æƒ…å†µ<br>æ¥æ”¶ä¸»æœºå¦‚æœæ”¶åˆ°ä¸€ä¸ªæœ¬åº”è¯¥æ¥æ”¶çš„åºå·ä»¥å¤–çš„æ•°æ®æ—¶, ä¼šé’ˆå¯¹å½“å‰ä¸ºæ­¢æ”¶åˆ°æ•°æ®è¿”å›ç¡®è®¤åº”ç­”ã€‚å‘é€ç«¯ä¸»æœºå¦‚æœè¿ç»­3æ¬¡æ”¶åˆ°åŒä¸€ä¸ªç¡®è®¤åº”ç­”, å°±ä¼šå°†å…¶æ‰€å¯¹åº”çš„æ•°æ®è¿›è¡Œé‡å‘ã€‚è¿™ç§æœºåˆ¶æ¯”ä¹‹å‰æåˆ°çš„è¶…æ—¶ç®¡ç†æ›´åŠ é«˜æ•ˆ, ä¹Ÿç§°ä½œé«˜é€Ÿé‡å‘æ§åˆ¶ã€‚<br><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1ficdkffgukj30r60lc0xq.jpg" alt=""></p>
</li>
</ul>
<h5 id="æµæ§åˆ¶"><a href="#æµæ§åˆ¶" class="headerlink" title="æµæ§åˆ¶"></a>æµæ§åˆ¶</h5><p>æµæ§åˆ¶:è®©å‘é€ç«¯æ ¹æ®æ¥æ”¶ç«¯çš„å®é™…æ¥æ”¶èƒ½åŠ›æ§åˆ¶å‘é€çš„æ•°æ®é‡ã€‚æ¥æ”¶ç«¯ä¸»æœºå‘å‘é€ç«¯ä¸»æœºé€šçŸ¥è‡ªå·±å¯ä»¥æ¥æ”¶æ•°æ®çš„å¤§å°, äºæ˜¯å‘é€ç«¯ä¼šå‘é€ä¸è¶…è¿‡è¿™ä¸ªé™åº¦çš„æ•°æ®ã€‚è¯¥å¤§å°é™åº¦å°±è¢«ç§°ä½œçª—å£çš„å¤§å° ã€‚<br>æ¥æ”¶ä¸»æœºå°†è‡ªå·±å¯ä»¥æ¥æ”¶çš„ç¼“å†²åŒºå¤§å°æ”¾å…¥è¿™ä¸ªå­—æ®µä¸­é€šçŸ¥ç»™å‘é€ç«¯ã€‚è¿™ä¸ªå­—æ®µçš„å€¼è¶Šå¤§, è¯´æ˜ç½‘ç»œçš„ååé‡è¶Šé«˜ã€‚æ¥æ”¶ç«¯çš„ç¼“å†²åŒºä¸€æ—¦é¢ä¸´æ•°æ®æº¢å‡ºæ—¶, çª—å£å¤§å°çš„å€¼ä¹Ÿä¼šéšä¹‹è¢«è®¾ç½®ä¸ºä¸€ä¸ªæ›´å°çš„å€¼é€šçŸ¥ç»™å‘é€ç«¯, ä»è€Œæ§åˆ¶æ•°æ®å‘é€é‡ã€‚ç®€è€Œè¨€ä¹‹, å‘é€ç«¯ä¸»æœºä¼šæ ¹æ®æ¥æ”¶ç«¯ä¸»æœºçš„æç¤º, å¯¹å‘é€çš„æ•°æ®é‡è¿›è¡Œæ§åˆ¶ã€‚<br><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1ficebte4egj30py0mwq77.jpg" alt=""></p>
<blockquote>
<p>çª—å£æ¢æµ‹çš„æ•°æ®æ®µ, æ¬¡æ•°æ®æ®µä»…åŒ…å«ä¸€ä¸ªå­—èŠ‚ä»¥è·å–æœ€æ–°çš„çª—å£å¤§å°ä¿¡æ¯ã€‚</p>
</blockquote>
<h5 id="æ‹¥å¡æ§åˆ¶"><a href="#æ‹¥å¡æ§åˆ¶" class="headerlink" title="æ‹¥å¡æ§åˆ¶"></a>æ‹¥å¡æ§åˆ¶</h5><p>åœ¨ç½‘ç»œå‡ºç°æ‹¥å µæ—¶, å¦‚æœçªç„¶å‘é€ä¸€ä¸ªè¾ƒå¤§é‡çš„æ•°æ®, ææœ‰å¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªç½‘ç»œçš„ç˜«ç—ªã€‚TCPä¸ºäº†é˜²æ­¢è¯¥é—®é¢˜å¾—å‡ºç°, åœ¨é€šä¿¡ä¸€å¼€å§‹å°±ä¼šé€šè¿‡ä¸€ä¸ªå«åšæ…¢å¯åŠ¨çš„ç®—æ³•å¾—å‡ºçš„æ•°å€¼, å¯¹å‘é€æ•°æ®é‡è¿›è¡Œæ§åˆ¶ã€‚<br><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1ficeg631tlj30o60oeq74.jpg" alt=""></p>
<p>é¦–å…ˆä¸ºäº†åœ¨å‘é€ç«¯è°ƒèŠ‚æ‰€è¦å‘é€çš„æ•°æ®çš„é‡, å®šä¹‰äº†ä¸€ä¸ªå«åšâ€æ‹¥å¡çš„çª—å£â€, åœ¨æ…¢å¯åŠ¨çš„æ—¶å€™, å°†è¿™ä¸ªæ‹¥å¡çª—å£çš„å¤§å°è®¾ç½®ä¸º1ä¸ªæ•°æ®æ®µ(1MSS)å‘é€æ•°æ®, ä¹‹åæ¯æ”¶åˆ°ä¸€æ¬¡ACK,å°±å°†æ‹¥å¡çª—å£çš„å€¼+1, åœ¨å‘é€æ•°æ®åŒ…æ—¶, å°†æ‹¥å¡çª—å£çš„å¤§å°ä¸æ¥æ”¶ç«¯ä¸»æœºçš„çª—å£å¤§å°åšæ¯”è¾ƒ, æŒ‰ç…§ä¸¤è€…ä¸­è¾ƒå°çš„å€¼, å‘é€æ¯”è¿™ä¸ªå€¼è¿˜è¦å°çš„æ•°æ®é‡ã€‚<br>éšç€åŒ…çš„æ¯æ¬¡å¾€è¿”, æ‹¥å¡çª—å£ä¼šä»¥1ã€2ã€4ç­‰æŒ‡æ•°å‡½æ•°çš„å¢é•¿, æ‹¥å µçŠ¶å†µæ¿€å¢ç”šè‡³å¯¼è‡´ç½‘ç»œæ‹¥å¡çš„å‘ç”Ÿã€‚ä¸ºäº†é˜²æ­¢è¿™äº›, å¼•å…¥äº†æ…¢å¯åŠ¨é˜€å€¼çš„æ¦‚å¿µã€‚åªè¦æ‹¥å¡çª—å£çš„å€¼è¶…è¿‡è¿™ä¸ªé˜€å€¼, ä¼šæŒ‰ç…§æŸç§è§„åˆ™æ§åˆ¶æ‹¥å¡çª—å£çš„æ•°é‡ã€‚</p>
<h4 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h4><h5 id="ä¸‰æ¬¡æ¡æ‰‹"><a href="#ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹"></a>ä¸‰æ¬¡æ¡æ‰‹</h5><p>äºŒæ¬¡æ¡æ‰‹:åœ¨ç½‘ç»œè¯·æ±‚ä¸­, å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€äº†ä¸€ä¸ªSYNåŒ…,è¯·æ±‚å»ºç«‹è¿æ¥ã€‚ç”±äºå»¶è¿Ÿ, æœåŠ¡ç«¯æ²¡æœ‰åŠæ—¶æ”¶åˆ°åŒ…; äºæ˜¯å®¢æˆ·ç«¯é‡æ–°å‘é€ä¸€ä¸ªSYNåŒ…ã€‚å‡è®¾æœåŠ¡ç«¯æ¥æ”¶äº†ç¬¬äºŒä¸ªSYNåŒ…, å»ºç«‹äº†é€šä¿¡, ä¸€æ®µæ—¶é—´åé€šä¿¡ç»“æŸ, è¿æ¥è¢«å…³é—­ã€‚è¿™æ—¶å€™æœ€åˆè¢«å‘é€çš„SYNåŒ…åˆšè¢«æœåŠ¡ç«¯æ¥æ”¶, æœåŠ¡ç«¯å‘å›ACKå,å°±ä¼šå»ºç«‹è¿æ¥, ç”±äºæ˜¯å‰ä¸€æ¬¡çš„è¿æ¥è¯·æ±‚, å¹¶æ²¡æœ‰è¢«ä½¿ç”¨, è¿™æ ·å°±å¯¼è‡´æœåŠ¡ç«¯å»ºç«‹äº†ä¸€ä¸ªç©ºçš„è¿æ¥ã€‚<br>ä¸‰æ¬¡æ¡æ‰‹: æœåŠ¡ç«¯å‘å›ACKå, å®¢æˆ·ç«¯ä¼šä¸¢å¼ƒè¿™ä¸ªæ•°æ®åŒ…, ä¸ä¼šå’ŒæœåŠ¡ç«¯è¿›è¡Œç¬¬ä¸‰æ¬¡çš„æ¡æ‰‹, å› æ­¤å¯ä»¥é¿å…æœåŠ¡ç«¯ç©ºçš„è¿æ¥ã€‚</p>
<h5 id="å»ºç«‹ACKç¡®è®¤åŒ…ä¸¢å¤±"><a href="#å»ºç«‹ACKç¡®è®¤åŒ…ä¸¢å¤±" class="headerlink" title="å»ºç«‹ACKç¡®è®¤åŒ…ä¸¢å¤±"></a>å»ºç«‹ACKç¡®è®¤åŒ…ä¸¢å¤±</h5><p>TCPåè®®å¤„ç†ä¸¢åŒ…çš„ä¸€èˆ¬æ–¹æ³•ï¼ŒæœåŠ¡ç«¯ä¼šé‡æ–°å‘å®¢æˆ·ç«¯å‘é€æ•°æ®åŒ…ï¼Œç›´è‡³æ”¶åˆ° ACK ç¡®è®¤ä¸ºæ­¢ã€‚å®é™…ä¸Šè¿™ç§åšæ³•æœ‰å¯èƒ½é­åˆ°SYNæ³›æ´ªæ”»å‡»ã€‚æ‰€è°“çš„æ³›æ´ªæ”»å‡»ï¼Œæ˜¯æŒ‡å‘é€æ–¹ä¼ªé€ å¤šä¸ª IP åœ°å€ï¼Œæ¨¡æ‹Ÿä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ã€‚å½“æœåŠ¡å™¨è¿”å› ACK åï¼Œæ”»å‡»æ–¹æ•…æ„ä¸ç¡®è®¤ï¼Œä»è€Œä½¿å¾—æœåŠ¡å™¨ä¸æ–­é‡å‘ ACKã€‚ç”±äºæœåŠ¡å™¨é•¿æ—¶é—´å¤„äºåŠè¿æ¥çŠ¶æ€ï¼Œæœ€åæ¶ˆè€—è¿‡å¤šçš„ CPU å’Œå†…å­˜èµ„æºå¯¼è‡´æ­»æœºã€‚<br>æ­£ç¡®åšæ³•:æœåŠ¡ç«¯å‘é€RSTæŠ¥æ–‡, è¿›å…¥å…³é—­çŠ¶æ€, è¿™ä¸ªRSTæ•°æ®åŒ…çš„TCPé¦–éƒ¨ä¸­, æ§åˆ¶ä½ä¸­çš„RSTä½è¢«è®¾ç½®ä¸º1, è¡¨ç¤ºè¿æ¥ä¿¡æ¯å…¨éƒ¨è¢«åˆå§‹åŒ–, åŸæœ‰çš„TCPé€šä¿¡ä¸èƒ½ç»§ç»­; å®¢æˆ·ç«¯å¦‚æœè¿˜æƒ³é‡æ–°å»ºç«‹TCPè¿æ¥, å°±å¿…é¡»é‡æ–°å¼€å§‹ç¬¬ä¸€æ¬¡æ¡æ‰‹ã€‚</p>
<h5 id="å…³é—­è¿æ¥çš„æœ€åä¸€ä¸ªACKä¸¢å¤±"><a href="#å…³é—­è¿æ¥çš„æœ€åä¸€ä¸ªACKä¸¢å¤±" class="headerlink" title="å…³é—­è¿æ¥çš„æœ€åä¸€ä¸ªACKä¸¢å¤±"></a>å…³é—­è¿æ¥çš„æœ€åä¸€ä¸ªACKä¸¢å¤±</h5><p>å®é™…ä¸Šï¼Œåœ¨ç¬¬ä¸‰æ­¥ä¸­ï¼Œå®¢æˆ·ç«¯æ”¶åˆ° FIN åŒ…æ—¶ï¼Œå®ƒä¼šè®¾ç½®ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œç­‰å¾…ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´ã€‚å¦‚æœå®¢æˆ·ç«¯è¿”å›çš„ ACK ä¸¢å¤±ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯è¿˜ä¼šé‡å‘ FIN å¹¶é‡ç½®è®¡æ—¶å™¨ã€‚å‡è®¾åœ¨è®¡æ—¶å™¨å¤±æ•ˆå‰æœåŠ¡å™¨é‡å‘çš„ FIN åŒ…æ²¡æœ‰åˆ°è¾¾å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°±ä¼šè¿›å…¥ CLOSE çŠ¶æ€ï¼Œä»è€Œå¯¼è‡´æœåŠ¡ç«¯æ°¸è¿œæ— æ³•æ”¶åˆ° ACK ç¡®è®¤ï¼Œä¹Ÿå°±æ— æ³•å…³é—­è¿æ¥ã€‚</p>
<blockquote>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1ficgjn9z94j30s40mu76w.jpg" alt=""></p>
</blockquote>
<h5 id="TCPä¸UDPçš„åŒºåˆ«"><a href="#TCPä¸UDPçš„åŒºåˆ«" class="headerlink" title="TCPä¸UDPçš„åŒºåˆ«"></a>TCPä¸UDPçš„åŒºåˆ«</h5><p>TCPæ˜¯é¢å‘è¿æ¥çš„ã€å¯é çš„æµåè®®, åœ¨ä½¿ç”¨TCPåè®®ä¼ è¾“æ•°æ®ä¹‹å‰éœ€è¦ç¡®è®¤å‘é€æ–¹å’Œæ¥æ”¶æ–¹çš„è¿æ¥æ˜¯å»ºç«‹çš„, å»ºç«‹è¿æ¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹, å…³é—­è¿æ¥éœ€è¦å››æ¬¡æŒ¥æ‰‹ã€‚æµå°±æ˜¯æŒ‡ä¸é—´æ–­çš„æ•°æ®ç»“æ„ã€‚TCPä¸ºæä¾›å¯é æ€§ä¼ è¾“, å®è¡Œâ€é¡ºåºæ§åˆ¶â€æˆ–â€é‡å‘æ§åˆ¶â€æœºåˆ¶;è¿˜å…·å¤‡â€æµé‡æ§åˆ¶â€, â€œæ‹¥å¡æ§åˆ¶â€, æé«˜ç½‘ç»œåˆ©ç”¨ç‡ç­‰ä¼—å¤šåŠŸèƒ½ã€‚</p>
<p>UDPæ˜¯ä¸å…·æœ‰å¯é æ€§çš„æ•°æ®æŠ¥åè®®ã€‚UDPå¯ä»¥ç¡®ä¿å‘é€æ¶ˆæ¯çš„å¤§å°, ä¸èƒ½ä¿è¯æ¶ˆæ¯çš„æ˜¯å¦ä¼šåˆ°è¾¾ç›®æ ‡ä¸»æœºã€‚å› æ­¤, éœ€è¦åœ¨åº”ç”¨è‡ªè¡Œæ§åˆ¶é‡å‘ç­‰æœºåˆ¶ã€‚</p>
<p>TCPç”¨äºåœ¨ä¼ è¾“å±‚æœ‰éœ€è¦å®ç°å¯é ä¼ è¾“çš„æƒ…å†µã€‚ç”±äºå®ƒæ˜¯é¢å‘æœ‰è¿æ¥å¹¶ä¸”å…·å¤‡é¡ºåºæ§åˆ¶ã€é‡å‘æ§åˆ¶ç­‰æœºåˆ¶çš„, æ‰€ä»¥å®ƒå¯ä»¥ä¸ºåº”ç”¨æä¾›å¯é çš„ä¼ è¾“, ç”±æ­¤å†³å®šäº†TCPéœ€è¦åˆ¶å®šå¾ˆå¤šå¤æ‚çš„è§„èŒƒ, æ‰€ä»¥ä¼ è¾“æ•ˆç‡ä¸å¦‚UDPåè®®, ä¸é€‚åˆå®æ—¶çš„éŸ³è§†é¢‘ä¼ è¾“ã€‚åœ¨å¦ä¸€æ–¹é¢, UDPä¸»è¦ç”¨äºé‚£äº›å¯¹é«˜é€Ÿä¼ è¾“å’Œå®æ—¶æ€§æœ‰è¾ƒé«˜è¦æ±‚çš„é€šä¿¡æˆ–å¹¿æ’­é€šä¿¡ã€‚</p>
<p>å‚è€ƒ:</p>
<ul>
<li><a href="http://www.jianshu.com/nb/3276500" target="_blank" rel="external">http://www.jianshu.com/nb/3276500</a></li>
<li><a href="">å›¾è§£TCP/IP</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ç½‘ç»œ/">ç½‘ç»œ</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">weiter &raquo;</a>
  </nav>

</section>
        
      </div>
      
        <div align="center" style="margin-top: 30px;"><hr class="hr" style="margin:0px; height:3px;"></div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2014 - 2017 Simonã®å°ğŸ“šåŠ All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				UV : <span id="busuanzi_value_site_uv"></span> |  
				PV : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>


  <script src="/js/home.js"></script>










	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">è®¾ç½®</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              æ­£æ–‡å­—å·å¤§å°
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            æ‚¨å·²è°ƒæ•´é¡µé¢å­—ä½“å¤§å°
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              å¤œé—´æŠ¤çœ¼æ¨¡å¼
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            å¤œé—´æ¨¡å¼å·²ç»å¼€å¯ï¼Œå†æ¬¡å•å‡»æŒ‰é’®å³å¯å…³é—­ 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å…³ äº&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            Simonã®å°ğŸ“šåŠ
          </div>
          <div class="panel-body">
            Copyright Â© 2017 Mr.Simon All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
</body>
</html>